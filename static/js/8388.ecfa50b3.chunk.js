"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[8388],{18388:(e,s,a)=>{a.r(s),a.d(s,{default:()=>B});var t=a(85580),i=a(72791),l=a(70032),o=a(29479),r=a(26834);function n(e,s,a,t,i,l,o){var n,c;0===i&&o.map.basemap.baseLayers.removeAll();const u=null===s||void 0===s||null===(n=s.detail)||void 0===n||null===(c=n.selectedItems[0])||void 0===c?void 0:c.value;if(u){const s=a.find((e=>e.id===u));null===s||void 0===s||s.load().then((s=>{if("Web Map"===s.type){new r.Z({portalItem:{id:s.id}}).loadAll().then((s=>{setTimeout((()=>{null===s||void 0===s||s.basemap.baseLayers.forEach((e=>{0===i&&(e.blendMode="multiply"),t.baseLayers.add(e,0)})),t.baseLayers.addMany(t.baseLayers,0),l(e),"opacity"===e&&(o.map.basemap=t)}))}))}}))}}var c=a(80184);function u(e){var s,a,r;const[u,d]=(0,i.useState)(),m=(0,i.useRef)(!1),[p,v]=(0,i.useState)("basemap"),[b,y]=(0,i.useState)([]),[h,f]=(0,i.useState)([]),g=(0,i.useRef)(new o.default({baseLayers:[]}));return(0,i.useEffect)((()=>{if(d(e.view),!m.current){const s=new l.Z;s.queryGroups({query:`id: ${e.mapGroup}`}).then((e=>{e.results[0].queryItems({query:"*"}).then((e=>{y(e.results)}))})),s.queryGroups({query:`id: ${e.imageGroup}`}).then((e=>{e.results[0].queryItems({query:"*"}).then((e=>{f(e.results)}))}))}}),[e.view,e.mapGroup,e.imageGroup]),(0,c.jsx)("div",{className:"blend",children:(0,c.jsxs)(t.Gq,{layout:"vertical",children:[(0,c.jsx)(t.cl,{active:"basemap"===p||void 0,itemTitle:"Basemap",description:"Select basemap layer",onClick:()=>v("basemap"),children:(0,c.jsx)(t.Y,{label:"Basemaps",selectionMode:"single",scale:"l",onCalciteComboboxChange:e=>n("images",e,b,g.current,0,v,u),children:b.map((e=>(0,c.jsx)(t.tp,{title:e.title,textLabel:e.title,value:e.id},e.id)))})}),(0,c.jsx)(t.cl,{active:"images"===p||void 0,itemTitle:"Image",description:"Select imagery layer",onClick:()=>v("images"),children:(0,c.jsx)(t.Y,{label:"Images",selectionMode:"single",scale:"l",onCalciteComboboxChange:e=>n("opacity",e,h,g.current,1,v,u),children:h.sort(((e,s)=>e.title>s.title?-1:1)).map((e=>(0,c.jsx)(t.tp,{title:e.title,textLabel:e.title,value:e.id},e.id)))})}),(0,c.jsx)(t.cl,{active:"opacity"===p||void 0,itemTitle:"Opacity",description:"Set opacity",onClick:()=>v("opacity"),children:(0,c.jsx)(t.XQ,{max:1,min:0,step:.1,value:null===(s=g.current)||void 0===s||null===(a=s.baseLayers)||void 0===a||null===(r=a.getItemAt(g.current.baseLayers.length-1))||void 0===r?void 0:r.opacity,maxLabel:"Opaque",minLabel:"Transparent",onCalciteSliderInput:e=>{u&&(u.map.basemap.baseLayers.getItemAt(0).opacity=e.target.value)}})})]})})}const d=i.memo(u);var m=a(2170),p=a(6934),v=a(97862),b=a(76200),y=a(80885),h=a(51995),f=a(94172);let g,x,j,w;const L=e=>m.intersects(e,x),C=e=>!!j||e.portalItem.tags.includes("countywide"),I=e=>new Promise(((e,s)=>{(0,b.default)("https://maps.raleighnc.gov/images/rest/services/Orthos2020/ImageServer/queryBoundary?outSR=102100&f=json",{responseType:"json"}).then((s=>{x=y.Z.fromJSON(s.data.shape),e(x)}))})),S=(e,s,a)=>{x&&g.source.basemaps.find((e=>g.activeBasemap.title===e.title))&&(w=j,j=L(s.extent),w!==j&&(g.source.refresh(),setTimeout((()=>{const e=g.source.basemaps.find((e=>s.map.basemap.title===e.title));if(e)g.activeBasemap=e;else{const e=g.activeBasemap.title;g.activeBasemap=g.source.basemaps.at(0);const s=g.activeBasemap.title;a({show:!0,from:e,to:s})}}),1e3)))},q=(e,s)=>new Promise(((a,t)=>{if(e.baseLayers.length){const t=e.baseLayers.find((e=>"vector-tile"===e.type));"vector-tile"===(null===t||void 0===t?void 0:t.type)?f.N1((()=>t.loaded)).then((e=>{const i=t.getStyleLayer("background");if(i){const e=new h.Z(i.paint["background-color"]);s.background={color:e},a(e.isBright)}else a(!0)})):t||"imagery"!==e.baseLayers.getItemAt(0).type?a(!0):a(!1)}})),A=(e,s)=>{const a=e.map.allLayers.find((e=>e.title.includes("Property")&&"feature"===e.type));if(a){const e=(null===a||void 0===a?void 0:a.renderer).clone();s?(e.symbol.outline.color.r=0,e.symbol.outline.color.g=0,e.symbol.outline.color.b=0):(e.symbol.outline.color.r=255,e.symbol.outline.color.g=255,e.symbol.outline.color.b=255),a.renderer=e}};function k(e){const[s,a]=(0,i.useState)(),[l,o]=(0,i.useState)({show:!1,from:"",to:""}),[r,n]=(0,i.useState)(!1),u=(0,i.useRef)(!1),m=(0,i.useRef)(null),b=(0,i.useRef)(null),y=(0,i.useRef)(null),h="f6329364e80c438a958ce74aadc3a89f",f="492386759d264d49948bf7f83957ddb9";(0,i.useEffect)((()=>{a(e.view),u.current||(u.current=!0,function(e,s,a){new p.Z({container:s,view:e,source:{query:`id: ${a}`}})}(e.view,m.current,h),function(e,s,a,t){g=new p.Z({container:s,view:e,source:new v.Z({query:`id: ${a}`,filterFunction:C,updateBasemapsCallback:e=>e.reverse()})}),g.when((()=>{g.source.basemaps.reverse(),x||I(e).then((s=>{x=s,j=L(e.extent),g.source.refresh()})),e.watch("extent",(s=>S(s,e,t)))})),e.map.watch("basemap",(s=>{q(s,e).then((s=>{A(e,s)}))}))}(e.view,b.current,f,o),function(e,s){new p.Z({container:s,view:e})}(e.view,y.current))}),[e.view]),(0,i.useEffect)((()=>{n(e.isActive)}),[e.isActive]);const w=(0,i.useCallback)((s=>{e.panelDismissed()}),[]);return(0,c.jsx)(t.N$,{id:"basemaps-panel",heading:"Basemaps",hidden:!r,closed:!r||void 0,dismissed:!r||void 0,dismissible:!0,onCalcitePanelDismiss:w,children:(0,c.jsxs)("div",{className:"basemaps",children:[(0,c.jsxs)(t.A3,{position:"below",layout:"center",scale:"m",children:[(0,c.jsxs)(t.yj,{slot:"tab-nav",children:[(0,c.jsx)(t.A7,{children:"Maps"}),(0,c.jsx)(t.A7,{children:"Images"}),(0,c.jsx)(t.A7,{children:"Esri"}),(0,c.jsx)(t.A7,{children:"Blend"})]}),(0,c.jsx)(t.Qi,{children:(0,c.jsx)("div",{ref:m})}),(0,c.jsx)(t.Qi,{children:(0,c.jsx)("div",{ref:b})}),(0,c.jsx)(t.Qi,{children:(0,c.jsx)("div",{ref:y})}),(0,c.jsx)(t.Qi,{children:(0,c.jsx)(d,{view:s,mapGroup:h,imageGroup:f})})]}),(0,c.jsxs)(t.Uh,{active:!0===l.show||void 0,autoDismiss:!0,autoDismissDuration:"medium",color:"yellow",label:"Imagery Year Changed",children:[(0,c.jsx)("div",{slot:"title",children:"Imagery Not Available"}),(0,c.jsx)("div",{slot:"message",children:`Imagery for ${l.from} only available inside Raleigh, base map has changed to ${l.to}`})]})]})})}const B=i.memo(k)}}]);
//# sourceMappingURL=8388.ecfa50b3.chunk.js.map