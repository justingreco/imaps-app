"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[2137],{36700:(e,t,n)=>{n.d(t,{x:()=>r});var o=n(95122),i=n(75691),a=n(61309);class r extends i.a{constructor(e){super({...e,constraint:new o.Hk(e.coordinateHelper,e.targetPoint)})}get hints(){return[new a.n(this.targetPoint,this.elevationInfo,this.domain)]}}},26823:(e,t,n)=>{n.r(t),n.d(t,{FeatureCollectionSnappingSource:()=>f});var o=n(27366),i=n(85015),a=n(92026),r=n(66978),s=n(94172),c=n(49861),l=(n(63780),n(25243),n(69912)),p=n(74509),u=n(64674),d=n(28426),h=n(59877),g=n(53580),y=n(48817);let f=class extends i.Z{constructor(e){super(e),this.view=null,this._layerView3D=null}get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,n=(0,a.pC)(e)&&"3d"===e.type;if(!n||"subtype-group"===t.type)return(0,h.p)();return(0,h.p)(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(n,o)=>(await(0,r.Hl)(e.whenLayerView(t),o)).elevationAlignPointsInFeatures(n,o),spatialReference:e.spatialReference})}get _snappingElevationFilter(){const{view:e}=this,t=(0,a.pC)(e)&&"3d"===e.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.c)(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return(0,a.pC)(e)&&"3d"===e.type&&"subtype-group"!==t.type?(0,y.k)(this._symbologySnappingSupported,(async(n,o)=>{const i=await e.whenLayerView(t);return(0,r.k_)(o),i.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},o)})):(0,y.k)()}get _symbologySnappingSupported(){return(0,a.pC)(this._layerView3D)&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;(0,a.pC)(e)&&"3d"===e.type&&"subtype-group"!==t.type&&(e.whenLayerView(t).then((e=>this._layerView3D=e)),this.addHandles([e.elevationProvider.on("elevation-change",(e=>{let{context:n}=e;const{elevationInfo:o}=t;(0,p.W_)(n,o)&&this._snappingElevationAligner.notifyElevationSourceChange()})),(0,s.YP)((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),s.nn),(0,s.YP)((()=>(0,a.pC)(this._layerView3D)?this._layerView3D.processor?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),s.nn)]))}refresh(){}async fetchCandidates(e,t){const{layer:n}=this.layerSource,{coordinateHelper:o,elevationInfo:i}=e,a=n.source;if(!a.querySnapping)return[];const s=(0,u.ML)(n),c=(0,u.rh)(e,s),l=await a.querySnapping(c,{signal:t});(0,r.k_)(t);const h=await this._snappingElevationAligner.alignCandidates(l.candidates,t);(0,r.k_)(t);const g=await this._symbologySnappingFetcher.fetch(h,t);(0,r.k_)(t);const y=0===g.length?h:[...h,...g],f=this._snappingElevationFilter.filter(c,y),_=o.hasZ()?p.jG:i,v=this._getGroundElevation;return f.map((e=>(0,d.X)(e,o,_,v)))}get _getGroundElevation(){return(0,d.g)(this.view)}};(0,o._)([(0,c.Cb)({constructOnly:!0})],f.prototype,"layerSource",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0})],f.prototype,"view",void 0),(0,o._)([(0,c.Cb)()],f.prototype,"_snappingElevationAligner",null),(0,o._)([(0,c.Cb)()],f.prototype,"_snappingElevationFilter",null),(0,o._)([(0,c.Cb)()],f.prototype,"_symbologySnappingFetcher",null),(0,o._)([(0,c.Cb)()],f.prototype,"_layerView3D",void 0),(0,o._)([(0,c.Cb)()],f.prototype,"_symbologySnappingSupported",null),(0,o._)([(0,c.Cb)()],f.prototype,"_getGroundElevation",null),f=(0,o._)([(0,l.j)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],f)},28426:(e,t,n)=>{n.d(t,{X:()=>u,g:()=>d});var o=n(92026),i=n(95122),a=n(64674),r=n(75691),s=n(53397);class c extends r.a{constructor(e){super({...e,constraint:new i.M8(e.coordinateHelper,e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new s.w(a.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}}var l=n(95905),p=n(36700);function u(e,t,n,o){switch(e.type){case"edge":return e.draped?new c({coordinateHelper:t,edgeStart:t.pointToVector(e.start),edgeEnd:t.pointToVector(e.end),targetPoint:t.pointToVector(e.target),objectId:e.objectId,getGroundElevation:o,elevationInfo:n}):new l.L({coordinateHelper:t,edgeStart:t.pointToVector(e.start),edgeEnd:t.pointToVector(e.end),targetPoint:t.pointToVector(e.target),objectId:e.objectId,elevationInfo:n});case"vertex":return new p.x({coordinateHelper:t,targetPoint:t.pointToVector(e.target),objectId:e.objectId,elevationInfo:n})}}function d(e){return(0,o.pC)(e)&&"3d"===e.type?(t,n,o)=>e.elevationProvider.getElevation(t,n,o,e.spatialReference,"ground"):()=>null}},59877:(e,t,n)=>{n.d(t,{p:()=>l});n(93169);var o=n(16054),i=n(77427),a=n(92026),r=n(66978),s=n(68860),c=n(88152);function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(e){const{elevationInfo:e,alignPointsInFeatures:n,spatialReference:o}=t;return new u(e,n,o)}return new p}class p{async alignCandidates(e,t){return e}notifyElevationSourceChange(){}}class u{constructor(e,t,n){this._elevationInfo=e,this._alignPointsInFeatures=t,this.spatialReference=n,this._alignmentsCache=new o.Z(1024),this._cacheVersion=0,this._metersPerVerticalUnit=(0,s._R)(n)}async alignCandidates(e,t){const n=this._elevationInfo;return(0,a.pC)(n)&&"absolute-height"===n.mode&&!n.featureExpressionInfo?(this._alignAbsoluteElevationCandidates(e,n),e):this._alignComputedElevationCandidates(e,t)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(e,t){const{offset:n,unit:o}=t;if((0,a.Wi)(n))return;const i=n*((0,c.Z7)(o??"meters")/this._metersPerVerticalUnit);for(const a of e)switch(a.type){case"edge":a.start.z+=i,a.end.z+=i;continue;case"vertex":a.target.z+=i;continue}}async _alignComputedElevationCandidates(e,t){const n=new Map;for(const r of e)(0,i.s1)(n,r.objectId,g).push(r);const[o,a,s]=this._prepareQuery(n),c=await this._alignPointsInFeatures(o,t);if((0,r.k_)(t),s!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t);this._applyCacheAndResponse(o,c,a);const{drapedObjectIds:l,failedObjectIds:p}=c,u=[];for(const i of e){const{objectId:e}=i;l.has(e)&&"edge"===i.type&&(i.draped=!0),p.has(e)||u.push(i)}return u}_prepareQuery(e){const t=[],n=[];for(const[o,i]of e){const e=[];for(const t of i)this._addToQueriesOrCachedResult(o,t.target,e,n),"edge"===t.type&&(this._addToQueriesOrCachedResult(o,t.start,e,n),this._addToQueriesOrCachedResult(o,t.end,e,n));0!==e.length&&t.push({objectId:o,points:e})}return[t,n,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,n,o){const i=h(e,t),r=this._alignmentsCache.get(i);(0,a.pC)(r)?o.push(new d(t,r)):n.push(t)}_applyCacheAndResponse(e,t,n){let{elevations:o,drapedObjectIds:i,failedObjectIds:a}=t;for(const c of n)c.apply();let r=0;const s=this._alignmentsCache;for(const{objectId:c,points:l}of e){if(a.has(c)){r+=l.length;continue}const e=!i.has(c);for(const t of l){const n=h(c,t),i=o[r++];t.z=i,e&&s.put(n,i,1)}}}}class d{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function h(e,t){let{x:n,y:o,z:i}=t;return`${e}-${n}-${o}-${i??0}}`}function g(){return[]}},53580:(e,t,n)=>{n.d(t,{c:()=>r});n(93169);class o{filter(e,t){return t}notifyElevationSourceChange(){}}class i{filter(e,t){const{point:n,distance:o}=e,{z:i}=n;if(null==i)return t;if(0===t.length)return t;const r=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(o),s=this._updateCandidatesTo3D(t,n,r).filter(a);return s.sort(l),s}_updateCandidatesTo3D(e,t,n){for(const o of e)switch(o.type){case"edge":s(o,t,n);continue;case"vertex":c(o,t,n);continue}return e}}function a(e){return e.distance<=1}function r(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?new i:new o}function s(e,t,n){let{x:o,y:i,z:a}=n;const{start:r,end:s,target:c}=e;e.draped||function(e,t,n,o){const i=o.x-n.x,a=o.y-n.y,r=o.z-n.z,s=i*i+a*a+r*r,c=(t.x-n.x)*i+(t.y-n.y)*a+r*(t.z-n.z),l=Math.min(1,Math.max(0,c/s)),p=n.x+i*l,u=n.y+a*l,d=n.z+r*l;e.x=p,e.y=u,e.z=d}(c,t,r,s);const l=(t.x-c.x)/o,p=(t.y-c.y)/i,u=(t.z-c.z)/a;e.distance=Math.sqrt(l*l+p*p+u*u)}function c(e,t,n){let{x:o,y:i,z:a}=n;const{target:r}=e,s=(t.x-r.x)/o,c=(t.y-r.y)/i,l=(t.z-r.z)/a,p=Math.sqrt(s*s+c*c+l*l);e.distance=p}function l(e,t){return e.distance-t.distance}},48817:(e,t,n)=>{n.d(t,{k:()=>s});n(93169);var o=n(84652),i=n(16054),a=n(66978),r=n(643);function s(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return e?new l(t):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}class l{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new i.Z(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const n=[],i=[],r=this._candidatesCache;for(const a of e){const e=p(a),t=r.get(e);if(t)for(const n of t)i.push((0,o.d9)(n));else n.push(a),r.put(e,[],1)}if(0===n.length)return i;const s=this._cacheVersion,{candidates:c,sourceCandidateIndices:l}=await this._getSymbologyCandidates(n,t);if((0,a.k_)(t),s!==this._cacheVersion)return this.fetch(e,t);const u=[],{length:d}=c;for(let a=0;a<d;++a){const e=c[a],t=p(n[l[a]]),i=r.get(t);i.push(e),r.put(t,i,i.length),u.push((0,o.d9)(e))}return i.concat(u)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function p(e){switch(e.type){case"vertex":{const{objectId:t,target:n}=e,o=`${t}-vertex-${n.x}-${n.y}-${n.z??0}`;return(0,r.hP)(o).toString()}case"edge":{const{objectId:t,start:n,end:o}=e,i=`${t}-edge-${n.x}-${n.y}-${n.z??0}-to-${o.x}-${o.y}-${o.z??0}`;return(0,r.hP)(i).toString()}default:return""}}},61309:(e,t,n)=>{n.d(t,{n:()=>a});var o=n(64674),i=n(55054);class a extends i.r{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof a&&(0,o.Xv)(this.point,e.point)}}}}]);
//# sourceMappingURL=2137.2436fa7b.chunk.js.map