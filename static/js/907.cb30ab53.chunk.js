"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[907],{20907:(e,a,t)=>{t.r(a),t.d(a,{default:()=>I});t(81325),t(47760),t(57766),t(86899),t(18936);var s=t(85580),i=t(72791),l=(t(74037),t(29134),t(78159),t(45946),t(21775),t(70032)),r=t(29479),n=t(26834);function o(e,a,t,s,i,l,r){var o,c;0===i&&r.map.basemap.baseLayers.removeAll();const u=null===a||void 0===a||null===(o=a.detail)||void 0===o||null===(c=o.selectedItems[0])||void 0===c?void 0:c.value;if(u){const a=t.find((e=>e.id===u));null===a||void 0===a||a.load().then((a=>{if("Web Map"===a.type){new n.Z({portalItem:{id:a.id}}).loadAll().then((a=>{setTimeout((()=>{null===a||void 0===a||a.basemap.baseLayers.forEach((e=>{0===i&&(e.blendMode="multiply"),s.baseLayers.add(e,0)})),s.baseLayers.addMany(s.baseLayers,0),l(e),"opacity"===e&&(r.map.basemap=s)}))}))}}))}}var c=t(80184);const u=function(e){var a,t,n;const[u,d]=(0,i.useState)(),m=(0,i.useRef)(!1),[p,v]=(0,i.useState)("basemap"),[h,b]=(0,i.useState)([]),[y,f]=(0,i.useState)([]),x=(0,i.useRef)(new r.default({baseLayers:[]}));return(0,i.useEffect)((()=>{if(d(e.view),!m.current){const a=new l.Z;a.queryGroups({query:`id: ${e.mapGroup}`}).then((e=>{e.results[0].queryItems({query:"*"}).then((e=>{b(e.results)}))})),a.queryGroups({query:`id: ${e.imageGroup}`}).then((e=>{e.results[0].queryItems({query:"*"}).then((e=>{f(e.results)}))}))}}),[e.view,e.mapGroup,e.imageGroup]),(0,c.jsx)("div",{className:"blend",children:(0,c.jsxs)(s.Gq,{layout:"vertical",children:[(0,c.jsx)(s.cl,{active:"basemap"===p||void 0,itemTitle:"Basemap",description:"Select basemap layer",onClick:()=>v("basemap"),children:(0,c.jsx)(s.Y,{label:"Basemaps",selectionMode:"single",onCalciteComboboxChange:e=>o("images",e,h,x.current,0,v,u),children:h.map((e=>(0,c.jsx)(s.tp,{title:e.title,textLabel:e.title,value:e.id},e.id)))})}),(0,c.jsx)(s.cl,{active:"images"===p||void 0,itemTitle:"Image",description:"Select imagery layer",onClick:()=>v("images"),children:(0,c.jsx)(s.Y,{label:"Images",selectionMode:"single",onCalciteComboboxChange:e=>o("opacity",e,y,x.current,1,v,u),children:y.sort(((e,a)=>e.title>a.title?-1:1)).map((e=>(0,c.jsx)(s.tp,{title:e.title,textLabel:e.title,value:e.id},e.id)))})}),(0,c.jsx)(s.cl,{active:"opacity"===p||void 0,itemTitle:"Opacity",description:"Set opacity",onClick:()=>v("opacity"),children:(0,c.jsx)(s.XQ,{max:1,min:0,step:.1,value:null===(a=x.current)||void 0===a||null===(t=a.baseLayers)||void 0===t||null===(n=t.getItemAt(x.current.baseLayers.length-1))||void 0===n?void 0:n.opacity,maxLabel:"Opaque",minLabel:"Transparent",onCalciteSliderInput:e=>{u&&(u.map.basemap.baseLayers.getItemAt(0).opacity=e.target.value)}})})]})})};var d=t(2170),m=t(6934),p=t(97862),v=t(76200),h=t(80885);let b,y,f,x;const g=e=>d.intersects(e,y);let j=0;const w=e=>!!f||e.portalItem.tags.includes("countywide"),C=e=>new Promise(((e,a)=>{(0,v.default)("https://maps.raleighnc.gov/images/rest/services/Orthos2020/ImageServer/queryBoundary?outSR=102100&f=json",{responseType:"json"}).then((a=>{y=h.Z.fromJSON(a.data.shape),e(y)}))}));const I=function(e){const[a,t]=(0,i.useState)(),[l,r]=(0,i.useState)({show:!1,from:"",to:""}),n=(0,i.useRef)(!1),o=(0,i.useRef)(null),d=(0,i.useRef)(null),v=(0,i.useRef)(null),h="f6329364e80c438a958ce74aadc3a89f",I="492386759d264d49948bf7f83957ddb9";return(0,i.useEffect)((()=>{t(e.view),n.current||(n.current=!0,function(e,a,t){new m.Z({container:a,view:e,source:{query:`id: ${t}`}})}(e.view,o.current,h),function(e,a,t,s){b=new m.Z({container:a,view:e,source:new p.Z({query:`id: ${t}`,filterFunction:w,updateBasemapsCallback:e=>e.reverse()})}),b.when((()=>{b.source.basemaps.reverse(),y||C(e).then((a=>{y=a,f=g(e.extent),b.source.refresh()})),e.watch("extent",(a=>{y&&b.source.basemaps.find((e=>b.activeBasemap.title===e.title))&&(x=f,f=g(e.extent),x!==f&&(b.source.refresh(),setTimeout((()=>{const a=b.source.basemaps.find((a=>e.map.basemap.title===a.title));if(a)b.activeBasemap=a;else{const e=b.activeBasemap.title;b.activeBasemap=b.source.basemaps.at(0);const a=b.activeBasemap.title;s({show:!0,from:e,to:a})}}),1e3)))}))}))}(e.view,d.current,I,r),function(e,a){new m.Z({container:a,view:e})}(e.view,v.current))}),[e.view]),(0,c.jsxs)("div",{className:"basemaps",children:[(0,c.jsxs)(s.A3,{position:"below",layout:"center",scale:"m",children:[(0,c.jsxs)(s.yj,{onCalciteTabChange:e=>((e,a,t)=>{j=e.detail.tab})(e),slot:"tab-nav",children:[(0,c.jsx)(s.A7,{children:"Maps"}),(0,c.jsx)(s.A7,{children:"Images"}),(0,c.jsx)(s.A7,{children:"Esri"}),(0,c.jsx)(s.A7,{children:"Blend"})]}),(0,c.jsx)(s.Qi,{children:(0,c.jsx)("div",{ref:o})}),(0,c.jsx)(s.Qi,{children:(0,c.jsx)("div",{ref:d})}),(0,c.jsx)(s.Qi,{children:(0,c.jsx)("div",{ref:v})}),(0,c.jsx)(s.Qi,{children:(0,c.jsx)(u,{view:a,mapGroup:h,imageGroup:I})})]}),(0,c.jsxs)(s.Uh,{active:!0===l.show||void 0,autoDismiss:!0,autoDismissDuration:"medium",color:"yellow",label:"Imagery Year Changed",children:[(0,c.jsx)("div",{slot:"title",children:"Imagery Not Available"}),(0,c.jsx)("div",{slot:"message",children:`Imagery for ${l.from} only available inside Raleigh, base map has changed to ${l.to}`})]})]})}}}]);
//# sourceMappingURL=907.cb30ab53.chunk.js.map