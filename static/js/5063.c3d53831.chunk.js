"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[5063],{61863:(t,e,r)=>{r.d(e,{T:()=>c,a:()=>u,b:()=>h});var i=r(67077),n=r(74321),s=r(95276),o=r(98634),a=r(64201),l=r(19253);class c extends o.K{constructor(){super(...arguments),this.color=(0,i.f)(1,1,1,1)}}function h(){const t=new a.kG;return t.include(n.k),t.fragment.uniforms.add([new l.A("tex",(t=>t.texture)),new s.N("uColor",(t=>t.color))]),t.fragment.code.add(o.H`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),t}const u=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:c,build:h},Symbol.toStringTag,{value:"Module"}))},8229:(t,e,r)=>{function i(){return new Float32Array(3)}function n(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function s(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function o(){return i()}function a(){return s(1,1,1)}function l(){return s(1,0,0)}function c(){return s(0,1,0)}function h(){return s(0,0,1)}r.d(e,{b:()=>n,c:()=>i,f:()=>s});const u=o(),d=a(),f=l(),_=c(),p=h();Object.freeze(Object.defineProperty({__proto__:null,create:i,clone:n,fromValues:s,createView:function(t,e){return new Float32Array(t,e,3)},zeros:o,ones:a,unitX:l,unitY:c,unitZ:h,ZEROS:u,ONES:d,UNIT_X:f,UNIT_Y:_,UNIT_Z:p},Symbol.toStringTag,{value:"Module"}))},48734:(t,e,r)=>{function i(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function n(t){switch(t){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function s(t){switch(t){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function o(t){switch(t){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}r.d(e,{B3:()=>n,Op:()=>o,U:()=>s,n1:()=>i})},85981:(t,e,r)=>{r.d(e,{AR:()=>g,Gr:()=>m,JG:()=>c,Jk:()=>d,KU:()=>_,Ue:()=>l,al:()=>h,ct:()=>p,nF:()=>f,zk:()=>u});var i=r(16889),n=r(21530),s=r(11186),o=r(71353),a=r(11185);function l(t){return t?{origin:(0,o.a)(t.origin),vector:(0,o.a)(t.vector)}:{origin:(0,o.c)(),vector:(0,o.c)()}}function c(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l();return h(t.origin,t.vector,e)}function h(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,s.c)(r.origin,t),(0,s.c)(r.vector,e),r}function u(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,s.c)(r.origin,t),(0,s.b)(r.vector,e,t),r}function d(t,e){const r=(0,s.b)(a.WM.get(),e,t.origin),n=(0,s.e)(t.vector,r),o=(0,s.e)(t.vector,t.vector),l=(0,i.uZ)(n/o,0,1),c=(0,s.b)(a.WM.get(),(0,s.g)(a.WM.get(),t.vector,l),r);return(0,s.e)(c,c)}function f(t,e,r){return p(t,e,0,1,r)}function _(t,e,r){return(0,s.a)(r,t.origin,(0,s.g)(r,t.vector,e))}function p(t,e,r,n,o){const{vector:l,origin:c}=t,h=(0,s.b)(a.WM.get(),e,c),u=(0,s.e)(l,h)/(0,s.p)(l);return(0,s.g)(o,l,(0,i.uZ)(u,r,n)),(0,s.a)(o,o,t.origin)}function m(t,e){if(v(t,function(t,e){const r=A.get();return r.origin=t,r.vector=e,r}(e.origin,e.direction),!1,T)){const{tA:e,pB:r,distance2:i}=T;if(e>=0&&e<=1)return i;if(e<0)return(0,s.d)(t.origin,r);if(e>1)return(0,s.d)((0,s.a)(a.WM.get(),t.origin,t.vector),r)}return null}function g(t,e,r){return!!v(t,e,!0,T)&&((0,s.c)(r,T.pA),!0)}function v(t,e,r,n){const o=1e-6,l=t.origin,c=(0,s.a)(a.WM.get(),l,t.vector),h=e.origin,u=(0,s.a)(a.WM.get(),h,e.vector),d=a.WM.get(),f=a.WM.get();if(d[0]=l[0]-h[0],d[1]=l[1]-h[1],d[2]=l[2]-h[2],f[0]=u[0]-h[0],f[1]=u[1]-h[1],f[2]=u[2]-h[2],Math.abs(f[0])<o&&Math.abs(f[1])<o&&Math.abs(f[2])<o)return!1;const _=a.WM.get();if(_[0]=c[0]-l[0],_[1]=c[1]-l[1],_[2]=c[2]-l[2],Math.abs(_[0])<o&&Math.abs(_[1])<o&&Math.abs(_[2])<o)return!1;const p=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],m=f[0]*_[0]+f[1]*_[1]+f[2]*_[2],g=d[0]*_[0]+d[1]*_[1]+d[2]*_[2],v=f[0]*f[0]+f[1]*f[1]+f[2]*f[2],T=(_[0]*_[0]+_[1]*_[1]+_[2]*_[2])*v-m*m;if(Math.abs(T)<o)return!1;let A=(p*m-g*v)/T,b=(p+m*A)/v;r&&(A=(0,i.uZ)(A,0,1),b=(0,i.uZ)(b,0,1));const x=a.WM.get(),E=a.WM.get();return x[0]=l[0]+A*_[0],x[1]=l[1]+A*_[1],x[2]=l[2]+A*_[2],E[0]=h[0]+b*f[0],E[1]=h[1]+b*f[1],E[2]=h[2]+b*f[2],n.tA=A,n.tB=b,n.pA=x,n.pB=E,n.distance2=(0,s.d)(x,E),!0}const T={tA:0,tB:0,pA:(0,o.c)(),pB:(0,o.c)(),distance2:0},A=new n.x((()=>l()))},74702:(t,e,r)=>{r.d(e,{bE:()=>c,wu:()=>l});var i=r(21530),n=r(11186),s=r(71353),o=r(85981);r(11185);function a(t){return t?{p0:(0,s.a)(t.p0),p1:(0,s.a)(t.p1),p2:(0,s.a)(t.p2)}:{p0:(0,s.c)(),p1:(0,s.c)(),p2:(0,s.c)()}}function l(t,e,r){const i=e[0]-t[0],n=e[1]-t[1],s=r[0]-t[0],o=r[1]-t[1];return.5*Math.abs(i*o-n*s)}function c(t,e,r){return(0,n.b)(h,e,t),(0,n.b)(u,r,t),(0,n.l)((0,n.f)(h,h,u))/2}new i.x(o.Ue),new i.x((()=>a()));const h=(0,s.c)(),u=(0,s.c)()},38330:(t,e,r)=>{r.d(e,{t:()=>n});var i=r(76200);async function n(t,e){const{data:r}=await(0,i.default)(t,{responseType:"image",...e});return r}},55158:(t,e,r)=>{r.d(e,{U$:()=>a});var i=r(25158),n=r(48734);class s{constructor(t,e){this.layout=t,this.buffer="number"==typeof e?new ArrayBuffer(e*t.stride):e;for(const r of t.fieldNames){const e=t.fields.get(r);this[r]=new e.constructor(this.buffer,e.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,e){const r=this[t];return r&&r.elementCount===e.ElementCount&&r.elementType===e.ElementType?r:null}slice(t,e){return new s(this.layout,this.buffer.slice(t*this.stride,e*this.stride))}copyFrom(t,e,r,i){const n=this.stride;if(n%4==0){const s=new Uint32Array(t.buffer,e*n,i*n/4);new Uint32Array(this.buffer,r*n,i*n/4).set(s)}else{const s=new Uint8Array(t.buffer,e*n,i*n);new Uint8Array(this.buffer,r*n,i*n).set(s)}}}class o{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,e){return this._appendField(t,i.Eu,e),this}vec2f64(t,e){return this._appendField(t,i.q6,e),this}vec3f(t,e){return this._appendField(t,i.ct,e),this}vec3f64(t,e){return this._appendField(t,i.fP,e),this}vec4f(t,e){return this._appendField(t,i.ek,e),this}vec4f64(t,e){return this._appendField(t,i.Cd,e),this}mat3f(t,e){return this._appendField(t,i.gK,e),this}mat3f64(t,e){return this._appendField(t,i.ey,e),this}mat4f(t,e){return this._appendField(t,i.bj,e),this}mat4f64(t,e){return this._appendField(t,i.O1,e),this}vec4u8(t,e){return this._appendField(t,i.mc,e),this}f32(t,e){return this._appendField(t,i.ly,e),this}f64(t,e){return this._appendField(t,i.oS,e),this}u8(t,e){return this._appendField(t,i.D_,e),this}u16(t,e){return this._appendField(t,i.av,e),this}i8(t,e){return this._appendField(t,i.Hz,e),this}vec2i8(t,e){return this._appendField(t,i.Vs,e),this}vec2i16(t,e){return this._appendField(t,i.or,e),this}vec2u8(t,e){return this._appendField(t,i.xA,e),this}vec4u16(t,e){return this._appendField(t,i.v6,e),this}u32(t,e){return this._appendField(t,i.Nu,e),this}_appendField(t,e,r){const i=e.ElementCount*(0,n.n1)(e.ElementType),s=this.stride;this.fields.set(t,{size:i,constructor:e,offset:s,optional:r}),this.stride+=i,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new s(this,t)}createView(t){return new s(this,t)}clone(){const t=new o;return t.stride=this.stride,t.fields=new Map,this.fields.forEach(((e,r)=>t.fields.set(r,e))),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function a(){return new o}},22357:(t,e,r)=>{r.d(e,{Lm:()=>a,Zu:()=>l,bA:()=>c,qj:()=>h});var i=r(37081),n=r(74058),s=r(82999),o=r(98634);function a(t){t.varyings.add("linearDepth","float")}function l(t){t.vertex.uniforms.add(new s.A("nearFar",((t,e)=>e.camera.nearFar)))}function c(t){t.vertex.code.add(o.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function h(t,e){const{vertex:r}=t;switch(e.output){case i.H.Color:if(e.receiveShadows)return a(t),void r.code.add(o.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case i.H.Depth:case i.H.Shadow:case i.H.ShadowHighlight:case i.H.ShadowExludeHighlight:return t.include(n.up,e),a(t),l(t),c(t),void r.code.add(o.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(o.H`void forwardLinearDepth() {}`)}},74321:(t,e,r)=>{r.d(e,{k:()=>s});var i=r(98634),n=r(4760);function s(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.attributes.add(n.T.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(i.H`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?i.H`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},37081:(t,e,r)=>{var i;r.d(e,{H:()=>i}),function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExludeHighlight=5]="ShadowExludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"}(i||(i={}))},33280:(t,e,r)=>{r.d(e,{f5:()=>h});var i=r(92026),n=r(14226),s=r(81949),o=r(11186),a=r(71353),l=r(86471),c=(r(49450),r(98634));function h(t,e){u(t,e,[new l.B("slicePlaneOrigin",((t,r)=>p(e,t,r))),new l.B("slicePlaneBasis1",((t,r)=>m(e,t,r,(0,i.Wg)(r.slicePlane)?.basis1))),new l.B("slicePlaneBasis2",((t,r)=>m(e,t,r,(0,i.Wg)(r.slicePlane)?.basis2)))])}function u(t,e,r){if(!e.hasSlicePlane){const r=c.H`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(r),void t.fragment.code.add(r)}t.extensions.add("GL_OES_standard_derivatives"),e.hasSliceInVertexProgram&&t.vertex.uniforms.add(r),t.fragment.uniforms.add(r);const i=c.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=c.H`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?c.H`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:c.H`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(s)}function d(t,e,r){return t.instancedDoublePrecision?(0,o.s)(g,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function f(t,e){return(0,i.pC)(t)?(0,o.b)(v,e.origin,t):e.origin}function _(t,e,r){return t.hasSliceTranslatedView?(0,i.pC)(e)?(0,n.v)(A,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function p(t,e,r){if((0,i.Wi)(r.slicePlane))return a.Z;const n=d(t,e,r),s=f(n,r.slicePlane),l=_(t,n,r);return(0,i.pC)(l)?(0,o.m)(v,s,l):s}function m(t,e,r,n){if((0,i.Wi)(n)||(0,i.Wi)(r.slicePlane))return a.Z;const s=d(t,e,r),l=f(s,r.slicePlane),c=_(t,s,r);return(0,i.pC)(c)?((0,o.a)(T,n,l),(0,o.m)(v,l,c),(0,o.m)(T,T,c),(0,o.b)(T,T,v)):n}const g=(0,a.c)(),v=(0,a.c)(),T=(0,a.c)(),A=(0,s.c)()},94951:(t,e,r)=>{r.d(e,{w:()=>s});var i=r(22357),n=r(98634);function s(t,e){if((0,i.bA)(t),e.hasModelTransformation)return t.vertex.code.add(n.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void t.vertex.code.add(n.H`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.vertex.code.add(n.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(n.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},14801:(t,e,r)=>{r.d(e,{R:()=>o});var i=r(37081),n=r(98634),s=r(4760);function o(t,e){const r=e.output===i.H.ObjectAndLayerIdColor,o=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),o?t.attributes.add(s.T.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):t.attributes.add(s.T.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(n.H`
     void forwardObjectAndLayerIdColor() {
      ${r?o?n.H`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:n.H`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:n.H``} }`),t.fragment.code.add(n.H`
      void outputObjectAndLayerIdColor() {
        ${r?n.H`gl_FragColor = objectAndLayerIdColorVarying;`:n.H``} }`)}},52276:(t,e,r)=>{r.d(e,{f:()=>s});var i=r(98634),n=r(4760);function s(t){t.attributes.add(n.T.POSITION,"vec3"),t.vertex.code.add(i.H`vec3 positionModel() { return position; }`)}},48655:(t,e,r)=>{r.d(e,{c:()=>s});var i=r(98634),n=r(4760);function s(t,e){e.hasVertexColors?(t.attributes.add(n.T.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(i.H`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(i.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(i.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},74058:(t,e,r)=>{r.d(e,{OU:()=>g,su:()=>m,up:()=>p});var i=r(11873),n=r(81949),s=r(8229),o=r(71353),a=r(52276),l=r(27254),c=r(86471),h=r(49450),u=r(98634),d=r(82644),f=r(35522),_=r(8654);function p(t,e){t.include(a.f);const r=t.vertex;r.include(l.$,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add([new h.J("transformWorldFromViewTH",(t=>t.transformWorldFromViewTH)),new h.J("transformWorldFromViewTL",(t=>t.transformWorldFromViewTL)),new f.c("transformViewFromCameraRelativeRS",(t=>t.transformViewFromCameraRelativeRS)),new _.g("transformProjFromView",(t=>t.transformProjFromView)),new d.j("transformWorldFromModelRS",(t=>t.transformWorldFromModelRS)),new c.B("transformWorldFromModelTH",(t=>t.transformWorldFromModelTH)),new c.B("transformWorldFromModelTL",(t=>t.transformWorldFromModelTL))]),r.code.add(u.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(u.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?u.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:u.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new h.J("transformWorldFromViewTL",(t=>t.transformWorldFromViewTL))),r.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class m extends u.K{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,o.c)(),this.transformWorldFromViewTL=(0,o.c)(),this.transformViewFromCameraRelativeRS=(0,i.c)(),this.transformProjFromView=(0,n.c)()}}class g extends u.K{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,i.c)(),this.transformWorldFromModelTH=(0,s.c)(),this.transformWorldFromModelTL=(0,s.c)()}}},16574:(t,e,r)=>{r.d(e,{F:()=>o});var i=r(37081),n=r(78980),s=r(98634);function o(t,e){switch(t.fragment.include(n.n),e.output){case i.H.Shadow:case i.H.ShadowHighlight:case i.H.ShadowExludeHighlight:t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(s.H`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case i.H.Depth:t.fragment.code.add(s.H`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}},137:(t,e,r)=>{r.d(e,{bA:()=>h});var i=r(67077),n=r(75993),s=r(98634),o=r(19253),a=r(97528);const l=(0,i.f)(1,1,0,1),c=(0,i.f)(1,0,1,1);function h(t,e){t.fragment.uniforms.add((0,o.J)("depthTex",((t,e)=>e.highlightDepthTexture),e.hasWebGL2Context?a.D.None:a.D.InvSize)),t.fragment.constants.add("occludedHighlightFlag","vec4",l).add("unoccludedHighlightFlag","vec4",c),t.fragment.code.add(s.H`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${(0,n.b6)(e,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}},21002:(t,e,r)=>{r.d(e,{S:()=>s});var i=r(78980),n=r(98634);function s(t){t.include(i.n),t.code.add(n.H`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},15226:(t,e,r)=>{r.d(e,{a:()=>l,l:()=>a});var i=r(21002),n=r(82999),s=r(98634),o=r(19253);function a(t,e){e.hasMultipassTerrain&&(t.fragment.include(i.S),t.fragment.uniforms.add(new o.A("terrainDepthTexture",((t,e)=>e.multipassTerrain.linearDepthTexture))),t.fragment.uniforms.add(new n.A("nearFar",((t,e)=>e.camera.nearFar))),t.fragment.uniforms.add(new n.A("inverseViewport",((t,e)=>e.inverseViewport))),t.fragment.code.add(s.H`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class l{constructor(){this.enabled=!1,this.cullAboveGround=!1}}},85586:(t,e,r)=>{r.d(e,{e:()=>n});var i=r(98634);function n(t){t.vertex.code.add(i.H`const float PI = 3.141592653589793;`),t.fragment.code.add(i.H`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},26461:(t,e,r)=>{r.d(e,{F:()=>i,b:()=>n});const i=.1,n=.001},96415:(t,e,r)=>{r.d(e,{G:()=>h,R:()=>d});var i=r(88396),n=r(6394),s=r(90045),o=r(67077),a=r(82999),l=r(95276),c=r(98634);function h(t){t.fragment.uniforms.add(new l.N("projInfo",((t,e)=>function(t){const e=t.camera.projectionMatrix;return 0===e[11]?(0,s.s)(u,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):(0,s.s)(u,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}(e)))),t.fragment.uniforms.add(new a.A("zScale",((t,e)=>d(e)))),t.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const u=(0,o.c)();function d(t){return 0===t.camera.projectionMatrix[11]?(0,i.s)(f,0,1):(0,i.s)(f,1,0)}const f=(0,n.a)()},116:(t,e,r)=>{r.d(e,{Y:()=>n});var i=r(98634);function n(t){t.code.add(i.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},27254:(t,e,r)=>{r.d(e,{$:()=>s,I:()=>o});var i=r(93169),n=r(98634);function s(t,e){let{code:r}=t;e.doublePrecisionRequiresObfuscation?r.add(n.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):r.add(n.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function o(t){return!!(0,i.Z)("force-double-precision-obfuscation")||t.driverTest.doublePrecisionRequiresObfuscation}},78980:(t,e,r)=>{r.d(e,{n:()=>n});var i=r(98634);function n(t){t.code.add(i.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},82552:(t,e,r)=>{r.d(e,{hY:()=>f,Sv:()=>_,_8:()=>g});var i=r(14226),n=r(92733),s=r(11186),o=r(71353),a=r(86471),l=r(49450),c=r(61809),h=r(99340);class u extends c.x{constructor(t,e){super(t,"mat4",h.P.Draw,((r,i,n)=>r.setUniformMatrix4fv(t,e(i,n))))}}var d=r(8654);function f(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",o.Z):t.uniforms.add(new a.B("cameraPosition",((t,e)=>(0,s.s)(m,e.camera.viewInverseTransposeMatrix[3]-t.origin[0],e.camera.viewInverseTransposeMatrix[7]-t.origin[1],e.camera.viewInverseTransposeMatrix[11]-t.origin[2]))))}function _(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add([new d.g("proj",((t,e)=>e.camera.projectionMatrix)),new u("view",((t,e)=>(0,i.v)(p,e.camera.viewMatrix,t.origin))),new a.B("localOrigin",(t=>t.origin))]);const r=t=>(0,s.s)(m,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]);t.uniforms.add([new d.g("proj",((t,e)=>e.camera.projectionMatrix)),new d.g("view",((t,e)=>(0,i.v)(p,e.camera.viewMatrix,r(e)))),new l.J("localOrigin",((t,e)=>r(e)))])}const p=(0,n.c)(),m=(0,o.c)();function g(t){t.uniforms.add(new d.g("viewNormal",((t,e)=>e.camera.viewInverseTransposeMatrix)))}},75993:(t,e,r)=>{r.d(e,{aU:()=>s,b6:()=>a,o_:()=>n,w_:()=>o});var i=r(98634);const n="Size",s="InvSize";function o(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t.hasWebGL2Context){const t=i.H`vec2(textureSize(${e}, ${i.H.int(o)}))`;return r?"(1.0 / "+t+")":t}return r?e+s:e+n}function a(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(t.hasWebGL2Context)return i.H`texelFetch(${e}, ivec2(${r}), ${i.H.int(o)})`;let a=i.H`texture2D(${e}, ${r} * `;return a+=n?i.H`(${n}))`:i.H`${e+s})`,a}},82999:(t,e,r)=>{r.d(e,{A:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e){super(t,"vec2",n.P.Pass,((r,i,n)=>r.setUniform2fv(t,e(i,n))))}}},86471:(t,e,r)=>{r.d(e,{B:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e){super(t,"vec3",n.P.Draw,((r,i,n,s)=>r.setUniform3fv(t,e(i,n,s))))}}},49450:(t,e,r)=>{r.d(e,{J:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e){super(t,"vec3",n.P.Pass,((r,i,n)=>r.setUniform3fv(t,e(i,n))))}}},95276:(t,e,r)=>{r.d(e,{N:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e){super(t,"vec4",n.P.Pass,((r,i,n)=>r.setUniform4fv(t,e(i,n))))}}},59150:(t,e,r)=>{r.d(e,{b:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e,r){super(t,"vec4",n.P.Pass,((r,i,n)=>r.setUniform4fv(t,e(i,n))),r)}}},58406:(t,e,r)=>{r.d(e,{p:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e){super(t,"float",n.P.Pass,((r,i,n)=>r.setUniform1f(t,e(i,n))))}}},699:(t,e,r)=>{r.d(e,{O:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e,r){super(t,"float",n.P.Pass,((r,i,n)=>r.setUniform1fv(t,e(i,n))),r)}}},82644:(t,e,r)=>{r.d(e,{j:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e){super(t,"mat3",n.P.Draw,((r,i,n)=>r.setUniformMatrix3fv(t,e(i,n))))}}},35522:(t,e,r)=>{r.d(e,{c:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e){super(t,"mat3",n.P.Pass,((r,i,n)=>r.setUniformMatrix3fv(t,e(i,n))))}}},8654:(t,e,r)=>{r.d(e,{g:()=>s});var i=r(61809),n=r(99340);class s extends i.x{constructor(t,e){super(t,"mat4",n.P.Pass,((r,i,n)=>r.setUniformMatrix4fv(t,e(i,n))))}}},64201:(t,e,r)=>{r.d(e,{kG:()=>l});var i=r(10064),n=r(32718),s=r(92026);const o=n.Z.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class a{constructor(){this._includedModules=new Map}include(t,e){if(this._includedModules.has(t)){const r=this._includedModules.get(t);if(r!==e){o.error("Trying to include shader module multiple times with different sets of options.");const e=new Set;for(const i of Object.keys(r))r[i]!==t[i]&&e.add(i);for(const i of Object.keys(t))r[i]!==t[i]&&e.add(i);e.forEach((e=>console.error(`  ${e}: current ${r[e]} new ${t[e]}`)))}}else this._includedModules.set(t,e),t(this.builder,e)}}class l extends a{constructor(){super(...arguments),this.vertex=new u,this.fragment=new u,this.attributes=new d,this.varyings=new f,this.extensions=new _,this.constants=new p}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const e=this.extensions.generateSource(t),r=this.attributes.generateSource(t),i=this.varyings.generateSource(),n="vertex"===t?this.vertex:this.fragment,s=n.uniforms.generateSource(),o=n.code.generateSource(),a="vertex"===t?g:m,l=this.constants.generateSource().concat(n.constants.generateSource());return`\n${e.join("\n")}\n\n${a}\n\n${l.join("\n")}\n\n${s.join("\n")}\n\n${r.join("\n")}\n\n${i.join("\n")}\n\n${o.join("\n")}`}generateBind(t,e){const r=new Map;this.vertex.uniforms.entries.forEach((e=>{const i=e.bind[t];(0,s.pC)(i)&&r.set(e.name,i)})),this.fragment.uniforms.entries.forEach((e=>{const i=e.bind[t];(0,s.pC)(i)&&r.set(e.name,i)}));const i=Array.from(r.values()),n=i.length;return(t,r,s)=>{for(let o=0;o<n;++o)i[o](e,t,r,s)}}}class c{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const e of t)this._add(e)}get(t){return this._entries.get(t)}_add(t){if((0,s.Wi)(t))o.error(`Trying to add null Uniform from ${(new Error).stack}.`);else{if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new i.Z(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}}generateSource(){return Array.from(this._entries.values()).map((t=>(0,s.pC)(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`))}get entries(){return Array.from(this._entries.values())}}class h{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class u extends a{constructor(){super(...arguments),this.uniforms=new c,this.code=new h,this.constants=new p}get builder(){return this}}class d{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return"fragment"===t?[]:this._entries.map((t=>`attribute ${t[1]} ${t[0]};`))}}class f{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(){return this._entries.map((t=>`varying ${t[1]} ${t[0]};`))}}class _{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e="vertex"===t?_.ALLOWLIST_VERTEX:_.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((t=>e.includes(t))).map((t=>`#extension ${t} : enable`))}}_.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],_.ALLOWLIST_VERTEX=[];class p{constructor(){this._entries=new Set}add(t,e,r){let i="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":i=p._numberToFloatStr(r);break;case"int":i=p._numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${p._numberToFloatStr(r[0])},                            ${p._numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${p._numberToFloatStr(r[0])},                            ${p._numberToFloatStr(r[1])},                            ${p._numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${p._numberToFloatStr(r[0])},                            ${p._numberToFloatStr(r[1])},                            ${p._numberToFloatStr(r[2])},                            ${p._numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${p._numberToIntStr(r[0])},                             ${p._numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${p._numberToIntStr(r[0])},                             ${p._numberToIntStr(r[1])},                             ${p._numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${p._numberToIntStr(r[0])},                             ${p._numberToIntStr(r[1])},                             ${p._numberToIntStr(r[2])},                             ${p._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${e}(${Array.prototype.map.call(r,(t=>p._numberToFloatStr(t))).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${i};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const m="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",g="precision highp float;\nprecision highp sampler2D;"},19253:(t,e,r)=>{r.d(e,{A:()=>u,J:()=>d});var i=r(92026),n=r(88396),s=r(6394),o=r(75993),a=r(82999),l=r(97528),c=r(61809),h=r(99340);class u extends c.x{constructor(t,e){super(t,"sampler2D",h.P.Pass,((r,i,n)=>r.bindTexture(t,e(i,n))))}}function d(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.D.None;const c=[new u(t,e)];if(r&l.D.Size){const r=t+o.o_;c.push(new a.A(r,((t,r)=>{const o=e(t,r);return(0,i.pC)(o)?(0,n.s)(f,o.descriptor.width,o.descriptor.height):s.Z})))}if(r&l.D.InvSize){const r=t+o.aU;c.push(new a.A(r,((t,r)=>{const o=e(t,r);return(0,i.pC)(o)?(0,n.s)(f,1/o.descriptor.width,1/o.descriptor.height):s.Z})))}return c}const f=(0,s.a)()},97528:(t,e,r)=>{var i;r.d(e,{D:()=>i}),function(t){t[t.None=0]="None",t[t.Size=1]="Size",t[t.InvSize=2]="InvSize"}(i||(i={}))},61809:(t,e,r)=>{r.d(e,{x:()=>s});var i=r(92026),n=r(99340);class s{constructor(t,e,r,s){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.name=t,this.type=e,this.arraySize=o,this.bind={[n.P.Pass]:null,[n.P.Draw]:null},(0,i.pC)(r)&&(0,i.pC)(s)&&(this.bind[r]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}},98634:(t,e,r)=>{r.d(e,{H:()=>n,K:()=>i});class i{}function n(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];let n="";for(let s=0;s<r.length;s++)n+=t[s]+r[s];return n+=t[t.length-1],n}!function(t){t.int=function(t){return Math.round(t).toString()},t.float=function(t){return t.toPrecision(8)}}(n||(n={}))},99340:(t,e,r)=>{var i;r.d(e,{P:()=>i}),function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"}(i||(i={}))},82144:(t,e,r)=>{r.d(e,{J:()=>i});class i{constructor(t,e){this._module=t,this._loadModule=e}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},31132:(t,e,r)=>{r.d(e,{A:()=>s});var i=r(92026),n=r(8548);class s{constructor(t,e,r){this.release=r,this.initializeConfiguration(t,e),this._configuration=e.snapshot(),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=(0,i.M2)(this._program),this._pipeline=this._configuration=null}reload(t){(0,i.M2)(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;t.setPipelineState(this.getPipelineState(e,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return n.MX.TRIANGLES}getPipelineState(t,e){return this._pipeline}initializeConfiguration(t,e){}}},33559:(t,e,r)=>{r.d(e,{m:()=>i,o:()=>n});class i{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map((()=>0)):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,e={key:this.key};for(const r of t)e[r]=this[r];return e}}function n(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),null!=t.constValue)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,r,{get(){return this[i]},set(t){if(this[i]!==t&&(this[i]=t,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+t<<l&c,"number"!=typeof t&&"boolean"!=typeof t))throw"Configuration value for "+r+" must be boolean or number, got "+typeof t}})}}}},1395:(t,e,r)=>{r.d(e,{c:()=>n});var i=r(95439);class n{constructor(){this.id=(0,i.D)()}unload(){}}},79100:(t,e,r)=>{var i;r.d(e,{U:()=>i}),function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Geometry=2]="Geometry",t[t.Material=3]="Material",t[t.Texture=4]="Texture",t[t.COUNT=5]="COUNT"}(i||(i={}))},7566:(t,e,r)=>{r.d(e,{i:()=>n});var i=r(4760);const n=new Map([[i.T.POSITION,0],[i.T.NORMAL,1],[i.T.UV0,2],[i.T.COLOR,3],[i.T.SIZE,4],[i.T.TANGENT,4],[i.T.AUXPOS1,5],[i.T.SYMBOLCOLOR,5],[i.T.AUXPOS2,6],[i.T.FEATUREATTRIBUTE,6],[i.T.INSTANCEFEATUREATTRIBUTE,6],[i.T.INSTANCECOLOR,7],[i.T.OBJECTANDLAYERIDCOLOR,7],[i.T.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[i.T.MODEL,8],[i.T.MODELNORMAL,12],[i.T.MODELORIGINHI,11],[i.T.MODELORIGINLO,15]])},23620:(t,e,r)=>{r.d(e,{Z:()=>n});var i=r(68401);class n{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._output;return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(r,e),this._technique),this._technique}ensureResources(t){return i.Rw.LOADED}}},17363:(t,e,r)=>{r.d(e,{E:()=>c,F:()=>l});var i=r(92026),n=r(66978),s=r(98634),o=r(68401),a=r(23620);class l extends a.Z{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,(t=>this._texture=t)),this._acquire(t.normalTextureId,(t=>this._textureNormal=t)),this._acquire(t.emissiveTextureId,(t=>this._textureEmissive=t)),this._acquire(t.occlusionTextureId,(t=>this._textureOcclusion=t)),this._acquire(t.metallicRoughnessTextureId,(t=>this._textureMetallicRoughness=t))}dispose(){this._texture=(0,i.RY)(this._texture),this._textureNormal=(0,i.RY)(this._textureNormal),this._textureEmissive=(0,i.RY)(this._textureEmissive),this._textureOcclusion=(0,i.RY)(this._textureOcclusion),this._textureMetallicRoughness=(0,i.RY)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return 0===this._numLoading?o.Rw.LOADED:o.Rw.LOADING}get textureBindParameters(){return new c((0,i.pC)(this._texture)?this._texture.glTexture:null,(0,i.pC)(this._textureNormal)?this._textureNormal.glTexture:null,(0,i.pC)(this._textureEmissive)?this._textureEmissive.glTexture:null,(0,i.pC)(this._textureOcclusion)?this._textureOcclusion.glTexture:null,(0,i.pC)(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){((0,i.Wi)(this._texture)||t!==this._texture.id)&&(this._texture=(0,i.RY)(this._texture),this._textureId=t,this._acquire(this._textureId,(t=>this._texture=t)))}_acquire(t,e){if((0,i.Wi)(t))return void e(null);const r=this._textureRepository.acquire(t);if((0,n.y8)(r))return++this._numLoading,void r.then((t=>{if(this._disposed)return(0,i.RY)(t),void e(null);e(t)})).finally((()=>--this._numLoading));e(r)}}class c extends s.K{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(),this.texture=t,this.textureNormal=e,this.textureEmissive=r,this.textureOcclusion=i,this.textureMetallicRoughness=n}}},74894:(t,e,r)=>{r.d(e,{Z:()=>m});var i=r(92026),n=r(68401),s=r(27546),o=r(11186),a=r(71353),l=r(97731);class c{constructor(t,e,r,i){this.primitiveIndices=t,this._numIndexPerPrimitive=e,this.indices=r,this.position=i,this.center=(0,a.c)(),this._children=void 0,(0,l.hu)(t.length>=1),(0,l.hu)(r.length%this._numIndexPerPrimitive==0),(0,l.hu)(r.length>=t.length*this._numIndexPerPrimitive),(0,l.hu)(3===i.size||4===i.size);const{data:n,size:s}=i,c=t.length;let u=s*r[this._numIndexPerPrimitive*t[0]];h.clear(),h.push(u),this.bbMin=(0,a.f)(n[u],n[u+1],n[u+2]),this.bbMax=(0,a.a)(this.bbMin);for(let o=0;o<c;++o){const e=this._numIndexPerPrimitive*t[o];for(let t=0;t<this._numIndexPerPrimitive;++t){u=s*r[e+t],h.push(u);let i=n[u];this.bbMin[0]=Math.min(i,this.bbMin[0]),this.bbMax[0]=Math.max(i,this.bbMax[0]),i=n[u+1],this.bbMin[1]=Math.min(i,this.bbMin[1]),this.bbMax[1]=Math.max(i,this.bbMax[1]),i=n[u+2],this.bbMin[2]=Math.min(i,this.bbMin[2]),this.bbMax[2]=Math.max(i,this.bbMax[2])}}(0,o.h)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let d=this.radius*this.radius;for(let o=0;o<h.length;++o){u=h.getItemAt(o);const t=n[u]-this.center[0],e=n[u+1]-this.center[1],r=n[u+2]-this.center[2],i=t*t+e*e+r*r;if(i<=d)continue;const s=Math.sqrt(i),a=.5*(s-this.radius);this.radius=this.radius+a,d=this.radius*this.radius;const l=a/s;this.center[0]+=t*l,this.center[1]+=e*l,this.center[2]+=r*l}h.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if((0,o.d)(this.bbMin,this.bbMax)>1){const t=(0,o.h)((0,a.c)(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length,r=new Uint8Array(e),i=new Array(8);for(let o=0;o<8;++o)i[o]=0;const{data:n,size:s}=this.position;for(let o=0;o<e;++o){let e=0;const a=this._numIndexPerPrimitive*this.primitiveIndices[o];let l=s*this.indices[a],c=n[l],h=n[l+1],u=n[l+2];for(let t=1;t<this._numIndexPerPrimitive;++t){l=s*this.indices[a+t];const e=n[l],r=n[l+1],i=n[l+2];e<c&&(c=e),r<h&&(h=r),i<u&&(u=i)}c<t[0]&&(e|=1),h<t[1]&&(e|=2),u<t[2]&&(e|=4),r[o]=e,++i[e]}let l=0;for(let o=0;o<8;++o)i[o]>0&&++l;if(l<2)return;const h=new Array(8);for(let o=0;o<8;++o)h[o]=i[o]>0?new Uint32Array(i[o]):void 0;for(let o=0;o<8;++o)i[o]=0;for(let o=0;o<e;++o){const t=r[o];h[t][i[t]++]=this.primitiveIndices[o]}this._children=new Array(8);for(let o=0;o<8;++o)void 0!==h[o]&&(this._children[o]=new c(h[o],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){h.prune()}}const h=new s.Z({deallocator:null});var u=r(1395),d=r(79100),f=r(81955),_=r(72838),p=r(4760);class m extends u.c{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.MX.Triangle,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;super(),this._primitiveType=r,this.objectAndLayerIdColor=i,this.edgeIndicesLength=s,this.type=d.U.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,o]of t)o&&this._vertexAttributes.set(n,{...o});if(null==e||0===e.length){const t=function(t){const e=t.values().next().value;return null==e?0:e.data.length/e.size}(this._vertexAttributes),e=(0,_.p)(t);this.edgeIndicesLength=this.edgeIndicesLength<0?t:this.edgeIndicesLength;for(const r of this._vertexAttributes.keys())this._indices.set(r,e)}else for(const[n,o]of e)o&&(this._indices.set(n,(0,_.mi)(o)),n===p.T.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new m([],void 0,this._primitiveType,this.objectAndLayerIdColor,void 0),{_vertexAttributes:e,_indices:r}=t;return this._vertexAttributes.forEach(((t,r)=>e.set(r,t))),this._indices.forEach(((t,e)=>r.set(e,t))),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const e=this._vertexAttributes.get(t);return e&&!e.exclusive&&(e.data=Array.from(e.data),e.exclusive=!0),e}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return(0,i.Wi)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===n.MX.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const e=this.indices.get(p.T.POSITION),r=this.vertexAttributes.get(p.T.POSITION);return(0,f.cM)(r,e,t)}_computeAttachmentOriginPoints(t){const e=this.indices.get(p.T.POSITION),r=this.vertexAttributes.get(p.T.POSITION);return(0,f.NO)(r,e,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(p.T.POSITION);if(!t||0===t.length)return null;const e=this.primitiveType===n.MX.Triangle?3:1;(0,l.hu)(t.length%e==0,"Indexing error: "+t.length+" not divisible by "+e);const r=(0,_.p)(t.length/e),i=this.vertexAttributes.get(p.T.POSITION);return i?new c(r,e,t,i):null}}},72838:(t,e,r)=>{r.d(e,{$z:()=>s,DX:()=>h,mi:()=>n,p:()=>c});const i=1024;function n(t){if(Array.isArray(t)){if(t.length<i)return t;for(const e of t)if(e>=65536)return new Uint32Array(t);return new Uint16Array(t)}if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}function s(t){const e=3*t;return e<=i?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}let o=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const a=[0],l=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function c(t){if(1===t)return a;if(t<i)return Array.from(new Uint16Array(l.buffer,0,t));if(t<l.length)return new Uint16Array(l.buffer,0,t);if(t>o.length){const e=Math.max(2*o.length,t);o=new Uint32Array(e);for(let t=0;t<o.length;t++)o[t]=t}return new Uint32Array(o.buffer,0,t)}function h(t){if(1===t)return a;if(t<i)return Array.from(new Uint16Array(l.buffer,0,t));if(t<l.length)return new Uint16Array(l.slice(0,t));if(t>o.length){const e=new Uint32Array(t);for(let t=0;t<e.length;t++)e[t]=t;return e}return new Uint32Array(o.slice(0,t))}},56529:(t,e,r)=>{r.d(e,{F5:()=>h,Mt:()=>u,yD:()=>i});var i,n=r(92026),s=r(98634),o=r(1395),a=r(79100),l=r(7566),c=r(22909);class h extends o.c{constructor(t,e){super(),this.type=a.U.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=l.i,this._parameters=(0,c.Uf)(t,e),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,c.LO)(this._parameters,t)&&(this.validateParameters(this._parameters),e&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleForOutput(t.output)&&0!=(this.renderOccluded&t.renderOccludedMask)}isVisibleForOutput(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){(0,n.pC)(this.repository)&&this.repository.materialChanged(this)}}!function(t){t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"}(i||(i={}));class u extends s.K{constructor(){super(...arguments),this.renderOccluded=i.Occlude}}},78041:(t,e,r)=>{r.d(e,{Bh:()=>_,E0:()=>d,IB:()=>l,K5:()=>h,j7:()=>c,je:()=>f,ve:()=>u,wu:()=>o});var i=r(25920),n=r(8548),s=r(36207);const o=(0,s.wK)(n.zi.SRC_ALPHA,n.zi.ONE,n.zi.ONE_MINUS_SRC_ALPHA,n.zi.ONE_MINUS_SRC_ALPHA),a=(0,s.if)(n.zi.ONE,n.zi.ONE),l=(0,s.if)(n.zi.ZERO,n.zi.ONE_MINUS_SRC_ALPHA);function c(t){return t===i.A.FrontFace?null:t===i.A.Alpha?l:a}function h(t){return t===i.A.FrontFace?s.LZ:null}const u=5e5,d={factor:-1,units:-2};function f(t){return t?d:null}function _(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.wb.LESS;return t===i.A.NONE||t===i.A.FrontFace?e:n.wb.LEQUAL}},27627:(t,e,r)=>{r.d(e,{$:()=>a});var i=r(92026),n=r(27546),s=r(99340),o=r(37825);class a{constructor(t,e,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new n.Z({deallocator:null}),this._glProgram=t.programCache.acquire(e.generate("vertex"),e.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=e.generateBind(s.P.Pass,this),this.bindDraw=e.generateBind(s.P.Draw,this),this._fragmentUniforms=(0,o.hZ)()?e.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,e){this._glProgram.setUniform1i(t,e?1:0)}setUniform1i(t,e){this._glProgram.setUniform1i(t,e)}setUniform1f(t,e){this._glProgram.setUniform1f(t,e)}setUniform2fv(t,e){this._glProgram.setUniform2fv(t,e)}setUniform3fv(t,e){this._glProgram.setUniform3fv(t,e)}setUniform4fv(t,e){this._glProgram.setUniform4fv(t,e)}setUniformMatrix3fv(t,e){this._glProgram.setUniformMatrix3fv(t,e)}setUniformMatrix4fv(t,e){this._glProgram.setUniformMatrix4fv(t,e)}setUniform1fv(t,e){this._glProgram.setUniform1fv(t,e)}setUniform1iv(t,e){this._glProgram.setUniform1iv(t,e)}setUniform2iv(t,e){this._glProgram.setUniform3iv(t,e)}setUniform3iv(t,e){this._glProgram.setUniform3iv(t,e)}setUniform4iv(t,e){this._glProgram.setUniform4iv(t,e)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,e){if((0,i.Wi)(e)||null==e.glName){const e=this._textures.get(t);return e&&(this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(t)),null}let r=this._textures.get(t);return null==r?(r=this._allocTextureUnit(e),this._textures.set(t,r)):r.texture=e,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(e,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((t,e)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(e,t.unit)})),(0,i.pC)(this._fragmentUniforms)&&this._fragmentUniforms.forEach((t=>{"sampler2D"!==t.type&&"samplerCube"!==t.type||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)}))}_allocTextureUnit(t){return{texture:t,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}},93822:(t,e,r)=>{var i;r.d(e,{r:()=>i}),function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"}(i||(i={}))},50411:(t,e,r)=>{r.d(e,{JN:()=>s,P7:()=>l,RY:()=>c,YD:()=>d,eD:()=>h,ii:()=>u,s3:()=>a,zV:()=>o});var i=r(68401),n=r(8548);const s={func:n.wb.LESS},o={func:n.wb.ALWAYS},a={mask:255},l={mask:0},c={function:{func:n.wb.ALWAYS,ref:i.hU.OutlineVisualElementMask,mask:i.hU.OutlineVisualElementMask},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.ZERO}},h={function:{func:n.wb.ALWAYS,ref:i.hU.OutlineVisualElementMask,mask:i.hU.OutlineVisualElementMask},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.REPLACE}},u={function:{func:n.wb.EQUAL,ref:i.hU.OutlineVisualElementMask,mask:i.hU.OutlineVisualElementMask},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.KEEP}},d={function:{func:n.wb.NOTEQUAL,ref:i.hU.OutlineVisualElementMask,mask:i.hU.OutlineVisualElementMask},operation:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.KEEP}}},76873:(t,e,r)=>{r.d(e,{x:()=>z});var i=r(41644),n=r(10064),s=r(91505),o=r(16889),a=r(92026),l=r(66978),c=r(18722),h=r(35995),u=r(38330),d=r(5640),f=r(61863),_=r(68401),p=r(65905);let m;var g;!function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"}(g||(g={}));var v=r(8548),T=r(51378),A=r(3384);let b=null,x=null;async function E(){return(0,a.Wi)(x)&&(x=function(){if((0,a.Wi)(m)){const t=t=>(0,p.V)(`esri/libs/basisu/${t}`);m=r.e(1562).then(r.bind(r,61562)).then((t=>t.b)).then((e=>{let{default:r}=e;return r({locateFile:t}).then((t=>(t.initializeBasis(),delete t.then,t)))}))}return m}(),b=await x),x}function O(t,e,r,i,n){const s=(0,A.RG)(e?v.q_.COMPRESSED_RGBA8_ETC2_EAC:v.q_.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*s*o)}function S(t){return t.getNumImages()>=1&&!t.isUASTC()}function I(t){return t.getFaces()>=1&&t.isETC1S()}function w(t,e,r,i,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,u]=l?i?[g.ETC2_RGBA,v.q_.COMPRESSED_RGBA8_ETC2_EAC]:[g.ETC1_RGB,v.q_.COMPRESSED_RGB8_ETC2]:c?i?[g.BC3_RGBA,v.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[g.BC1_RGB,v.q_.COMPRESSED_RGB_S3TC_DXT1_EXT]:[g.RGBA32,v.VI.RGBA],d=e.hasMipmap?r:Math.min(1,r),f=[];for(let g=0;g<d;g++)f.push(new Uint8Array(o(g,h))),a(g,h,f[g]);const _=f.length>1,p=_?v.cw.LINEAR_MIPMAP_LINEAR:v.cw.LINEAR,m={...e,samplingMode:p,hasMipmap:_,internalFormat:u,width:n,height:s};return new T.x(t,m,{type:"compressed",levels:f})}var R=r(1395),M=r(79100);const C=r(32718).Z.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),P=542327876,y=131072;function L(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}const N=L("DXT1"),F=L("DXT3"),D=L("DXT5");function U(t,e,r){const{textureData:i,internalFormat:n,width:s,height:l}=(0,a.s3)(function(t,e){const r=new Int32Array(t,0,31);if(r[0]!==P)return C.error("Invalid magic number in DDS header"),null;if(!(4&r[20]))return C.error("Unsupported format, must contain a FourCC code"),null;const i=r[21];let n,s;switch(i){case N:n=8,s=v.q_.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case F:n=16,s=v.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case D:n=16,s=v.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return C.error("Unsupported FourCC code:",function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}(i)),null}let a=1,l=r[4],c=r[3];0==(3&l)&&0==(3&c)||(C.warn("Rounding up compressed texture size to nearest multiple of 4."),l=l+3&-4,c=c+3&-4);const h=l,u=c;let d,f;r[2]&y&&!1!==e&&(a=Math.max(1,r[7])),1===a||(0,o.wt)(l)&&(0,o.wt)(c)||(C.warn("Ignoring mipmaps of non power of two sized compressed texture."),a=1);let _=r[1]+4;const p=[];for(let o=0;o<a;++o)f=(l+3>>2)*(c+3>>2)*n,d=new Uint8Array(t,_,f),p.push(d),_+=f,l=Math.max(1,l>>1),c=Math.max(1,c>>1);return{textureData:{type:"compressed",levels:p},internalFormat:s,width:h,height:u}}(r,e.hasMipmap??!1));return e.samplingMode=i.levels.length>1?v.cw.LINEAR_MIPMAP_LINEAR:v.cw.LINEAR,e.hasMipmap=i.levels.length>1,e.internalFormat=n,e.width=s,e.height=l,new T.x(t,e,i)}var B,H=r(32534),V=r(97731),G=r(53634),W=r(30308);class z extends R.c{constructor(t,e){super(),this._data=t,this.type=M.U.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new s.Z,this._passParameters=new f.T,this.params=e||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:v.e8.REPEAT,t:v.e8.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||_.CE.STRETCH,this.estimatedTexMemRequired=z._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const t=this._data;(0,a.Wi)(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!((0,h.jc)(t.src)||"auto"===t.preload&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const e=!t.paused;if(t.src=t.src,e&&t.autoplay){const e=()=>{t.removeEventListener("canplay",e),t.play()};t.addEventListener("canplay",e)}}}_startPreloadImageElement(t){(0,h.HK)(t.src)||(0,h.jc)(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,e){if((0,a.Wi)(t))return 0;if((0,c.eP)(t)||(0,c.lq)(t))return e.encoding===z.KTX2_ENCODING?function(t,e){if((0,a.Wi)(b))return t.byteLength;const r=new b.KTX2File(new Uint8Array(t)),i=I(r)?O(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}(t,e.mipmap):e.encoding===z.BASIS_ENCODING?function(t,e){if((0,a.Wi)(b))return t.byteLength;const r=new b.BasisFile(new Uint8Array(t)),i=S(r)?O(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}(t,e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?z._getDataDimensions(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){return{target:v.No.TEXTURE_2D,pixelFormat:v.VI.RGBA,dataType:v.Br.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?v.cw.LINEAR_MIPMAP_LINEAR:v.cw.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?t.parameters.maxMaxAnisotropy:1)}}get glTexture(){return this._glTexture}load(t,e){if((0,a.pC)(this._glTexture))return this._glTexture;if((0,a.pC)(this._loadingPromise))return this._loadingPromise;const r=this._data;return(0,a.Wi)(r)?(this._glTexture=new T.x(t,this._createDescriptor(t),null),this._glTexture):"string"==typeof r?this._loadFromURL(t,e,r):r instanceof Image?this._loadFromImageElement(t,e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,e):((0,c.eP)(r)||(0,c.lq)(r))&&this.params.encoding===z.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(t,r)):((0,c.eP)(r)||(0,c.lq)(r))&&this.params.encoding===z.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(t,r)):((0,c.eP)(r)||(0,c.lq)(r))&&this.params.encoding===z.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(t,r)):(0,c.lq)(r)?this._loadFromPixelData(t,r):(0,c.eP)(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(t,e,r){if(!(this._data instanceof HTMLVideoElement)||(0,a.Wi)(this._glTexture))return r;if(this._data.readyState<B.HAVE_CURRENT_DATA||r===this._data.currentTime)return r;if((0,a.pC)(this._powerOfTwoStretchInfo)){const{framebuffer:r,vao:i,sourceTexture:n}=this._powerOfTwoStretchInfo;n.setData(this._data),this._drawStretchedTexture(t,e,r,i,n,this._glTexture)}else{const{videoWidth:t,videoHeight:e}=this._data,{width:r,height:i}=this._glTexture.descriptor;t!==r||e!==i?this._glTexture.updateData(0,0,0,Math.min(t,r),Math.min(e,i),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(t,e){return this._glTexture=U(t,this._createDescriptor(t),e),this._glTexture}_loadFromKTX2(t,e){return this._loadAsync((()=>async function(t,e,r){(0,a.Wi)(b)&&(b=await E());const i=new b.KTX2File(new Uint8Array(r));if(!I(i))return null;i.startTranscoding();const n=w(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),((t,e)=>i.getImageTranscodedSizeInBytes(t,0,0,e)),((t,e,r)=>i.transcodeImage(r,t,0,0,e,0,-1,-1)));return i.close(),i.delete(),n}(t,this._createDescriptor(t),e).then((t=>(this._glTexture=t,t)))))}_loadFromBasis(t,e){return this._loadAsync((()=>async function(t,e,r){(0,a.Wi)(b)&&(b=await E());const i=new b.BasisFile(new Uint8Array(r));if(!S(i))return null;i.startTranscoding();const n=w(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),((t,e)=>i.getImageTranscodedSizeInBytes(0,t,e)),((t,e,r)=>i.transcodeImage(r,0,t,e,0,0)));return i.close(),i.delete(),n}(t,this._createDescriptor(t),e).then((t=>(this._glTexture=t,t)))))}_loadFromPixelData(t,e){(0,V.hu)(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=1===this.params.components?v.VI.LUMINANCE:3===this.params.components?v.VI.RGB:v.VI.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new T.x(t,r,e),this._glTexture}_loadFromURL(t,e,r){return this._loadAsync((async i=>{const n=await(0,u.t)(r,{signal:i});return(0,l.k_)(i),this._loadFromImage(t,n,e)}))}_loadFromImageElement(t,e,r){return r.complete?this._loadFromImage(t,r,e):this._loadAsync((async i=>{const n=await(0,d.fY)(r,r.src,!1,i);return(0,l.k_)(i),this._loadFromImage(t,n,e)}))}_loadFromVideoElement(t,e,r){return r.readyState>=B.HAVE_CURRENT_DATA?this._loadFromImage(t,r,e):this._loadFromVideoElementAsync(t,e,r)}_loadFromVideoElementAsync(t,e,r){return this._loadAsync((i=>new Promise(((s,o)=>{const c=()=>{r.removeEventListener("loadeddata",h),r.removeEventListener("error",u),(0,a.hw)(d)},h=()=>{r.readyState>=B.HAVE_CURRENT_DATA&&(c(),s(this._loadFromImage(t,r,e)))},u=t=>{c(),o(t||new n.Z("Failed to load video"))};r.addEventListener("loadeddata",h),r.addEventListener("error",u);const d=(0,l.fu)(i,(()=>u((0,l.zE)())))}))))}_loadFromImage(t,e,r){const i=z._getDataDimensions(e);this.params.width=i.width,this.params.height=i.height;const n=this._createDescriptor(t);return n.pixelFormat=3===this.params.components?v.VI.RGB:v.VI.RGBA,!this._requiresPowerOfTwo(t,n)||(0,o.wt)(i.width)&&(0,o.wt)(i.height)?(n.width=i.width,n.height=i.height,this._glTexture=new T.x(t,n,e),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,e,i,n,r),this._glTexture)}_loadAsync(t){const e=new AbortController;this._loadingController=e;const r=t(e.signal);this._loadingPromise=r;const i=()=>{this._loadingController===e&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(i,i),r}_requiresPowerOfTwo(t,e){const r=v.e8.CLAMP_TO_EDGE,i="number"==typeof e.wrapMode?e.wrapMode===r:e.wrapMode.s===r&&e.wrapMode.t===r;return!(0,W.Z)(t.gl)&&(e.hasMipmap||!i)}_makePowerOfTwoTexture(t,e,r,n,s){const{width:a,height:l}=r,c=(0,o.Sf)(a),h=(0,o.Sf)(l);let u;switch(n.width=c,n.height=h,this.params.powerOfTwoResizeMode){case _.CE.PAD:n.textureCoordinateScaleFactor=[a/c,l/h],u=new T.x(t,n),u.updateData(0,0,0,a,l,e);break;case _.CE.STRETCH:case null:case void 0:u=this._stretchToPowerOfTwo(t,e,n,s());break;default:(0,i.Bg)(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&u.generateMipmap(),u}_stretchToPowerOfTwo(t,e,r,i){const n=new T.x(t,r),s=new G.X(t,{colorTarget:v.Lm.TEXTURE,depthStencilTarget:v.OU.NONE},n),o=new T.x(t,{target:v.No.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:v.Br.UNSIGNED_BYTE,wrapMode:v.e8.CLAMP_TO_EDGE,samplingMode:v.cw.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},e),a=(0,H.ow)(t),l=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,i,s,a,o,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:a,sourceTexture:o,framebuffer:s}:(a.dispose(!0),o.dispose(),s.detachColorTexture(),s.dispose()),t.bindFramebuffer(l),n}_drawStretchedTexture(t,e,r,i,n,s){this._passParameters.texture=n,t.bindFramebuffer(r);const o=t.getViewport();t.setViewport(0,0,s.descriptor.width,s.descriptor.height),t.bindTechnique(e,this._passParameters,null),t.bindVAO(i),t.drawArrays(v.MX.TRIANGLE_STRIP,0,(0,A._V)(i,"geometry")),t.bindFramebuffer(null),t.setViewport(o.x,o.y,o.width,o.height),this._passParameters.texture=null}unload(){if((0,a.pC)(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:e,sourceTexture:r}=this._powerOfTwoStretchInfo;e.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if((0,a.pC)(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),(0,a.pC)(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}z.DDS_ENCODING="image/vnd-ms.dds",z.KTX2_ENCODING="image/ktx2",z.BASIS_ENCODING="image/x.basis",function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(B||(B={}))},25920:(t,e,r)=>{var i;r.d(e,{A:()=>i}),function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"}(i||(i={}))},97731:(t,e,r)=>{r.d(e,{E6:()=>c,Kj:()=>d,RQ:()=>p,T:()=>o,ep:()=>l,hu:()=>s,kG:()=>u,tM:()=>_,u_:()=>h,yK:()=>a,zF:()=>f});var i=r(6394);r(90045);(0,r(67077).c)();class n{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function s(t,e){if(!t)throw e=e||"assert",console.log(new Error(e).stack),new n(e)}function o(t,e){t||(e=e||"",console.warn("Verify failed: "+e+"\n"+new Error("verify").stack))}function a(t,e,r,i){let n,s=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],h=(i[2]-t[2])/e[2];return c>h&&(n=c,c=h,h=n),!(s>h||c>o)&&(h<o&&(o=h),!(o<0))}function l(t,e,r,n,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,i.a)();const a=(n[s]-r[s])*(e[0]-t[0])-(n[0]-r[0])*(e[s]-t[s]),l=(n[0]-r[0])*(t[s]-r[s])-(n[s]-r[s])*(t[0]-r[0]);if(0===a)return!1;const c=l/a;return o[0]=t[0]+c*(e[0]-t[0]),o[1]=t[s]+c*(e[s]-t[s]),!0}function c(t,e){return Math.log(t)/Math.log(e)}function h(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function u(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}function d(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function f(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function _(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function p(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}},80658:(t,e,r)=>{r.d(e,{U:()=>n});var i=r(45412);class n extends i.U{}},4760:(t,e,r)=>{var i;r.d(e,{T:()=>i}),function(t){t.POSITION="position",t.NORMAL="normal",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.MAPPOS="mapPos",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.NORMALCOMPRESSED="normalCompressed",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"}(i||(i={}))},68401:(t,e,r)=>{var i,n,s,o,a,l,c,h,u,d,f,_;r.d(e,{CE:()=>u,Gv:()=>n,JJ:()=>f,MX:()=>h,Rw:()=>o,V_:()=>c,Vr:()=>i,Yg:()=>d,hU:()=>a,jq:()=>l}),function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"}(i||(i={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(n||(n={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(s||(s={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(o||(o={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"}(l||(l={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(c||(c={})),function(t){t[t.Triangle=0]="Triangle",t[t.Point=1]="Point",t[t.Line=2]="Line"}(h||(h={})),function(t){t[t.STRETCH=1]="STRETCH",t[t.PAD=2]="PAD"}(u||(u={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(d||(d={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(f||(f={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(_||(_={}))},81955:(t,e,r)=>{r.d(e,{NO:()=>a,cM:()=>o,qZ:()=>l});var i=r(11186),n=r(71353),s=r(74702);function o(t,e,r){if(!t||!e)return!1;const{size:n,data:o}=t;(0,i.s)(r,0,0,0),(0,i.s)(d,0,0,0);let a=0,l=0;for(let f=0;f<e.length-2;f+=3){const t=e[f+0]*n,_=e[f+1]*n,p=e[f+2]*n;(0,i.s)(c,o[t+0],o[t+1],o[t+2]),(0,i.s)(h,o[_+0],o[_+1],o[_+2]),(0,i.s)(u,o[p+0],o[p+1],o[p+2]);const m=(0,s.bE)(c,h,u);m?((0,i.a)(c,c,h),(0,i.a)(c,c,u),(0,i.g)(c,c,1/3*m),(0,i.a)(r,r,c),a+=m):((0,i.a)(d,d,c),(0,i.a)(d,d,h),(0,i.a)(d,d,u),l+=3)}return(0!==l||0!==a)&&(0!==a?((0,i.g)(r,r,1/a),!0):0!==l&&((0,i.g)(r,d,1/l),!0))}function a(t,e,r){if(!t||!e)return!1;const{size:n,data:s}=t;(0,i.s)(r,0,0,0);let o=-1,a=0;for(let i=0;i<e.length;i++){const t=e[i]*n;o!==t&&(r[0]+=s[t+0],r[1]+=s[t+1],r[2]+=s[t+2],a++),o=t}return a>1&&(0,i.g)(r,r,1/a),a>0}function l(t,e,r,n){if(!t)return!1;const{size:s,data:o}=t;(0,i.s)(n,0,0,0),(0,i.s)(d,0,0,0);let a=0,l=0;const u=e?e.length-1:o.length/s-1,f=u+(r?2:0);for(let _=0;_<f;_+=2){const t=_<u?_:u,r=_<u?_+1:0,f=(e?e[t]:t)*s,p=(e?e[r]:r)*s;c[0]=o[f+0],c[1]=o[f+1],c[2]=o[f+2],h[0]=o[p+0],h[1]=o[p+1],h[2]=o[p+2],(0,i.g)(c,(0,i.a)(c,c,h),.5);const m=(0,i.j)(c,h);m>0?((0,i.a)(n,n,(0,i.g)(c,c,m)),a+=m):((0,i.a)(d,d,c),l++)}return 0!==a?((0,i.g)(n,n,1/a),!0):0!==l&&((0,i.g)(n,d,1/l),!0)}const c=(0,n.c)(),h=(0,n.c)(),u=(0,n.c)(),d=(0,n.c)()},32534:(t,e,r)=>{r.d(e,{hf:()=>f,ow:()=>d});var i=r(7566),n=r(4760),s=r(8548),o=r(61109);new o.G(n.T.POSITION,3,s.g.FLOAT,0,12),new o.G(n.T.POSITION,3,s.g.FLOAT,0,20),new o.G(n.T.UV0,2,s.g.FLOAT,12,20),new o.G(n.T.POSITION,3,s.g.FLOAT,0,32),new o.G(n.T.NORMAL,3,s.g.FLOAT,12,32),new o.G(n.T.UV0,2,s.g.FLOAT,24,32),new o.G(n.T.POSITION,3,s.g.FLOAT,0,16),new o.G(n.T.COLOR,4,s.g.UNSIGNED_BYTE,12,16);const a=[new o.G(n.T.POSITION,2,s.g.FLOAT,0,8)],l=[new o.G(n.T.POSITION,2,s.g.FLOAT,0,16),new o.G(n.T.UV0,2,s.g.FLOAT,8,16)];var c=r(80658),h=r(44070),u=r(51378);function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.i,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=null;return u=e===l?new Float32Array([n,n,0,0,o,n,1,0,n,o,0,1,o,o,1,1]):new Float32Array([n,n,o,n,n,o,o,o]),new c.U(t,r,{geometry:e},{geometry:h.f.createVertex(t,s.l1.STATIC_DRAW,u)})}function f(t){return new u.x(t,{target:s.No.TEXTURE_2D,pixelFormat:s.VI.RGBA,dataType:s.Br.UNSIGNED_BYTE,samplingMode:s.cw.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}},65216:(t,e,r)=>{r.d(e,{PV:()=>a,TU:()=>l,bA:()=>c,sX:()=>o});var i=r(16889);r(50951);function n(t,e,r){const i=r.parameters,n=r.paddingPixelsOverride;return h.scale=Math.min(i.divisor/(e-i.offset),1),h.factor=function(t){return Math.abs(t*t*t)}(t),h.minPixelSize=i.minPixelSize,h.paddingPixels=n,h}function s(t,e){return 0===t?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function o(t,e){return Math.max((0,i.t7)(t*e.scale,t,e.factor),s(t,e))}function a(t,e,r,i){i.scale=function(t,e,r){const i=n(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,o(1,i)}(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function l(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];const i=Math.min(Math.max(e.scale,s(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function c(t,e,r,i){return o(t,n(e,r,i))}(0,i.Vl)(10),(0,i.Vl)(12),(0,i.Vl)(70),(0,i.Vl)(40);const h={scale:0,factor:0,minPixelSize:0,paddingPixels:0}},76783:(t,e,r)=>{r.d(e,{W9:()=>A,cy:()=>b,yn:()=>_});var i=r(92026),n=r(22753),s=r(11873),o=r(14226),a=r(81949),l=r(48976),c=r(98131),h=r(11186),u=r(8229),d=r(71353),f=r(23470);class _{constructor(){this._transform=(0,a.c)(),this._transformInverse=new p({value:this._transform},o.a,a.c),this._transformInverseTranspose=new p(this._transformInverse,o.t,a.c),this._transformTranspose=new p({value:this._transform},o.t,a.c),this._transformInverseRotation=new p({value:this._transform},n.n,s.c)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){(0,o.c)(this._transform,t)}multiplyTransform(t){(0,o.m)(this._transform,this._transform,t)}set(t){(0,o.c)(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,e){this.setTransformMatrix(t),this.multiplyTransform(e),this._invalidateLazyTransforms()}}class p{constructor(t,e,r){this._original=t,this._update=e,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const m=(0,d.c)(),g=(0,d.c)(),v=(0,d.c)();const T=new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=t,this.sphere=(0,f.c)(),this.tmpVertex=(0,d.c)()}applyToVertex(t,e,r){const i=this.objectTransform.transform;let n=i[0]*t+i[4]*e+i[8]*r+i[12],s=i[1]*t+i[5]*e+i[9]*r+i[13],o=i[2]*t+i[6]*e+i[10]*r+i[14];const a=this.offset/Math.sqrt(n*n+s*s+o*o);n+=n*a,s+=s*a,o+=o*a;const l=this.objectTransform.inverse;return this.tmpVertex[0]=l[0]*n+l[4]*s+l[8]*o+l[12],this.tmpVertex[1]=l[1]*n+l[5]*s+l[9]*o+l[13],this.tmpVertex[2]=l[2]*n+l[6]*s+l[10]*o+l[14],this.tmpVertex}applyToMinMax(t,e){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i}applyToAabb(t){const e=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*e,t[1]+=t[1]*e,t[2]+=t[2]*e;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/e;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/e,this.sphere}};function A(t){return(0,i.pC)(t)?(T.offset=t,T):null}new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.componentLocalOriginLength=0,this._tmpVertex=(0,d.c)(),this._mbs=(0,f.c)(),this._obb={center:(0,d.c)(),halfSize:(0,u.c)(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,e,r){const i=t,n=e,s=r+this.componentLocalOriginLength,o=this._totalOffset/Math.sqrt(i*i+n*n+s*s);return this._tmpVertex[0]=t+i*o,this._tmpVertex[1]=e+n*o,this._tmpVertex[2]=r+s*o,this._tmpVertex}applyToAabb(t){const e=t[0],r=t[1],i=t[2]+this.componentLocalOriginLength,n=t[3],s=t[4],o=t[5]+this.componentLocalOriginLength,a=e*n<0?0:Math.min(Math.abs(e),Math.abs(n)),l=r*s<0?0:Math.min(Math.abs(r),Math.abs(s)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=Math.sqrt(a*a+l*l+c*c);if(h<this._totalOffset)return t[0]-=e<0?this._totalOffset:0,t[1]-=r<0?this._totalOffset:0,t[2]-=i<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=s>0?this._totalOffset:0,t[5]+=o>0?this._totalOffset:0,t;const u=Math.max(Math.abs(e),Math.abs(n)),d=Math.max(Math.abs(r),Math.abs(s)),f=Math.max(Math.abs(i),Math.abs(o)),_=Math.sqrt(u*u+d*d+f*f),p=this._totalOffset/_,m=this._totalOffset/h;return t[0]+=e*(e>0?p:m),t[1]+=r*(r>0?p:m),t[2]+=i*(i>0?p:m),t[3]+=n*(n<0?p:m),t[4]+=s*(s<0?p:m),t[5]+=o*(o<0?p:m),t}applyToMbs(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this._totalOffset/e;return this._mbs[0]=t[0]+t[0]*r,this._mbs[1]=t[1]+t[1]*r,this._mbs[2]=t[2]+t[2]*r,this._mbs[3]=t[3]+t[3]*this._totalOffset/e,this._mbs}applyToObb(t){const e=t.center,r=this._totalOffset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);this._obb.center[0]=e[0]+e[0]*r,this._obb.center[1]=e[1]+e[1]*r,this._obb.center[2]=e[2]+e[2]*r,(0,h.q)(this._obb.halfSize,t.halfSize,t.quaternion),(0,h.a)(this._obb.halfSize,this._obb.halfSize,t.center);const i=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*i,this._obb.halfSize[1]+=this._obb.halfSize[1]*i,this._obb.halfSize[2]+=this._obb.halfSize[2]*i,(0,h.b)(this._obb.halfSize,this._obb.halfSize,t.center),(0,l.c)(x,t.quaternion),(0,h.q)(this._obb.halfSize,this._obb.halfSize,x),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}};new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=t,this.tmpVertex=(0,d.c)()}applyToVertex(t,e,r){const i=t+this.localOrigin[0],n=e+this.localOrigin[1],s=r+this.localOrigin[2],o=this.offset/Math.sqrt(i*i+n*n+s*s);return this.tmpVertex[0]=t+i*o,this.tmpVertex[1]=e+n*o,this.tmpVertex[2]=r+s*o,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)m[n]=t[0+n]+this.localOrigin[n],g[n]=t[3+n]+this.localOrigin[n],v[n]=m[n];const e=this.applyToVertex(m[0],m[1],m[2]);for(let n=0;n<3;++n)t[n]=e[n],t[n+3]=e[n];const r=e=>{const r=this.applyToVertex(e[0],e[1],e[2]);for(let i=0;i<3;++i)t[i+0]=Math.min(t[i+0],r[i]),t[i+3]=Math.max(t[i+3],r[i])};for(let n=1;n<8;++n){for(let t=0;t<3;++t)v[t]=0==(n&1<<t)?m[t]:g[t];r(v)}let i=0;for(let n=0;n<3;++n)m[n]*g[n]<0&&(i|=1<<n);if(0!==i&&7!==i)for(let n=0;n<8;++n)if(0==(i&n)){for(let t=0;t<3;++t)i[t]?v[t]=0:v[t]=0!=(n&1<<t)?m[t]:g[t];r(v)}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}};const b="terrain",x=(0,c.a)()},8883:(t,e,r)=>{r.d(e,{W:()=>o});var i=r(27366),n=r(99340),s=r(33559);class o extends s.m{constructor(){super(...arguments),this.hasWebGL2Context=!1}}(0,i._)([(0,s.o)({constValue:!0})],o.prototype,"hasSliceHighlight",void 0),(0,i._)([(0,s.o)({constValue:!1})],o.prototype,"hasSliceInVertexProgram",void 0),(0,i._)([(0,s.o)({constValue:!1})],o.prototype,"instancedDoublePrecision",void 0),(0,i._)([(0,s.o)({constValue:!1})],o.prototype,"useLegacyTerrainShading",void 0),(0,i._)([(0,s.o)({constValue:!1})],o.prototype,"hasModelTransformation",void 0),(0,i._)([(0,s.o)({constValue:n.P.Pass})],o.prototype,"pbrTextureBindType",void 0),(0,i._)([(0,s.o)()],o.prototype,"hasWebGL2Context",void 0)},65964:(t,e,r)=>{r.d(e,{n:()=>o,x:()=>a});var i=r(11873),n=r(71353),s=r(56529);class o extends s.Mt{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=(0,n.f)(1,1,1),this.vvSizeMaxSize=(0,n.f)(100,100,100),this.vvSizeOffset=(0,n.f)(0,0,0),this.vvSizeFactor=(0,n.f)(1,1,1),this.vvSizeValue=(0,n.f)(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=(0,i.c)()}}const a=8},22909:(t,e,r)=>{r.d(e,{Bw:()=>p,CN:()=>T,FZ:()=>M,Hx:()=>O,LO:()=>I,TT:()=>w,Tw:()=>E,Uf:()=>S});var i=r(63780),n=r(16889),s=r(92026),o=r(11186),a=r(71353),l=r(41414),c=r(68401),h=r(65216),u=r(97731),d=r(4760),f=r(32683);const _=(0,l.Ue)();function p(t,e,r,i,n,s,o){if(!(0,f.PD)(e))if(t.boundingInfo){(0,u.hu)(t.primitiveType===c.MX.Triangle);const e=r.tolerance;g(t.boundingInfo,i,n,e,s,o)}else{const e=t.indices.get(d.T.POSITION),r=t.vertexAttributes.get(d.T.POSITION);T(i,n,0,e.length/3,e,r,void 0,s,o)}}const m=(0,a.c)();function g(t,e,r,i,n,a){if((0,s.Wi)(t))return;const c=function(t,e,r){return(0,o.s)(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}(e,r,m);if((0,l.op)(_,t.getBBMin()),(0,l.Tn)(_,t.getBBMax()),(0,s.pC)(n)&&n.applyToAabb(_),E(_,e,c,i)){const{primitiveIndices:s,indices:o,position:l}=t,c=s?s.length:o.length/3;if(c>C){const s=t.getChildren();if(void 0!==s){for(let t=0;t<8;++t)void 0!==s[t]&&g(s[t],e,r,i,n,a);return}}T(e,r,0,c,o,l,s,n,a)}}const v=(0,a.c)();function T(t,e,r,i,n,o,a,l,c){if(a)return function(t,e,r,i,n,o,a,l,c){const h=o.data,u=o.stride||o.size,d=t[0],f=t[1],_=t[2],p=e[0]-d,m=e[1]-f,g=e[2]-_;for(let T=r;T<i;++T){const t=a[T];let e=3*t,r=u*n[e++],i=h[r++],o=h[r++],A=h[r];r=u*n[e++];let b=h[r++],E=h[r++],O=h[r];r=u*n[e];let S=h[r++],I=h[r++],w=h[r];(0,s.pC)(l)&&([i,o,A]=l.applyToVertex(i,o,A,T),[b,E,O]=l.applyToVertex(b,E,O,T),[S,I,w]=l.applyToVertex(S,I,w,T));const R=b-i,M=E-o,C=O-A,P=S-i,y=I-o,L=w-A,N=m*L-y*g,F=g*P-L*p,D=p*y-P*m,U=R*N+M*F+C*D;if(Math.abs(U)<=Number.EPSILON)continue;const B=d-i,H=f-o,V=_-A,G=B*N+H*F+V*D;if(U>0){if(G<0||G>U)continue}else if(G>0||G<U)continue;const W=H*C-M*V,z=V*R-C*B,q=B*M-R*H,k=p*W+m*z+g*q;if(U>0){if(k<0||G+k>U)continue}else if(k>0||G+k<U)continue;const j=(P*W+y*z+L*q)/U;j>=0&&c(j,x(R,M,C,P,y,L,v),t,!1)}}(t,e,r,i,n,o,a,l,c);const h=o.data,u=o.stride||o.size,d=t[0],f=t[1],_=t[2],p=e[0]-d,m=e[1]-f,g=e[2]-_;for(let T=r,A=3*r;T<i;++T){let t=u*n[A++],e=h[t++],r=h[t++],i=h[t];t=u*n[A++];let o=h[t++],a=h[t++],b=h[t];t=u*n[A++];let E=h[t++],O=h[t++],S=h[t];(0,s.pC)(l)&&([e,r,i]=l.applyToVertex(e,r,i,T),[o,a,b]=l.applyToVertex(o,a,b,T),[E,O,S]=l.applyToVertex(E,O,S,T));const I=o-e,w=a-r,R=b-i,M=E-e,C=O-r,P=S-i,y=m*P-C*g,L=g*M-P*p,N=p*C-M*m,F=I*y+w*L+R*N;if(Math.abs(F)<=Number.EPSILON)continue;const D=d-e,U=f-r,B=_-i,H=D*y+U*L+B*N;if(F>0){if(H<0||H>F)continue}else if(H>0||H<F)continue;const V=U*R-w*B,G=B*I-R*D,W=D*w-I*U,z=p*V+m*G+g*W;if(F>0){if(z<0||H+z>F)continue}else if(z>0||H+z<F)continue;const q=(M*V+C*G+P*W)/F;q>=0&&c(q,x(I,w,R,M,C,P,v),T,!1)}}const A=(0,a.c)(),b=(0,a.c)();function x(t,e,r,i,n,s,a){return(0,o.s)(A,t,e,r),(0,o.s)(b,i,n,s),(0,o.f)(a,A,b),(0,o.n)(a,a),a}function E(t,e,r,i){return function(t,e,r,i,n){const s=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-i-e[1])*r[1],h=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0)return!1;if(a=Math.max(a,Math.min(c,h)),a>l)return!1;const u=(t[2]-i-e[2])*r[2],d=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(u,d)),!(l<0)&&(a=Math.max(a,Math.min(u,d)),!(a>l)&&a<n)}(t,e,r,i,1/0)}function O(t,e,r,i,o){let a=(r.screenLength||0)*t.pixelRatio;(0,s.pC)(o)&&(a=(0,h.bA)(a,i,e,o));const l=a*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return(0,n.uZ)(l*e,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)}function S(t,e){const r=e?S(e):{};for(const i in t){let e=t[i];e&&e.forEach&&(e=R(e)),null==e&&i in r||(r[i]=e)}return r}function I(t,e){let r=!1;for(const n in e){const s=e[n];void 0!==s&&(Array.isArray(s)?null===t[n]?(t[n]=s.slice(),r=!0):(0,i.Vx)(t[n],s)&&(r=!0):t[n]!==s&&(r=!0,t[n]=s))}return r}function w(t,e,r,i,s,o){if(!e.options.selectionMode)return;const a=t.vertexAttributes.get(d.T.POSITION).data,l=t.vertexAttributes.get(d.T.SIZE),c=l&&l.data[0],h=i[0],u=i[1],f=((c+s)/2+4)*t.screenToWorldRatio;let _=Number.MAX_VALUE,p=0;for(let d=0;d<a.length-5;d+=3){const t=a[d],e=a[d+1],r=h-t,i=u-e,s=a[d+3]-t,o=a[d+4]-e,l=(0,n.uZ)((s*r+o*i)/(s*s+o*o),0,1),c=s*l-r,f=o*l-i,m=c*c+f*f;m<_&&(_=m,p=d/3)}_<f*f&&o(r.dist,r.normal,p,!1)}function R(t){const e=[];return t.forEach((t=>e.push(t))),e}const M={multiply:1,ignore:2,replace:3,tint:4},C=1e3},33236:(t,e,r)=>{r.d(e,{NK:()=>m,SW:()=>h,Vs:()=>_,ho:()=>u,s5:()=>d,xP:()=>p});var i=r(92026),n=r(14226),s=r(25158),o=r(97731),a=r(4760);function l(t,e,r,i){const n=r.typedBuffer,s=r.typedBufferStride,o=t.length;i*=s;for(let a=0;a<o;++a){const r=2*t[a];n[i]=e[r],n[i+1]=e[r+1],i+=s}}function c(t,e,r,i,n){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,null==n||1===n)for(let l=0;l<a;++l){const r=3*t[l];s[i]=e[r],s[i+1]=e[r+1],s[i+2]=e[r+2],i+=o}else for(let l=0;l<a;++l){const r=3*t[l];for(let t=0;t<n;++t)s[i]=e[r],s[i+1]=e[r+1],s[i+2]=e[r+2],i+=o}}function h(t,e,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,1===n)for(let l=0;l<a;++l){const r=4*t[l];s[i]=e[r],s[i+1]=e[r+1],s[i+2]=e[r+2],s[i+3]=e[r+3],i+=o}else for(let l=0;l<a;++l){const r=4*t[l];for(let t=0;t<n;++t)s[i]=e[r],s[i+1]=e[r+1],s[i+2]=e[r+2],s[i+3]=e[r+3],i+=o}}function u(t,e,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(!r)return void c(t,e,i,n,s);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,h=r[0],u=r[1],d=r[2],f=r[4],_=r[5],p=r[6],m=r[8],v=r[9],T=r[10],A=r[12],b=r[13],x=r[14];n*=a;let E=0,O=0,S=0;const I=g(r)?t=>{E=e[t]+A,O=e[t+1]+b,S=e[t+2]+x}:t=>{const r=e[t],i=e[t+1],n=e[t+2];E=h*r+f*i+m*n+A,O=u*r+_*i+v*n+b,S=d*r+p*i+T*n+x};if(1===s)for(let c=0;c<l;++c)I(3*t[c]),o[n]=E,o[n+1]=O,o[n+2]=S,n+=a;else for(let c=0;c<l;++c){I(3*t[c]);for(let t=0;t<s;++t)o[n]=E,o[n+1]=O,o[n+2]=S,n+=a}}function d(t,e,r,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(!r)return void c(t,e,i,s,o);const a=r,l=i.typedBuffer,h=i.typedBufferStride,u=t.length,d=a[0],f=a[1],_=a[2],p=a[4],m=a[5],v=a[6],T=a[8],A=a[9],b=a[10],x=!(0,n.x)(a),E=1e-6,O=1-E;s*=h;let S=0,I=0,w=0;const R=g(a)?t=>{S=e[t],I=e[t+1],w=e[t+2]}:t=>{const r=e[t],i=e[t+1],n=e[t+2];S=d*r+p*i+T*n,I=f*r+m*i+A*n,w=_*r+v*i+b*n};if(1===o)if(x)for(let n=0;n<u;++n){R(3*t[n]);const e=S*S+I*I+w*w;if(e<O&&e>E){const t=1/Math.sqrt(e);l[s]=S*t,l[s+1]=I*t,l[s+2]=w*t}else l[s]=S,l[s+1]=I,l[s+2]=w;s+=h}else for(let n=0;n<u;++n)R(3*t[n]),l[s]=S,l[s+1]=I,l[s+2]=w,s+=h;else for(let n=0;n<u;++n){if(R(3*t[n]),x){const t=S*S+I*I+w*w;if(t<O&&t>E){const e=1/Math.sqrt(t);S*=e,I*=e,w*=e}}for(let t=0;t<o;++t)l[s]=S,l[s+1]=I,l[s+2]=w,s+=h}}function f(t,e,r,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(!r)return void h(t,e,i,s,o);const a=r,l=i.typedBuffer,c=i.typedBufferStride,u=t.length,d=a[0],f=a[1],_=a[2],p=a[4],m=a[5],g=a[6],v=a[8],T=a[9],A=a[10],b=!(0,n.x)(a),x=1e-6,E=1-x;if(s*=c,1===o)for(let n=0;n<u;++n){const r=4*t[n],i=e[r],o=e[r+1],a=e[r+2],h=e[r+3];let u=d*i+p*o+v*a,O=f*i+m*o+T*a,S=_*i+g*o+A*a;if(b){const t=u*u+O*O+S*S;if(t<E&&t>x){const e=1/Math.sqrt(t);u*=e,O*=e,S*=e}}l[s]=u,l[s+1]=O,l[s+2]=S,l[s+3]=h,s+=c}else for(let n=0;n<u;++n){const r=4*t[n],i=e[r],a=e[r+1],h=e[r+2],u=e[r+3];let O=d*i+p*a+v*h,S=f*i+m*a+T*h,I=_*i+g*a+A*h;if(b){const t=O*O+S*S+I*I;if(t<E&&t>x){const e=1/Math.sqrt(t);O*=e,S*=e,I*=e}}for(let t=0;t<o;++t)l[s]=O,l[s+1]=S,l[s+2]=I,l[s+3]=u,s+=c}}function _(t,e,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(n*=a,r!==e.length||4!==r)if(1!==s)if(4!==r)for(let c=0;c<l;++c){const r=3*t[c];for(let t=0;t<s;++t)o[n]=e[r],o[n+1]=e[r+1],o[n+2]=e[r+2],o[n+3]=255,n+=a}else for(let c=0;c<l;++c){const r=4*t[c];for(let t=0;t<s;++t)o[n]=e[r],o[n+1]=e[r+1],o[n+2]=e[r+2],o[n+3]=e[r+3],n+=a}else{if(4===r){for(let r=0;r<l;++r){const i=4*t[r];o[n]=e[i],o[n+1]=e[i+1],o[n+2]=e[i+2],o[n+3]=e[i+3],n+=a}return}for(let r=0;r<l;++r){const i=3*t[r];o[n]=e[i],o[n+1]=e[i+1],o[n+2]=e[i+2],o[n+3]=255,n+=a}}else{o[n]=e[0],o[n+1]=e[1],o[n+2]=e[2],o[n+3]=e[3];const t=new Uint32Array(i.typedBuffer.buffer,i.start),r=a/4,c=t[n/=4];n+=r;const h=l*s;for(let e=1;e<h;++e)t[n]=c,n+=r}}function p(t,e,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=e.typedBuffer,o=e.typedBufferStride;if(i*=o,1===n)for(let a=0;a<r;++a)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let e=0;e<n;++e)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o}function m(t,e,r,n,c,h){for(const m of e.fieldNames){const e=t.vertexAttributes.get(m),g=t.indices.get(m);if(e&&g)switch(m){case a.T.POSITION:{(0,o.hu)(3===e.size);const t=c.getField(m,s.ct);t&&u(g,e.data,r,t,h);break}case a.T.NORMAL:{(0,o.hu)(3===e.size);const t=c.getField(m,s.ct);t&&d(g,e.data,n,t,h);break}case a.T.UV0:{(0,o.hu)(2===e.size);const t=c.getField(m,s.Eu);t&&l(g,e.data,t,h);break}case a.T.COLOR:{(0,o.hu)(3===e.size||4===e.size);const t=c.getField(m,s.mc);t&&_(g,e.data,e.size,t,h);break}case a.T.SYMBOLCOLOR:{(0,o.hu)(3===e.size||4===e.size);const t=c.getField(m,s.mc);t&&_(g,e.data,e.size,t,h);break}case a.T.TANGENT:{(0,o.hu)(4===e.size);const t=c.getField(m,s.ek);t&&f(g,e.data,n,t,h);break}}else if(m===a.T.OBJECTANDLAYERIDCOLOR&&(0,i.pC)(t.objectAndLayerIdColor)&&4===t.objectAndLayerIdColor.length){const e=t.indices.get(a.T.POSITION);if(e){const r=e.length,i=c.getField(m,s.mc);p(t.objectAndLayerIdColor,i,r,h)}}}}function g(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[8]&&0===t[9]&&1===t[10]}},32683:(t,e,r)=>{r.d(e,{EE:()=>d,PD:()=>h,U_:()=>c,bZ:()=>u,lr:()=>l});var i=r(92026),n=r(14226),s=r(81949),o=r(97731),a=r(43411);function l(t,e){return(0,i.Wi)(t)&&(t=[]),t.push(e),t}function c(t,e){if((0,i.Wi)(t))return null;const r=t.filter((t=>t!==e));return 0===r.length?null:r}function h(t){return!!(0,i.pC)(t)&&!t.visible}function u(t,e,r){const s=t.origin.vec3;(0,o.u_)(p,-s[0],-s[1],-s[2]),(0,i.pC)(t.transformation)?(0,n.m)(e,p,t.transformation):(0,n.c)(e,p),(0,n.a)(r,e),(0,n.t)(r,r)}function d(t,e,r,i,n){f[0]=t.get(e,0),f[1]=t.get(e,1),f[2]=t.get(e,2),(0,a.LF)(f,_,3),r.set(n,0,_[0]),i.set(n,0,_[1]),r.set(n,1,_[2]),i.set(n,1,_[3]),r.set(n,2,_[4]),i.set(n,2,_[5])}const f=new Float64Array(3),_=new Float32Array(6),p=(0,s.c)()},61109:(t,e,r)=>{r.d(e,{G:()=>i});class i{constructor(t,e,r,i,n){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.name=t,this.count=e,this.type=r,this.offset=i,this.stride=n,this.normalized=s,this.divisor=o}}},43411:(t,e,r)=>{function i(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function n(t,e){const r=t.length;for(let i=0;i<r;++i)o[0]=t[i],e[i]=o[0];return e}function s(t,e){const r=t.length;for(let i=0;i<r;++i)o[0]=t[i],o[1]=t[i]-o[0],e[i]=o[1];return e}r.d(e,{GB:()=>s,LF:()=>i,U8:()=>n});const o=new Float32Array(2)},36207:(t,e,r)=>{r.d(e,{BK:()=>u,LZ:()=>h,if:()=>s,jp:()=>V,sg:()=>l,sm:()=>A,wK:()=>o,zp:()=>c});var i=r(68401),n=r(8548);function s(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.db.ADD,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0,0];return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function o(t,e,r,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n.db.ADD,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n.db.ADD,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0,0];return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a={face:n.LR.BACK,mode:n.Wf.CCW},l={face:n.LR.FRONT,mode:n.Wf.CCW},c=t=>t===i.Vr.Back?a:t===i.Vr.Front?l:null,h={zNear:0,zFar:1},u={r:!0,g:!0,b:!0,a:!0};function d(t){return E.intern(t)}function f(t){return S.intern(t)}function _(t){return w.intern(t)}function p(t){return M.intern(t)}function m(t){return P.intern(t)}function g(t){return L.intern(t)}function v(t){return F.intern(t)}function T(t){return U.intern(t)}function A(t){return H.intern(t)}class b{constructor(t,e){this._makeKey=t,this._makeRef=e,this._interns=new Map}intern(t){if(!t)return null;const e=this._makeKey(t),r=this._interns;return r.has(e)||r.set(e,this._makeRef(t)),r.get(e)??null}}function x(t){return"["+t.join(",")+"]"}const E=new b(O,(t=>({__tag:"Blending",...t})));function O(t){return t?x([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const S=new b(I,(t=>({__tag:"Culling",...t})));function I(t){return t?x([t.face,t.mode]):null}const w=new b(R,(t=>({__tag:"PolygonOffset",...t})));function R(t){return t?x([t.factor,t.units]):null}const M=new b(C,(t=>({__tag:"DepthTest",...t})));function C(t){return t?x([t.func]):null}const P=new b(y,(t=>({__tag:"StencilTest",...t})));function y(t){return t?x([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const L=new b(N,(t=>({__tag:"DepthWrite",...t})));function N(t){return t?x([t.zNear,t.zFar]):null}const F=new b(D,(t=>({__tag:"ColorWrite",...t})));function D(t){return t?x([t.r,t.g,t.b,t.a]):null}const U=new b(B,(t=>({__tag:"StencilWrite",...t})));function B(t){return t?x([t.mask]):null}const H=new b((function(t){return t?x([O(t.blending),I(t.culling),R(t.polygonOffset),C(t.depthTest),y(t.stencilTest),N(t.depthWrite),D(t.colorWrite),B(t.stencilWrite)]):null}),(t=>({blending:d(t.blending),culling:f(t.culling),polygonOffset:_(t.polygonOffset),depthTest:p(t.depthTest),stencilTest:m(t.stencilTest),depthWrite:g(t.depthWrite),colorWrite:v(t.colorWrite),stencilWrite:T(t.stencilWrite)})));class V{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,e,r,i){return(r||t!==e)&&(i(t),this._pipelineInvalid=!0),t}}}}]);
//# sourceMappingURL=5063.c3d53831.chunk.js.map