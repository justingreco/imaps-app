"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[5604],{42137:(e,t,o)=>{o.d(t,{Z:()=>y});var i,n=o(27366),r=o(68860),s=o(49861),a=(o(63780),o(93169),o(25243),o(69912)),p=o(7882),l=o(80885),h=o(92183),c=o(15559),d=o(81753),u=o(89093);let g=i=class extends l.Z{constructor(){super(...arguments),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let o;if(e&&e.center)o=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);o={center:e}}return{...super.normalizeCtorArgs(),...o,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,0!==this.rings.length||!e)return;const o=(0,r.En)(this.radius,this.radiusUnit,"meters"),i=e.spatialReference;let n,s="geographic";if(i.isWebMercator?s="webMercator":(null!=u.Z[i.wkid]||i.wkt&&0===i.wkt.indexOf("PROJCS"))&&(s="projected"),this.geodesic){let i;switch(s){case"webMercator":i=(0,d.Sx)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":i=e}n=this._createGeodesicCircle(i,o,t),"webMercator"===s&&(n=(0,d.$)(n))}else{let i;"webMercator"===s||"projected"===s?i=o/this._convert2Meters(1,e.spatialReference):"geographic"===s&&(i=(0,r.ty)(o,"meters",(0,h.Iu)(e.spatialReference).radius)),n=this._createPlanarCircle(e,i,t)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:o,radiusUnit:n,geodesic:r}=this;return new i({center:e.clone(),numberOfPoints:t,radius:o,radiusUnit:n,geodesic:r})}_createGeodesicCircle(e,t,o){let i=0;const n=[];for(;i<360;){const r=[0,0],s=[e.x,e.y];(0,c.TB)(r,s,i,t),this.hasZ&&r.push(e.z),n.push(r),i+=360/o}return n.push(n[0]),new l.Z(n)}_createPlanarCircle(e,t,o){const i=[],n=2*Math.PI/o;for(let r=0;r<o;++r){const o=n*r,s=[e.x+Math.cos(-o)*t,e.y+Math.sin(-o)*t];this.hasZ&&s.push(e.z),i.push(s)}return i.push(i[0]),new l.Z({spatialReference:e.spatialReference,rings:[i]})}_convert2Meters(e,t){let o;if(null!=u.Z[t.wkid])o=u.Z.values[u.Z[t.wkid]];else{const e=t.wkt,i=e.lastIndexOf(",")+1,n=e.lastIndexOf("]]");o=parseFloat(e.substring(i,n))}return e*o}};(0,n._)([(0,s.Cb)({type:p.Z})],g.prototype,"center",void 0),(0,n._)([(0,s.Cb)()],g.prototype,"geodesic",void 0),(0,n._)([(0,s.Cb)()],g.prototype,"numberOfPoints",void 0),(0,n._)([(0,s.Cb)()],g.prototype,"radius",void 0),(0,n._)([(0,s.Cb)()],g.prototype,"radiusUnit",void 0),g=i=(0,n._)([(0,a.j)("esri.geometry.Circle")],g);const y=g},40237:(e,t,o)=>{o.d(t,{N:()=>i});const i={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,o){const i=new n(e.getPointX(t),e.getPointY(t),o),r=e.hasZ(t),s=e.hasM(t);return r&&(i.z=e.getPointZ(t)),s&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,o){return new r(e.exportPaths(t),o,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,o){return new s(e.exportPaths(t),o,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,o){return new a(e.exportPoints(t),o,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,o){const i=e.hasZ(t),n=e.hasM(t),r=new p(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),o);if(i){const o=e.getZExtent(t);r.zmin=o.vmin,r.zmax=o.vmax}if(n){const o=e.getMExtent(t);r.mmin=o.vmin,r.mmax=o.vmax}return r}};class n{constructor(e,t,o){this.x=e,this.y=t,this.spatialReference=o,this.z=void 0,this.m=void 0}}class r{constructor(e,t,o,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,o&&(this.hasZ=o),i&&(this.hasM=i)}}class s{constructor(e,t,o,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,o&&(this.hasZ=o),i&&(this.hasM=i)}}class a{constructor(e,t,o,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,o&&(this.hasZ=o),i&&(this.hasM=i)}}class p{constructor(e,t,o,i,n){this.xmin=e,this.ymin=t,this.xmax=o,this.ymax=i,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},19995:(e,t,o)=>{o.d(t,{_W:()=>d,iV:()=>y,oj:()=>m});var i=o(92026),n=o(79803),r=o(40237),s=o(92975),a=o(81753);const p=[0,0];function l(e,t){if(!t)return null;if("x"in t){const o={x:0,y:0};return[o.x,o.y]=e(t.x,t.y,p),null!=t.z&&(o.z=t.z),null!=t.m&&(o.m=t.m),o}if("xmin"in t){const o={xmin:0,ymin:0,xmax:0,ymax:0};return[o.xmin,o.ymin]=e(t.xmin,t.ymin,p),[o.xmax,o.ymax]=e(t.xmax,t.ymax,p),t.hasZ&&(o.zmin=t.zmin,o.zmax=t.zmax,o.hasZ=!0),t.hasM&&(o.mmin=t.mmin,o.mmax=t.mmax,o.hasM=!0),o}return"rings"in t?{rings:h(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:h(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:c(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function h(e,t){const o=[];for(const i of e)o.push(c(i,t));return o}function c(e,t){const o=[];for(const i of e){const e=t(i[0],i[1],[0,0]);o.push(e),i.length>2&&e.push(i[2]),i.length>3&&e.push(i[3])}return o}async function d(e,t){if(!t)return;const o=Array.isArray(e)?e.map((e=>(0,i.pC)(e.geometry)&&e.geometry.spatialReference)):[e];await(0,n.iQ)(o.map((e=>({source:e,dest:t}))))}const u=l.bind(null,a.hG),g=l.bind(null,a.R6);function y(e,t,o,i){if(!e)return e;if(o||(o=t,t=e.spatialReference),!(0,s.JY)(t)||!(0,s.JY)(o)||(0,s.fS)(t,o))return e;if((0,a.Q8)(t,o)){const t=(0,s.sS)(o)?u(e):g(e);return t.spatialReference=o,t}return(0,n.oj)(r.N,[e],t,o,null,i)[0]}const v=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,o){if(!e||!e.length||!t||!o||(0,s.fS)(t,o))return e;const i={geometries:e,inSpatialReference:t,outSpatialReference:o,resolve:null};return this._jobs.push(i),new Promise((e=>{i.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:o,outSpatialReference:i,resolve:p}=e;(0,a.Q8)(o,i)?(0,s.sS)(i)?p(t.map(u)):p(t.map(g)):p((0,n.oj)(r.N,t,o,i,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function m(e,t,o){return v.push(e,t,o)}},74509:(e,t,o)=>{o.d(t,{Lt:()=>l,Ou:()=>c,RL:()=>p,VW:()=>s,Zz:()=>r,vQ:()=>d,vu:()=>a,zx:()=>u});var i=o(92026),n=o(88152);function r(e,t){return(0,i.Wi)(t)||!t.mode?e?"absolute-height":"on-the-ground":t.mode}function s(e,t){return r(!!(0,i.pC)(e)&&e.hasZ,t)}function a(e){const t=h(e);return s(e.geometry,t)}function p(e){const t=h(e),o=s(e.geometry,t);return{mode:o,offset:(0,i.pC)(t)&&"on-the-ground"!==o?(0,i.Pt)(t.offset,0)*(0,n.Z7)((0,i.Pt)(t.unit,"meters")):0}}function l(e){if("on-the-ground"===a(e))return!1;const t=h(e),o=(0,i.pC)(t)&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!o||"0"===o)}function h(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function c(e,t,o){if((0,i.Wi)(o)||!o.mode)return;const n=e.hasZ?e.z:0,r=(0,i.pC)(o.offset)?o.offset:0;switch(o.mode){case"absolute-height":return n-r;case"on-the-ground":return 0;case"relative-to-ground":return n-((0,i.Pt)(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"ground"),0)+r);case"relative-to-scene":return n-((0,i.Pt)(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"scene"),0)+r)}}function d(e,t,o){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return g(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,o,i)}function u(e,t,o,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return g(e,t[0],t[1],t.length>2?t[2]:0,o,i,n)}function g(e,t,o,n,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if((0,i.Wi)(s))return;const p=(0,i.pC)(a)?a.mode:"absolute-height";if("on-the-ground"===p)return 0;const{absoluteZ:l}=y(t,o,n,r,e,s);return v(l,t,o,n,r,e,a,p)}function y(e,t,o,n,r,s){const a=(0,i.pC)(s.offset)?s.offset:0;switch(s.mode){case"absolute-height":return{absoluteZ:o+a,elevation:0};case"on-the-ground":{const o=(0,i.Pt)(r.elevationProvider.getElevation(e,t,0,n,"ground"),0);return{absoluteZ:o,elevation:o}}case"relative-to-ground":{const s=(0,i.Pt)(r.elevationProvider.getElevation(e,t,o,n,"ground"),0);return{absoluteZ:o+s+a,elevation:s}}case"relative-to-scene":{const s=(0,i.Pt)(r.elevationProvider.getElevation(e,t,o,n,"scene"),0);return{absoluteZ:o+s+a,elevation:s}}}}function v(e,t,o,n,r,s,a,p){const l=(0,i.pC)(a)&&(0,i.pC)(a.offset)?a.offset:0;switch(p){case"absolute-height":return e-l;case"relative-to-ground":return e-((0,i.Pt)(s.elevationProvider.getElevation(t,o,n,r,"ground"),0)+l);case"relative-to-scene":return e-((0,i.Pt)(s.elevationProvider.getElevation(t,o,n,r,"scene"),0)+l)}}},77498:(e,t,o)=>{o.d(t,{Z:()=>n,e:()=>i});var i;o(93169);function n(e){switch(e){case i.SUPPORTED:break;case i.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case i.GEOMETRY_MISSING:return"no geometry";case i.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case i.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case i.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}!function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(i||(i={}))},57889:(e,t,o)=>{o.d(t,{P:()=>s});o(93169);var i=o(92026),n=o(74509),r=o(77498);function s(e){if("graphics"!==e.layer?.type)return r.e.GRAPHICS_LAYER_MISSING;if((0,i.Wi)(e.geometry))return r.e.GEOMETRY_MISSING;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return r.e.GEOMETRY_TYPE_UNSUPPORTED}return"on-the-ground"!==(0,n.vu)(e)&&(0,n.Lt)(e)?r.e.ELEVATION_MODE_UNSUPPORTED:r.e.SUPPORTED}},46684:(e,t,o)=>{o.d(t,{P:()=>a,b:()=>p});var i=o(92026),n=o(42137),r=o(74509),s=o(77498);function a(e){return l(e).result}function p(e){return l(e).geometry}function l(e){return"graphics"!==e.layer?.type?{result:s.e.GRAPHICS_LAYER_MISSING,geometry:null}:(0,i.Wi)(e.geometry)?{result:s.e.GEOMETRY_MISSING,geometry:null}:"on-the-ground"!==(0,r.vu)(e)&&(0,r.Lt)(e)?{result:s.e.ELEVATION_MODE_UNSUPPORTED,geometry:null}:"point"!==e.geometry.type&&"polyline"!==e.geometry.type&&("polygon"!==e.geometry.type||e.geometry instanceof n.Z)?{result:s.e.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:s.e.SUPPORTED,geometry:e.geometry}}},83089:(e,t,o)=>{o.d(t,{j:()=>r,p:()=>n});var i=o(92026);function n(e,t,o){if(!t||!e||!e.map)return;const{map:i}=e,n=i.layers.find((e=>e===t));n||i.add(t,o),null!=o&&i.layers.reorder(n,o)}function r(e,t){return e.allLayerViews.find((e=>{const o=e.layer;return o===t||"sublayers"in o&&(0,i.pC)(o.sublayers)&&o.sublayers.includes(t)}))}},87888:(e,t,o)=>{o.d(t,{j:()=>i});const i={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "}},52349:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(27366),n=o(85015),r=o(49861),s=(o(63780),o(93169),o(25243),o(69912));let a=class extends n.Z{constructor(e){super(e),this.enabled=!1}};(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],a.prototype,"enabled",void 0),a=(0,i._)([(0,s.j)("esri.views.interactive.sketch.SketchLabelOptions")],a);const p=a},61920:(e,t,o)=>{o.d(t,{Z:()=>h});var i=o(27366),n=o(85015),r=o(49861),s=(o(63780),o(93169),o(25243),o(69912));let a=class extends n.Z{constructor(e){super(e),this.mode="absolute-height"}};(0,i._)([(0,r.Cb)({type:String,nonNullable:!0})],a.prototype,"mode",void 0),a=(0,i._)([(0,s.j)("esri.widgets.Sketch.SketchTooltipOptions.ElevationOptions")],a);let p=class extends n.Z{constructor(){super(...arguments),this.distance=!0,this.elevation=!0,this.size=!0,this.scale=!0,this.rotation=!0,this.orientation=!0,this.totalLength=!0,this.area=!0,this.radius=!0}};(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],p.prototype,"distance",void 0),(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],p.prototype,"elevation",void 0),(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],p.prototype,"size",void 0),(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],p.prototype,"scale",void 0),(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],p.prototype,"rotation",void 0),(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],p.prototype,"orientation",void 0),(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],p.prototype,"totalLength",void 0),(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],p.prototype,"area",void 0),(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],p.prototype,"radius",void 0),p=(0,i._)([(0,s.j)("esri.widgets.Sketch.SketchTooltipOptions.VisibleElements")],p);let l=class extends n.Z{constructor(e){super(e),this.enabled=!1,this.elevation=new a,this.visibleElements=new p,this.visualVariables=null}};(0,i._)([(0,r.Cb)({type:Boolean,nonNullable:!0})],l.prototype,"enabled",void 0),(0,i._)([(0,r.Cb)({type:a,nonNullable:!0})],l.prototype,"elevation",void 0),(0,i._)([(0,r.Cb)({type:p,nonNullable:!0})],l.prototype,"visibleElements",void 0),(0,i._)([(0,r.Cb)()],l.prototype,"visualVariables",void 0),l=(0,i._)([(0,s.j)("esri.widgets.Sketch.SketchTooltipOptions")],l);const h=l},76014:(e,t,o)=>{o.d(t,{c:()=>h});var i=o(27366),n=o(51995),r=o(46784),s=o(49861),a=o(69912);let p=class extends r.wq{constructor(){super(...arguments),this.enabled=!0}};(0,i._)([(0,s.Cb)({type:Boolean})],p.prototype,"enabled",void 0),p=(0,i._)([(0,a.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],p);let l=class extends r.wq{constructor(e){super(e),this.lineSnapper=new p,this.parallelLineSnapper=new p,this.rightAngleSnapper=new p,this.rightAngleTriangleSnapper=new p,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new n.Z([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};(0,i._)([(0,s.Cb)({type:p,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"lineSnapper",void 0),(0,i._)([(0,s.Cb)({type:p,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"parallelLineSnapper",void 0),(0,i._)([(0,s.Cb)({type:p,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"rightAngleSnapper",void 0),(0,i._)([(0,s.Cb)({type:p,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"rightAngleTriangleSnapper",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],l.prototype,"shortLineThreshold",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],l.prototype,"distance",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"pointThreshold",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"intersectionParallelLineThreshold",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"parallelLineThreshold",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"touchSensitivityMultiplier",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"pointOnLineThreshold",void 0),(0,i._)([(0,s.Cb)({type:n.Z,nonNullable:!0})],l.prototype,"orange",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"lineHintWidthReference",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"lineHintWidthTarget",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"lineHintFadedExtensions",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"parallelLineHintWidth",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],l.prototype,"parallelLineHintLength",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],l.prototype,"parallelLineHintOffset",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],l.prototype,"rightAngleHintSize",void 0),(0,i._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],l.prototype,"rightAngleHintOutlineSize",void 0),l=(0,i._)([(0,a.j)("esri.views.interactive.snapping.Settings.Defaults")],l);const h=new l},95122:(e,t,o)=>{o.d(t,{Bq:()=>u,Hk:()=>l,UL:()=>g,ku:()=>d,yG:()=>c});var i=o(88396),n=o(6394),r=o(76014),s=o(64674),a=o(94163);class p{constructor(e){this.coordinateHelper=e}}class l extends p{constructor(e,t){super(e),this.point=t}objectEqual(e){return e instanceof l&&(0,s.Xv)(this.point,e.point)}check(e){return(0,i.s)(e,this.point)<r.c.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(e){const t=[];return e instanceof h?t.push(...(0,a.pk)({start:e.start,end:e.end,type:e instanceof d?a.SP.LINE:a.SP.RAY},this.point)):e instanceof g&&t.push(...(0,a.l0)(e.center,e.radius,this.point)),t.map((t=>new u(this.coordinateHelper,t,this,e)))}}class h extends p{constructor(e,t,o){super(e),this.start=t,this.end=o}objectEqual(e){return e instanceof h&&(0,s.Xv)(this.start,e.start)&&(0,s.Xv)(this.end,e.end)}intersect(e){const t=[];return e instanceof l?t.push(...(0,a.pk)({start:this.start,end:this.end,type:this instanceof d?a.SP.LINE:a.SP.RAY},e.point)):e instanceof h?t.push(...(0,a.dU)({start:this.start,end:this.end,type:this instanceof d?a.SP.LINE:a.SP.RAY},{start:e.start,end:e.end,type:e instanceof d?a.SP.LINE:a.SP.RAY})):e instanceof g&&t.push(...(0,a.UG)({start:this.start,end:this.end,type:this instanceof d?a.SP.LINE:a.SP.RAY},e.center,e.radius)),t.map((t=>new u(this.coordinateHelper,t,this,e)))}}class c extends h{constructor(e,t,o){super(e,t,o),this.dir=(0,n.a)(),this.p=(0,n.a)()}objectEqual(e){return e instanceof c&&super.objectEqual(e)}check(e){return(0,i.g)(this.dir,this.end,this.start),(0,i.g)(this.p,e,this.start),(0,i.h)(this.dir,this.p)>=0&&(0,a.Oy)(e,this.start,this.end)<r.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,a.aW)(t,e,this.start,this.end),t}}class d extends h{constructor(e,t,o){super(e,t,o)}objectEqual(e){return e instanceof d&&super.objectEqual(e)}check(e){return(0,a.Oy)(e,this.start,this.end)<r.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,a.k0)(t,e,this.start,this.end),t}}class u extends p{constructor(e,t,o,i){super(e),this.intersection=t,this.first=o,this.second=i}objectEqual(e){return e instanceof u&&this.first.objectEqual(e.first)&&this.second.objectEqual(e.second)}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,i.c)(t,this.intersection),t}intersect(){return[]}}class g extends p{constructor(e,t,o){super(e),this.center=t,this.radius=o}objectEqual(e){return e instanceof g&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,a.xO)(t,e,this.center,this.radius),t}intersect(e){const t=[];return e instanceof h?t.push(...(0,a.UG)({start:e.start,end:e.end,type:e instanceof d?a.SP.LINE:a.SP.RAY},this.center,this.radius)):e instanceof l&&t.push(...(0,a.l0)(this.center,this.radius,e.point)),t.map((t=>new u(this.coordinateHelper,t,this,e)))}}},95905:(e,t,o)=>{o.d(t,{L:()=>a});var i=o(95122),n=o(64674),r=o(75691),s=o(53397);class a extends r.a{constructor(e){super({...e,constraint:new i.ku(e.coordinateHelper,e.edgeStart,e.edgeEnd)})}get hints(){return[new s.w(n.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo)]}}},75691:(e,t,o)=>{o.d(t,{a:()=>n});var i=o(92605);class n extends i.j{constructor(e){let{coordinateHelper:t,targetPoint:o,objectId:i,constraint:n,elevationInfo:r}=e;super(t,o,n,r),this.objectId=i}}},92605:(e,t,o)=>{o.d(t,{j:()=>i});class i{constructor(e,t,o,i){this.coordinateHelper=e,this.targetPoint=t,this.constraint=o,this.elevationInfo=i}}},90609:(e,t,o)=>{o.d(t,{w:()=>r});var i=o(64674),n=o(55054);class r extends n.r{constructor(e,t){super(t),this.intersectionPoint=e}equals(e){return e instanceof r&&(0,i.Xv)(this.intersectionPoint,e.intersectionPoint)}}},53397:(e,t,o)=>{o.d(t,{w:()=>s});o(93169);var i=o(32718),n=o(64674),r=o(55054);i.Z.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class s extends r.r{constructor(e,t,o,i){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(i),this.type=e,this.lineStart=t,this.lineEnd=o,this.fadeLeft=n,this.fadeRight=r}equals(e){return e instanceof s&&this.type===e.type&&(0,n.Xv)(this.lineStart,e.lineStart)&&(0,n.Xv)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}},5916:(e,t,o)=>{o.d(t,{L:()=>s});o(93169);var i=o(32718),n=o(64674),r=o(55054);i.Z.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class s extends r.r{constructor(e,t,o){super(o),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof s&&(0,n.Xv)(this.lineStart,e.lineStart)&&(0,n.Xv)(this.lineEnd,e.lineEnd)}}},41216:(e,t,o)=>{o.d(t,{y:()=>s});o(93169);var i=o(32718),n=o(64674),r=o(55054);i.Z.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class s extends r.r{constructor(e,t,o,i){super(i),this.previousVertex=e,this.centerVertex=t,this.nextVertex=o}equals(e){return e instanceof s&&(0,n.Xv)(this.previousVertex,e.previousVertex)&&(0,n.Xv)(this.centerVertex,e.centerVertex)&&(0,n.Xv)(this.nextVertex,e.nextVertex)}}},55054:(e,t,o)=>{o.d(t,{r:()=>i});class i{constructor(e){this.elevationInfo=e}}},64674:(e,t,o)=>{o.d(t,{Xv:()=>s,lQ:()=>a,tp:()=>r,ze:()=>i});var i,n=o(88396);function r(e,t){const o=e.x-t.x,i=e.y-t.y;return o*o+i*i}function s(e,t){const o=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return o;case 3:return o&&e[2]===t[2];case 4:return o&&e[3]===t[3]}return!1}function a(e,t){t.sort(((t,o)=>(0,n.s)(t.targetPoint,e)-(0,n.s)(o.targetPoint,e)))}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(i||(i={}))},11208:(e,t,o)=>{o.d(t,{$r:()=>p,By:()=>c,RS:()=>l,a7:()=>h});var i=o(17842),n=(o(88396),o(11186)),r=o(71353),s=o(7882),a=o(74509);function p(e,t,o,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,r.c)();const s=t.toXYZ(e);return s[2]=(0,a.zx)(i,s,t.spatialReference,o)||0,i.renderCoordsHelper.toRenderCoords(s,t.spatialReference,n),n}function l(e,t,o,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,r.c)();const p=(0,n.c)(u,e);return p[2]=(0,a.zx)(i,p,t,o)||0,i.renderCoordsHelper.toRenderCoords(p,t,s),s}function h(e,t,o,n){return"2d"===n.type?n.toScreen(t.vectorToPoint(e,d)):(p(e,t,o,n,u),n.state.camera.projectToScreen(u,g),(0,i.vW)(g[0],g[1]))}function c(e,t,o,i,n,r,s){const p=o.toXYZ(e),l=o.toXYZ(t);if("absolute-height"!==i.mode){const e=(0,a.zx)(n,p,o.spatialReference,i),t=(0,a.zx)(n,l,o.spatialReference,i),r=(null==e?t:null==t?e:Math.min(e,t))||0;p[2]=r,l[2]=r}n.renderCoordsHelper.toRenderCoords(p,o.spatialReference,r),n.renderCoordsHelper.toRenderCoords(l,o.spatialReference,s)}const d=new s.Z,u=(0,r.c)(),g=((0,i.J$)(),(0,i.J$)(),(0,i.s1)());(0,i.s1)()},94163:(e,t,o)=>{o.d(t,{Oy:()=>p,SP:()=>i,UG:()=>v,aW:()=>c,dU:()=>y,k0:()=>h,l0:()=>g,pk:()=>u,xO:()=>d});var i,n=o(16889),r=o(88396),s=o(6394);function a(e,t){return e[0]*t[1]-e[1]*t[0]}function p(e,t,o){const i=(t[0]-e[0])*(o[1]-e[1])-(t[1]-e[1])*(o[0]-e[0]);return Math.abs(i)/(0,r.j)(t,o)}function l(e,t,o){const i=(0,r.h)(o,t)/(0,r.u)(o);return(0,r.f)(e,o,i)}function h(e,t,o,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o;return(0,r.g)(f,i,o),(0,r.g)(b,t,n),l(E,b,f),(0,r.b)(e,n,E)}function c(e,t,o,i){(0,r.g)(f,i,o),(0,r.g)(b,t,o);const n=(0,r.h)(f,b)/(0,r.u)(f);return n>0?(0,r.v)(e,o,f,n):(0,r.c)(e,o)}function d(e,t,o,i){(0,r.g)(f,t,o);const n=i/(0,r.o)(f);return(0,r.v)(e,o,f,n)}function u(e,t){return h(b,t,e.start,e.end),(0,n.W8)(b[0],t[0])&&(0,n.W8)(b[1],t[1])?[(0,s.d)(t)]:[]}function g(e,t,o){return d(b,o,e,t),(0,n.W8)(b[0],o[0])&&(0,n.W8)(b[1],o[1])?[(0,s.d)(o)]:[]}function y(e,t){const o=e.start,n=e.end,s=t.start,p=t.end,l=(0,r.g)(f,n,o),h=(0,r.g)(_,p,s),c=a(l,h);if(Math.abs(c)<=m)return[];const d=(0,r.g)(b,o,s),u=a(h,d)/c,g=a(l,d)/c;if(u>=0){if(g>=0||t.type===i.LINE)return[(0,r.v)(E,o,l,u)]}else if(e.type===i.LINE&&(g>=0||t.type===i.LINE))return[(0,r.v)(E,o,l,u)];return[]}function v(e,t,o){const n=[],s=(0,r.g)(f,e.end,e.start),a=(0,r.g)(_,e.start,t),p=(0,r.u)(s),l=2*(0,r.h)(s,a),h=l*l-4*p*((0,r.u)(a)-o*o);if(0===h){const t=-l/(2*p);(e.type===i.LINE||t>=0)&&n.push((0,r.v)(E,e.start,s,t))}else if(h>0){const t=Math.sqrt(h),o=(-l+t)/(2*p);(e.type===i.LINE||o>=0)&&n.push((0,r.v)(E,e.start,s,o));const a=(-l-t)/(2*p);(e.type===i.LINE||a>=0)&&n.push((0,r.v)(b,e.start,s,a))}return n}!function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"}(i||(i={}));const m=1e-6,f=(0,s.a)(),_=(0,s.a)(),b=(0,s.a)(),E=(0,s.a)()},97426:(e,t,o)=>{o.d(t,{Z:()=>Ue});var i=o(27366),n=o(51508),r=o(40281),s=(o(93169),o(10064)),a=o(91505),p=o(100),l=o(32718),h=o(92026),c=o(66978),d=o(94172),u=o(49861),g=(o(63780),o(25243),o(69912)),y=o(79803),v=o(92183),m=o(69662),f=o(92975),_=o(93655),b=o(15404),E=o(77498),w=o(57889),C=o(46684),S=o(74509);var T,x=o(83089),O=o(91806),P=o(87888),G=o(52349),R=o(61920),I=o(41691),M=o(88396),H=o(77427),A=o(71353),k=o(92536),L=o(95122),V=o(64674),N=o(95905),D=o(75691),U=o(92605),j=o(53397),Z=o(41216);class F extends U.j{constructor(e){let{coordinateHelper:t,targetPoint:o,constraint:i,previousVertex:n,otherVertex:r,otherVertexType:s,objectId:a,elevationInfo:p}=e;super(t,o,i,p),this.previousVertex=n,this.otherVertex=r,this.otherVertexType=s,this.objectId=a}get hints(){const e=this.previousVertex,t=this.otherVertexType===T.CENTER?this.otherVertex:this.targetPoint,o=this.otherVertexType===T.CENTER?this.targetPoint:this.otherVertex,i=this.elevationInfo;return[new j.w(V.ze.TARGET,t,o,i),new j.w(V.ze.REFERENCE,e,t,i),new Z.y(this.previousVertex,t,o,i)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(T||(T={}));var W=o(11208);let z=class extends I.r{constructor(e){super(e),this.options=null,this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return(0,H.oE)(this.snappingSources,(e=>{let{snappingSource:t}=e;return t.updating}))||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,t=new Map;if((0,h.pC)(this.options)&&(0,h.pC)(this.options.featureSources))for(const o of this.options.featureSources.items){const i=o.layer.uid,n=e.get(i);if(n){e.delete(i),t.set(i,n);continue}if(!o.layer.loaded){this.updatingHandles.addPromise(o.layer.load());continue}const r=this._createSourceInfo(o);(0,h.pC)(r)&&t.set(i,r)}for(const[,o]of e)o.destroy();return t}initialize(){this.updatingHandles.add((()=>this.snappingSources),(()=>this.notifyChange("updating")),d.Z_),(0,h.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",(e=>this._updateLayerView(e.layer,e.layerView))),this.view.on("layerview-destroy",(e=>this._updateLayerView(e.layer,null)))])}_updateLayerView(e,t){for(const[,o]of this.snappingSources)o.snappingSource.layerSource.layer===e&&(o.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,o){if((0,h.Wi)(this.options)||!this.options.effectiveFeatureEnabled)return[];const i=[],n=this._computeScreeenSizeDistanceParameters(e,t),r={distance:n,point:e,coordinateHelper:t.coordinateHelper,types:this.types,filter:null};for(const[,{snappingSource:a,layerView:p}]of this.snappingSources)!a.layerSource.enabled||(0,h.pC)(p)&&p.suspended||i.push(a.fetchCandidates(r,o).then((e=>e.filter((e=>!this._candidateIsExcluded(a,e,t.excludeFeature))))));const s=(await(0,c.WW)(i)).flat();return this._addRightAngleCandidates(s,e,n,t),(0,c.k_)(o),(0,V.lQ)(e,s),s}_addRightAngleCandidates(e,t,o,i){const n=(0,h.pC)(i.vertexHandle)?i.vertexHandle.rightEdge?.rightVertex?.pos:(0,h.pC)(i.editGeometryOperations)&&"polygon"===i.editGeometryOperations.data.type?(0,h.Wg)(i.editGeometryOperations.data.components[0]?.getFirstVertex())?.pos:null,r=(0,h.pC)(i.vertexHandle)?i.vertexHandle.leftEdge?.leftVertex?.pos:(0,h.pC)(i.editGeometryOperations)?(0,h.Wg)(i.editGeometryOperations.data.components[0]?.getLastVertex())?.pos:null,s=e.length;for(let a=0;a<s;a++)this._addRightAngleCandidate(e[a],r,t,o,i,e),this._addRightAngleCandidate(e[a],n,t,o,i,e)}_addRightAngleCandidate(e,t,o,i,n,r){if((0,h.Wi)(t)||!(e instanceof N.L))return;const s=e.constraint.closestTo(t),a=(s[0]-o[0])/i.x,p=(s[1]-o[1])/i.y;if(a*a+p*p<=1){const o=n.coordinateHelper;r.push(new F({coordinateHelper:o,targetPoint:s,otherVertex:t,otherVertexType:T.NEXT,previousVertex:e.constraint.start,constraint:new L.yG(o,t,s),objectId:e.objectId,elevationInfo:e.elevationInfo}))}}_computeScreeenSizeDistanceParameters(e,t){const o=(0,h.pC)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;if((0,h.Wi)(this.view))return{x:o,y:o,pixelSize:o};if("2d"===this.view.type){const e=o*this.view.resolution;return{x:e,y:e,pixelSize:e}}return this._computeScreenSizeDistanceParameters3D(e,o,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,o,i){const{coordinateHelper:n,elevationInfo:r}=i,s=o.state.camera.computeScreenPixelSizeAt((0,W.$r)(e,n,r,o,q)),a=s*o.renderCoordsHelper.unitInMeters/o.mapCoordsHelper.unitInMeters,p=t*a;return{x:p/this._computeScreenMagnitudeOfMapOffset(e,a,0,o,i),y:p/this._computeScreenMagnitudeOfMapOffset(e,0,a,o,i),pixelSize:s}}_computeScreenMagnitudeOfMapOffset(e,t,o,i,n){let{coordinateHelper:r,elevationInfo:s}=n;const a=r.clone(e);a[0]+=t,a[1]+=o;const p=(0,W.a7)(e,r,s,i),l=(0,W.a7)(a,r,s,i),h=l.x-p.x,c=l.y-p.y;return Math.sqrt(h*h+c*c)}get types(){return k.r.EDGE|k.r.VERTEX}_candidateIsExcluded(e,t,o){if((0,h.Wi)(o))return!1;const i=this._getCandidateObjectId(t);if((0,h.Wi)(i))return!1;const n=e.layerSource.layer;return"graphics"===n.type?o.uid===i:o.sourceLayer===n&&!(!o.attributes||!("objectIdField"in n))&&o.attributes[n.objectIdField]===i}_getCandidateObjectId(e){return e instanceof D.a?e.objectId:null}_createSourceInfo(e){const t=this._createFeatureSnappingSourceType(e);if((0,h.Wi)(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then((()=>{this.destroyed||this.notifyChange("snappingSources")}))),null;const o=(0,h.pC)(this.view)?this.view.allLayerViews.find((t=>t.layer===e.layer)):null;return new Y(t.source,o)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e)}return null}_createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":{const t=this._getSourceModule("featureService");return(0,h.pC)(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===e.layer.geometryType)return null;const t=this._getSourceModule("featureCollection");return(0,h.pC)(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:t.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const t=this._getSourceModule("graphics");return(0,h.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_getSourceModule(e){const t=this.sourceModules[e];if((0,h.Wi)(t.loader)){const o=this._loadSourceModule(e).then((e=>{t.module=e}));return t.loader=o,{module:t.module,loader:o}}return{module:t.module,loader:t.loader}}_loadSourceModule(e){switch(e){case"featureService":return this.updatingHandles.addPromise(Promise.all([o.e(5652),o.e(4134)]).then(o.bind(o,84134)));case"featureCollection":return this.updatingHandles.addPromise(o.e(2137).then(o.bind(o,26823)));case"graphics":return this.updatingHandles.addPromise(Promise.all([o.e(4e3),o.e(8928),o.e(3518)]).then(o.bind(o,33518)))}return null}};(0,i._)([(0,u.Cb)({constructOnly:!0})],z.prototype,"spatialReference",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],z.prototype,"view",void 0),(0,i._)([(0,u.Cb)()],z.prototype,"options",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],z.prototype,"updating",null),(0,i._)([(0,u.Cb)({readOnly:!0})],z.prototype,"snappingSources",null),z=(0,i._)([(0,g.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],z);class Y{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new p.Z;const o=this.snappingSource.layerSource.layer;if("refresh"in o){const t=o;this.handles.add(t.on("refresh",(()=>e.refresh())))}this.handles.add([(0,d.YP)((()=>e.updating),(t=>e.layerSource.updating=t),d.tX),(0,d.YP)((()=>e.availability),(t=>e.layerSource.availability=t),d.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const q=(0,A.c)();var X=o(85015),B=o(6394),K=o(76014);class Q{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=K.c.shortLineThreshold*K.c.shortLineThreshold}snap(e,t){return(0,h.pC)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}exceedsShortLineThreshold(e,t,o){let{elevationInfo:i,editGeometryOperations:n}=o;const r=n.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,V.tp)((0,W.a7)(t,r,i,this.view),(0,W.a7)(e,r,i,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,o=e*t;return o*o}}class $ extends U.j{constructor(e){let{coordinateHelper:t,lineStart:o,lineEnd:i,targetPoint:n,elevationInfo:r}=e;super(t,n,new L.ku(t,o,i),r),this.referenceLineHint=new j.w(V.ze.REFERENCE_EXTENSION,o,i,r)}get hints(){return[this.referenceLineHint,new j.w(V.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo)]}_lineEndClosestToTarget(){const e=this.constraint.start,t=this.constraint.end;return Math.sign((0,M.h)((0,M.g)(ee,t,e),(0,M.g)(J,this.targetPoint,e)))>0?t:e}}const J=(0,B.a)(),ee=(0,B.a)();var te=o(94163);class oe extends Q{snapNewVertex(e,t){const o=t.editGeometryOperations.data.components[0],i=o.edges.length,n=[];if(i<1)return n;const r=t.coordinateHelper,s=(0,W.a7)(e,r,t.elevationInfo,this.view),a=o.edges[i-1];let p=a;do{this.edgeExceedsShortLineThreshold(p,t)&&this._processCandidateProposal(p.leftVertex.pos,p.rightVertex.pos,e,s,t,n),p=p.leftVertex.leftEdge}while(p&&p!==a);return n}snapExistingVertex(e,t){const o=[],i=(0,h.Wg)(t.vertexHandle),n=i.component;if(n.edges.length<2)return o;const r=t.coordinateHelper,s=(0,W.a7)(e,r,t.elevationInfo,this.view),a=i.leftEdge,p=i.rightEdge;a&&p&&this.edgeExceedsShortLineThreshold(a,t)&&this.edgeExceedsShortLineThreshold(p,t)&&this._processCandidateProposal(a.leftVertex.pos,p.rightVertex.pos,e,s,t,o);const l=n.edges[0];let c=l;do{c!==i.leftEdge&&c!==i.rightEdge&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(c.leftVertex.pos,c.rightVertex.pos,e,s,t,o),c=c.rightVertex.rightEdge}while(c&&c!==l);return o}_processCandidateProposal(e,t,o,i,n,r){const s=(0,te.k0)((0,B.a)(),o,e,t),{coordinateHelper:a,elevationInfo:p,pointer:l}=n,h=a.fromXYZ(s,a.getZ(o,0));(0,V.tp)(i,(0,W.a7)(h,a,p,this.view))<this.squaredProximityTreshold(l)&&r.push(new $({coordinateHelper:a,lineStart:e,lineEnd:t,targetPoint:h,elevationInfo:p}))}}var ie=o(5916);class ne extends U.j{constructor(e){let{coordinateHelper:t,referenceLine:o,lineStart:i,targetPoint:n,elevationInfo:r}=e;const s=t.clone(i);(0,M.g)(s,(0,M.b)(s,s,o.rightVertex.pos),o.leftVertex.pos),super(t,n,new L.ku(t,i,s),r),this._referenceLines=[{edge:o,fadeLeft:!0,fadeRight:!0}]}get hints(){const e=this.elevationInfo;return[new j.w(V.ze.TARGET,this.constraint.start,this.targetPoint,e),new ie.L(this.constraint.start,this.targetPoint,e),...this._referenceLines.map((t=>new j.w(V.ze.REFERENCE,t.edge.leftVertex.pos,t.edge.rightVertex.pos,e,t.fadeLeft,t.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((o=>{e.rightVertex.rightEdge===o.edge&&(o.fadeLeft=!1,t.fadeRight=!1),e.leftVertex.leftEdge===o.edge&&(o.fadeRight=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class re extends Q{constructor(){super(...arguments),this._tmpProjection=(0,B.a)()}snapNewVertex(e,t){const o=t.editGeometryOperations.data.components[0],i=o.edges.length,n=o.vertices.length,r=[];if(i<2)return r;const s=(0,W.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),a=o.vertices[n-1],p=o.vertices[0],l=o.edges[i-1];let h=l;do{this.edgeExceedsShortLineThreshold(h,t)&&(this._checkEdgeForParalleLines(h,a.pos,e,s,t,r),this._checkEdgeForParalleLines(h,p.pos,e,s,t,r)),h=h.leftVertex.leftEdge}while(h&&h!==l);return r}snapExistingVertex(e,t){const o=[],i=(0,h.Wg)(t.vertexHandle),n=i.component;if(n.edges.length<3)return o;const r=(0,W.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),s=i.leftEdge,a=i.rightEdge,p=n.vertices[0],l=n.vertices.length,c=n.vertices[l-1],d=n.edges[0];let u=d;do{u!==s&&u!==a&&this.edgeExceedsShortLineThreshold(u,t)&&(s&&this._checkEdgeForParalleLines(u,s.leftVertex.pos,e,r,t,o),a&&this._checkEdgeForParalleLines(u,a.rightVertex.pos,e,r,t,o),i===p?this._checkEdgeForParalleLines(u,c.pos,e,r,t,o):i===c&&this._checkEdgeForParalleLines(u,p.pos,e,r,t,o)),u=u.rightVertex.rightEdge}while(u&&u!==d);return o}_checkEdgeForParalleLines(e,t,o,i,n,r){const s=e.leftVertex.pos,a=e.rightVertex.pos;if((0,te.k0)(this._tmpProjection,t,s,a),(0,M.s)(this._tmpProjection,t)<K.c.parallelLineThreshold)return;(0,te.k0)(this._tmpProjection,o,s,a,t);const{coordinateHelper:p,elevationInfo:l,pointer:h}=n,c=p.fromXYZ(this._tmpProjection,p.getZ(o,0));if((0,V.tp)(i,(0,W.a7)(c,p,l,this.view))<this.squaredProximityTreshold(h)){if(this._parallelToPreviousCandidate(e,r))return;r.push(new ne({coordinateHelper:p,referenceLine:e,lineStart:t,targetPoint:c,elevationInfo:l}))}}_parallelToPreviousCandidate(e,t){const o=e.leftVertex.pos,i=e.rightVertex.pos;for(const n of t)if((0,te.k0)(this._tmpProjection,i,n.constraint.start,n.constraint.end,o),(0,M.s)(this._tmpProjection,i)<K.c.parallelLineThreshold)return n.addReferenceLine(e),!0;return!1}}class se extends Q{constructor(){super(...arguments),this._tmp=(0,B.a)()}snapNewVertex(e,t){const o=t.editGeometryOperations.data.components[0],i=o.vertices.length,n=[];if(i<2)return n;const r=(0,W.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),s=o.vertices[i-1];this._checkForSnappingCandidate(n,s.leftEdge,s.pos,e,s.leftEdge.leftVertex.pos,s.pos,t,e,r);const a=o.vertices[0];return this._checkForSnappingCandidate(n,a.rightEdge,a.pos,e,a.rightEdge.rightVertex.pos,a.pos,t,e,r),n}snapExistingVertex(e,t){const o=[],i=(0,h.Wg)(t.vertexHandle),n=i.component,r=n.vertices.length;if(r<3)return o;const s=(0,W.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),a=i.leftEdge,p=i.rightEdge,l=n.vertices[0],c=n.vertices[r-1];if(!a)return this._checkForSnappingCandidate(o,l.rightEdge.rightVertex.rightEdge,l.rightEdge.rightVertex.pos,e,l.rightEdge.rightVertex.rightEdge.rightVertex.pos,l.rightEdge.rightVertex.pos,t,e,s),o;if(!p)return this._checkForSnappingCandidate(o,c.leftEdge.leftVertex.leftEdge,c.leftEdge.leftVertex.pos,e,c.leftEdge.leftVertex.leftEdge.leftVertex.pos,c.leftEdge.leftVertex.pos,t,e,s),o;if(a&&a.leftVertex.leftEdge){const i=a.leftVertex.leftEdge;this._checkForSnappingCandidate(o,i,a.leftVertex.pos,e,i.leftVertex.pos,a.leftVertex.pos,t,e,s)}if(p&&p.rightVertex.rightEdge){const i=p.rightVertex.rightEdge;this._checkForSnappingCandidate(o,i,p.rightVertex.pos,e,i.rightVertex.pos,p.rightVertex.pos,t,e,s)}return o}_checkForSnappingCandidate(e,t,o,i,n,r,s,a,p){if(!this.edgeExceedsShortLineThreshold(t,s))return;(0,M.g)(this._tmp,t.rightVertex.pos,t.leftVertex.pos);const l=(0,B.f)(this._tmp[1],-this._tmp[0]),h=(0,M.h)(l,(0,M.g)(this._tmp,i,o))/(0,M.u)(l),{coordinateHelper:c,elevationInfo:d,pointer:u}=s,g=c.fromXYZ((0,M.v)((0,B.a)(),r,l,h),c.getZ(a,0));(0,V.tp)(p,(0,W.a7)(g,c,d,this.view))<this.squaredProximityTreshold(u)&&e.push(new F({coordinateHelper:c,targetPoint:g,constraint:new L.yG(c,r,(0,M.v)(c.createVector(),r,l,Math.sign(h))),previousVertex:n,otherVertex:r,otherVertexType:T.CENTER,elevationInfo:d}))}}class ae extends U.j{constructor(e){let{coordinateHelper:t,targetPoint:o,point1:i,point2:n,elevationInfo:r}=e;super(t,o,new L.UL(t,(0,M.l)(pe,i,n,.5),.5*(0,M.j)(i,n)),r),this.p1=i,this.p2=n}get hints(){const e=this.elevationInfo;return[new j.w(V.ze.REFERENCE,this.targetPoint,this.p1,e),new j.w(V.ze.REFERENCE,this.targetPoint,this.p2,e),new Z.y(this.p1,this.targetPoint,this.p2,e)]}}const pe=(0,B.a)();class le extends Q{snapNewVertex(e,t){const o=t.editGeometryOperations.data.components[0],i=[],n=o.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||n<2)return i;const r=o.vertices[0],s=o.vertices[n-1];return this._processCandidateProposal(r.pos,s.pos,e,t,i),i}snapExistingVertex(e,t){const o=[],i=(0,h.Wg)(t.vertexHandle),n=i.component;return n.edges.length<2?o:"polyline"!==t.editGeometryOperations.data.type||0!==i.index&&i.index!==n.vertices.length-1?(this._processCandidateProposal(i.leftEdge.leftVertex.pos,i.rightEdge.rightVertex.pos,e,t,o),o):o}_processCandidateProposal(e,t,o,i,n){if(!this.exceedsShortLineThreshold(e,t,i))return;const r=(0,M.l)((0,B.a)(),e,t,.5),s=.5*(0,M.j)(e,t),a=(0,te.xO)((0,B.a)(),o,r,s),{coordinateHelper:p,elevationInfo:l,pointer:h}=i,c=p.fromXYZ(a,p.getZ(o,0)),d=(0,W.a7)(o,p,l,this.view);(0,V.tp)(d,(0,W.a7)(c,p,l,this.view))<this.squaredProximityTreshold(h)&&n.push(new ae({coordinateHelper:p,targetPoint:c,point1:e,point2:t,elevationInfo:l}))}}let he=class extends X.Z{constructor(e){super(e),this.updating=!1,this._snappers=new r.Z}initialize(){this._snappers.push(new re(this.view,this.options),new oe(this.view,this.options),new se(this.view,this.options),new le(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t){if(!this.options.effectiveSelfEnabled)return[];const o=[];for(const i of this._snappers.items)o.push(...i.snap(e,t));return(0,V.lQ)(e,o),o}};function ce(e,t){return[new he({view:e,options:t}),new z({view:e,options:t,spatialReference:e.spatialReference})]}(0,i._)([(0,u.Cb)({readOnly:!0})],he.prototype,"updating",void 0),(0,i._)([(0,u.Cb)({constructOnly:!0})],he.prototype,"view",void 0),(0,i._)([(0,u.Cb)()],he.prototype,"options",null),he=(0,i._)([(0,g.j)("esri.views.interactive.snapping.SelfSnappingEngine")],he);let de=class extends X.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,i._)([(0,u.Cb)({constructOnly:!0})],de.prototype,"layer",void 0),(0,i._)([(0,u.Cb)()],de.prototype,"enabled",void 0),(0,i._)([(0,u.Cb)()],de.prototype,"updating",void 0),(0,i._)([(0,u.Cb)()],de.prototype,"availability",void 0),de=(0,i._)([(0,g.j)("esri.views.interactive.snapping.SnappingLayerSource")],de);const ue=de;let ge=class extends X.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new r.Z,this.distance=K.c.distance,this.touchSensitivityMultiplier=K.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,i._)([(0,u.Cb)()],ge.prototype,"enabled",void 0),(0,i._)([(0,u.Cb)()],ge.prototype,"enabledToggled",void 0),(0,i._)([(0,u.Cb)()],ge.prototype,"selfEnabled",void 0),(0,i._)([(0,u.Cb)()],ge.prototype,"featureEnabled",void 0),(0,i._)([(0,u.Cb)({type:r.Z.ofType(ue)})],ge.prototype,"featureSources",void 0),(0,i._)([(0,u.Cb)()],ge.prototype,"distance",void 0),(0,i._)([(0,u.Cb)()],ge.prototype,"touchSensitivityMultiplier",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],ge.prototype,"effectiveEnabled",null),(0,i._)([(0,u.Cb)({readOnly:!0})],ge.prototype,"effectiveSelfEnabled",null),(0,i._)([(0,u.Cb)({readOnly:!0})],ge.prototype,"effectiveFeatureEnabled",null),ge=(0,i._)([(0,g.j)("esri.views.interactive.snapping.SnappingOptions")],ge);const ye=ge;var ve=o(90609);class me extends U.j{constructor(e,t,o,i,n){super(e,t,new L.Bq(e,t,o.constraint,i.constraint),n),this.first=o,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ve.w(this.targetPoint,this.elevationInfo)]}}let fe=class extends(a.Z.EventedMixin(I.r)){constructor(e){super(e),this.options=new ye,this.snappingEnginesFactory=ce,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}initialize(){this.handles.add([(0,d.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:o,distance:i}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:o,distance:i}}),(()=>{this.doneSnapping(),this.emit("changed")}),d.Z_),(0,d.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),d.Z_),(0,d.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:o}=e;return this._recreateEngines(t,o)}),d.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:o,options:i}=this;this._engines=t(o,i)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,o=e*t;return o*o}async snap(e,t,o){const i=t.coordinateHelper.pointToVector(e),n=await this._fetchCandidates(i,t,o);return{get valid(){return!(0,c.Hc)(o)},apply:()=>{const{snappedPoint:e,hints:o}=this._processCandidates(i,n,t);return this._removeVisualization(),(0,h.pC)(t.visualizer)&&this.handles.add(t.visualizer.draw(o,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),_e),e}}}update(e,t){this._removeVisualization();let o=e;const i=[];if((0,h.pC)(this._currentMainCandidate)){const n=t.coordinateHelper,r=n.pointToVector(e),s=this._currentMainCandidate.constraint.closestTo(r);if((0,V.tp)((0,W.a7)(r,n,t.elevationInfo,this.view),(0,W.a7)(s,n,t.elevationInfo,this.view))<this._squaredPointProximityThreshold(t.pointer)){o=n.vectorToDehydratedPoint(s),this._currentMainCandidate.targetPoint=s,i.push(...this._currentMainCandidate.hints);for(const e of this._currentOtherActiveCandidates)e.targetPoint=s,i.push(...e.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return(0,h.pC)(t.visualizer)&&this.handles.add(t.visualizer.draw(i,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),_e),o}doneSnapping(){this._removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}_removeVisualization(){this.handles.remove(_e)}async _fetchCandidates(e,t,o){return(await Promise.all(this._engines.map((i=>i.fetchCandidates(e,t,o))))).flat()}_processCandidates(e,t,o){if(t.length<1)return this.doneSnapping(),{snappedPoint:o.coordinateHelper.vectorToDehydratedPoint(e),hints:[]};(0,V.lQ)(e,t);const i=this._currentMainCandidate;if((0,h.pC)(i)){const n=this._findOldConstraintInNewCandidates(i,t);if(n>=0){if(!(t[n]instanceof me))return this._intersectWithOtherCandidates(n,t,e,o);if((0,M.s)(e,i.targetPoint)<this._squaredPointProximityThreshold(o.pointer))return this._updateSnappingCandidate(i,t,o)}}return this._intersectWithOtherCandidates(0,t,e,o)}_findOldConstraintInNewCandidates(e,t){return e instanceof me?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,o,i){const n=t[e],r=[],s=i.coordinateHelper;for(let a=0;a<t.length;++a){if(a===e)continue;const p=t[a];for(const e of n.constraint.intersect(p.constraint)){const t=s.fromXYZ(e.intersection,n.targetPoint[2]);r.push([new me(s,t,n,p,p.elevationInfo),(0,V.tp)((0,W.a7)(o,i.coordinateHelper,i.elevationInfo,this.view),(0,W.a7)(t,i.coordinateHelper,i.elevationInfo,this.view))])}}return r.length>0&&(r.sort(((e,t)=>e[1]-t[1])),r[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(r[0][0],t,i):this._updateSnappingCandidate(n,t,i)}_updateSnappingCandidate(e,t,o){this.doneSnapping(),this._currentMainCandidate=e;const i=this._currentMainCandidate.targetPoint,n=[];n.push(...e.hints);for(const r of t){if(e instanceof me){if(r.constraint.objectEqual(e.first.constraint)||r.constraint.objectEqual(e.second.constraint))continue}else if(r.constraint.objectEqual(e.constraint))continue;r.constraint.check(i)&&(r.targetPoint=i,this._currentOtherActiveCandidates.push(r),n.push(...r.hints))}return{snappedPoint:o.coordinateHelper.vectorToDehydratedPoint(i),hints:n}}_squaredPointProximityThreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}_findOldCandidateIndex(e,t){let o=-1;for(let i=0;i<e.length;++i)if(t.constraint.objectEqual(e[i].constraint)){o=i;break}return o}get test(){return{visualizationsActive:this.handles.has(_e),engines:this._engines}}};(0,i._)([(0,u.Cb)({constructOnly:!0})],fe.prototype,"view",void 0),(0,i._)([(0,u.Cb)()],fe.prototype,"options",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],fe.prototype,"updating",null),(0,i._)([(0,u.Cb)()],fe.prototype,"snappingEnginesFactory",void 0),(0,i._)([(0,u.Cb)()],fe.prototype,"_engines",void 0),(0,i._)([(0,u.Cb)()],fe.prototype,"squaredMouseProximityTreshold",null),(0,i._)([(0,u.Cb)()],fe.prototype,"squaredTouchProximityThreshold",null),fe=(0,i._)([(0,g.j)("esri.views.interactive.snapping.SnappingManager")],fe);const _e="visualization-handle";function be(e){return(0,h.pC)(e)&&"graphic"===e.type}var Ee=o(72612),we=o(41644);let Ce=class extends a.Z.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,we.Bg)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",(()=>{this.canUndo()&&e()}))}set redo(e){this._set("redo",(()=>{this.canRedo()&&e()}))}};(0,i._)([(0,u.Cb)()],Ce.prototype,"activeComponent",void 0),(0,i._)([(0,u.Cb)()],Ce.prototype,"cancelled",void 0),(0,i._)([(0,u.Cb)()],Ce.prototype,"history",void 0),(0,i._)([(0,u.Cb)()],Ce.prototype,"tool",null),(0,i._)([(0,u.Cb)()],Ce.prototype,"type",void 0),(0,i._)([(0,u.Cb)()],Ce.prototype,"canUndo",null),(0,i._)([(0,u.Cb)()],Ce.prototype,"canRedo",null),(0,i._)([(0,u.Cb)()],Ce.prototype,"onEnd",void 0),(0,i._)([(0,u.Cb)()],Ce.prototype,"undo",null),(0,i._)([(0,u.Cb)()],Ce.prototype,"redo",null),(0,i._)([(0,u.Cb)()],Ce.prototype,"toggleTool",void 0),(0,i._)([(0,u.Cb)()],Ce.prototype,"addToSelection",void 0),(0,i._)([(0,u.Cb)()],Ce.prototype,"removeFromSelection",void 0),Ce=(0,i._)([(0,g.j)("esri.widgets.Sketch.support.OperationHandle")],Ce);let Se=class extends Ce{};(0,i._)([(0,u.Cb)()],Se.prototype,"activeComponent",void 0),Se=(0,i._)([(0,g.j)("esri.widgets.Sketch.support.CreateOperationHandle")],Se);let Te=class extends Ce{constructor(e){super(e)}};(0,i._)([(0,u.Cb)()],Te.prototype,"activeComponent",void 0),Te=(0,i._)([(0,g.j)("esri.widgets.Sketch.support.UpdateOperationHandle")],Te);var xe=o(16072),Oe=o(61459),Pe=o(16851);const Ge="esri.widgets.Sketch.SketchViewModel",Re=l.Z.getLogger(Ge),Ie={defaultZ:0},Me={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let He=class extends a.Z.EventedAccessor{constructor(e){super(e),this._numUpdating=0,this._handles=new p.Z,this._internalGraphicsLayer=new _.Z({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new p.Z,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.labelOptions=new G.Z,this.layer=null,this.pointSymbol=new xe.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Oe.Z({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Pe.Z({color:[130,130,130,1],width:2}),this._snappingManager=null,this.tooltipOptions=new R.Z,this.updateGraphics=new r.Z,this.updateOnGraphicClick=!0,this.updatePointSymbol=new xe.Z({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new Oe.Z({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new Pe.Z({color:[12,207,255],width:2}),this.vertexSymbol=new xe.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=Ie,this.defaultUpdateOptions=Me,this.snappingOptions=new ye}initialize(){this._handles.add([(0,d.on)((()=>this.view?.map?.layers),"change",(e=>{e.removed.includes(this.layer)&&this.cancel()})),(0,d.on)((()=>this.layer?.graphics),"change",(e=>{if((0,h.pC)(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),(0,d.YP)((()=>this.layer?.elevationInfo??null),(e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)}),d.tX),(0,d.YP)((()=>this.view),(e=>{(0,h.SC)(this._snappingManager),e&&(this._snappingManager=new fe({view:e,options:this.snappingOptions}),"2d"===e.type?Promise.all([o.e(5652),o.e(2497),o.e(1129),o.e(8431),o.e(1283)]).then(o.bind(o,51283)):"3d"===e.type&&(Promise.all([o.e(1378),o.e(2029),o.e(5652),o.e(5158),o.e(2497),o.e(2618),o.e(1129),o.e(5269),o.e(4567),o.e(8431),o.e(2110),o.e(1883),o.e(1859),o.e(3567)]).then(o.bind(o,73567)),Promise.all([o.e(1378),o.e(2029),o.e(5652),o.e(5158),o.e(2618),o.e(5269),o.e(4567),o.e(1883),o.e(493),o.e(1859),o.e(6099),o.e(6929),o.e(5022)]).then(o.bind(o,35022))))}),d.tX),(0,d.YP)((()=>this.view?.spatialReference),((e,t)=>{e&&t&&!e.equals(t)&&this.cancel()}))])}destroy(){this.cancel(),this._handles=(0,h.SC)(this._handles),this._viewHandles=(0,h.SC)(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=(0,h.SC)(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return"3d"===this.view.type?"move":"transform"}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return!(0,h.pC)(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):(0,h.Wg)(this.activeComponent.graphic)}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Ie,...e})}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Me,...e,reshapeOptions:{...Me.reshapeOptions,...e?.reshapeOptions}})}set snappingOptions(e){(0,h.pC)(this._snappingManager)&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:o}=t;e&&(t.cursor=null),o&&o.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const o="view-ready";this._handles.remove(o),e&&this._handles.add((0,d.gx)((()=>e.ready),(t=>{this._viewHandles.removeAll(),t&&this._viewHandles.add(this._generateViewHandles(e))}),d.tX),o),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,h.IM)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,h.IM)(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:o}=this,i=t.toArray();o.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:e})}}async create(e,t){if(this.cancel(),await this._waitViewReady(),"disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),(0,c.zE)();if((0,h.pC)(this.view.activeTool)&&(this.view.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,x.p)(this.view,this._internalGraphicsLayer);const o=await this._setupCreateOperation(e,t);if((0,h.Wi)(o)||this.destroyed)return void this.view.map.remove(this._internalGraphicsLayer);o.on("complete",(()=>{if(o===this._operationHandle){const t=this.createGraphic,i=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||null==t||this.layer.add(t),this.emit("create",{graphic:t,state:i?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}})),this._operationHandle=o,this.view.ready&&(0,b.t)(this.view)&&this.view.focus()}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:o,view:i,state:n}=this;if("disabled"===n)throw i||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),o||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),(0,c.zE)();(0,h.pC)(this.view.activeTool)&&(this.view.activeTool=null);const r=Array.isArray(e)?e:[e];if(null==e||!r||!r.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some((e=>e.layer!==o?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):!!(0,h.Wi)(e.geometry)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0))))return;const s=await this._setupUpdateOperation(r,t);this.destroyed||(0,h.Wi)(s)||De(s)||((0,x.p)(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(s,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:s.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){this._beginAsyncOperation(),e=Array.isArray(e)?e:[e];for(const t of e)(0,h.pC)(t.geometry)&&"mesh"!==t.geometry.type&&!(0,f.fS)(t.geometry.spatialReference,this.view.spatialReference)&&((0,y.Up)(t.geometry.spatialReference,this.view.spatialReference)||(0,y.kR)()||await(0,y.zD)(),t.geometry=(0,y.iV)(t.geometry,this.view.spatialReference));this._endAsyncOperation()}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=this.view;if("2d"===t.type){const t=[];this.view.map.allLayers.forEach((e=>{"vector-tile"!==e.type&&"imagery"!==e.type||t.push(e)}));return function(e){return e.find(be)??null}((await this.view.hitTest(e,{exclude:t})).results)}const o=[this.view.map.ground];t.map.allLayers.forEach((e=>{"integrated-mesh"===e.type&&o.push(e)}));const i=await t.hitTest(e,{exclude:o});if(i.results.length>0){const e=i.results[0];if((0,h.pC)(e)&&"graphic"===e.type&&e.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(0,h.Pt)(e.distance,0)>-Math.min(3*i.ground.distance,"global"===t.viewingMode?(0,v.Iu)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",(async t=>{const o="active"===this.state&&"create"===this._operationHandle.type;if("disabled"===this.state||o||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const i=await t.async((()=>this._getFirstHit((0,Ee.vT)(t))));let n=null;if((0,h.pC)(i)){const o=i.graphic;this.updateGraphics.includes(o)||o.layer===this.layer?(t.stopPropagation(),n=o):"2d"!==e.type||this._isComponentGraphic(o)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();(0,h.pC)(n)&&!this.updateGraphics.includes(n)&&await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()}),O.f.WIDGET)]}async _setupCreateOperation(e,t){const o={hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...t},i=await this._setupDrawGraphicTool(e,this.view,o);return(0,h.Wi)(i)?null:(this.view.tools.add(i),this.view.activeTool=i,this._setupCreateOperationHandle(i))}async _setupDrawGraphicTool(e,t,o){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;const i="rectangle"!==e,n="rectangle"!==e;this.snappingOptions.enabledToggled=!1;const r={view:t,mode:"rectangle"===e||"circle"===e?"hybrid":"click",...o,snapToScene:!1,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),snappingManager:this._snappingManager,forceUniformSize:n,centered:i};return"2d"===this.view.type?this._makeDrawGraphicTool2D(r):this._makeDrawGraphicTool3D(r)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(Promise.all([o.e(5652),o.e(2497),o.e(1129),o.e(8431),o.e(1283)]).then(o.bind(o,51283)));return De(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Ae(e.geometryType)?this.activeFillSymbol:null})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(Promise.all([o.e(1378),o.e(2029),o.e(5652),o.e(5158),o.e(2497),o.e(2618),o.e(1129),o.e(5269),o.e(4567),o.e(8431),o.e(2110),o.e(1883),o.e(1859),o.e(3567)]).then(o.bind(o,73567)));if(De(t)||this.destroyed)return null;const{elevationInfo:i}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:i,snapToScene:!(0,h.pC)(i)||"absolute-height"===i.mode,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions})}_setupCreateOperationHandle(e){let t=null;const o=e.forceUniformSize,i=e.centered,n=[this.view.on("key-down",(t=>{if(t.key===P.j.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===P.j.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==P.j.vertexAdd||t.repeat)t.key===P.j.undo?(t.stopPropagation(),r.undo()):t.key===P.j.redo?(t.stopPropagation(),r.redo()):t.key!==P.j.snappingToggle||"rectangle"===e.geometryType||"circle"===e.geometryType||t.repeat?t.key!==P.j.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===P.j.center&&(t.repeat||(e.centered=!i,t.stopPropagation())):(e.forceUniformSize=!o,t.stopPropagation()):(this.snappingOptions.enabledToggled=!0,t.stopPropagation());else{const o=e.drawOperation.geometryType;"polyline"!==o&&"polygon"!==o&&"multipoint"!==o||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}}),O.f.WIDGET),this.view.on("key-up",(t=>{t.key===P.j.pan?e.enabled=!0:t.key===P.j.snappingToggle&&"rectangle"!==e.geometryType&&"circle"!==e.geometryType?(this.snappingOptions.enabledToggled=!1,t.stopPropagation()):t.key!==P.j.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===P.j.center&&(e.centered=i,t.stopPropagation()):(e.forceUniformSize=o,t.stopPropagation())}),O.f.WIDGET),e.on("vertex-add",(o=>{switch(t=(0,h.Wi)(t)?"start":"active",o.operation){case"apply":this.emit("create",{graphic:(0,h.Wg)(e.graphic),state:t,tool:this.activeTool,toolEventInfo:o,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,h.Wg)(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[(0,h.Wg)(e.graphic)],tool:e.geometryType})}})),e.on("cursor-update",(t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:(0,h.Wg)(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),e.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:(0,h.Wg)(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,h.Wg)(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[(0,h.Wg)(e.graphic)],tool:e.geometryType})}})),e.on("complete",(e=>{this._set("createGraphic",(0,h.Wg)(e.graphic)),t="complete",e.aborted?r&&r.cancel():r&&r.complete()})),(0,d.YP)((()=>this._getGraphicSymbolFromTool(e.geometryType)),(t=>{e.graphicSymbol=t}))],r=new Ce({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{n.forEach((e=>e.remove())),n.length=0,this.view.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return r}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;default:return null}}async _setupUpdateOperation(e,t){const{layer:o,view:i}=this,n={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions}};let r=n.tool;for(const s of e)o.remove(s),o.add(s);if("3d"===i.type){if(0===e.length)return null;switch(r){case"move":return this._setupMove3DOperation(e,n,i,r);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,C.P)(e[0]);return t===E.e.SUPPORTED?this._setupReshape3DOperation(e[0],n,i):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,E.Z)(t)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,n,i)}}switch(r){case"move":return this._setupMove2DOperation(e,n,i);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,C.P)(e[0]);return t===E.e.SUPPORTED?this._setupTransformOrReshape2DOperation(e,r,n,i):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,E.Z)(t)}).`),null)}case"transform":if(1===e.length){const t=(0,h.U2)(e[0].geometry,"type");"point"!==t&&"multipoint"!==t||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,n,i)}}async _setupMove3DOperation(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];for(const o of e){const e=(0,w.P)(o);if(e!==E.e.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,E.Z)(e)}).`),null}const s=await this._requireModule(Promise.all([o.e(1378),o.e(2029),o.e(5652),o.e(5158),o.e(2497),o.e(2618),o.e(1129),o.e(5269),o.e(4567),o.e(8431),o.e(2110),o.e(1883),o.e(1859),o.e(3567)]).then(o.bind(o,73567)));if(De(s))return s;const a=new s.module.GraphicMoveTool({view:i,enableZ:t.enableZ,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(a),a.graphics.addMany(e),r||this.updateGraphics.addMany(e);const p=[],l=new Te({activeComponent:a,tool:n,type:"update",onEnd:()=>{p.forEach((e=>e.remove())),p.length=0,this.view.tools?.remove(a),a.destroyed||a.destroy()},undo:()=>{ke(l,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{Le(l,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:e=>{this.updateGraphics.push(e),a.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);l.history.undo.forEach((e=>e.updates.splice(t,1))),l.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics.remove(e):l.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==n)return;const e=this.updateGraphics.getItemAt(0);if((0,C.P)(e)!==E.e.SUPPORTED)return;const o=await this._setupReshape3DOperation(e,t,i,!0);De(o)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(o,t))}});return p.push(...this._getHandlesForComponent(l,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(l,e,t)),O.f.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(l,e),e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),O.f.WIDGET),i.on("key-up",(e=>{e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),O.f.WIDGET)),l}_setupGraphicTransform3DOperation(e,t,o){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(1===e.length&&function(e){if("graphics"!==e.layer?.type)return E.e.GRAPHICS_LAYER_MISSING;if((0,h.Wi)(e.geometry))return E.e.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return E.e.SUPPORTED;default:return E.e.GEOMETRY_TYPE_UNSUPPORTED}const t=(0,h.pC)(e.symbol)&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.length>0&&t.some((e=>"object"===e.type))?"on-the-ground"!==(0,S.vu)(e)&&(0,S.Lt)(e)?E.e.ELEVATION_MODE_UNSUPPORTED:E.e.SUPPORTED:E.e.SYMBOL_TYPE_UNSUPPORTED}(e[0])===E.e.SUPPORTED){const n=e[0],r=n.geometry;if((0,h.pC)(r)&&("point"===r.type||"mesh"===r.type))return this._setupPointTransform3DOperation(n,t,o);if((0,h.pC)(r)&&("polygon"===r.type||"polyline"===r.type))return this._setupPolyTransform3DOperation(n,t,o,i)}return this._setupMove3DOperation(e,t,o,"transform",i)}async _setupPointTransform3DOperation(e,t,i){const n="transform",{enableRotation:r,enableScaling:s,enableZ:a}=t,p=await this._requireModule(Promise.all([o.e(1378),o.e(2029),o.e(5652),o.e(5158),o.e(2497),o.e(2618),o.e(1129),o.e(5269),o.e(4567),o.e(8431),o.e(2110),o.e(1883),o.e(1859),o.e(3567)]).then(o.bind(o,73567)));if(De(p))return p;const l=new p.module.GraphicTransformTool({graphic:e,view:i,enableRotation:r,enableScaling:s,enableZ:a,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(l),this.updateGraphics.add(e);const h=[],c=new Te({activeComponent:l,tool:n,type:"update",onEnd:()=>{h.forEach((e=>e.remove())),h.length=0,this.view.tools?.remove(l),l.destroyed||l.destroy()},undo:()=>{ke(c,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{Le(c,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);De(o)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(o,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),c.complete()},toggleTool:()=>{}});return h.push(...this._getHandlesForComponent(c,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(c,e,t)),O.f.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(c,e),e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),O.f.WIDGET),i.on("key-up",(e=>{e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),O.f.WIDGET)),c}async _setupPolyTransform3DOperation(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r="transform",{enableRotation:s,enableScaling:a,enableZ:p,preserveAspectRatio:l}=t,h=await this._requireModule(Promise.all([o.e(1378),o.e(2029),o.e(5652),o.e(5158),o.e(2497),o.e(2618),o.e(1129),o.e(5269),o.e(4567),o.e(8431),o.e(2110),o.e(1883),o.e(1859),o.e(3567)]).then(o.bind(o,73567)));if(De(h))return h;const c=new h.module.ExtentTransformTool({graphic:e,view:i,enableRotation:s,enableScaling:a,enableZ:p,preserveAspectRatio:l,tooltipOptions:this.tooltipOptions});this.view.tools.add(c),n||this.updateGraphics.add(e);const d=[],u=new Te({activeComponent:c,tool:r,type:"update",onEnd:()=>{d.forEach((e=>e.remove())),d.length=0,this.view.tools?.remove(c),c.destroyed||c.destroy()},canUndo:()=>c.canUndo,undo:()=>{c.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},canRedo:()=>c.canRedo,redo:()=>{c.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);De(o)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(o,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),u.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.getItemAt(0);if((0,C.P)(e)!==E.e.SUPPORTED)return;const o=await this._setupReshape3DOperation(e,t,i,!0);De(o)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(o,t))}});return d.push(...this._getHandlesForComponent(u,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(u,e,t)),O.f.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(u,e)),O.f.WIDGET),this.view.on("key-down",(e=>{e.key!==P.j.constraint||e.repeat||(c.preserveAspectRatio=!c.preserveAspectRatio,e.stopPropagation())}),O.f.WIDGET),this.view.on("key-up",(e=>{e.key===P.j.constraint&&(c.preserveAspectRatio=!c.preserveAspectRatio,e.stopPropagation())}),O.f.WIDGET)),u}async _setupMove2DOperation(e,t,o){const i="move";this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const n=await this._getGraphicMover(e,t,o);if(De(n))return n;const r=new Te({activeComponent:n,tool:i,type:"update",onEnd:()=>{this._displayDefaultCursor(),p.forEach((e=>e.remove())),a.forEach((e=>e.remove())),p=[],a=[],n.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();ke(r,e),r.refreshComponent(),this._emitUndoEvent({graphics:e,tool:i})},redo:()=>{const e=this.updateGraphics.toArray();Le(r,e),r.refreshComponent(),this._emitRedoEvent({graphics:e,tool:i})},addToSelection:async e=>{await this._updateSpatialReference(e),this.updateGraphics.push(e),n.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach((e=>e.updates.splice(t,1))),r.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?n.graphics=o:r.complete()}});let s=!1,a=[o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(r,e,t)),O.f.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==P.j.constraint||e.repeat||(s=!0,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)}),O.f.WIDGET),o.on("key-up",(e=>{e.key===P.j.constraint&&s&&(s=!1,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)}),O.f.WIDGET)],p=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r="reshape",s=await this._requireModule(Promise.all([o.e(1378),o.e(2029),o.e(5652),o.e(5158),o.e(2497),o.e(2618),o.e(1129),o.e(5269),o.e(4567),o.e(8431),o.e(2110),o.e(1883),o.e(1859),o.e(3567)]).then(o.bind(o,73567)));if(De(s))return s;this.snappingOptions.enabledToggled=!1;const a=new s.module.GraphicReshapeTool({view:i,graphic:e,enableZVertex:t.enableZ&&"move"===t.reshapeOptions.vertexOperation,enableZShape:t.enableZ&&"move"===t.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===t.reshapeOptions.shapeOperation||"move-xy"===t.reshapeOptions.shapeOperation,enableMidpoints:"split"===t.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===t.reshapeOptions.edgeOperation,snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});i.tools.add(a),n||this.updateGraphics.add(e);const p=[],l=new Te({activeComponent:a,tool:r,type:"update",onEnd:()=>{p.forEach((e=>e.remove())),p.length=0,this.view.tools?.remove(a),a.destroyed||a.destroy()},canUndo:()=>a.canUndo,undo:()=>{a.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},canRedo:()=>a.canRedo,redo:()=>{a.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);De(o)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(o,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),l.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);De(e)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(e,t))}});return p.push(...this._getHandlesForComponent(l,t),i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(l,e,t)),O.f.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(l,e),e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),O.f.WIDGET),i.on("key-up",(e=>{e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),O.f.WIDGET)),l}async _setupTransformOrReshape2DOperation(e,t,o,i){this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const n="transform"===t?await this._getBox(e,o,i):await this._getReshape(e,o,i);if(De(n))return n;const r=new Te({activeComponent:n,type:"update",onEnd:()=>{a.forEach((e=>e.remove())),s.forEach((e=>e.remove())),a=[],s=[],r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{ke(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{Le(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async e=>{let t=r.activeComponent;if("reshape"===t.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll();const n=await this._setupMove2DOperation(t,o,i);if(De(n))return;r.onEnd(),r.destroy(),this._setUpdateOperationHandle(n,o)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach((e=>e.updates.splice(t,1))),r.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();if(0===o.length)r.complete();else{const e=o[0].geometry;1!==o.length||!(0,h.pC)(e)||"point"!==e.type&&"multipoint"!==e.type?r.activeComponent.graphics=o:r.toggleTool()}this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.getItemAt(0),t=e.geometry;if((0,h.pC)(t)&&("reshape"===r.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===r.tool&&"extent"===t.type))return;let n=null;"transform"===r.tool?n=await this._getReshape([e],o,i):"reshape"===r.tool&&(n=await this._getBox([e],o,i)),De(n)||(r.activeComponent.destroy(),r.activeComponent=n,r.activeComponent&&(a.forEach((e=>e.remove())),a=this._getHandlesForComponent(r,o)))}});let s=[i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(r,e,o)),O.f.WIDGET),i.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==P.j.snappingToggle||e.repeat||(this.snappingOptions.enabledToggled=!0,e.stopPropagation()),e.key===P.j.constraint&&!e.repeat&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),O.f.WIDGET),i.on("key-up",(e=>{if(e.key===P.j.snappingToggle&&"reshape"===r?.activeComponent?.type&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation()),e.key===P.j.constraint&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),O.f.WIDGET)],a=this._getHandlesForComponent(r,o);return r}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:n}=t,r=await this._requireModule(o.e(3503).then(o.bind(o,53503)));return De(r)?r:new r.module.default({enableMoveAllGraphics:n,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:e=>{let{dx:t,dy:o,graphic:i}=e;this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move-start"},type:"update"})},onGraphicMove:e=>{let{dx:t,dy:o,graphic:i}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move"},type:"update"})},onGraphicMoveStop:e=>{let{dx:t,dy:o,graphic:i}=e;this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){const{enableRotation:n,enableScaling:r,preserveAspectRatio:s}=t,a=await this._requireModule(Promise.all([o.e(3503),o.e(6306)]).then(o.bind(o,96306)));return De(a)?a:new a.module.default({graphics:e,enableRotation:n,enableScaling:r,preserveAspectRatio:s,layer:this._internalGraphicsLayer,view:i,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,i){const n="split"===t.reshapeOptions?.edgeOperation,r="move"===t.reshapeOptions?.shapeOperation,s=await this._requireModule(Promise.all([o.e(5652),o.e(1129),o.e(3503),o.e(3362)]).then(o.bind(o,83362)));return De(s)?s:new s.module.default({enableMidpoints:n,enableMovement:r,graphic:e[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:i,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:e=>{let{mover:t,type:o}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t,type:o},type:"update"})},onMoveStart:e=>{let{dx:t,dy:o,mover:i,type:n}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:n},type:"update"})},onMove:e=>{let{dx:t,dy:o,mover:i,type:n}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:n},type:"update"})},onMoveStop:e=>{let{dx:t,dy:o,mover:i,type:n}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:n},type:"update"})},onVertexAdd:e=>{let{added:t,type:o,vertices:i}=e;const n=t.map((e=>(0,m.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:n,vertices:i,type:o},type:"update"})},onVertexRemove:e=>{let{removed:t,type:o,vertices:i}=e;const n=t.map((e=>(0,m.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:n,vertices:i,type:o},type:"update"})}}})}_getHandlesForComponent(e,t){const o=e.activeComponent;switch(o.type){case"graphic-mover":return[o.on("graphic-click",(t=>{let{graphic:o,viewEvent:i}=t;i.native?.shiftKey&&(i.stopPropagation(),e.removeFromSelection(o))})),o.on("graphic-move-start",(t=>e.addToHistory(Ne(t.allGraphics))))];case"box":return[o.on("graphic-click",(o=>this._onTransformOrReshape2DGraphicClick(e,t,o))),o.on("move-start",(t=>e.addToHistory(Ne(t.graphics)))),o.on("rotate-start",(t=>e.addToHistory(Ne(t.graphics)))),o.on("scale-start",(t=>e.addToHistory(Ne(t.graphics))))];case"reshape":return[o.on("graphic-click",(o=>this._onTransformOrReshape2DGraphicClick(e,t,o))),o.on("move-start",(t=>e.addToHistory(Ne([t.mover])))),o.on("reshape-start",(t=>e.addToHistory(Ne([t.graphic])))),o.on("vertex-add",(t=>e.addToHistory(Ne([t.oldGraphic])))),o.on("vertex-remove",(t=>e.addToHistory(Ne([t.oldGraphic]))))];case"move-3d":return[o.on("graphic-move-start",(t=>{e.addToHistory(Ne(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"})})),o.on("graphic-move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"})})),o.on("graphic-move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"})})),o.on("immediate-click",(o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[o.on("record-undo",(t=>{let{record:o}=t;e.addToHistory({updates:[o]})})),o.on("graphic-translate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})})),o.on("graphic-translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})})),o.on("graphic-rotate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-start"},type:"update"})})),o.on("graphic-rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})})),o.on("graphic-scale-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})})),o.on("graphic-scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})})),o.on("graphic-translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})})),o.on("graphic-rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"})})),o.on("graphic-scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})})),o.on("immediate-click",(o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool()}))];case"reshape-3d":return[o.on("reshape",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),o.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),o.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),o.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),o.on("immediate-click",(o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool()}))];default:return}}_onTransformOrReshape2DGraphicClick(e,t,o){const{graphic:i,viewEvent:n}=o;return n.native?.shiftKey&&i.layer===this.layer?(n.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(n.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const o=this.view.map;this._disablePopup(t);e.on("complete",(()=>{if(e===this._operationHandle){const i=this.updateGraphics.toArray(),n=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),o&&o.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:i,state:"complete",aborted:e.cancelled,tool:n,toolEventInfo:null,type:"update"})}}))}async _getCommonUpdateOperationClickHandlers(e,t,o){const i=(0,Ee.vT)(t),n=await t.async((()=>this._getFirstHit(i)));(0,h.Wi)(n)?e.complete():t.native.shiftKey&&this._toggleSelection([n.graphic],e,o)||this.updateGraphics.includes(n.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,o){const i=!!o.multipleSelectionEnabled;return e.some((e=>null!=e&&!(!i||e.layer!==this.layer)&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0)))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const o=t.key;o===P.j.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):o===P.j.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):o===P.j.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&P.j.delete.includes(o)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,o=this.updateGraphics.toArray();(0,h.Wi)(t)||"reshape-3d"===t.type||("reshape"!==t.type||1===o.length&&"point"===(0,h.U2)(o[0].geometry,"type"))&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,h.SC)(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||(0,h.Wi)(t))&&(e.attributes&&e.attributes.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,o){Re.error(new s.Z(e,t,o))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const o=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:o}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:Me}}wait(){return(0,d.N1)((()=>!this.updating))}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(0,h.pC)(e)&&e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&(0,h.Wi)(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1)}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&(0,h.pC)(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}async _waitViewReady(){const e=this.view;e&&((0,h.IM)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,c.Hl)((0,d.N1)((()=>e?.ready)),this._viewReadyAbortController.signal))}};function Ae(e){return"polygon"===e||"rectangle"===e||"circle"===e}function ke(e,t){Ve("undo",e.history.undo,e.history.redo,t)}function Le(e,t){Ve("redo",e.history.redo,e.history.undo,t)}function Ve(e,t,o,i){const n=t.pop().updates,r=[];i.forEach(((t,o)=>{const i=n[o];null!=i&&("geometry"in i&&(0,h.pC)(i.geometry)&&(r.push({geometry:t.geometry}),t.geometry=i.geometry),"symbol"in i&&(0,h.pC)(i.symbol)&&(r.push({symbol:t.symbol}),t.symbol=i.symbol),"undo"in i&&(r.push(i),i[e](t)))})),o.push({updates:r})}function Ne(e){return{updates:e.map((e=>({geometry:e.geometry})))}}function De(e){return"requireError"in e&&"aborted"===e.requireError}(0,i._)([(0,u.Cb)()],He.prototype,"updating",null),(0,i._)([(0,u.Cb)()],He.prototype,"_operationHandle",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],He.prototype,"activeTool",null),(0,i._)([(0,u.Cb)()],He.prototype,"activeFillSymbol",void 0),(0,i._)([(0,u.Cb)()],He.prototype,"activeLineSymbol",void 0),(0,i._)([(0,u.Cb)()],He.prototype,"activeVertexSymbol",void 0),(0,i._)([(0,u.Cb)()],He.prototype,"allowDeleteKey",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],He.prototype,"createGraphic",null),(0,i._)([(0,u.Cb)()],He.prototype,"defaultCreateOptions",null),(0,i._)([(0,u.Cb)()],He.prototype,"defaultUpdateOptions",null),(0,i._)([(0,u.Cb)({type:G.Z,nonNullable:!0})],He.prototype,"labelOptions",void 0),(0,i._)([(0,u.Cb)()],He.prototype,"layer",void 0),(0,i._)([(0,u.Cb)({types:n.LB})],He.prototype,"pointSymbol",void 0),(0,i._)([(0,u.Cb)({types:n.LB})],He.prototype,"polygonSymbol",void 0),(0,i._)([(0,u.Cb)({types:n.LB})],He.prototype,"polylineSymbol",void 0),(0,i._)([(0,u.Cb)({type:ye,nonNullable:!0})],He.prototype,"snappingOptions",null),(0,i._)([(0,u.Cb)()],He.prototype,"_snappingManager",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],He.prototype,"state",null),(0,i._)([(0,u.Cb)({type:R.Z,nonNullable:!0})],He.prototype,"tooltipOptions",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],He.prototype,"updateGraphics",void 0),(0,i._)([(0,u.Cb)()],He.prototype,"updateOnGraphicClick",void 0),(0,i._)([(0,u.Cb)({types:n.LB})],He.prototype,"updatePointSymbol",void 0),(0,i._)([(0,u.Cb)({types:n.LB})],He.prototype,"updatePolygonSymbol",void 0),(0,i._)([(0,u.Cb)({types:n.LB})],He.prototype,"updatePolylineSymbol",void 0),(0,i._)([(0,u.Cb)({types:n.LB})],He.prototype,"vertexSymbol",void 0),(0,i._)([(0,u.Cb)({value:null})],He.prototype,"view",null),He=(0,i._)([(0,g.j)(Ge)],He);const Ue=He}}]);
//# sourceMappingURL=5604.f8062f21.chunk.js.map