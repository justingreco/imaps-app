"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[1409],{85981:(t,n,e)=>{e.d(n,{AR:()=>_,Gr:()=>m,JG:()=>u,Jk:()=>g,KU:()=>f,Ue:()=>a,al:()=>d,ct:()=>l,nF:()=>p,zk:()=>h});var o=e(16889),i=e(21530),r=e(11186),s=e(71353),c=e(11185);function a(t){return t?{origin:(0,s.a)(t.origin),vector:(0,s.a)(t.vector)}:{origin:(0,s.c)(),vector:(0,s.c)()}}function u(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a();return d(t.origin,t.vector,n)}function d(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a();return(0,r.c)(e.origin,t),(0,r.c)(e.vector,n),e}function h(t,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a();return(0,r.c)(e.origin,t),(0,r.b)(e.vector,n,t),e}function g(t,n){const e=(0,r.b)(c.WM.get(),n,t.origin),i=(0,r.e)(t.vector,e),s=(0,r.e)(t.vector,t.vector),a=(0,o.uZ)(i/s,0,1),u=(0,r.b)(c.WM.get(),(0,r.g)(c.WM.get(),t.vector,a),e);return(0,r.e)(u,u)}function p(t,n,e){return l(t,n,0,1,e)}function f(t,n,e){return(0,r.a)(e,t.origin,(0,r.g)(e,t.vector,n))}function l(t,n,e,i,s){const{vector:a,origin:u}=t,d=(0,r.b)(c.WM.get(),n,u),h=(0,r.e)(a,d)/(0,r.p)(a);return(0,r.g)(s,a,(0,o.uZ)(h,e,i)),(0,r.a)(s,s,t.origin)}function m(t,n){if(b(t,function(t,n){const e=v.get();return e.origin=t,e.vector=n,e}(n.origin,n.direction),!1,M)){const{tA:n,pB:e,distance2:o}=M;if(n>=0&&n<=1)return o;if(n<0)return(0,r.d)(t.origin,e);if(n>1)return(0,r.d)((0,r.a)(c.WM.get(),t.origin,t.vector),e)}return null}function _(t,n,e){return!!b(t,n,!0,M)&&((0,r.c)(e,M.pA),!0)}function b(t,n,e,i){const s=1e-6,a=t.origin,u=(0,r.a)(c.WM.get(),a,t.vector),d=n.origin,h=(0,r.a)(c.WM.get(),d,n.vector),g=c.WM.get(),p=c.WM.get();if(g[0]=a[0]-d[0],g[1]=a[1]-d[1],g[2]=a[2]-d[2],p[0]=h[0]-d[0],p[1]=h[1]-d[1],p[2]=h[2]-d[2],Math.abs(p[0])<s&&Math.abs(p[1])<s&&Math.abs(p[2])<s)return!1;const f=c.WM.get();if(f[0]=u[0]-a[0],f[1]=u[1]-a[1],f[2]=u[2]-a[2],Math.abs(f[0])<s&&Math.abs(f[1])<s&&Math.abs(f[2])<s)return!1;const l=g[0]*p[0]+g[1]*p[1]+g[2]*p[2],m=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],_=g[0]*f[0]+g[1]*f[1]+g[2]*f[2],b=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],M=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*b-m*m;if(Math.abs(M)<s)return!1;let v=(l*m-_*b)/M,w=(l+m*v)/b;e&&(v=(0,o.uZ)(v,0,1),w=(0,o.uZ)(w,0,1));const C=c.WM.get(),E=c.WM.get();return C[0]=a[0]+v*f[0],C[1]=a[1]+v*f[1],C[2]=a[2]+v*f[2],E[0]=d[0]+w*p[0],E[1]=d[1]+w*p[1],E[2]=d[2]+w*p[2],i.tA=v,i.tB=w,i.pA=C,i.pB=E,i.distance2=(0,r.d)(C,E),!0}const M={tA:0,tB:0,pA:(0,s.c)(),pB:(0,s.c)(),distance2:0},v=new i.x((()=>({origin:null,vector:null})))},97731:(t,n,e)=>{e.d(n,{E6:()=>u,Kj:()=>g,RQ:()=>l,T:()=>s,ep:()=>a,hu:()=>r,kG:()=>h,tM:()=>f,u_:()=>d,yK:()=>c,zF:()=>p});var o=e(6394);e(90045);(0,e(67077).c)();class i{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function r(t,n){if(!t)throw n=n||"assert",console.log(new Error(n).stack),new i(n)}function s(t,n){t||(n=n||"",console.warn("Verify failed: "+n+"\n"+new Error("verify").stack))}function c(t,n,e,o){let i,r=(e[0]-t[0])/n[0],s=(o[0]-t[0])/n[0];r>s&&(i=r,r=s,s=i);let c=(e[1]-t[1])/n[1],a=(o[1]-t[1])/n[1];if(c>a&&(i=c,c=a,a=i),r>a||c>s)return!1;c>r&&(r=c),a<s&&(s=a);let u=(e[2]-t[2])/n[2],d=(o[2]-t[2])/n[2];return u>d&&(i=u,u=d,d=i),!(r>d||u>s)&&(d<s&&(s=d),!(s<0))}function a(t,n,e,i,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,o.a)();const c=(i[r]-e[r])*(n[0]-t[0])-(i[0]-e[0])*(n[r]-t[r]),a=(i[0]-e[0])*(t[r]-e[r])-(i[r]-e[r])*(t[0]-e[0]);if(0===c)return!1;const u=a/c;return s[0]=t[0]+u*(n[0]-t[0]),s[1]=t[r]+u*(n[r]-t[r]),!0}function u(t,n){return Math.log(t)/Math.log(n)}function d(t,n,e,o){t[12]=n,t[13]=e,t[14]=o}function h(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}function g(t,n,e){return 2*Math.atan(Math.sqrt(n*n+e*e)*Math.tan(.5*t)/n)}function p(t,n,e){return 2*Math.atan(Math.sqrt(n*n+e*e)*Math.tan(.5*t)/e)}function f(t,n,e){return 2*Math.atan(n*Math.tan(.5*t)/Math.sqrt(n*n+e*e))}function l(t,n,e){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(n*n+e*e))}},54357:(t,n,e)=>{e.r(n),e.d(n,{SceneLayerSnappingSourceWorker:()=>f,default:()=>l});var o=e(27366),i=e(92026),r=e(66978),s=(e(32718),e(25243),e(63780),e(93169),e(75366),e(69912)),c=e(11186),a=e(71353),u=e(85981),d=e(23470),h=e(92536),g=e(78329),p=e(11438);let f=class{constructor(){this._idToComponent=new Map,this._components=new g.Z((t=>t.bounds)),this._edges=new g.Z((t=>t.bounds)),this._tmpLineSegment=(0,u.Ue)(),this._tmpP1=(0,a.c)(),this._tmpP2=(0,a.c)(),this._tmpP3=(0,a.c)(),this.remoteClient=null}async fetchCandidates(t,n){await Promise.resolve(),(0,r.k_)(n),await this._ensureEdgeLocations(t,n);const e=[];return this._edges.forEachNeighbor((n=>this._addCandidates(t,n,e)),t.bounds),{result:{candidates:e}}}async _ensureEdgeLocations(t,n){const e=[];if(this._components.forEachNeighbor((t=>{if((0,i.Wi)(t.info)){const{id:n,uid:o}=t;e.push({id:n,uid:o})}}),t.bounds),!e.length)return;const o={components:e},r=await this.remoteClient.invoke("fetchAllEdgeLocations",o,(0,i.Pt)(n,{}));for(const i of r.components)this._setFetchEdgeLocations(i)}async add(t){const n=new m(t.id,t.bounds);return this._idToComponent.set(n.id,n),this._components.add([n]),{result:{}}}async remove(t){const n=this._idToComponent.get(t.id);if(n){const t=[];this._edges.forEachNeighbor((e=>{e.component===n&&t.push(e)}),n.bounds),this._edges.remove(t),this._components.remove([n]),this._idToComponent.delete(n.id)}return{result:{}}}_setFetchEdgeLocations(t){const n=this._idToComponent.get(t.id);if((0,i.Wi)(n)||t.uid!==n.uid)return;const e=p.extractComponentsEdgeLocationsLayout.createView(t.locations),o=new Array(e.count),r=(0,a.c)(),s=(0,a.c)();for(let i=0;i<e.count;i++){const a=(0,d.c)(),u=(0,d.g)(a);e.position0.getVec(i,r),e.position1.getVec(i,s),(0,c.C)(u,u,r,.5),(0,c.C)(u,u,s,.5),(0,c.a)(u,u,t.origin),a[3]=(0,c.i)(u,r);const h=new _(n,i,a);o[i]=h}this._edges.add(o);const{objectIds:u,origin:h}=t;n.info={locations:e,objectIds:u,origin:h}}_addCandidates(t,n,e){const{locations:o,origin:i,objectIds:r}=n.component.info,s=o.position0.getVec(n.index,this._tmpP1),a=o.position1.getVec(n.index,this._tmpP2);(0,c.a)(s,s,i),(0,c.a)(a,a,i);const u=r[o.componentIndex.get(n.index)];this._addEdgeCandidate(t,u,s,a,e),this._addVertexCandidate(t,u,s,e),this._addVertexCandidate(t,u,a,e)}_addEdgeCandidate(t,n,e,o,i){if(!(t.types&h.r.EDGE))return;const r=(0,d.g)(t.bounds),s=(0,u.zk)(e,o,this._tmpLineSegment),g=(0,u.nF)(s,r,this._tmpP3);if(!(0,d.m)(t.bounds,g))return null;i.push({type:"edge",objectId:n,target:(0,a.a)(g),distance:(0,c.i)(r,g),start:(0,a.a)(e),end:(0,a.a)(o)})}_addVertexCandidate(t,n,e,o){if(!(t.types&h.r.VERTEX))return;const i=(0,d.g)(t.bounds);if(!(0,d.m)(t.bounds,e))return null;o.push({type:"vertex",objectId:n,target:(0,a.a)(e),distance:(0,c.i)(i,e)})}};function l(){return new f}f=(0,o._)([(0,s.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],f);class m{constructor(t,n){this.id=t,this.bounds=n,this.info=null,this.uid=++m.uid}}m.uid=0;class _{constructor(t,n,e){this.component=t,this.index=n,this.bounds=e}}}}]);
//# sourceMappingURL=1409.d5030b50.chunk.js.map