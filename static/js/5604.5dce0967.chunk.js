"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[5604],{42137:(e,t,i)=>{i.d(t,{Z:()=>y});var o,r=i(27366),s=i(68860),n=i(49861),a=(i(63780),i(93169),i(25243),i(69912)),p=i(7882),l=i(80885),h=i(92183),c=i(15559),d=i(81753),u=i(89093);let g=o=class extends l.Z{constructor(){super(...arguments),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e&&e.center)i=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return{...super.normalizeCtorArgs(),...i,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,0!==this.rings.length||!e)return;const i=(0,s.En)(this.radius,this.radiusUnit,"meters"),o=e.spatialReference;let r,n="geographic";if(o.isWebMercator?n="webMercator":(null!=u.Z[o.wkid]||o.wkt&&0===o.wkt.indexOf("PROJCS"))&&(n="projected"),this.geodesic){let o;switch(n){case"webMercator":o=(0,d.Sx)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":o=e}r=this._createGeodesicCircle(o,i,t),"webMercator"===n&&(r=(0,d.$)(r))}else{let o;"webMercator"===n||"projected"===n?o=i/this._convert2Meters(1,e.spatialReference):"geographic"===n&&(o=(0,s.ty)(i,"meters",(0,h.Iu)(e.spatialReference).radius)),r=this._createPlanarCircle(e,o,t)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s}=this;return new o({center:e.clone(),numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s})}_createGeodesicCircle(e,t,i){let o=0;const r=[];for(;o<360;){const s=[0,0],n=[e.x,e.y];(0,c.TB)(s,n,o,t),this.hasZ&&s.push(e.z),r.push(s),o+=360/i}return r.push(r[0]),new l.Z(r)}_createPlanarCircle(e,t,i){const o=[],r=2*Math.PI/i;for(let s=0;s<i;++s){const i=r*s,n=[e.x+Math.cos(-i)*t,e.y+Math.sin(-i)*t];this.hasZ&&n.push(e.z),o.push(n)}return o.push(o[0]),new l.Z({spatialReference:e.spatialReference,rings:[o]})}_convert2Meters(e,t){let i;if(null!=u.Z[t.wkid])i=u.Z.values[u.Z[t.wkid]];else{const e=t.wkt,o=e.lastIndexOf(",")+1,r=e.lastIndexOf("]]");i=parseFloat(e.substring(o,r))}return e*i}};(0,r._)([(0,n.Cb)({type:p.Z})],g.prototype,"center",void 0),(0,r._)([(0,n.Cb)()],g.prototype,"geodesic",void 0),(0,r._)([(0,n.Cb)()],g.prototype,"numberOfPoints",void 0),(0,r._)([(0,n.Cb)()],g.prototype,"radius",void 0),(0,r._)([(0,n.Cb)()],g.prototype,"radiusUnit",void 0),g=o=(0,r._)([(0,a.j)("esri.geometry.Circle")],g);const y=g},40237:(e,t,i)=>{i.d(t,{N:()=>o});const o={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,i){const o=new r(e.getPointX(t),e.getPointY(t),i),s=e.hasZ(t),n=e.hasM(t);return s&&(o.z=e.getPointZ(t)),n&&(o.m=e.getPointM(t)),o},exportPolygon:function(e,t,i){return new s(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,i){return new n(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,i){return new a(e.exportPoints(t),i,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,i){const o=e.hasZ(t),r=e.hasM(t),s=new p(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),i);if(o){const i=e.getZExtent(t);s.zmin=i.vmin,s.zmax=i.vmax}if(r){const i=e.getMExtent(t);s.mmin=i.vmin,s.mmax=i.vmax}return s}};class r{constructor(e,t,i){this.x=e,this.y=t,this.spatialReference=i,this.z=void 0,this.m=void 0}}class s{constructor(e,t,i,o){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),o&&(this.hasM=o)}}class n{constructor(e,t,i,o){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),o&&(this.hasM=o)}}class a{constructor(e,t,i,o){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),o&&(this.hasM=o)}}class p{constructor(e,t,i,o,r){this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=o,this.spatialReference=r,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},19995:(e,t,i)=>{i.d(t,{_W:()=>d,iV:()=>y,oj:()=>m});var o=i(92026),r=i(79803),s=i(40237),n=i(92975),a=i(81753);const p=[0,0];function l(e,t){if(!t)return null;if("x"in t){const i={x:0,y:0};return[i.x,i.y]=e(t.x,t.y,p),null!=t.z&&(i.z=t.z),null!=t.m&&(i.m=t.m),i}if("xmin"in t){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,p),[i.xmax,i.ymax]=e(t.xmax,t.ymax,p),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:h(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:h(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:c(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function h(e,t){const i=[];for(const o of e)i.push(c(o,t));return i}function c(e,t){const i=[];for(const o of e){const e=t(o[0],o[1],[0,0]);i.push(e),o.length>2&&e.push(o[2]),o.length>3&&e.push(o[3])}return i}async function d(e,t){if(!t)return;const i=Array.isArray(e)?e.map((e=>(0,o.pC)(e.geometry)&&e.geometry.spatialReference)):[e];await(0,r.iQ)(i.map((e=>({source:e,dest:t}))))}const u=l.bind(null,a.hG),g=l.bind(null,a.R6);function y(e,t,i,o){if(!e)return e;if(i||(i=t,t=e.spatialReference),!(0,n.JY)(t)||!(0,n.JY)(i)||(0,n.fS)(t,i))return e;if((0,a.Q8)(t,i)){const t=(0,n.sS)(i)?u(e):g(e);return t.spatialReference=i,t}return(0,r.oj)(s.N,[e],t,i,null,o)[0]}const v=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,i){if(!e||!e.length||!t||!i||(0,n.fS)(t,i))return e;const o={geometries:e,inSpatialReference:t,outSpatialReference:i,resolve:null};return this._jobs.push(o),new Promise((e=>{o.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:i,outSpatialReference:o,resolve:p}=e;(0,a.Q8)(i,o)?(0,n.sS)(o)?p(t.map(u)):p(t.map(g)):p((0,r.oj)(s.N,t,i,o,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function m(e,t,i){return v.push(e,t,i)}},77498:(e,t,i)=>{i.d(t,{Z:()=>r,e:()=>o});var o;i(93169);function r(e){switch(e){case o.SUPPORTED:break;case o.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case o.GEOMETRY_MISSING:return"no geometry";case o.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case o.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case o.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}!function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(o||(o={}))},57889:(e,t,i)=>{i.d(t,{P:()=>n});i(93169);var o=i(92026),r=i(74509),s=i(77498);function n(e){if("graphics"!==e.layer?.type)return s.e.GRAPHICS_LAYER_MISSING;if((0,o.Wi)(e.geometry))return s.e.GEOMETRY_MISSING;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return s.e.GEOMETRY_TYPE_UNSUPPORTED}return"on-the-ground"!==(0,r.vu)(e)&&(0,r.Lt)(e)?s.e.ELEVATION_MODE_UNSUPPORTED:s.e.SUPPORTED}},46684:(e,t,i)=>{i.d(t,{P:()=>a,b:()=>p});var o=i(92026),r=i(42137),s=i(74509),n=i(77498);function a(e){return l(e).result}function p(e){return l(e).geometry}function l(e){return"graphics"!==e.layer?.type?{result:n.e.GRAPHICS_LAYER_MISSING,geometry:null}:(0,o.Wi)(e.geometry)?{result:n.e.GEOMETRY_MISSING,geometry:null}:"on-the-ground"!==(0,s.vu)(e)&&(0,s.Lt)(e)?{result:n.e.ELEVATION_MODE_UNSUPPORTED,geometry:null}:"point"!==e.geometry.type&&"polyline"!==e.geometry.type&&("polygon"!==e.geometry.type||e.geometry instanceof r.Z)?{result:n.e.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:n.e.SUPPORTED,geometry:e.geometry}}},83089:(e,t,i)=>{i.d(t,{j:()=>s,p:()=>r});var o=i(92026);function r(e,t,i){if(!t||!e||!e.map)return;const{map:o}=e,r=o.layers.find((e=>e===t));r||o.add(t,i),null!=i&&o.layers.reorder(r,i)}function s(e,t){return e.allLayerViews.find((e=>{const i=e.layer;return i===t||"sublayers"in i&&(0,o.pC)(i.sublayers)&&i.sublayers.includes(t)}))}},95122:(e,t,i)=>{i.d(t,{Bq:()=>u,Hk:()=>l,UL:()=>g,ku:()=>d,yG:()=>c});var o=i(88396),r=i(6394),s=i(76014),n=i(64674),a=i(94163);class p{constructor(e){this.coordinateHelper=e}}class l extends p{constructor(e,t){super(e),this.point=t}objectEqual(e){return e instanceof l&&(0,n.Xv)(this.point,e.point)}check(e){return(0,o.s)(e,this.point)<s.c.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(e){const t=[];return e instanceof h?t.push(...(0,a.pk)({start:e.start,end:e.end,type:e instanceof d?a.SP.LINE:a.SP.RAY},this.point)):e instanceof g&&t.push(...(0,a.l0)(e.center,e.radius,this.point)),t.map((t=>new u(this.coordinateHelper,t,this,e)))}}class h extends p{constructor(e,t,i){super(e),this.start=t,this.end=i}objectEqual(e){return e instanceof h&&(0,n.Xv)(this.start,e.start)&&(0,n.Xv)(this.end,e.end)}intersect(e){const t=[];return e instanceof l?t.push(...(0,a.pk)({start:this.start,end:this.end,type:this instanceof d?a.SP.LINE:a.SP.RAY},e.point)):e instanceof h?t.push(...(0,a.dU)({start:this.start,end:this.end,type:this instanceof d?a.SP.LINE:a.SP.RAY},{start:e.start,end:e.end,type:e instanceof d?a.SP.LINE:a.SP.RAY})):e instanceof g&&t.push(...(0,a.UG)({start:this.start,end:this.end,type:this instanceof d?a.SP.LINE:a.SP.RAY},e.center,e.radius)),t.map((t=>new u(this.coordinateHelper,t,this,e)))}}class c extends h{constructor(e,t,i){super(e,t,i),this.dir=(0,r.a)(),this.p=(0,r.a)()}objectEqual(e){return e instanceof c&&super.objectEqual(e)}check(e){return(0,o.g)(this.dir,this.end,this.start),(0,o.g)(this.p,e,this.start),(0,o.h)(this.dir,this.p)>=0&&(0,a.Oy)(e,this.start,this.end)<s.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,a.aW)(t,e,this.start,this.end),t}}class d extends h{constructor(e,t,i){super(e,t,i)}objectEqual(e){return e instanceof d&&super.objectEqual(e)}check(e){return(0,a.Oy)(e,this.start,this.end)<s.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,a.k0)(t,e,this.start,this.end),t}}class u extends p{constructor(e,t,i,o){super(e),this.intersection=t,this.first=i,this.second=o}objectEqual(e){return e instanceof u&&this.first.objectEqual(e.first)&&this.second.objectEqual(e.second)}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,o.c)(t,this.intersection),t}intersect(){return[]}}class g extends p{constructor(e,t,i){super(e),this.center=t,this.radius=i}objectEqual(e){return e instanceof g&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return(0,a.xO)(t,e,this.center,this.radius),t}intersect(e){const t=[];return e instanceof h?t.push(...(0,a.UG)({start:e.start,end:e.end,type:e instanceof d?a.SP.LINE:a.SP.RAY},this.center,this.radius)):e instanceof l&&t.push(...(0,a.l0)(this.center,this.radius,e.point)),t.map((t=>new u(this.coordinateHelper,t,this,e)))}}},95905:(e,t,i)=>{i.d(t,{L:()=>a});var o=i(95122),r=i(64674),s=i(75691),n=i(53397);class a extends s.a{constructor(e){super({...e,constraint:new o.ku(e.coordinateHelper,e.edgeStart,e.edgeEnd)})}get hints(){return[new n.w(r.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo)]}}},75691:(e,t,i)=>{i.d(t,{a:()=>r});var o=i(92605);class r extends o.j{constructor(e){let{coordinateHelper:t,targetPoint:i,objectId:o,constraint:r,elevationInfo:s}=e;super(t,i,r,s),this.objectId=o}}},92605:(e,t,i)=>{i.d(t,{j:()=>o});class o{constructor(e,t,i,o){this.coordinateHelper=e,this.targetPoint=t,this.constraint=i,this.elevationInfo=o}}},11208:(e,t,i)=>{i.d(t,{$r:()=>p,By:()=>c,RS:()=>l,a7:()=>h});var o=i(17842),r=(i(88396),i(11186)),s=i(71353),n=i(7882),a=i(74509);function p(e,t,i,o){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,s.c)();const n=t.toXYZ(e);return n[2]=(0,a.zx)(o,n,t.spatialReference,i)||0,o.renderCoordsHelper.toRenderCoords(n,t.spatialReference,r),r}function l(e,t,i,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,s.c)();const p=(0,r.c)(u,e);return p[2]=(0,a.zx)(o,p,t,i)||0,o.renderCoordsHelper.toRenderCoords(p,t,n),n}function h(e,t,i,r){return"2d"===r.type?r.toScreen(t.vectorToPoint(e,d)):(p(e,t,i,r,u),r.state.camera.projectToScreen(u,g),(0,o.vW)(g[0],g[1]))}function c(e,t,i,o,r,s,n){const p=i.toXYZ(e),l=i.toXYZ(t);if("absolute-height"!==o.mode){const e=(0,a.zx)(r,p,i.spatialReference,o),t=(0,a.zx)(r,l,i.spatialReference,o),s=(null==e?t:null==t?e:Math.min(e,t))||0;p[2]=s,l[2]=s}r.renderCoordsHelper.toRenderCoords(p,i.spatialReference,s),r.renderCoordsHelper.toRenderCoords(l,i.spatialReference,n)}const d=new n.Z,u=(0,s.c)(),g=((0,o.J$)(),(0,o.J$)(),(0,o.s1)());(0,o.s1)()},97426:(e,t,i)=>{i.d(t,{Z:()=>je});var o=i(27366),r=i(51508),s=i(40281),n=(i(93169),i(10064)),a=i(91505),p=i(100),l=i(32718),h=i(92026),c=i(66978),d=i(94172),u=i(49861),g=(i(63780),i(25243),i(69912)),y=i(79803),v=i(92183),m=i(69662),f=i(92975),_=i(93655),E=i(15404),b=i(77498),w=i(57889),T=i(46684),S=i(74509);var C,x=i(83089),O=i(91806),P=i(87888),G=i(52349),R=i(61920),I=i(41691),M=i(88396),A=i(77427),H=i(71353),k=i(92536),V=i(95122),U=i(64674),D=i(95905),L=i(75691),j=i(92605),Z=i(53397),F=i(41216);class N extends j.j{constructor(e){let{coordinateHelper:t,targetPoint:i,constraint:o,previousVertex:r,otherVertex:s,otherVertexType:n,objectId:a,elevationInfo:p}=e;super(t,i,o,p),this.previousVertex=r,this.otherVertex=s,this.otherVertexType=n,this.objectId=a}get hints(){const e=this.previousVertex,t=this.otherVertexType===C.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===C.CENTER?this.targetPoint:this.otherVertex,o=this.elevationInfo;return[new Z.w(U.ze.TARGET,t,i,o),new Z.w(U.ze.REFERENCE,e,t,o),new F.y(this.previousVertex,t,i,o)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(C||(C={}));var W=i(11208);let z=class extends I.r{constructor(e){super(e),this.options=null,this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return(0,A.oE)(this.snappingSources,(e=>{let{snappingSource:t}=e;return t.updating}))||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,t=new Map;if((0,h.pC)(this.options)&&(0,h.pC)(this.options.featureSources))for(const i of this.options.featureSources.items){const o=i.layer.uid,r=e.get(o);if(r){e.delete(o),t.set(o,r);continue}if(!i.layer.loaded){this.updatingHandles.addPromise(i.layer.load());continue}const s=this._createSourceInfo(i);(0,h.pC)(s)&&t.set(o,s)}for(const[,i]of e)i.destroy();return t}initialize(){this.updatingHandles.add((()=>this.snappingSources),(()=>this.notifyChange("updating")),d.Z_),(0,h.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",(e=>this._updateLayerView(e.layer,e.layerView))),this.view.on("layerview-destroy",(e=>this._updateLayerView(e.layer,null)))])}_updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i){if((0,h.Wi)(this.options)||!this.options.effectiveFeatureEnabled)return[];const o=[],r=this._computeScreeenSizeDistanceParameters(e,t),s={distance:r,point:e,coordinateHelper:t.coordinateHelper,types:this.types,filter:null};for(const[,{snappingSource:a,layerView:p}]of this.snappingSources)!a.layerSource.enabled||(0,h.pC)(p)&&p.suspended||o.push(a.fetchCandidates(s,i).then((e=>e.filter((e=>!this._candidateIsExcluded(a,e,t.excludeFeature))))));const n=(await(0,c.WW)(o)).flat();return this._addRightAngleCandidates(n,e,r,t),(0,c.k_)(i),(0,U.lQ)(e,n),n}_addRightAngleCandidates(e,t,i,o){const r=(0,h.pC)(o.vertexHandle)?o.vertexHandle.rightEdge?.rightVertex?.pos:(0,h.pC)(o.editGeometryOperations)&&"polygon"===o.editGeometryOperations.data.type?(0,h.Wg)(o.editGeometryOperations.data.components[0]?.getFirstVertex())?.pos:null,s=(0,h.pC)(o.vertexHandle)?o.vertexHandle.leftEdge?.leftVertex?.pos:(0,h.pC)(o.editGeometryOperations)?(0,h.Wg)(o.editGeometryOperations.data.components[0]?.getLastVertex())?.pos:null,n=e.length;for(let a=0;a<n;a++)this._addRightAngleCandidate(e[a],s,t,i,o,e),this._addRightAngleCandidate(e[a],r,t,i,o,e)}_addRightAngleCandidate(e,t,i,o,r,s){if((0,h.Wi)(t)||!(e instanceof D.L))return;const n=e.constraint.closestTo(t),a=(n[0]-i[0])/o.x,p=(n[1]-i[1])/o.y;if(a*a+p*p<=1){const i=r.coordinateHelper;s.push(new N({coordinateHelper:i,targetPoint:n,otherVertex:t,otherVertexType:C.NEXT,previousVertex:e.constraint.start,constraint:new V.yG(i,t,n),objectId:e.objectId,elevationInfo:e.elevationInfo}))}}_computeScreeenSizeDistanceParameters(e,t){const i=(0,h.pC)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;if((0,h.Wi)(this.view))return{x:i,y:i,pixelSize:i};if("2d"===this.view.type){const e=i*this.view.resolution;return{x:e,y:e,pixelSize:e}}return this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,o){const{coordinateHelper:r,elevationInfo:s}=o,n=i.state.camera.computeScreenPixelSizeAt((0,W.$r)(e,r,s,i,q)),a=n*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,p=t*a;return{x:p/this._computeScreenMagnitudeOfMapOffset(e,a,0,i,o),y:p/this._computeScreenMagnitudeOfMapOffset(e,0,a,i,o),pixelSize:n}}_computeScreenMagnitudeOfMapOffset(e,t,i,o,r){let{coordinateHelper:s,elevationInfo:n}=r;const a=s.clone(e);a[0]+=t,a[1]+=i;const p=(0,W.a7)(e,s,n,o),l=(0,W.a7)(a,s,n,o),h=l.x-p.x,c=l.y-p.y;return Math.sqrt(h*h+c*c)}get types(){return k.r.EDGE|k.r.VERTEX}_candidateIsExcluded(e,t,i){if((0,h.Wi)(i))return!1;const o=this._getCandidateObjectId(t);if((0,h.Wi)(o))return!1;const r=e.layerSource.layer;return"graphics"===r.type?i.uid===o:i.sourceLayer===r&&!(!i.attributes||!("objectIdField"in r))&&i.attributes[r.objectIdField]===o}_getCandidateObjectId(e){return e instanceof L.a?e.objectId:null}_createSourceInfo(e){const t=this._createFeatureSnappingSourceType(e);if((0,h.Wi)(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then((()=>{this.destroyed||this.notifyChange("snappingSources")}))),null;const i=(0,h.pC)(this.view)?this.view.allLayerViews.find((t=>t.layer===e.layer)):null;return new Y(t.source,i)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e)}return null}_createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":{const t=this._getSourceModule("featureService");return(0,h.pC)(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===e.layer.geometryType)return null;const t=this._getSourceModule("featureCollection");return(0,h.pC)(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:t.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const t=this._getSourceModule("graphics");return(0,h.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_getSourceModule(e){const t=this.sourceModules[e];if((0,h.Wi)(t.loader)){const i=this._loadSourceModule(e).then((e=>{t.module=e}));return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}_loadSourceModule(e){switch(e){case"featureService":return this.updatingHandles.addPromise(Promise.all([i.e(5652),i.e(4134)]).then(i.bind(i,84134)));case"featureCollection":return this.updatingHandles.addPromise(i.e(2137).then(i.bind(i,26823)));case"graphics":return this.updatingHandles.addPromise(Promise.all([i.e(4e3),i.e(8928),i.e(3518)]).then(i.bind(i,33518)))}return null}};(0,o._)([(0,u.Cb)({constructOnly:!0})],z.prototype,"spatialReference",void 0),(0,o._)([(0,u.Cb)({constructOnly:!0})],z.prototype,"view",void 0),(0,o._)([(0,u.Cb)()],z.prototype,"options",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],z.prototype,"updating",null),(0,o._)([(0,u.Cb)({readOnly:!0})],z.prototype,"snappingSources",null),z=(0,o._)([(0,g.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],z);class Y{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new p.Z;const i=this.snappingSource.layerSource.layer;if("refresh"in i){const t=i;this.handles.add(t.on("refresh",(()=>e.refresh())))}this.handles.add([(0,d.YP)((()=>e.updating),(t=>e.layerSource.updating=t),d.tX),(0,d.YP)((()=>e.availability),(t=>e.layerSource.availability=t),d.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const q=(0,H.c)();var X=i(85015),B=i(6394),K=i(76014);class ${constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=K.c.shortLineThreshold*K.c.shortLineThreshold}snap(e,t){return(0,h.pC)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}exceedsShortLineThreshold(e,t,i){let{elevationInfo:o,editGeometryOperations:r}=i;const s=r.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,U.tp)((0,W.a7)(t,s,o,this.view),(0,W.a7)(e,s,o,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class J extends j.j{constructor(e){let{coordinateHelper:t,lineStart:i,lineEnd:o,targetPoint:r,elevationInfo:s}=e;super(t,r,new V.ku(t,i,o),s),this.referenceLineHint=new Z.w(U.ze.REFERENCE_EXTENSION,i,o,s)}get hints(){return[this.referenceLineHint,new Z.w(U.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo)]}_lineEndClosestToTarget(){const e=this.constraint.start,t=this.constraint.end;return Math.sign((0,M.h)((0,M.g)(ee,t,e),(0,M.g)(Q,this.targetPoint,e)))>0?t:e}}const Q=(0,B.a)(),ee=(0,B.a)();var te=i(94163);class ie extends ${snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=i.edges.length,r=[];if(o<1)return r;const s=t.coordinateHelper,n=(0,W.a7)(e,s,t.elevationInfo,this.view),a=i.edges[o-1];let p=a;do{this.edgeExceedsShortLineThreshold(p,t)&&this._processCandidateProposal(p.leftVertex.pos,p.rightVertex.pos,e,n,t,r),p=p.leftVertex.leftEdge}while(p&&p!==a);return r}snapExistingVertex(e,t){const i=[],o=(0,h.Wg)(t.vertexHandle),r=o.component;if(r.edges.length<2)return i;const s=t.coordinateHelper,n=(0,W.a7)(e,s,t.elevationInfo,this.view),a=o.leftEdge,p=o.rightEdge;a&&p&&this.edgeExceedsShortLineThreshold(a,t)&&this.edgeExceedsShortLineThreshold(p,t)&&this._processCandidateProposal(a.leftVertex.pos,p.rightVertex.pos,e,n,t,i);const l=r.edges[0];let c=l;do{c!==o.leftEdge&&c!==o.rightEdge&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(c.leftVertex.pos,c.rightVertex.pos,e,n,t,i),c=c.rightVertex.rightEdge}while(c&&c!==l);return i}_processCandidateProposal(e,t,i,o,r,s){const n=(0,te.k0)((0,B.a)(),i,e,t),{coordinateHelper:a,elevationInfo:p,pointer:l}=r,h=a.fromXYZ(n,a.getZ(i,0));(0,U.tp)(o,(0,W.a7)(h,a,p,this.view))<this.squaredProximityTreshold(l)&&s.push(new J({coordinateHelper:a,lineStart:e,lineEnd:t,targetPoint:h,elevationInfo:p}))}}var oe=i(5916);class re extends j.j{constructor(e){let{coordinateHelper:t,referenceLine:i,lineStart:o,targetPoint:r,elevationInfo:s}=e;const n=t.clone(o);(0,M.g)(n,(0,M.b)(n,n,i.rightVertex.pos),i.leftVertex.pos),super(t,r,new V.ku(t,o,n),s),this._referenceLines=[{edge:i,fadeLeft:!0,fadeRight:!0}]}get hints(){const e=this.elevationInfo;return[new Z.w(U.ze.TARGET,this.constraint.start,this.targetPoint,e),new oe.L(this.constraint.start,this.targetPoint,e),...this._referenceLines.map((t=>new Z.w(U.ze.REFERENCE,t.edge.leftVertex.pos,t.edge.rightVertex.pos,e,t.fadeLeft,t.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{e.rightVertex.rightEdge===i.edge&&(i.fadeLeft=!1,t.fadeRight=!1),e.leftVertex.leftEdge===i.edge&&(i.fadeRight=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class se extends ${constructor(){super(...arguments),this._tmpProjection=(0,B.a)()}snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=i.edges.length,r=i.vertices.length,s=[];if(o<2)return s;const n=(0,W.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),a=i.vertices[r-1],p=i.vertices[0],l=i.edges[o-1];let h=l;do{this.edgeExceedsShortLineThreshold(h,t)&&(this._checkEdgeForParalleLines(h,a.pos,e,n,t,s),this._checkEdgeForParalleLines(h,p.pos,e,n,t,s)),h=h.leftVertex.leftEdge}while(h&&h!==l);return s}snapExistingVertex(e,t){const i=[],o=(0,h.Wg)(t.vertexHandle),r=o.component;if(r.edges.length<3)return i;const s=(0,W.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),n=o.leftEdge,a=o.rightEdge,p=r.vertices[0],l=r.vertices.length,c=r.vertices[l-1],d=r.edges[0];let u=d;do{u!==n&&u!==a&&this.edgeExceedsShortLineThreshold(u,t)&&(n&&this._checkEdgeForParalleLines(u,n.leftVertex.pos,e,s,t,i),a&&this._checkEdgeForParalleLines(u,a.rightVertex.pos,e,s,t,i),o===p?this._checkEdgeForParalleLines(u,c.pos,e,s,t,i):o===c&&this._checkEdgeForParalleLines(u,p.pos,e,s,t,i)),u=u.rightVertex.rightEdge}while(u&&u!==d);return i}_checkEdgeForParalleLines(e,t,i,o,r,s){const n=e.leftVertex.pos,a=e.rightVertex.pos;if((0,te.k0)(this._tmpProjection,t,n,a),(0,M.s)(this._tmpProjection,t)<K.c.parallelLineThreshold)return;(0,te.k0)(this._tmpProjection,i,n,a,t);const{coordinateHelper:p,elevationInfo:l,pointer:h}=r,c=p.fromXYZ(this._tmpProjection,p.getZ(i,0));if((0,U.tp)(o,(0,W.a7)(c,p,l,this.view))<this.squaredProximityTreshold(h)){if(this._parallelToPreviousCandidate(e,s))return;s.push(new re({coordinateHelper:p,referenceLine:e,lineStart:t,targetPoint:c,elevationInfo:l}))}}_parallelToPreviousCandidate(e,t){const i=e.leftVertex.pos,o=e.rightVertex.pos;for(const r of t)if((0,te.k0)(this._tmpProjection,o,r.constraint.start,r.constraint.end,i),(0,M.s)(this._tmpProjection,o)<K.c.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}}class ne extends ${constructor(){super(...arguments),this._tmp=(0,B.a)()}snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=i.vertices.length,r=[];if(o<2)return r;const s=(0,W.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),n=i.vertices[o-1];this._checkForSnappingCandidate(r,n.leftEdge,n.pos,e,n.leftEdge.leftVertex.pos,n.pos,t,e,s);const a=i.vertices[0];return this._checkForSnappingCandidate(r,a.rightEdge,a.pos,e,a.rightEdge.rightVertex.pos,a.pos,t,e,s),r}snapExistingVertex(e,t){const i=[],o=(0,h.Wg)(t.vertexHandle),r=o.component,s=r.vertices.length;if(s<3)return i;const n=(0,W.a7)(e,t.coordinateHelper,t.elevationInfo,this.view),a=o.leftEdge,p=o.rightEdge,l=r.vertices[0],c=r.vertices[s-1];if(!a)return this._checkForSnappingCandidate(i,l.rightEdge.rightVertex.rightEdge,l.rightEdge.rightVertex.pos,e,l.rightEdge.rightVertex.rightEdge.rightVertex.pos,l.rightEdge.rightVertex.pos,t,e,n),i;if(!p)return this._checkForSnappingCandidate(i,c.leftEdge.leftVertex.leftEdge,c.leftEdge.leftVertex.pos,e,c.leftEdge.leftVertex.leftEdge.leftVertex.pos,c.leftEdge.leftVertex.pos,t,e,n),i;if(a&&a.leftVertex.leftEdge){const o=a.leftVertex.leftEdge;this._checkForSnappingCandidate(i,o,a.leftVertex.pos,e,o.leftVertex.pos,a.leftVertex.pos,t,e,n)}if(p&&p.rightVertex.rightEdge){const o=p.rightVertex.rightEdge;this._checkForSnappingCandidate(i,o,p.rightVertex.pos,e,o.rightVertex.pos,p.rightVertex.pos,t,e,n)}return i}_checkForSnappingCandidate(e,t,i,o,r,s,n,a,p){if(!this.edgeExceedsShortLineThreshold(t,n))return;(0,M.g)(this._tmp,t.rightVertex.pos,t.leftVertex.pos);const l=(0,B.f)(this._tmp[1],-this._tmp[0]),h=(0,M.h)(l,(0,M.g)(this._tmp,o,i))/(0,M.u)(l),{coordinateHelper:c,elevationInfo:d,pointer:u}=n,g=c.fromXYZ((0,M.v)((0,B.a)(),s,l,h),c.getZ(a,0));(0,U.tp)(p,(0,W.a7)(g,c,d,this.view))<this.squaredProximityTreshold(u)&&e.push(new N({coordinateHelper:c,targetPoint:g,constraint:new V.yG(c,s,(0,M.v)(c.createVector(),s,l,Math.sign(h))),previousVertex:r,otherVertex:s,otherVertexType:C.CENTER,elevationInfo:d}))}}class ae extends j.j{constructor(e){let{coordinateHelper:t,targetPoint:i,point1:o,point2:r,elevationInfo:s}=e;super(t,i,new V.UL(t,(0,M.l)(pe,o,r,.5),.5*(0,M.j)(o,r)),s),this.p1=o,this.p2=r}get hints(){const e=this.elevationInfo;return[new Z.w(U.ze.REFERENCE,this.targetPoint,this.p1,e),new Z.w(U.ze.REFERENCE,this.targetPoint,this.p2,e),new F.y(this.p1,this.targetPoint,this.p2,e)]}}const pe=(0,B.a)();class le extends ${snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=[],r=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return o;const s=i.vertices[0],n=i.vertices[r-1];return this._processCandidateProposal(s.pos,n.pos,e,t,o),o}snapExistingVertex(e,t){const i=[],o=(0,h.Wg)(t.vertexHandle),r=o.component;return r.edges.length<2?i:"polyline"!==t.editGeometryOperations.data.type||0!==o.index&&o.index!==r.vertices.length-1?(this._processCandidateProposal(o.leftEdge.leftVertex.pos,o.rightEdge.rightVertex.pos,e,t,i),i):i}_processCandidateProposal(e,t,i,o,r){if(!this.exceedsShortLineThreshold(e,t,o))return;const s=(0,M.l)((0,B.a)(),e,t,.5),n=.5*(0,M.j)(e,t),a=(0,te.xO)((0,B.a)(),i,s,n),{coordinateHelper:p,elevationInfo:l,pointer:h}=o,c=p.fromXYZ(a,p.getZ(i,0)),d=(0,W.a7)(i,p,l,this.view);(0,U.tp)(d,(0,W.a7)(c,p,l,this.view))<this.squaredProximityTreshold(h)&&r.push(new ae({coordinateHelper:p,targetPoint:c,point1:e,point2:t,elevationInfo:l}))}}let he=class extends X.Z{constructor(e){super(e),this.updating=!1,this._snappers=new s.Z}initialize(){this._snappers.push(new se(this.view,this.options),new ie(this.view,this.options),new ne(this.view,this.options),new le(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t){if(!this.options.effectiveSelfEnabled)return[];const i=[];for(const o of this._snappers.items)i.push(...o.snap(e,t));return(0,U.lQ)(e,i),i}};function ce(e,t){return[new he({view:e,options:t}),new z({view:e,options:t,spatialReference:e.spatialReference})]}(0,o._)([(0,u.Cb)({readOnly:!0})],he.prototype,"updating",void 0),(0,o._)([(0,u.Cb)({constructOnly:!0})],he.prototype,"view",void 0),(0,o._)([(0,u.Cb)()],he.prototype,"options",null),he=(0,o._)([(0,g.j)("esri.views.interactive.snapping.SelfSnappingEngine")],he);let de=class extends X.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,o._)([(0,u.Cb)({constructOnly:!0})],de.prototype,"layer",void 0),(0,o._)([(0,u.Cb)()],de.prototype,"enabled",void 0),(0,o._)([(0,u.Cb)()],de.prototype,"updating",void 0),(0,o._)([(0,u.Cb)()],de.prototype,"availability",void 0),de=(0,o._)([(0,g.j)("esri.views.interactive.snapping.SnappingLayerSource")],de);const ue=de;let ge=class extends X.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new s.Z,this.distance=K.c.distance,this.touchSensitivityMultiplier=K.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,o._)([(0,u.Cb)()],ge.prototype,"enabled",void 0),(0,o._)([(0,u.Cb)()],ge.prototype,"enabledToggled",void 0),(0,o._)([(0,u.Cb)()],ge.prototype,"selfEnabled",void 0),(0,o._)([(0,u.Cb)()],ge.prototype,"featureEnabled",void 0),(0,o._)([(0,u.Cb)({type:s.Z.ofType(ue)})],ge.prototype,"featureSources",void 0),(0,o._)([(0,u.Cb)()],ge.prototype,"distance",void 0),(0,o._)([(0,u.Cb)()],ge.prototype,"touchSensitivityMultiplier",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],ge.prototype,"effectiveEnabled",null),(0,o._)([(0,u.Cb)({readOnly:!0})],ge.prototype,"effectiveSelfEnabled",null),(0,o._)([(0,u.Cb)({readOnly:!0})],ge.prototype,"effectiveFeatureEnabled",null),ge=(0,o._)([(0,g.j)("esri.views.interactive.snapping.SnappingOptions")],ge);const ye=ge;var ve=i(90609);class me extends j.j{constructor(e,t,i,o,r){super(e,t,new V.Bq(e,t,i.constraint,o.constraint),r),this.first=i,this.second=o}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ve.w(this.targetPoint,this.elevationInfo)]}}let fe=class extends(a.Z.EventedMixin(I.r)){constructor(e){super(e),this.options=new ye,this.snappingEnginesFactory=ce,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}initialize(){this.handles.add([(0,d.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:o}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:o}}),(()=>{this.doneSnapping(),this.emit("changed")}),d.Z_),(0,d.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),d.Z_),(0,d.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:i}=e;return this._recreateEngines(t,i)}),d.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:o}=this;this._engines=t(i,o)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e,t,i){const o=t.coordinateHelper.pointToVector(e),r=await this._fetchCandidates(o,t,i);return{get valid(){return!(0,c.Hc)(i)},apply:()=>{const{snappedPoint:e,hints:i}=this._processCandidates(o,r,t);return this._removeVisualization(),(0,h.pC)(t.visualizer)&&this.handles.add(t.visualizer.draw(i,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),_e),e}}}update(e,t){this._removeVisualization();let i=e;const o=[];if((0,h.pC)(this._currentMainCandidate)){const r=t.coordinateHelper,s=r.pointToVector(e),n=this._currentMainCandidate.constraint.closestTo(s);if((0,U.tp)((0,W.a7)(s,r,t.elevationInfo,this.view),(0,W.a7)(n,r,t.elevationInfo,this.view))<this._squaredPointProximityThreshold(t.pointer)){i=r.vectorToDehydratedPoint(n),this._currentMainCandidate.targetPoint=n,o.push(...this._currentMainCandidate.hints);for(const e of this._currentOtherActiveCandidates)e.targetPoint=n,o.push(...e.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return(0,h.pC)(t.visualizer)&&this.handles.add(t.visualizer.draw(o,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),_e),i}doneSnapping(){this._removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}_removeVisualization(){this.handles.remove(_e)}async _fetchCandidates(e,t,i){return(await Promise.all(this._engines.map((o=>o.fetchCandidates(e,t,i))))).flat()}_processCandidates(e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(e),hints:[]};(0,U.lQ)(e,t);const o=this._currentMainCandidate;if((0,h.pC)(o)){const r=this._findOldConstraintInNewCandidates(o,t);if(r>=0){if(!(t[r]instanceof me))return this._intersectWithOtherCandidates(r,t,e,i);if((0,M.s)(e,o.targetPoint)<this._squaredPointProximityThreshold(i.pointer))return this._updateSnappingCandidate(o,t,i)}}return this._intersectWithOtherCandidates(0,t,e,i)}_findOldConstraintInNewCandidates(e,t){return e instanceof me?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,o){const r=t[e],s=[],n=o.coordinateHelper;for(let a=0;a<t.length;++a){if(a===e)continue;const p=t[a];for(const e of r.constraint.intersect(p.constraint)){const t=n.fromXYZ(e.intersection,r.targetPoint[2]);s.push([new me(n,t,r,p,p.elevationInfo),(0,U.tp)((0,W.a7)(i,o.coordinateHelper,o.elevationInfo,this.view),(0,W.a7)(t,o.coordinateHelper,o.elevationInfo,this.view))])}}return s.length>0&&(s.sort(((e,t)=>e[1]-t[1])),s[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(s[0][0],t,o):this._updateSnappingCandidate(r,t,o)}_updateSnappingCandidate(e,t,i){this.doneSnapping(),this._currentMainCandidate=e;const o=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const s of t){if(e instanceof me){if(s.constraint.objectEqual(e.first.constraint)||s.constraint.objectEqual(e.second.constraint))continue}else if(s.constraint.objectEqual(e.constraint))continue;s.constraint.check(o)&&(s.targetPoint=o,this._currentOtherActiveCandidates.push(s),r.push(...s.hints))}return{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(o),hints:r}}_squaredPointProximityThreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}_findOldCandidateIndex(e,t){let i=-1;for(let o=0;o<e.length;++o)if(t.constraint.objectEqual(e[o].constraint)){i=o;break}return i}get test(){return{visualizationsActive:this.handles.has(_e),engines:this._engines}}};(0,o._)([(0,u.Cb)({constructOnly:!0})],fe.prototype,"view",void 0),(0,o._)([(0,u.Cb)()],fe.prototype,"options",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],fe.prototype,"updating",null),(0,o._)([(0,u.Cb)()],fe.prototype,"snappingEnginesFactory",void 0),(0,o._)([(0,u.Cb)()],fe.prototype,"_engines",void 0),(0,o._)([(0,u.Cb)()],fe.prototype,"squaredMouseProximityTreshold",null),(0,o._)([(0,u.Cb)()],fe.prototype,"squaredTouchProximityThreshold",null),fe=(0,o._)([(0,g.j)("esri.views.interactive.snapping.SnappingManager")],fe);const _e="visualization-handle";function Ee(e){return(0,h.pC)(e)&&"graphic"===e.type}var be=i(72612),we=i(41644);let Te=class extends a.Z.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,we.Bg)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",(()=>{this.canUndo()&&e()}))}set redo(e){this._set("redo",(()=>{this.canRedo()&&e()}))}};(0,o._)([(0,u.Cb)()],Te.prototype,"activeComponent",void 0),(0,o._)([(0,u.Cb)()],Te.prototype,"cancelled",void 0),(0,o._)([(0,u.Cb)()],Te.prototype,"history",void 0),(0,o._)([(0,u.Cb)()],Te.prototype,"tool",null),(0,o._)([(0,u.Cb)()],Te.prototype,"type",void 0),(0,o._)([(0,u.Cb)()],Te.prototype,"canUndo",null),(0,o._)([(0,u.Cb)()],Te.prototype,"canRedo",null),(0,o._)([(0,u.Cb)()],Te.prototype,"onEnd",void 0),(0,o._)([(0,u.Cb)()],Te.prototype,"undo",null),(0,o._)([(0,u.Cb)()],Te.prototype,"redo",null),(0,o._)([(0,u.Cb)()],Te.prototype,"toggleTool",void 0),(0,o._)([(0,u.Cb)()],Te.prototype,"addToSelection",void 0),(0,o._)([(0,u.Cb)()],Te.prototype,"removeFromSelection",void 0),Te=(0,o._)([(0,g.j)("esri.widgets.Sketch.support.OperationHandle")],Te);let Se=class extends Te{};(0,o._)([(0,u.Cb)()],Se.prototype,"activeComponent",void 0),Se=(0,o._)([(0,g.j)("esri.widgets.Sketch.support.CreateOperationHandle")],Se);let Ce=class extends Te{constructor(e){super(e)}};(0,o._)([(0,u.Cb)()],Ce.prototype,"activeComponent",void 0),Ce=(0,o._)([(0,g.j)("esri.widgets.Sketch.support.UpdateOperationHandle")],Ce);var xe=i(16072),Oe=i(61459),Pe=i(16851);const Ge="esri.widgets.Sketch.SketchViewModel",Re=l.Z.getLogger(Ge),Ie={defaultZ:0},Me={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let Ae=class extends a.Z.EventedAccessor{constructor(e){super(e),this._numUpdating=0,this._handles=new p.Z,this._internalGraphicsLayer=new _.Z({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new p.Z,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.labelOptions=new G.Z,this.layer=null,this.pointSymbol=new xe.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Oe.Z({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Pe.Z({color:[130,130,130,1],width:2}),this._snappingManager=null,this.tooltipOptions=new R.Z,this.updateGraphics=new s.Z,this.updateOnGraphicClick=!0,this.updatePointSymbol=new xe.Z({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new Oe.Z({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new Pe.Z({color:[12,207,255],width:2}),this.vertexSymbol=new xe.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=Ie,this.defaultUpdateOptions=Me,this.snappingOptions=new ye}initialize(){this._handles.add([(0,d.on)((()=>this.view?.map?.layers),"change",(e=>{e.removed.includes(this.layer)&&this.cancel()})),(0,d.on)((()=>this.layer?.graphics),"change",(e=>{if((0,h.pC)(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),(0,d.YP)((()=>this.layer?.elevationInfo??null),(e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)}),d.tX),(0,d.YP)((()=>this.view),(e=>{(0,h.SC)(this._snappingManager),e&&(this._snappingManager=new fe({view:e,options:this.snappingOptions}),"2d"===e.type?Promise.all([i.e(9058),i.e(5652),i.e(5710),i.e(1129),i.e(8431),i.e(1283)]).then(i.bind(i,51283)):"3d"===e.type&&(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(5710),i.e(2618),i.e(1129),i.e(5269),i.e(4567),i.e(8431),i.e(2110),i.e(1883),i.e(1859),i.e(3567)]).then(i.bind(i,73567)),Promise.all([i.e(1378),i.e(2029),i.e(5652),i.e(5158),i.e(2618),i.e(5269),i.e(4567),i.e(1883),i.e(493),i.e(1859),i.e(6099),i.e(6929),i.e(5022)]).then(i.bind(i,35022))))}),d.tX),(0,d.YP)((()=>this.view?.spatialReference),((e,t)=>{e&&t&&!e.equals(t)&&this.cancel()}))])}destroy(){this.cancel(),this._handles=(0,h.SC)(this._handles),this._viewHandles=(0,h.SC)(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=(0,h.SC)(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return"3d"===this.view.type?"move":"transform"}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return!(0,h.pC)(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):(0,h.Wg)(this.activeComponent.graphic)}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Ie,...e})}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Me,...e,reshapeOptions:{...Me.reshapeOptions,...e?.reshapeOptions}})}set snappingOptions(e){(0,h.pC)(this._snappingManager)&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),i&&i.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const i="view-ready";this._handles.remove(i),e&&this._handles.add((0,d.gx)((()=>e.ready),(t=>{this._viewHandles.removeAll(),t&&this._viewHandles.add(this._generateViewHandles(e))}),d.tX),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,h.IM)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,h.IM)(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:e})}}async create(e,t){if(this.cancel(),await this._waitViewReady(),"disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),(0,c.zE)();if((0,h.pC)(this.view.activeTool)&&(this.view.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,x.p)(this.view,this._internalGraphicsLayer);const i=await this._setupCreateOperation(e,t);if((0,h.Wi)(i)||this.destroyed)return void this.view.map.remove(this._internalGraphicsLayer);i.on("complete",(()=>{if(i===this._operationHandle){const t=this.createGraphic,o=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||null==t||this.layer.add(t),this.emit("create",{graphic:t,state:o?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}})),this._operationHandle=i,this.view.ready&&(0,E.t)(this.view)&&this.view.focus()}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:o,state:r}=this;if("disabled"===r)throw o||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),i||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),(0,c.zE)();(0,h.pC)(this.view.activeTool)&&(this.view.activeTool=null);const s=Array.isArray(e)?e:[e];if(null==e||!s||!s.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some((e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):!!(0,h.Wi)(e.geometry)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0))))return;const n=await this._setupUpdateOperation(s,t);this.destroyed||(0,h.Wi)(n)||Le(n)||((0,x.p)(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(n,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:n.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){this._beginAsyncOperation(),e=Array.isArray(e)?e:[e];for(const t of e)(0,h.pC)(t.geometry)&&"mesh"!==t.geometry.type&&!(0,f.fS)(t.geometry.spatialReference,this.view.spatialReference)&&((0,y.Up)(t.geometry.spatialReference,this.view.spatialReference)||(0,y.kR)()||await(0,y.zD)(),t.geometry=(0,y.iV)(t.geometry,this.view.spatialReference));this._endAsyncOperation()}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=this.view;if("2d"===t.type){const t=[];this.view.map.allLayers.forEach((e=>{"vector-tile"!==e.type&&"imagery"!==e.type||t.push(e)}));return function(e){return e.find(Ee)??null}((await this.view.hitTest(e,{exclude:t})).results)}const i=[this.view.map.ground];t.map.allLayers.forEach((e=>{"integrated-mesh"===e.type&&i.push(e)}));const o=await t.hitTest(e,{exclude:i});if(o.results.length>0){const e=o.results[0];if((0,h.pC)(e)&&"graphic"===e.type&&e.graphic&&(!o.ground.mapPoint||t.map.ground.opacity<1||o.ground.distance-(0,h.Pt)(e.distance,0)>-Math.min(3*o.ground.distance,"global"===t.viewingMode?(0,v.Iu)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",(async t=>{const i="active"===this.state&&"create"===this._operationHandle.type;if("disabled"===this.state||i||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const o=await t.async((()=>this._getFirstHit((0,be.vT)(t))));let r=null;if((0,h.pC)(o)){const i=o.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(t.stopPropagation(),r=i):"2d"!==e.type||this._isComponentGraphic(i)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();(0,h.pC)(r)&&!this.updateGraphics.includes(r)&&await this.update([r],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()}),O.f.WIDGET)]}async _setupCreateOperation(e,t){const i={hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,this.view,i);return(0,h.Wi)(o)?null:(this.view.tools.add(o),this.view.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,i){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;const o="rectangle"!==e,r="rectangle"!==e;this.snappingOptions.enabledToggled=!1;const s={view:t,mode:"rectangle"===e||"circle"===e?"hybrid":"click",...i,snapToScene:!1,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),snappingManager:this._snappingManager,forceUniformSize:r,centered:o};return"2d"===this.view.type?this._makeDrawGraphicTool2D(s):this._makeDrawGraphicTool3D(s)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(Promise.all([i.e(9058),i.e(5652),i.e(5710),i.e(1129),i.e(8431),i.e(1283)]).then(i.bind(i,51283)));return Le(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:He(e.geometryType)?this.activeFillSymbol:null})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(5710),i.e(2618),i.e(1129),i.e(5269),i.e(4567),i.e(8431),i.e(2110),i.e(1883),i.e(1859),i.e(3567)]).then(i.bind(i,73567)));if(Le(t)||this.destroyed)return null;const{elevationInfo:o}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:o,snapToScene:!(0,h.pC)(o)||"absolute-height"===o.mode,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions})}_setupCreateOperationHandle(e){let t=null;const i=e.forceUniformSize,o=e.centered,r=[this.view.on("key-down",(t=>{if(t.key===P.j.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===P.j.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==P.j.vertexAdd||t.repeat)t.key===P.j.undo?(t.stopPropagation(),s.undo()):t.key===P.j.redo?(t.stopPropagation(),s.redo()):t.key!==P.j.snappingToggle||"rectangle"===e.geometryType||"circle"===e.geometryType||t.repeat?t.key!==P.j.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===P.j.center&&(t.repeat||(e.centered=!o,t.stopPropagation())):(e.forceUniformSize=!i,t.stopPropagation()):(this.snappingOptions.enabledToggled=!0,t.stopPropagation());else{const i=e.drawOperation.geometryType;"polyline"!==i&&"polygon"!==i&&"multipoint"!==i||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}}),O.f.WIDGET),this.view.on("key-up",(t=>{t.key===P.j.pan?e.enabled=!0:t.key===P.j.snappingToggle&&"rectangle"!==e.geometryType&&"circle"!==e.geometryType?(this.snappingOptions.enabledToggled=!1,t.stopPropagation()):t.key!==P.j.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===P.j.center&&(e.centered=o,t.stopPropagation()):(e.forceUniformSize=i,t.stopPropagation())}),O.f.WIDGET),e.on("vertex-add",(i=>{switch(t=(0,h.Wi)(t)?"start":"active",i.operation){case"apply":this.emit("create",{graphic:(0,h.Wg)(e.graphic),state:t,tool:this.activeTool,toolEventInfo:i,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,h.Wg)(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[(0,h.Wg)(e.graphic)],tool:e.geometryType})}})),e.on("cursor-update",(t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:(0,h.Wg)(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),e.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:(0,h.Wg)(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,h.Wg)(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[(0,h.Wg)(e.graphic)],tool:e.geometryType})}})),e.on("complete",(e=>{this._set("createGraphic",(0,h.Wg)(e.graphic)),t="complete",e.aborted?s&&s.cancel():s&&s.complete()})),(0,d.YP)((()=>this._getGraphicSymbolFromTool(e.geometryType)),(t=>{e.graphicSymbol=t}))],s=new Te({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{r.forEach((e=>e.remove())),r.length=0,this.view.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return s}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;default:return null}}async _setupUpdateOperation(e,t){const{layer:i,view:o}=this,r={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions}};let s=r.tool;for(const n of e)i.remove(n),i.add(n);if("3d"===o.type){if(0===e.length)return null;switch(s){case"move":return this._setupMove3DOperation(e,r,o,s);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,T.P)(e[0]);return t===b.e.SUPPORTED?this._setupReshape3DOperation(e[0],r,o):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,b.Z)(t)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,r,o)}}switch(s){case"move":return this._setupMove2DOperation(e,r,o);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,T.P)(e[0]);return t===b.e.SUPPORTED?this._setupTransformOrReshape2DOperation(e,s,r,o):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,b.Z)(t)}).`),null)}case"transform":if(1===e.length){const t=(0,h.U2)(e[0].geometry,"type");"point"!==t&&"multipoint"!==t||(s="reshape")}return this._setupTransformOrReshape2DOperation(e,s,r,o)}}async _setupMove3DOperation(e,t,o,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];for(const i of e){const e=(0,w.P)(i);if(e!==b.e.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,b.Z)(e)}).`),null}const n=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(5710),i.e(2618),i.e(1129),i.e(5269),i.e(4567),i.e(8431),i.e(2110),i.e(1883),i.e(1859),i.e(3567)]).then(i.bind(i,73567)));if(Le(n))return n;const a=new n.module.GraphicMoveTool({view:o,enableZ:t.enableZ,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(a),a.graphics.addMany(e),s||this.updateGraphics.addMany(e);const p=[],l=new Ce({activeComponent:a,tool:r,type:"update",onEnd:()=>{p.forEach((e=>e.remove())),p.length=0,this.view.tools?.remove(a),a.destroyed||a.destroy()},undo:()=>{ke(l,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{Ve(l,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:e=>{this.updateGraphics.push(e),a.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);l.history.undo.forEach((e=>e.updates.splice(t,1))),l.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics.remove(e):l.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==r)return;const e=this.updateGraphics.getItemAt(0);if((0,T.P)(e)!==b.e.SUPPORTED)return;const i=await this._setupReshape3DOperation(e,t,o,!0);Le(i)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(i,t))}});return p.push(...this._getHandlesForComponent(l,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(l,e,t)),O.f.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(l,e),e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),O.f.WIDGET),o.on("key-up",(e=>{e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),O.f.WIDGET)),l}_setupGraphicTransform3DOperation(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(1===e.length&&function(e){if("graphics"!==e.layer?.type)return b.e.GRAPHICS_LAYER_MISSING;if((0,h.Wi)(e.geometry))return b.e.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return b.e.SUPPORTED;default:return b.e.GEOMETRY_TYPE_UNSUPPORTED}const t=(0,h.pC)(e.symbol)&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.length>0&&t.some((e=>"object"===e.type))?"on-the-ground"!==(0,S.vu)(e)&&(0,S.Lt)(e)?b.e.ELEVATION_MODE_UNSUPPORTED:b.e.SUPPORTED:b.e.SYMBOL_TYPE_UNSUPPORTED}(e[0])===b.e.SUPPORTED){const r=e[0],s=r.geometry;if((0,h.pC)(s)&&("point"===s.type||"mesh"===s.type))return this._setupPointTransform3DOperation(r,t,i);if((0,h.pC)(s)&&("polygon"===s.type||"polyline"===s.type))return this._setupPolyTransform3DOperation(r,t,i,o)}return this._setupMove3DOperation(e,t,i,"transform",o)}async _setupPointTransform3DOperation(e,t,o){const r="transform",{enableRotation:s,enableScaling:n,enableZ:a}=t,p=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(5710),i.e(2618),i.e(1129),i.e(5269),i.e(4567),i.e(8431),i.e(2110),i.e(1883),i.e(1859),i.e(3567)]).then(i.bind(i,73567)));if(Le(p))return p;const l=new p.module.GraphicTransformTool({graphic:e,view:o,enableRotation:s,enableScaling:n,enableZ:a,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(l),this.updateGraphics.add(e);const h=[],c=new Ce({activeComponent:l,tool:r,type:"update",onEnd:()=>{h.forEach((e=>e.remove())),h.length=0,this.view.tools?.remove(l),l.destroyed||l.destroy()},undo:()=>{ke(c,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{Ve(c,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);Le(i)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),c.complete()},toggleTool:()=>{}});return h.push(...this._getHandlesForComponent(c,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(c,e,t)),O.f.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(c,e),e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),O.f.WIDGET),o.on("key-up",(e=>{e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),O.f.WIDGET)),c}async _setupPolyTransform3DOperation(e,t,o){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s="transform",{enableRotation:n,enableScaling:a,enableZ:p,preserveAspectRatio:l}=t,h=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(5710),i.e(2618),i.e(1129),i.e(5269),i.e(4567),i.e(8431),i.e(2110),i.e(1883),i.e(1859),i.e(3567)]).then(i.bind(i,73567)));if(Le(h))return h;const c=new h.module.ExtentTransformTool({graphic:e,view:o,enableRotation:n,enableScaling:a,enableZ:p,preserveAspectRatio:l,tooltipOptions:this.tooltipOptions});this.view.tools.add(c),r||this.updateGraphics.add(e);const d=[],u=new Ce({activeComponent:c,tool:s,type:"update",onEnd:()=>{d.forEach((e=>e.remove())),d.length=0,this.view.tools?.remove(c),c.destroyed||c.destroy()},canUndo:()=>c.canUndo,undo:()=>{c.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>c.canRedo,redo:()=>{c.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);Le(i)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),u.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.getItemAt(0);if((0,T.P)(e)!==b.e.SUPPORTED)return;const i=await this._setupReshape3DOperation(e,t,o,!0);Le(i)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(i,t))}});return d.push(...this._getHandlesForComponent(u,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(u,e,t)),O.f.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(u,e)),O.f.WIDGET),this.view.on("key-down",(e=>{e.key!==P.j.constraint||e.repeat||(c.preserveAspectRatio=!c.preserveAspectRatio,e.stopPropagation())}),O.f.WIDGET),this.view.on("key-up",(e=>{e.key===P.j.constraint&&(c.preserveAspectRatio=!c.preserveAspectRatio,e.stopPropagation())}),O.f.WIDGET)),u}async _setupMove2DOperation(e,t,i){const o="move";this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const r=await this._getGraphicMover(e,t,i);if(Le(r))return r;const s=new Ce({activeComponent:r,tool:o,type:"update",onEnd:()=>{this._displayDefaultCursor(),p.forEach((e=>e.remove())),a.forEach((e=>e.remove())),p=[],a=[],r.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();ke(s,e),s.refreshComponent(),this._emitUndoEvent({graphics:e,tool:o})},redo:()=>{const e=this.updateGraphics.toArray();Ve(s,e),s.refreshComponent(),this._emitRedoEvent({graphics:e,tool:o})},addToSelection:async e=>{await this._updateSpatialReference(e),this.updateGraphics.push(e),r.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);s.history.undo.forEach((e=>e.updates.splice(t,1))),s.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?r.graphics=i:s.complete()}});let n=!1,a=[i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(s,e,t)),O.f.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key!==P.j.constraint||e.repeat||(n=!0,r.enableMoveAllGraphics=!r.enableMoveAllGraphics)}),O.f.WIDGET),i.on("key-up",(e=>{e.key===P.j.constraint&&n&&(n=!1,r.enableMoveAllGraphics=!r.enableMoveAllGraphics)}),O.f.WIDGET)],p=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,o){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s="reshape",n=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(5710),i.e(2618),i.e(1129),i.e(5269),i.e(4567),i.e(8431),i.e(2110),i.e(1883),i.e(1859),i.e(3567)]).then(i.bind(i,73567)));if(Le(n))return n;this.snappingOptions.enabledToggled=!1;const a=new n.module.GraphicReshapeTool({view:o,graphic:e,enableZVertex:t.enableZ&&"move"===t.reshapeOptions.vertexOperation,enableZShape:t.enableZ&&"move"===t.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===t.reshapeOptions.shapeOperation||"move-xy"===t.reshapeOptions.shapeOperation,enableMidpoints:"split"===t.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===t.reshapeOptions.edgeOperation,snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});o.tools.add(a),r||this.updateGraphics.add(e);const p=[],l=new Ce({activeComponent:a,tool:s,type:"update",onEnd:()=>{p.forEach((e=>e.remove())),p.length=0,this.view.tools?.remove(a),a.destroyed||a.destroy()},canUndo:()=>a.canUndo,undo:()=>{a.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>a.canRedo,redo:()=>{a.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);Le(i)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),l.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,o,!0);Le(e)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(e,t))}});return p.push(...this._getHandlesForComponent(l,t),o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(l,e,t)),O.f.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(l,e),e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),O.f.WIDGET),o.on("key-up",(e=>{e.key===P.j.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),O.f.WIDGET)),l}async _setupTransformOrReshape2DOperation(e,t,i,o){this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const r="transform"===t?await this._getBox(e,i,o):await this._getReshape(e,i,o);if(Le(r))return r;const s=new Ce({activeComponent:r,type:"update",onEnd:()=>{a.forEach((e=>e.remove())),n.forEach((e=>e.remove())),a=[],n=[],s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{ke(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{Ve(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async e=>{let t=s.activeComponent;if("reshape"===t.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll();const r=await this._setupMove2DOperation(t,i,o);if(Le(r))return;s.onEnd(),s.destroy(),this._setUpdateOperationHandle(r,i)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);s.history.undo.forEach((e=>e.updates.splice(t,1))),s.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();if(0===i.length)s.complete();else{const e=i[0].geometry;1!==i.length||!(0,h.pC)(e)||"point"!==e.type&&"multipoint"!==e.type?s.activeComponent.graphics=i:s.toggleTool()}this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.getItemAt(0),t=e.geometry;if((0,h.pC)(t)&&("reshape"===s.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===s.tool&&"extent"===t.type))return;let r=null;"transform"===s.tool?r=await this._getReshape([e],i,o):"reshape"===s.tool&&(r=await this._getBox([e],i,o)),Le(r)||(s.activeComponent.destroy(),s.activeComponent=r,s.activeComponent&&(a.forEach((e=>e.remove())),a=this._getHandlesForComponent(s,i)))}});let n=[o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(s,e,i)),O.f.WIDGET),o.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key!==P.j.snappingToggle||e.repeat||(this.snappingOptions.enabledToggled=!0,e.stopPropagation()),e.key===P.j.constraint&&!e.repeat&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),O.f.WIDGET),o.on("key-up",(e=>{if(e.key===P.j.snappingToggle&&"reshape"===s?.activeComponent?.type&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation()),e.key===P.j.constraint&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),O.f.WIDGET)],a=this._getHandlesForComponent(s,i);return s}async _getGraphicMover(e,t,o){const{enableMoveAllGraphics:r}=t,s=await this._requireModule(i.e(3503).then(i.bind(i,53503)));return Le(s)?s:new s.module.default({enableMoveAllGraphics:r,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:e,view:o,callbacks:{onGraphicMoveStart:e=>{let{dx:t,dy:i,graphic:o}=e;this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:"move-start"},type:"update"})},onGraphicMove:e=>{let{dx:t,dy:i,graphic:o}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:"move"},type:"update"})},onGraphicMoveStop:e=>{let{dx:t,dy:i,graphic:o}=e;this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,o){const{enableRotation:r,enableScaling:s,preserveAspectRatio:n}=t,a=await this._requireModule(Promise.all([i.e(3503),i.e(6306)]).then(i.bind(i,96306)));return Le(a)?a:new a.module.default({graphics:e,enableRotation:r,enableScaling:s,preserveAspectRatio:n,layer:this._internalGraphicsLayer,view:o,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,o){const r="split"===t.reshapeOptions?.edgeOperation,s="move"===t.reshapeOptions?.shapeOperation,n=await this._requireModule(Promise.all([i.e(5652),i.e(1129),i.e(3503),i.e(3362)]).then(i.bind(i,83362)));return Le(n)?n:new n.module.default({enableMidpoints:r,enableMovement:s,graphic:e[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:o,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:e=>{let{mover:t,type:i}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t,type:i},type:"update"})},onMoveStart:e=>{let{dx:t,dy:i,mover:o,type:r}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:r},type:"update"})},onMove:e=>{let{dx:t,dy:i,mover:o,type:r}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:r},type:"update"})},onMoveStop:e=>{let{dx:t,dy:i,mover:o,type:r}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:r},type:"update"})},onVertexAdd:e=>{let{added:t,type:i,vertices:o}=e;const r=t.map((e=>(0,m.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:r,vertices:o,type:i},type:"update"})},onVertexRemove:e=>{let{removed:t,type:i,vertices:o}=e;const r=t.map((e=>(0,m.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:r,vertices:o,type:i},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;switch(i.type){case"graphic-mover":return[i.on("graphic-click",(t=>{let{graphic:i,viewEvent:o}=t;o.native?.shiftKey&&(o.stopPropagation(),e.removeFromSelection(i))})),i.on("graphic-move-start",(t=>e.addToHistory(De(t.allGraphics))))];case"box":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(De(t.graphics)))),i.on("rotate-start",(t=>e.addToHistory(De(t.graphics)))),i.on("scale-start",(t=>e.addToHistory(De(t.graphics))))];case"reshape":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(De([t.mover])))),i.on("reshape-start",(t=>e.addToHistory(De([t.graphic])))),i.on("vertex-add",(t=>e.addToHistory(De([t.oldGraphic])))),i.on("vertex-remove",(t=>e.addToHistory(De([t.oldGraphic]))))];case"move-3d":return[i.on("graphic-move-start",(t=>{e.addToHistory(De(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"})})),i.on("graphic-move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"})})),i.on("graphic-move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[i.on("record-undo",(t=>{let{record:i}=t;e.addToHistory({updates:[i]})})),i.on("graphic-translate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})})),i.on("graphic-translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})})),i.on("graphic-rotate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-start"},type:"update"})})),i.on("graphic-rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})})),i.on("graphic-scale-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})})),i.on("graphic-scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})})),i.on("graphic-translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})})),i.on("graphic-rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"})})),i.on("graphic-scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"reshape-3d":return[i.on("reshape",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];default:return}}_onTransformOrReshape2DGraphicClick(e,t,i){const{graphic:o,viewEvent:r}=i;return r.native?.shiftKey&&o.layer===this.layer?(r.stopPropagation(),e.removeFromSelection(o)):t.toggleToolOnClick?(r.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view.map;this._disablePopup(t);e.on("complete",(()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}}))}async _getCommonUpdateOperationClickHandlers(e,t,i){const o=(0,be.vT)(t),r=await t.async((()=>this._getFirstHit(o)));(0,h.Wi)(r)?e.complete():t.native.shiftKey&&this._toggleSelection([r.graphic],e,i)||this.updateGraphics.includes(r.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const o=!!i.multipleSelectionEnabled;return e.some((e=>null!=e&&!(!o||e.layer!==this.layer)&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0)))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===P.j.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===P.j.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===P.j.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&P.j.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,i=this.updateGraphics.toArray();(0,h.Wi)(t)||"reshape-3d"===t.type||("reshape"!==t.type||1===i.length&&"point"===(0,h.U2)(i[0].geometry,"type"))&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,h.SC)(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||(0,h.Wi)(t))&&(e.attributes&&e.attributes.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){Re.error(new n.Z(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:Me}}wait(){return(0,d.N1)((()=>!this.updating))}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(0,h.pC)(e)&&e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&(0,h.Wi)(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1)}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&(0,h.pC)(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}async _waitViewReady(){const e=this.view;e&&((0,h.IM)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,c.Hl)((0,d.N1)((()=>e?.ready)),this._viewReadyAbortController.signal))}};function He(e){return"polygon"===e||"rectangle"===e||"circle"===e}function ke(e,t){Ue("undo",e.history.undo,e.history.redo,t)}function Ve(e,t){Ue("redo",e.history.redo,e.history.undo,t)}function Ue(e,t,i,o){const r=t.pop().updates,s=[];o.forEach(((t,i)=>{const o=r[i];null!=o&&("geometry"in o&&(0,h.pC)(o.geometry)&&(s.push({geometry:t.geometry}),t.geometry=o.geometry),"symbol"in o&&(0,h.pC)(o.symbol)&&(s.push({symbol:t.symbol}),t.symbol=o.symbol),"undo"in o&&(s.push(o),o[e](t)))})),i.push({updates:s})}function De(e){return{updates:e.map((e=>({geometry:e.geometry})))}}function Le(e){return"requireError"in e&&"aborted"===e.requireError}(0,o._)([(0,u.Cb)()],Ae.prototype,"updating",null),(0,o._)([(0,u.Cb)()],Ae.prototype,"_operationHandle",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],Ae.prototype,"activeTool",null),(0,o._)([(0,u.Cb)()],Ae.prototype,"activeFillSymbol",void 0),(0,o._)([(0,u.Cb)()],Ae.prototype,"activeLineSymbol",void 0),(0,o._)([(0,u.Cb)()],Ae.prototype,"activeVertexSymbol",void 0),(0,o._)([(0,u.Cb)()],Ae.prototype,"allowDeleteKey",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],Ae.prototype,"createGraphic",null),(0,o._)([(0,u.Cb)()],Ae.prototype,"defaultCreateOptions",null),(0,o._)([(0,u.Cb)()],Ae.prototype,"defaultUpdateOptions",null),(0,o._)([(0,u.Cb)({type:G.Z,nonNullable:!0})],Ae.prototype,"labelOptions",void 0),(0,o._)([(0,u.Cb)()],Ae.prototype,"layer",void 0),(0,o._)([(0,u.Cb)({types:r.LB})],Ae.prototype,"pointSymbol",void 0),(0,o._)([(0,u.Cb)({types:r.LB})],Ae.prototype,"polygonSymbol",void 0),(0,o._)([(0,u.Cb)({types:r.LB})],Ae.prototype,"polylineSymbol",void 0),(0,o._)([(0,u.Cb)({type:ye,nonNullable:!0})],Ae.prototype,"snappingOptions",null),(0,o._)([(0,u.Cb)()],Ae.prototype,"_snappingManager",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],Ae.prototype,"state",null),(0,o._)([(0,u.Cb)({type:R.Z,nonNullable:!0})],Ae.prototype,"tooltipOptions",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],Ae.prototype,"updateGraphics",void 0),(0,o._)([(0,u.Cb)()],Ae.prototype,"updateOnGraphicClick",void 0),(0,o._)([(0,u.Cb)({types:r.LB})],Ae.prototype,"updatePointSymbol",void 0),(0,o._)([(0,u.Cb)({types:r.LB})],Ae.prototype,"updatePolygonSymbol",void 0),(0,o._)([(0,u.Cb)({types:r.LB})],Ae.prototype,"updatePolylineSymbol",void 0),(0,o._)([(0,u.Cb)({types:r.LB})],Ae.prototype,"vertexSymbol",void 0),(0,o._)([(0,u.Cb)({value:null})],Ae.prototype,"view",null),Ae=(0,o._)([(0,g.j)(Ge)],Ae);const je=Ae}}]);
//# sourceMappingURL=5604.5dce0967.chunk.js.map