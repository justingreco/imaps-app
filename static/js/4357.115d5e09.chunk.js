"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[4357],{85981:(t,e,n)=>{n.d(e,{AR:()=>m,Gr:()=>_,JG:()=>d,Jk:()=>h,KU:()=>l,Ue:()=>a,al:()=>u,ct:()=>f,nF:()=>p,zk:()=>g});var i=n(16889),o=n(21530),s=n(11186),r=n(71353),c=n(11185);function a(t){return t?{origin:(0,r.a)(t.origin),vector:(0,r.a)(t.vector)}:{origin:(0,r.c)(),vector:(0,r.c)()}}function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a();return u(t.origin,t.vector,e)}function u(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a();return(0,s.c)(n.origin,t),(0,s.c)(n.vector,e),n}function g(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a();return(0,s.c)(n.origin,t),(0,s.b)(n.vector,e,t),n}function h(t,e){const n=(0,s.b)(c.WM.get(),e,t.origin),o=(0,s.e)(t.vector,n),r=(0,s.e)(t.vector,t.vector),a=(0,i.uZ)(o/r,0,1),d=(0,s.b)(c.WM.get(),(0,s.g)(c.WM.get(),t.vector,a),n);return(0,s.e)(d,d)}function p(t,e,n){return f(t,e,0,1,n)}function l(t,e,n){return(0,s.a)(n,t.origin,(0,s.g)(n,t.vector,e))}function f(t,e,n,o,r){const{vector:a,origin:d}=t,u=(0,s.b)(c.WM.get(),e,d),g=(0,s.e)(a,u)/(0,s.p)(a);return(0,s.g)(r,a,(0,i.uZ)(g,n,o)),(0,s.a)(r,r,t.origin)}function _(t,e){if(b(t,function(t,e){const n=C.get();return n.origin=t,n.vector=e,n}(e.origin,e.direction),!1,v)){const{tA:e,pB:n,distance2:i}=v;if(e>=0&&e<=1)return i;if(e<0)return(0,s.d)(t.origin,n);if(e>1)return(0,s.d)((0,s.a)(c.WM.get(),t.origin,t.vector),n)}return null}function m(t,e,n){return!!b(t,e,!0,v)&&((0,s.c)(n,v.pA),!0)}function b(t,e,n,o){const r=1e-6,a=t.origin,d=(0,s.a)(c.WM.get(),a,t.vector),u=e.origin,g=(0,s.a)(c.WM.get(),u,e.vector),h=c.WM.get(),p=c.WM.get();if(h[0]=a[0]-u[0],h[1]=a[1]-u[1],h[2]=a[2]-u[2],p[0]=g[0]-u[0],p[1]=g[1]-u[1],p[2]=g[2]-u[2],Math.abs(p[0])<r&&Math.abs(p[1])<r&&Math.abs(p[2])<r)return!1;const l=c.WM.get();if(l[0]=d[0]-a[0],l[1]=d[1]-a[1],l[2]=d[2]-a[2],Math.abs(l[0])<r&&Math.abs(l[1])<r&&Math.abs(l[2])<r)return!1;const f=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],_=p[0]*l[0]+p[1]*l[1]+p[2]*l[2],m=h[0]*l[0]+h[1]*l[1]+h[2]*l[2],b=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],v=(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])*b-_*_;if(Math.abs(v)<r)return!1;let C=(f*_-m*b)/v,M=(f+_*C)/b;n&&(C=(0,i.uZ)(C,0,1),M=(0,i.uZ)(M,0,1));const W=c.WM.get(),w=c.WM.get();return W[0]=a[0]+C*l[0],W[1]=a[1]+C*l[1],W[2]=a[2]+C*l[2],w[0]=u[0]+M*p[0],w[1]=u[1]+M*p[1],w[2]=u[2]+M*p[2],o.tA=C,o.tB=M,o.pA=W,o.pB=w,o.distance2=(0,s.d)(W,w),!0}const v={tA:0,tB:0,pA:(0,r.c)(),pB:(0,r.c)(),distance2:0},C=new o.x((()=>({origin:null,vector:null})))},54357:(t,e,n)=>{n.r(e),n.d(e,{SceneLayerSnappingSourceWorker:()=>l,default:()=>f});var i=n(27366),o=n(92026),s=n(66978),r=(n(32718),n(25243),n(63780),n(93169),n(75366),n(69912)),c=n(11186),a=n(71353),d=n(85981),u=n(23470),g=n(92536),h=n(78329),p=n(11438);let l=class{constructor(){this._idToComponent=new Map,this._components=new h.Z((t=>t.bounds)),this._edges=new h.Z((t=>t.bounds)),this._tmpLineSegment=(0,d.Ue)(),this._tmpP1=(0,a.c)(),this._tmpP2=(0,a.c)(),this._tmpP3=(0,a.c)(),this.remoteClient=null}async fetchCandidates(t,e){await Promise.resolve(),(0,s.k_)(e),await this._ensureEdgeLocations(t,e);const n=[];return this._edges.forEachNeighbor((e=>this._addCandidates(t,e,n)),t.bounds),{result:{candidates:n}}}async _ensureEdgeLocations(t,e){const n=[];if(this._components.forEachNeighbor((t=>{if((0,o.Wi)(t.info)){const{id:e,uid:i}=t;n.push({id:e,uid:i})}}),t.bounds),!n.length)return;const i={components:n},s=await this.remoteClient.invoke("fetchAllEdgeLocations",i,(0,o.Pt)(e,{}));for(const o of s.components)this._setFetchEdgeLocations(o)}async add(t){const e=new _(t.id,t.bounds);return this._idToComponent.set(e.id,e),this._components.add([e]),{result:{}}}async remove(t){const e=this._idToComponent.get(t.id);if(e){const t=[];this._edges.forEachNeighbor((n=>{n.component===e&&t.push(n)}),e.bounds),this._edges.remove(t),this._components.remove([e]),this._idToComponent.delete(e.id)}return{result:{}}}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if((0,o.Wi)(e)||t.uid!==e.uid)return;const n=p.extractComponentsEdgeLocationsLayout.createView(t.locations),i=new Array(n.count),s=(0,a.c)(),r=(0,a.c)();for(let o=0;o<n.count;o++){const a=(0,u.c)(),d=(0,u.g)(a);n.position0.getVec(o,s),n.position1.getVec(o,r),(0,c.C)(d,d,s,.5),(0,c.C)(d,d,r,.5),(0,c.a)(d,d,t.origin),a[3]=(0,c.i)(d,s);const g=new m(e,o,a);i[o]=g}this._edges.add(i);const{objectIds:d,origin:g}=t;e.info={locations:n,objectIds:d,origin:g}}_addCandidates(t,e,n){const{locations:i,origin:o,objectIds:s}=e.component.info,r=i.position0.getVec(e.index,this._tmpP1),a=i.position1.getVec(e.index,this._tmpP2);(0,c.a)(r,r,o),(0,c.a)(a,a,o);const d=s[i.componentIndex.get(e.index)];this._addEdgeCandidate(t,d,r,a,n),this._addVertexCandidate(t,d,r,n),this._addVertexCandidate(t,d,a,n)}_addEdgeCandidate(t,e,n,i,o){if(!(t.types&g.r.EDGE))return;const s=(0,u.g)(t.bounds),r=(0,d.zk)(n,i,this._tmpLineSegment),h=(0,d.nF)(r,s,this._tmpP3);if(!(0,u.m)(t.bounds,h))return null;o.push({type:"edge",objectId:e,target:(0,a.a)(h),distance:(0,c.i)(s,h),start:(0,a.a)(n),end:(0,a.a)(i)})}_addVertexCandidate(t,e,n,i){if(!(t.types&g.r.VERTEX))return;const o=(0,u.g)(t.bounds);if(!(0,u.m)(t.bounds,n))return null;i.push({type:"vertex",objectId:e,target:(0,a.a)(n),distance:(0,c.i)(o,n)})}};function f(){return new l}l=(0,i._)([(0,r.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],l);class _{constructor(t,e){this.id=t,this.bounds=e,this.info=null,this.uid=++_.uid}}_.uid=0;class m{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}}}}]);
//# sourceMappingURL=4357.115d5e09.chunk.js.map