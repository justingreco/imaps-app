"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[9634,2078],{62078:(e,r,t)=>{t.r(r),t.d(r,{addOrUpdateResource:()=>u,contentToBlob:()=>d,fetchResources:()=>c,getSiblingOfSameType:()=>m,getSiblingOfSameTypeI:()=>f,removeAllResources:()=>i,removeResource:()=>p,splitPrefixFileNameAndExtension:()=>h});var s=t(76200),o=t(10064),a=t(92026),n=t(35995);async function c(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;await e.load(t);const s=(0,n.v_)(e.itemUrl,"resources"),{start:o=1,num:c=10,sortOrder:u="asc",sortField:p="created"}=r,i={query:{start:o,num:c,sortOrder:u,sortField:p,token:e.apiKey},signal:(0,a.U2)(t,"signal")},l=await e.portal.request(s,i);return{total:l.total,nextStart:l.nextStart,resources:l.resources.map((r=>{let{created:t,size:s,resource:o}=r;return{created:new Date(t),size:s,resource:e.resourceFromPath(o)}}))}}async function u(e,r,t,s){if(!e.hasPath())throw new o.Z(`portal-item-resource-${r}:invalid-path`,"Resource does not have a valid path");const c=e.portalItem;await c.load(s);const u=(0,n.v_)(c.userItemUrl,"add"===r?"addResources":"updateResources"),[p,i]=l(e.path),h=await d(t),m=new FormData;return p&&"."!==p&&m.append("resourcesPrefix",p),(0,a.pC)(s)&&s.compress&&m.append("compress","true"),m.append("fileName",i),m.append("file",h,i),m.append("f","json"),(0,a.pC)(s)&&s.access&&m.append("access",s.access),await c.portal.request(u,{method:"post",body:m,signal:(0,a.U2)(s,"signal")}),e}async function p(e,r,t){if(!r.hasPath())throw new o.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(t);const s=(0,n.v_)(e.userItemUrl,"removeResources");await e.portal.request(s,{method:"post",query:{resource:r.path},signal:(0,a.U2)(t,"signal")}),r.portalItem=null}async function i(e,r){await e.load(r);const t=(0,n.v_)(e.userItemUrl,"removeResources");return e.portal.request(t,{method:"post",query:{deleteAll:!0},signal:(0,a.U2)(r,"signal")})}function l(e){const r=e.lastIndexOf("/");return-1===r?[".",e]:[e.slice(0,r),e.slice(r+1)]}function h(e){const[r,t]=function(e){const r=(0,n.Ml)(e);return(0,a.Wi)(r)?[e,""]:[e.slice(0,e.length-r.length-1),`.${r}`]}(e),[s,o]=l(r);return[s,o,t]}async function d(e){return e instanceof Blob?e:(await(0,s.default)(e.url,{responseType:"blob"})).data}function m(e,r){if(!e.hasPath())return null;const[t,,s]=h(e.path);return e.portalItem.resourceFromPath((0,n.v_)(t,r+s))}function f(e,r){if(!e.hasPath())return null;const[t,,s]=h(e.path);return e.portalItem.resourceFromPath((0,n.v_)(t,r+s))}},9634:(e,r,t)=>{t.r(r),t.d(r,{saveResources:()=>p});var s=t(14921),o=t(10064),a=t(92026),n=t(66978),c=t(71907),u=t(62078);async function p(e,r,t){if(!r||!r.resources)return;const s=r.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=r.portalItem;const a=new Set(r.resources.toKeep.map((e=>e.resource.path))),p=new Set,h=[];a.forEach((r=>{s.delete(r),e.paths.push(r)}));for(const o of r.resources.toUpdate)if(s.delete(o.resource.path),a.has(o.resource.path)||p.has(o.resource.path)){const{resource:r,content:s,finish:a,error:n}=o,p=(0,u.getSiblingOfSameTypeI)(r,(0,c.D)());e.paths.push(p.path),h.push(i({resource:p,content:s,compress:o.compress,finish:a,error:n},t))}else e.paths.push(o.resource.path),h.push(l(o,t)),p.add(o.resource.path);for(const o of r.resources.toAdd)h.push(i(o,t)),e.paths.push(o.resource.path);if(s.forEach((e=>{if(r.portalItem){const t=r.portalItem.resourceFromPath(e);h.push(t.portalItem.removeResource(t).catch((()=>{})))}})),0===h.length)return;const d=await(0,n.as)(h);(0,n.k_)(t);const m=d.filter((e=>"error"in e)).map((e=>e.error));if(m.length>0)throw new o.Z("save:resources","Failed to save one or more resources",{errors:m})}async function i(e,r){const t={...(0,a.pC)(r)?r:{},compress:e.compress},o=await(0,s.q6)(e.resource.portalItem.addResource(e.resource,e.content,t));if(!0!==o.ok)throw e.error?.(o.error),o.error;e.finish?.(e.resource)}async function l(e,r){const t=await(0,s.q6)(e.resource.update(e.content,r));if(!0!==t.ok)throw e.error?.(t.error),t.error;e.finish?.(e.resource)}}}]);
//# sourceMappingURL=9634.988dc56a.chunk.js.map