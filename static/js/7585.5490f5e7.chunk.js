"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[7585],{47585:(e,t,a)=>{a.r(t),a.d(t,{default:()=>E});var l=a(72791),n=a(54901),r=a(64326),i=a(73937),o=a(81734),d=a(61524),s=a(91946),u=a(64128);let c,m;function p(e,t,a){return new Promise(((a,l)=>{(function(e){return new Promise(((t,a)=>{const l=new r.default({portalItem:{id:"318be24592ea4dcba042511b3125fd53"},layerId:2});m=l,l.load().then((a=>{const l=new r.default({source:[],fields:a.fields,geometryType:"point",spatialReference:e.spatialReference,popupTemplate:a.popupTemplate,objectIdField:a.objectIdField,displayField:a.displayField,id:"feature-table"});l.fields.forEach((e=>{e.nullable=!0,"DEED_DATE"===e.name&&(e.type="string")})),e.map.allTables.add(l),l.load().then((e=>{t(e)})).catch((e=>{console.log(e)}))}))}))})(t).then((l=>{var r;c=new n.Z({container:e,view:t,editingEnabled:!1,multiSortEnabled:!0,visibleElements:{selectionColumn:!1,menuItems:{refreshData:!1,toggleColumns:!1}},menuConfig:{items:[new d.Z({label:"Export",iconClass:"esri-icon-download",clickFunction:()=>{f(c)}})]},tableTemplate:h(l),layer:l}),null===(r=c)||void 0===r||r.when((()=>{a(c),function(e){e.findColumn("ADDRESS").width=150,e.findColumn("FEATURETYPE").width=150,setTimeout((()=>{const t=e.container.querySelector("vaadin-grid");null===t||void 0===t||t.addEventListener("click",(a=>{if("VAADIN-GRID-CELL-CONTENT"===a.target.nodeName){var l;e.highlightIds.removeAll();const n=(null===(l=t.getEventContext(a))||void 0===l?void 0:l.item).feature;e.highlightIds.add(n.getAttribute("OBJECTID"))}}))}),2e3)}(c),c.on("selection-change",(e=>{e.added.length&&c.layer.queryFeatures({objectIds:[e.added[0].feature.getObjectId()],returnGeometry:!0}).then((e=>{if(e.features.length){const a=e.features[0];a.setAttribute("type","address"),a.symbol=new s.Z({url:"assets/pin.svg",height:24,width:24}),(0,u.l)(t),t.graphics.add(a),t.goTo({target:a,zoom:18},{easing:"ease-in-out",duration:1e3})}}))}))}))}))}))}function h(e){return new o.Z({columnTemplates:[new i.Z({label:"Address",fieldName:"ADDRESS",editable:!1,initialSortPriority:0,direction:"asc"}),new i.Z({label:"Type",fieldName:"FEATURETYPE",editable:!1,initialSortPriority:1,direction:"asc"})]})}const f=e=>{e.layer.queryFeatures({where:"1=1",outFields:["*"],orderByFields:["ADDRESS","FEATURETYPE"]}).then((t=>{let a="";e.tableTemplate.columnTemplates.forEach((e=>{a+=`${e.label},`})),a+="\r\n",t.features.forEach((t=>{e.tableTemplate.columnTemplates.forEach((e=>{t.attributes[e.fieldName]?a+=`"${t.attributes[e.fieldName]}",`:a+='"",'})),a+="\r\n"}));let l=(new Date).toISOString();l=l.replaceAll(":","").replaceAll("-","");const n=`imaps_addresses_export_${l}.csv`,r=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(void 0!==i.download){const e=URL.createObjectURL(r);i.setAttribute("href",e),i.setAttribute("download",n),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}))};var b=a(80184);function y(e){const t=(0,l.useRef)(),a=(0,l.useRef)(!1);return(0,l.useEffect)((()=>(a.current||(a.current=!0,p(t.current,e.view,e.featureSelected).then((t=>{!function(e,t){var a;t&&((0,u.l)(t.view),null===(a=m)||void 0===a||a.queryFeatures({geometry:e.geometry,outFields:["ADDRESS","FEATURETYPE"],returnGeometry:!0,where:"1=1"}).then((e=>{t.layer.queryFeatures({where:"1=1",returnGeometry:!0}).then((a=>{t.layer.applyEdits({deleteFeatures:a.features}).then((a=>{t.layer.applyEdits({addFeatures:e.features}).then((e=>{t.refresh()})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}))})))}(e.property,t)}))),()=>{})),[]),(0,b.jsx)("div",{id:"address-table",ref:t})}const E=l.memo(y)}}]);
//# sourceMappingURL=7585.5490f5e7.chunk.js.map