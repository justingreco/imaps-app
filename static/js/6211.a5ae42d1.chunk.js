"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[6211],{96211:(e,t,i)=>{i.r(t),i.d(t,{default:()=>K});var s=i(27366),a=i(66978),n=i(68860),l=i(8025),r=i(63780),o=(i(93169),i(25243),i(49861)),u=i(69912),h=i(69407),d=i(80573),p=i(32718),c=i(92026),_=i(80885);const m=p.Z.getLogger("esri.analysis.AreaMeasurementAnalysis");let y=class extends d.Z{constructor(e){super(e),this.type="area-measurement",this.extent=null,this.unit=null,this.nonEditableMessage="Assign a closed polygon geometry containing more than two points to the analysis to allow editing."}set geometry(e){if((0,c.Wi)(e))return this._set("geometry",null),void this._set("extent",null);e.rings.length>1&&m.warn("Measuring polygons with multiple rings is not supported."),this._set("geometry",e.clone()),this._set("extent",e.extent)}get requiredPropertiesForEditing(){if((0,c.pC)(this.geometry)&&1===this.geometry.rings.length){const e=this.geometry.rings[0];if(e.length<=2||!(0,r.fS)(e[0],e[e.length-1]))return[null]}return[this.geometry]}clear(){this.geometry=null}};(0,s._)([(0,o.Cb)({type:["area-measurement"]})],y.prototype,"type",void 0),(0,s._)([(0,o.Cb)({value:null,type:_.Z})],y.prototype,"geometry",null),(0,s._)([(0,o.Cb)({readOnly:!0})],y.prototype,"extent",void 0),(0,s._)([(0,o.Cb)({type:n.fN,value:null})],y.prototype,"unit",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],y.prototype,"requiredPropertiesForEditing",null),(0,s._)([(0,o.Cb)({readOnly:!0})],y.prototype,"nonEditableMessage",void 0),y=(0,s._)([(0,u.j)("esri.analysis.AreaMeasurementAnalysis")],y);const g=y;var v=i(77671),w=i(100),b=i(94172),V=i(37818),C=i(48681),D=i(51328),M=i(84652),f=i(17842),L=i(71353),S=i(83639),P=i(92382),x=i(62389),O=i(70619),A=i(81268),k=i(54463),U=i(92853);const I={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:1,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,handleRadiusHovered:10,handleRadiusMouse:10,handleRadiusTouch:25,pathLineColor:[1,.5,0,1],pathLineWidth:3,intersectingLineColor:[1,.2,0,1],perimeterLineColor:[1,.5,0,1],perimeterLineWidth:2,projectionLineColor:[1,.5,0,1],projectionLineWidth:2,projectionLineStippleSize:5,areaColor1:[1,.5,0,.5],areaColor2:[1,1,1,.5],fillColor:[1,.5,0,.5],lineSubdivisions:64,labelDistance:25};class T{constructor(e){this.vertexManipulators=[],this._analysisViewData=null,this._destroyed=!1,this._isManipulatorsOwner=!0,this._visible=!0,this._laserLine=null,this._cursorManipulator=null,this._listenerHandles=null,this._tempHandlePosition=(0,L.c)();const{analysisViewData:t,manipulators:i,toolState:s,view:a,visible:n}=e;this._analysisViewData=t,this._toolState=s,null!=i?(this._manipulators=i,this._isManipulatorsOwner=!1):this._manipulators=new U.D,this._view=a;const l=this._style=function(e,t){return{...e,...(0,M.d9)(t)}}(I,e.style);this._intersector=(0,A.Z8)(a.state.viewingMode),this._intersector.options.store=k.eC.MIN;const r=(0,S.aD)(a,l.handleColor,l.handleOpacity);r.available=!1,r.radius=l.handleRadius,r.interactive=!1,this._manipulators.add(r),this._cursorManipulator=r,this._laserLine=new x.W({view:a,attached:!0,style:{glowColor:l.laserLineGlowColor,glowWidth:l.laserLineGlowWidth,glowFalloff:l.laserLineGlowFalloff,innerColor:l.laserLineInnerColor,innerWidth:l.laserLineInnerWidth,globalAlpha:l.laserLineGlobalAlpha}}),this._updateVisibility(n||!0)}destroy(){this._listenerHandles=(0,c.SC)(this._listenerHandles),this._isManipulatorsOwner?this._manipulators=(0,c.SC)(this._manipulators):this._manipulators=null,this._laserLine=(0,c.SC)(this._laserLine),this._destroyed=!0}get destroyed(){return this._destroyed}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get testData(){const e=this._laserLine.testData;return{laserLineRenderer:(0,c.pC)(e)?{heightManifoldEnabled:e.heightManifoldEnabled,heightManifoldTarget:e.heightManifoldTarget,pointDistanceEnabled:e.pointDistanceEnabled,pointDistanceOrigin:e.pointDistanceOrigin,pointDistanceTarget:e.pointDistanceTarget,lineVerticalPlaneEnabled:e.lineVerticalPlaneEnabled}:{heightManifoldEnabled:!1,heightManifoldTarget:null,pointDistanceEnabled:!1,pointDistanceOrigin:null,pointDistanceTarget:null,lineVerticalPlaneEnabled:!1}}}show(){this._setVisibility(!0)}hide(){this._setVisibility(!1)}_setVisibility(e){this._destroyed||this._visible===e||this._updateVisibility(e)}_updateVisibility(e){this._visible=e,this._laserLine.visible=e,e?(this._initializeListeners(),this._updateAll()):(this._destroyListeners(),this.vertexManipulators.forEach((e=>{this._removeVertexManipulator(e.manipulator)})),this.vertexManipulators=[],this._view.cursor=null)}vertexHandleAt(e,t){const i=this._manipulators.intersect(e,t);return(0,c.pC)(i)?i.manipulator.metadata:null}pick(e){const t=this._view.spatialReference,i=(0,f.md)(e.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const s=this._intersector.results.min,a=(0,L.c)();if(!s.getIntersectionPoint(a))return null;const n=this._view.renderCoordsHelper.fromRenderCoords(a,t);return(0,c.Wi)(n)?null:new P.G(a,n)}_updateAll(){this._visible&&(this._updateVertexManipulators(),this._updateLaserLine())}_createVertexManipulator(){const e=(0,S.aD)(this._view,this._style.handleColor,this._style.handleOpacity);return e.radius=this._style.handleRadius,{id:this._manipulators.add(e),manipulator:e}}_removeVertexManipulator(e){this._manipulators.remove(e)}_updateVertexManipulators(){const{viewData:e}=this._analysisViewData,t=this._analysisViewData.path?this._analysisViewData.path.vertices:[],i=this.vertexManipulators;(function(e,t,i,s){for(;e.length<t;)e.push(i());if(s)for(;e.length>t;)s(e.pop());else e.length=t})(i,t.length,(()=>this._createVertexManipulator()),(e=>this._removeVertexManipulator(e.manipulator))),i.forEach(((i,s)=>{i.manipulator.metadata=t[s],i.manipulator.renderLocation=e.positionsRenderCoords[s]})),"drawing"===this._toolState.polygonState&&(0,c.pC)(this._analysisViewData.cursorPoint)?(this._cursorManipulator.available=!0,this._cursorManipulator.location=this._analysisViewData.cursorPoint):this._cursorManipulator.available=!1}_getFocusPoint(){const{lastDraggedVertex:e}=this._analysisViewData;switch(this._toolState.polygonState){case"drawing":return(0,c.pC)(this._analysisViewData.cursorPoint)?this._analysisViewData.cursorPoint:(0,c.pC)(e)?this._analysisViewData.path.getVertexPositionAsPoint(e):(0,c.Wg)(this._analysisViewData.path.lastPoint);case"editing":return(0,c.pC)(e)?this._analysisViewData.path.getVertexPositionAsPoint(e):null;default:return this._analysisViewData.cursorPoint}}_updateLaserLine(){const e=this._style.laserLineEnabled&&"measured"!==this._toolState.polygonState&&this._toolState.active,t=this._getFocusPoint();if(e&&(0,c.pC)(t)){const e=this._tempHandlePosition;this._view.renderCoordsHelper.toRenderCoords(t,e),this._laserLine.heightManifoldTarget=e}else this._laserLine.heightManifoldTarget=null}_initializeListeners(){this._listenerHandles=new w.Z,this._listenerHandles.add([(0,b.YP)((()=>this._toolState.polygonState),(()=>this._updateLaserLine())),(0,b.YP)((()=>this._analysisViewData.viewData),(()=>this._updateAll()),b.Z_),(0,b.YP)((()=>({lastDraggedVertex:this._analysisViewData.lastDraggedVertex,cursorPoint:this._analysisViewData.cursorPoint})),(()=>this._updateLaserLine())),(0,b.YP)((()=>this._toolState.active),(()=>this._updateAll()))])}_destroyListeners(){this._listenerHandles=(0,c.SC)(this._listenerHandles)}}T._handleGeometry=O.Z.createSphereGeometry(1,32,32);var E=i(86509),W=i(74229),$=i(72612);let H=class extends E.f{constructor(e){super(e),this._handles=new w.Z,this.polygonState="initial",this.analysisViewData=null}initialize(){const{view:e,analysisViewData:t,manipulators:i,visible:s}=this;this.measurementView=new T({view:e,analysisViewData:t,toolState:this,manipulators:i,visible:s}),this._setupManipulators(),this._handles.add((0,b.YP)((()=>this.state),(e=>{"measured"===e&&this.finishToolCreation()}),b.tX))}destroy(){this.measurementView.destroy(),this._set("measurementView",null),this._handles=(0,c.SC)(this._handles)}get state(){return 0===this.analysisViewData.path.numVertices?"ready":this.analysisViewData.validMeasurement&&"editing"!==this.polygonState?"measured":"measuring"}get cursor(){return"ready"===this.state||"drawing"===this.polygonState?"crosshair":null}finishMeasurement(){const{path:e}=this.analysisViewData;e.numVertices<3?(e.clear(),this.polygonState="initial"):(e.close(),this.polygonState="measured"),this.analysisViewData.cursorPoint=null}onShow(){this.measurementView.show()}onHide(){this.measurementView.hide()}onInputEvent(e){switch(e.type){case"immediate-double-click":this._handleImmediateDoubleClick(e);break;case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"drag":this._handleDrag(e);break;case"key-down":this._handleKeyDown(e)}}_setupManipulators(){const e=e=>`manipulator-${e}`,t=e=>e.events.on("grab-changed",(()=>{if(this.analysisViewData.validMeasurement){const e=this.manipulators.some((e=>e.manipulator.grabbing));this.polygonState=e?"editing":"measured"}})),i=(i,s)=>{this._handles.add([(0,W.Xd)(s,((e,t,i)=>{const s=(0,D.J4)(e),a=(0,c.Wg)(e.metadata);t.next(s).next((0,D.gv)(this.view)).next((t=>{e.location=t.mapEnd,this.analysisViewData.path.setVertexPosition(a,(0,V.WG)(t.mapEnd))}));const n=(0,V.WG)(this.analysisViewData.path.getVertexPositionAsPoint(a));i.next(s).next((()=>{this.analysisViewData.path.setVertexPosition(a,n),e.location=n}))})),t(s)],e(i))},s=t=>{this._handles.remove(e(t))};this.manipulators.forEach((e=>{let{id:t,manipulator:s}=e;i(t,s)})),this._handles.add([this.manipulators.on("after-add",(e=>{let{item:{id:t,manipulator:s}}=e;i(t,s)})),this.manipulators.on("after-remove",(e=>{let{item:{id:t}}=e;s(t)}))])}_handleImmediateDoubleClick(e){(0,C.y1)(e)&&("drawing"===this.polygonState&&this.finishMeasurement(),e.stopPropagation())}_handleDrag(e){"editing"===this.polygonState&&e.stopPropagation()}_handleImmediateClick(e){if(!(0,C.y1)(e))return;const t=(0,$.vT)(e);if(this.active)switch(this.polygonState){case"initial":if(this._addVertexAt(t))return this.analysisViewData.cursorPoint=null,this.polygonState="drawing",void e.stopPropagation();break;case"drawing":{const i=this.measurementView.vertexHandleAt(t,e.pointerType);if((0,c.Wi)(i)){if(this._addVertexAt(t))return this.analysisViewData.cursorPoint=null,void e.stopPropagation()}else 0===i.index&&(this.finishMeasurement(),e.stopPropagation());break}}"mouse"===e.pointerType&&this._hoverAt(t)}_handlePointerMove(e){if("mouse"===e.pointerType){const t=(0,$.vT)(e);this._hoverAt(t)}}_handleKeyDown(e){"Enter"===e.key&&"drawing"===this.polygonState&&(this.finishMeasurement(),e.stopPropagation())}_hoverAt(e){if(!this.active||"initial"!==this.polygonState&&"drawing"!==this.polygonState)this.analysisViewData.cursorPoint=null;else{const t=this._pick(e);(0,c.pC)(t)&&(this.analysisViewData.cursorPoint=t.mapPoint)}}_addVertexAt(e){const t=this._pick(e);return!(!(0,c.pC)(t)||!(0,c.pC)(t.mapPoint))&&(this.analysisViewData.path.add(t.mapPoint),!0)}_pick(e){const t=new P.e(e);return this.measurementView.pick(t)}};(0,s._)([(0,o.Cb)({readOnly:!0})],H.prototype,"state",null),(0,s._)([(0,o.Cb)()],H.prototype,"polygonState",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],H.prototype,"cursor",null),(0,s._)([(0,o.Cb)()],H.prototype,"measurementView",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0})],H.prototype,"view",void 0),(0,s._)([(0,o.Cb)()],H.prototype,"analysis",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0})],H.prototype,"analysisViewData",void 0),H=(0,s._)([(0,u.j)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],H);const G=H;var R=i(40085);let Z=class extends R.O{constructor(e){super(e),this.analysis=null,this.supportedViewType="3d",this.unsupportedErrorMessage="AreaMeasurement3DViewModel is only supported in 3D views.",this._userUnitOptions=null,this._userUnit=null}initialize(){this.analysis.unit=this.unit}get state(){return this.disabled||!this.ready?"disabled":(0,c.Wi)(this.tool)?"ready":this.tool.state}get measurement(){if((0,c.Wi)(this.tool)||this.disabled||this.tool.destroyed)return null;const{analysisView:e}=this;if((0,c.Wi)(e))return null;const t=e.analysisVisualization,i=t.viewData,s=i.measurementData,a=e.validMeasurement,n="euclidean"===i.mode,l=0===(n?s.intersectingSegments:s.geodesicIntersectingSegments).size,r=l?a?"available":"unavailable":"invalid";return{mode:n?"euclidean":"geodesic",area:{text:l&&a?t.areaLabel:null,state:r},perimeterLength:{text:l&&a?t.perimeterLengthLabel:null,state:r}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.analysis.unit=this._userUnit}get unit(){return(0,c.pC)(this._userUnit)?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}constructAnalysis(){return new g}constructTool(){return new G({view:(0,c.Wg)(this.view),analysis:this.analysis,analysisViewData:(0,c.Wg)(this.analysisView),visible:this.visible})}_findSelectableUnit(e,t){const{unitOptions:i}=this;return i.includes(e)?e:(0,c.pC)(t)?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){if((0,c.Wi)(e))return n.fN.slice();const t=e.filter((e=>n.fN.includes(e)));return 0===t.length?n.fN.slice():t}};(0,s._)([(0,o.Cb)({type:g})],Z.prototype,"analysis",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],Z.prototype,"state",null),(0,s._)([(0,o.Cb)({readOnly:!0})],Z.prototype,"measurement",null),(0,s._)([(0,o.Cb)()],Z.prototype,"unitOptions",null),(0,s._)([(0,o.Cb)()],Z.prototype,"unit",null),(0,s._)([(0,o.Cb)(v.Y)],Z.prototype,"defaultUnit",void 0),(0,s._)([(0,o.Cb)()],Z.prototype,"_userUnit",void 0),Z=(0,s._)([(0,u.j)("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],Z);const z=Z;var j=i(78088),B=i(80532),F=i(67005);i(80975);const N="esri-area-measurement-3d",Y={buttonDisabled:"esri-button--disabled",base:`${N} esri-widget esri-widget--panel`,container:`${N}__container`,hint:`${N}__hint`,hintText:`${N}__hint-text`,panelError:`${N}__panel--error`,measurement:`${N}__measurement`,measurementItem:`${N}__measurement-item`,measurementItemDisabled:`${N}__measurement-item--disabled`,measurementItemTitle:`${N}__measurement-item-title`,measurementItemValue:`${N}__measurement-item-value`,settings:`${N}__settings`,units:`${N}__units`,unitsLabel:`${N}__units-label`,unitsSelect:`${N}__units-select esri-select`,unitsSelectWrapper:`${N}__units-select-wrapper`,actionSection:`${N}__actions`,newMeasurementButton:`${N}__clear-button esri-button esri-button--primary`,widgetIcon:"esri-icon-measure-area"};let q=class extends h.Z{constructor(e,t){super(e,t),this.view=null,this.visible=null,this.iconClass=Y.widgetIcon,this.label=void 0,this.messages=null,this.messagesUnits=null,this.viewModel=new z,this.unitOptions=null,this.unit=null}get analysis(){return this.viewModel.analysis}set analysis(e){this.viewModel.analysis=e}render(){const{supported:e,active:t,measurement:i,state:s,unit:a}=this.viewModel,l="disabled"===s,r="ready"===s,o="measuring"===s||"measured"===s,{messages:u,messagesUnits:h}=this,d=t&&r?(0,F.u)("section",{key:"esri-area-measurement-3d__hint",class:Y.hint},(0,F.u)("p",{class:Y.hintText},u.hint)):null,p=e?null:(0,F.u)("section",{key:"esri-area-measurement-3d__unsupported",class:Y.panelError},(0,F.u)("p",null,u.unsupported)),c=(e,t,i)=>{switch(t.state){case"available":return(0,F.u)("div",{key:`${i}-enabled`,class:Y.measurementItem},(0,F.u)("span",{class:Y.measurementItemTitle},e),(0,F.u)("span",{class:Y.measurementItemValue},t.text));case"unavailable":return(0,F.u)("div",{key:`${i}-disabled`,class:this.classes(Y.measurementItem,Y.measurementItemDisabled)},(0,F.u)("span",{class:Y.measurementItemTitle},e));case"invalid":return(0,F.u)("div",{key:`${i}-enabled`,class:Y.measurementItem},(0,F.u)("span",{class:Y.measurementItemTitle},e),(0,F.u)("span",{class:Y.measurementItemValue},u.notApplicable))}},_=o?(0,F.u)("section",{key:"esri-area-measurement-3d__measurement",class:Y.measurement},c(u.area,i.area,"area"),c(u.perimeterLength,i.perimeterLength,"perimeter-length")):null,m=`${this.id}__units`,y=(0,F.u)("label",{class:Y.unitsLabel,for:m},u.unit),g=(0,F.u)("div",{class:Y.unitsSelectWrapper},(0,F.u)("select",{class:Y.unitsSelect,id:m,onchange:this._changeUnit,bind:this,value:a},this.viewModel.unitOptions.map((e=>(0,F.u)("option",{key:e,value:e},(0,n.ZO)(e)?h.systems[e]:h.units[e]?.pluralCapitalized))))),v=o?(0,F.u)("section",{key:"esri-area-measurement-3d__units",class:Y.units},y,g):null,w=o?(0,F.u)("div",{key:"settings",class:Y.settings},v):null,b=!e||t&&!o?null:(0,F.u)("div",{class:Y.actionSection},(0,F.u)("button",{disabled:l,class:this.classes(Y.newMeasurementButton,l&&Y.buttonDisabled),bind:this,onclick:this._newMeasurement,type:"button"},u.newMeasurement)),V=this.visible?(0,F.u)("div",{class:Y.container},p,d,w,_,b):null;return(0,F.u)("div",{key:this,class:Y.base,role:"presentation"},V)}_newMeasurement(){(0,a.R8)(this.viewModel.start())}_changeUnit(e){const t=e.target,i=t.options[t.selectedIndex];i&&(this.unit=i.value)}};(0,s._)([(0,l.B)("viewModel.view")],q.prototype,"view",void 0),(0,s._)([(0,l.B)("viewModel.visible")],q.prototype,"visible",void 0),(0,s._)([(0,l.B)("viewModel.active")],q.prototype,"active",void 0),(0,s._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],q.prototype,"analysis",null),(0,s._)([(0,o.Cb)()],q.prototype,"iconClass",void 0),(0,s._)([(0,o.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],q.prototype,"label",void 0),(0,s._)([(0,o.Cb)(),(0,B.H)("esri/widgets/AreaMeasurement3D/t9n/AreaMeasurement3D")],q.prototype,"messages",void 0),(0,s._)([(0,o.Cb)(),(0,B.H)("esri/core/t9n/Units")],q.prototype,"messagesUnits",void 0),(0,s._)([(0,o.Cb)()],q.prototype,"uiStrings",void 0),(0,s._)([(0,o.Cb)({type:z})],q.prototype,"viewModel",void 0),(0,s._)([(0,l.B)("viewModel.unitOptions")],q.prototype,"unitOptions",void 0),(0,s._)([(0,l.B)("viewModel.unit")],q.prototype,"unit",void 0),(0,s._)([(0,j.h)()],q.prototype,"_newMeasurement",null),(0,s._)([(0,j.h)()],q.prototype,"_changeUnit",null),q=(0,s._)([(0,u.j)("esri.widgets.AreaMeasurement3D")],q);const K=q}}]);
//# sourceMappingURL=6211.a5ae42d1.chunk.js.map