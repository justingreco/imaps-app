"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[6211],{96211:(e,t,i)=>{i.r(t),i.d(t,{default:()=>X});var s=i(27366),a=i(66978),n=i(68860),l=i(49861),r=i(63780),o=(i(25243),i(69912)),u=i(69407),h=i(80573),d=i(32718),p=i(92026),_=i(80885);let c=class extends h.Z{constructor(e){super(e),this.type="area-measurement",this.unit=null}set geometry(e){(0,p.Wi)(e)?this._set("geometry",null):(e.rings.length>1&&d.Z.getLogger(this.declaredClass).warn("Measuring polygons with multiple rings is not supported."),this._set("geometry",e.clone()))}get requiredPropertiesForEditing(){if((0,p.pC)(this.geometry)&&1===this.geometry.rings.length){const e=this.geometry.rings[0];if(e.length<=2||!(0,r.fS)(e[0],e[e.length-1]))return[null]}return[this.geometry]}clear(){this.geometry=null}};(0,s._)([(0,l.Cb)({type:["area-measurement"]})],c.prototype,"type",void 0),(0,s._)([(0,l.Cb)({value:null,type:_.Z})],c.prototype,"geometry",null),(0,s._)([(0,l.Cb)({type:n.fN,value:null})],c.prototype,"unit",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],c.prototype,"requiredPropertiesForEditing",null),c=(0,s._)([(0,o.j)("esri.analysis.AreaMeasurementAnalysis")],c);const m=c;var y=i(94172),g=i(77671),w=i(100),v=i(37818),b=i(48681),V=i(51328),D=i(51995),M=i(70148),C=i(84652),f=i(17842),S=i(71353),P=i(30036),L=i(92382),x=i(62389),O=i(70619),k=i(81268),A=i(54463),I=i(92853);class U{constructor(e){this.vertexManipulators=[],this._analysisViewData=null,this._destroyed=!1,this._isManipulatorsOwner=!0,this._visible=!0,this._laserLine=null,this._cursorManipulator=null,this._listenerHandles=null,this._tempHandlePosition=(0,S.c)(),this._defaultStyle={laserLineGlowColor:D.Z.toUnitRGB((0,M.e9)()),laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:D.Z.toUnitRGB((0,M.RN)()),laserLineInnerWidth:1,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:D.Z.toUnitRGB((0,M.e9)()),handleOpacity:.5,handleRadius:5,handleRadiusHovered:10,handleRadiusMouse:10,handleRadiusTouch:25};const{analysisViewData:t,manipulators:i,toolState:s,view:a,visible:n}=e;this._analysisViewData=t,this._toolState=s,null!=i?(this._manipulators=i,this._isManipulatorsOwner=!1):this._manipulators=new I.D,this._view=a;const l=this._style=(r=this._defaultStyle,o=e.style,{...r,...(0,C.d9)(o)});var r,o;this._intersector=(0,k.Z8)(a.state.viewingMode),this._intersector.options.store=A.eC.MIN;const u=(0,P.aD)(a,l.handleColor,l.handleOpacity);u.available=!1,u.radius=l.handleRadius,u.interactive=!1,this._manipulators.add(u),this._cursorManipulator=u,this._laserLine=new x.W({view:a,attached:!0,style:{glowColor:l.laserLineGlowColor,glowWidth:l.laserLineGlowWidth,glowFalloff:l.laserLineGlowFalloff,innerColor:l.laserLineInnerColor,innerWidth:l.laserLineInnerWidth,globalAlpha:l.laserLineGlobalAlpha}}),this._updateVisibility(n||!0)}destroy(){this._listenerHandles=(0,p.SC)(this._listenerHandles),this._isManipulatorsOwner?this._manipulators=(0,p.SC)(this._manipulators):this._manipulators=null,this._laserLine=(0,p.SC)(this._laserLine),this._destroyed=!0}get destroyed(){return this._destroyed}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get testData(){const e=this._laserLine.testData;return{laserLineRenderer:(0,p.pC)(e)?{heightManifoldEnabled:e.heightManifoldEnabled,heightManifoldTarget:e.heightManifoldTarget,pointDistanceEnabled:e.pointDistanceEnabled,pointDistanceOrigin:e.pointDistanceOrigin,pointDistanceTarget:e.pointDistanceTarget,lineVerticalPlaneEnabled:e.lineVerticalPlaneEnabled}:{heightManifoldEnabled:!1,heightManifoldTarget:null,pointDistanceEnabled:!1,pointDistanceOrigin:null,pointDistanceTarget:null,lineVerticalPlaneEnabled:!1}}}show(){this._setVisibility(!0)}hide(){this._setVisibility(!1)}_setVisibility(e){this._destroyed||this._visible===e||this._updateVisibility(e)}_updateVisibility(e){this._visible=e,this._laserLine.visible=e,e?(this._initializeListeners(),this._updateAll()):(this._destroyListeners(),this.vertexManipulators.forEach((e=>this._removeVertexManipulator(e))),this.vertexManipulators=[],this._view.cursor=null)}vertexHandleAt(e,t){const i=this._manipulators.intersect(e,t);return(0,p.pC)(i)?i.metadata:null}pick(e){const t=this._view.spatialReference,i=(0,f.md)(e.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const s=this._intersector.results.min,a=(0,S.c)();if(!s.getIntersectionPoint(a))return null;const n=this._view.renderCoordsHelper.fromRenderCoords(a,t);return(0,p.Wi)(n)?null:new L.G(a,n)}_updateAll(){this._visible&&(this._updateVertexManipulators(),this._updateLaserLine())}_createVertexManipulator(){const e=(0,P.aD)(this._view,this._style.handleColor,this._style.handleOpacity);return e.radius=this._style.handleRadius,this._manipulators.add(e),e}_removeVertexManipulator(e){this._manipulators.remove(e)}_updateVertexManipulators(){const{viewData:e}=this._analysisViewData,t=this._analysisViewData.path?this._analysisViewData.path.vertices:[],i=this.vertexManipulators;(function(e,t,i,s){for(;e.length<t;)e.push(i());if(s)for(;e.length>t;)s(e.pop());else e.length=t})(i,t.length,(()=>this._createVertexManipulator()),(e=>this._removeVertexManipulator(e))),i.forEach(((i,s)=>{i.metadata=t[s],i.renderLocation=e.positionsRenderCoords[s],i.cursor=0===s&&"drawing"===this._toolState.polygonState?"crosshair":null})),"drawing"===this._toolState.polygonState&&(0,p.pC)(this._analysisViewData.cursorPoint)?(this._cursorManipulator.available=!0,this._cursorManipulator.location=this._analysisViewData.cursorPoint):this._cursorManipulator.available=!1}_getFocusPoint(){const{lastDraggedVertex:e}=this._analysisViewData;switch(this._toolState.polygonState){case"drawing":return(0,p.pC)(this._analysisViewData.cursorPoint)?this._analysisViewData.cursorPoint:(0,p.pC)(e)?this._analysisViewData.path.getVertexPositionAsPoint(e):(0,p.Wg)(this._analysisViewData.path.lastPoint);case"editing":return(0,p.pC)(e)?this._analysisViewData.path.getVertexPositionAsPoint(e):null;default:return this._analysisViewData.cursorPoint}}_updateLaserLine(){const e=this._style.laserLineEnabled&&"measured"!==this._toolState.polygonState&&this._toolState.active,t=this._getFocusPoint();if(e&&(0,p.pC)(t)){const e=this._tempHandlePosition;this._view.renderCoordsHelper.toRenderCoords(t,e),this._laserLine.heightManifoldTarget=e}else this._laserLine.heightManifoldTarget=null}_initializeListeners(){this._listenerHandles=new w.Z,this._listenerHandles.add([(0,y.YP)((()=>this._toolState.polygonState),(()=>this._updateLaserLine())),(0,y.YP)((()=>this._analysisViewData.viewData),(()=>this._updateAll()),y.Z_),(0,y.YP)((()=>({lastDraggedVertex:this._analysisViewData.lastDraggedVertex,cursorPoint:this._analysisViewData.cursorPoint})),(()=>this._updateLaserLine())),(0,y.YP)((()=>this._toolState.active),(()=>this._updateAll()))])}_destroyListeners(){this._listenerHandles=(0,p.SC)(this._listenerHandles)}}U._handleGeometry=(0,O.PI)(1,32,32);var T=i(86509),E=i(74229),W=i(72612);let $=class extends T.f{constructor(e){super(e),this._handles=new w.Z,this.polygonState="initial",this.analysisViewData=null}initialize(){const{view:e,analysisViewData:t,manipulators:i,visible:s}=this;this.measurementView=new U({view:e,analysisViewData:t,toolState:this,manipulators:i,visible:s}),this._setupManipulators(),this._handles.add((0,y.YP)((()=>this.state),(e=>{"measured"===e&&this.finishToolCreation()}),y.tX))}destroy(){this.measurementView.destroy(),this._set("measurementView",null),this._handles=(0,p.SC)(this._handles)}get state(){return 0===this.analysisViewData.path.numVertices?"ready":this.analysisViewData.validMeasurement&&"editing"!==this.polygonState?"measured":"measuring"}get cursor(){return"ready"===this.state||"drawing"===this.polygonState?"crosshair":null}finishMeasurement(){const{path:e}=this.analysisViewData;e.numVertices<3?(e.clear(),this.polygonState="initial"):(e.close(),this.polygonState="measured"),this.analysisViewData.cursorPoint=null}onShow(){this.measurementView.show()}onHide(){this.measurementView.hide()}onInputEvent(e){switch(e.type){case"immediate-double-click":this._handleImmediateDoubleClick(e);break;case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"drag":this._handleDrag(e);break;case"key-down":this._handleKeyDown(e)}}_setupManipulators(){const e=e=>e.events.on("grab-changed",(()=>{if(this.analysisViewData.validMeasurement){const e=this.manipulators.some((e=>e.manipulator.grabbing));this.polygonState=e?"editing":"measured"}})),t=t=>{this._handles.add([(0,E.Xd)(t,((e,t,i)=>{const s=(0,V.J4)(e),a=(0,p.Wg)(e.metadata);t.next(s).next((0,V.gv)(this.view)).next((t=>{e.location=t.mapEnd,this.analysisViewData.path.setVertexPosition(a,(0,v.WG)(t.mapEnd))}));const n=(0,v.WG)(this.analysisViewData.path.getVertexPositionAsPoint(a));i.next(s).next((()=>{this.analysisViewData.path.setVertexPosition(a,n),e.location=n}))})),e(t)],t)};this.manipulators.forEach((e=>{let{manipulator:i}=e;t(i)})),this._handles.add([this.manipulators.on("after-add",(e=>{let{item:{manipulator:i}}=e;t(i)})),this.manipulators.on("after-remove",(e=>{let{item:{manipulator:t}}=e;return this._handles.remove(t)}))])}_handleImmediateDoubleClick(e){(0,b.y1)(e)&&("drawing"===this.polygonState&&this.finishMeasurement(),e.stopPropagation())}_handleDrag(e){"editing"===this.polygonState&&e.stopPropagation()}_handleImmediateClick(e){if(!(0,b.y1)(e))return;const t=(0,W.vT)(e);if(this.active)switch(this.polygonState){case"initial":if(this._addVertexAt(t))return this.analysisViewData.cursorPoint=null,this.polygonState="drawing",void e.stopPropagation();break;case"drawing":{const i=this.measurementView.vertexHandleAt(t,e.pointerType);if((0,p.Wi)(i)){if(this._addVertexAt(t))return this.analysisViewData.cursorPoint=null,void e.stopPropagation()}else 0===i.index&&(this.finishMeasurement(),e.stopPropagation());break}}"mouse"===e.pointerType&&this._hoverAt(t)}_handlePointerMove(e){if("mouse"===e.pointerType){const t=(0,W.vT)(e);this._hoverAt(t)}}_handleKeyDown(e){"Enter"===e.key&&"drawing"===this.polygonState&&(this.finishMeasurement(),e.stopPropagation())}_hoverAt(e){if(!this.active||"initial"!==this.polygonState&&"drawing"!==this.polygonState)this.analysisViewData.cursorPoint=null;else{const t=this._pick(e);(0,p.pC)(t)&&(this.analysisViewData.cursorPoint=t.mapPoint)}}_addVertexAt(e){const t=this._pick(e);return!(!(0,p.pC)(t)||!(0,p.pC)(t.mapPoint))&&(this.analysisViewData.path.add(t.mapPoint),!0)}_pick(e){const t=new L.e(e);return this.measurementView.pick(t)}};(0,s._)([(0,l.Cb)({readOnly:!0})],$.prototype,"state",null),(0,s._)([(0,l.Cb)()],$.prototype,"polygonState",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],$.prototype,"cursor",null),(0,s._)([(0,l.Cb)()],$.prototype,"measurementView",void 0),(0,s._)([(0,l.Cb)({constructOnly:!0})],$.prototype,"view",void 0),(0,s._)([(0,l.Cb)()],$.prototype,"analysis",void 0),(0,s._)([(0,l.Cb)({constructOnly:!0})],$.prototype,"analysisViewData",void 0),$=(0,s._)([(0,o.j)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],$);const H=$;var R=i(40085);let G=class extends R.O{constructor(e){super(e),this.analysis=null,this.supportedViewType="3d",this.unsupportedErrorMessage="AreaMeasurement3DViewModel is only supported in 3D views.",this._userUnitOptions=null,this._userUnit=null}initialize(){this.addHandles((0,y.YP)((()=>({analysis:this.analysis,unit:this.unit})),(e=>{let{analysis:t,unit:i}=e;(0,p.pC)(t)&&(t.unit=i)}),y.tX))}get state(){return this.disabled||!this.ready?"disabled":(0,p.Wi)(this.tool)?"ready":this.tool.state}get measurement(){if((0,p.Wi)(this.tool)||this.disabled||this.tool.destroyed)return null;const{analysisView:e}=this;if((0,p.Wi)(e))return null;const t=e.analysisVisualization,i=t.viewData,s=i.measurementData,a=e.validMeasurement,n="euclidean"===i.mode,l=0===(n?s.intersectingSegments:s.geodesicIntersectingSegments).size,r=l?a?"available":"unavailable":"invalid";return{mode:n?"euclidean":"geodesic",area:{text:l&&a?t.areaLabel:null,state:r},perimeterLength:{text:l&&a?t.perimeterLengthLabel:null,state:r}}}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null}get unit(){return(0,p.pC)(this._userUnit)?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}constructAnalysis(){return new m}constructTool(){return new H({view:(0,p.Wg)(this.view),analysis:this.analysis,analysisViewData:(0,p.Wg)(this.analysisView),visible:this.visible})}_findSelectableUnit(e,t){const{unitOptions:i}=this;return i.includes(e)?e:(0,p.pC)(t)?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){if((0,p.Wi)(e))return n.fN.slice();const t=e.filter((e=>n.fN.includes(e)));return 0===t.length?n.fN.slice():t}};(0,s._)([(0,l.Cb)({type:m})],G.prototype,"analysis",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],G.prototype,"state",null),(0,s._)([(0,l.Cb)({readOnly:!0})],G.prototype,"measurement",null),(0,s._)([(0,l.Cb)()],G.prototype,"unitOptions",null),(0,s._)([(0,l.Cb)()],G.prototype,"unit",null),(0,s._)([(0,l.Cb)(g.Y)],G.prototype,"defaultUnit",void 0),(0,s._)([(0,l.Cb)()],G.prototype,"_userUnit",void 0),G=(0,s._)([(0,o.j)("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],G);const Z=G;var z=i(78088),F=i(80532),N=i(67005);i(80975);const Y="esri-area-measurement-3d",B={buttonDisabled:"esri-button--disabled",base:`${Y} esri-widget esri-widget--panel`,container:`${Y}__container`,hint:`${Y}__hint`,hintText:`${Y}__hint-text`,panelError:`${Y}__panel--error`,measurement:`${Y}__measurement`,measurementItem:`${Y}__measurement-item`,measurementItemDisabled:`${Y}__measurement-item--disabled`,measurementItemTitle:`${Y}__measurement-item-title`,measurementItemValue:`${Y}__measurement-item-value`,settings:`${Y}__settings`,units:`${Y}__units`,unitsLabel:`${Y}__units-label`,unitsSelect:`${Y}__units-select esri-select`,unitsSelectWrapper:`${Y}__units-select-wrapper`,actionSection:`${Y}__actions`,newMeasurementButton:`${Y}__clear-button esri-button esri-button--primary`,widgetIcon:"esri-icon-measure-area"};let j=class extends u.Z{constructor(e,t){super(e,t),this.iconClass=B.widgetIcon,this.viewModel=new Z}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}get active(){return this.viewModel.active}get analysis(){return this.viewModel.analysis}set analysis(e){this.viewModel.analysis=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(e){this.viewModel.unitOptions=e}get unit(){return this.viewModel.unit}set unit(e){this.viewModel.unit=e}render(){const{messages:e,messagesUnits:t}=this,{supported:i,active:s,measurement:a,state:l,unit:r}=this.viewModel,o="disabled"===l,u="measuring"===l||"measured"===l,h=s&&"ready"===l?(0,N.u)("section",{key:"esri-area-measurement-3d__hint",class:B.hint},(0,N.u)("p",{class:B.hintText},e.hint)):null,d=i?null:(0,N.u)("section",{key:"esri-area-measurement-3d__unsupported",class:B.panelError},(0,N.u)("p",null,e.unsupported)),p=(t,i,s)=>{switch(i.state){case"available":return(0,N.u)("div",{key:`${s}-enabled`,class:B.measurementItem},(0,N.u)("span",{class:B.measurementItemTitle},t),(0,N.u)("span",{"aria-live":"polite",class:B.measurementItemValue},i.text));case"unavailable":return(0,N.u)("div",{key:`${s}-disabled`,class:this.classes(B.measurementItem,B.measurementItemDisabled)},(0,N.u)("span",{class:B.measurementItemTitle},t));case"invalid":return(0,N.u)("div",{key:`${s}-enabled`,class:B.measurementItem},(0,N.u)("span",{class:B.measurementItemTitle},t),(0,N.u)("span",{class:B.measurementItemValue},e.notApplicable))}},_=u?(0,N.u)("section",{key:"esri-area-measurement-3d__measurement",class:B.measurement},p(e.area,a.area,"area"),p(e.perimeterLength,a.perimeterLength,"perimeter-length")):null,c=`${this.id}__units`,m=(0,N.u)("label",{class:B.unitsLabel,for:c},e.unit),y=(0,N.u)("div",{class:B.unitsSelectWrapper},(0,N.u)("select",{class:B.unitsSelect,id:c,onchange:this._changeUnit,bind:this,value:r},this.viewModel.unitOptions.map((e=>(0,N.u)("option",{key:e,value:e},(0,n.ZO)(e)?t.systems[e]:t.units[e]?.pluralCapitalized))))),g=u?(0,N.u)("section",{key:"esri-area-measurement-3d__units",class:B.units},m,y):null,w=u?(0,N.u)("div",{key:"settings",class:B.settings},g):null,v=!i||s&&!u?null:(0,N.u)("div",{class:B.actionSection},(0,N.u)("button",{bind:this,class:this.classes(B.newMeasurementButton,o&&B.buttonDisabled),disabled:o,onclick:this._newMeasurement,type:"button"},e.newMeasurement)),b=this.visible?(0,N.u)("div",{class:B.container},d,h,w,_,v):null;return(0,N.u)("div",{"aria-label":e.widgetLabel,key:this,class:B.base,role:"presentation"},b)}_newMeasurement(){(0,a.R8)(this.viewModel.start())}_changeUnit(e){const t=e.target,i=t.options[t.selectedIndex];i&&(this.unit=i.value)}};(0,s._)([(0,l.Cb)()],j.prototype,"view",null),(0,s._)([(0,l.Cb)()],j.prototype,"visible",null),(0,s._)([(0,l.Cb)()],j.prototype,"active",null),(0,s._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],j.prototype,"analysis",null),(0,s._)([(0,l.Cb)()],j.prototype,"iconClass",void 0),(0,s._)([(0,l.Cb)()],j.prototype,"label",null),(0,s._)([(0,l.Cb)(),(0,F.H)("esri/widgets/AreaMeasurement3D/t9n/AreaMeasurement3D")],j.prototype,"messages",void 0),(0,s._)([(0,l.Cb)(),(0,F.H)("esri/core/t9n/Units")],j.prototype,"messagesUnits",void 0),(0,s._)([(0,l.Cb)()],j.prototype,"uiStrings",void 0),(0,s._)([(0,l.Cb)({type:Z})],j.prototype,"viewModel",void 0),(0,s._)([(0,l.Cb)()],j.prototype,"unitOptions",null),(0,s._)([(0,l.Cb)()],j.prototype,"unit",null),(0,s._)([(0,z.h)()],j.prototype,"_newMeasurement",null),(0,s._)([(0,z.h)()],j.prototype,"_changeUnit",null),j=(0,s._)([(0,o.j)("esri.widgets.AreaMeasurement3D")],j);const X=j}}]);
//# sourceMappingURL=6211.703910b9.chunk.js.map