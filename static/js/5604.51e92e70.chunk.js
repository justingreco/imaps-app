"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[5604],{42137:(e,t,i)=>{i.d(t,{Z:()=>y});var o,n=i(27366),r=i(68860),s=i(49861),a=(i(63780),i(25243),i(69912)),p=i(585),c=i(80885),l=i(92183),h=i(15559),d=i(81753),u=i(89093);let g=o=class extends c.Z{constructor(){super(...arguments),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e&&e.center)i=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return{...super.normalizeCtorArgs(),...i,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,0!==this.rings.length||!e)return;const i=(0,r.En)(this.radius,this.radiusUnit,"meters"),o=e.spatialReference;let n,s="geographic";if(o.isWebMercator?s="webMercator":(null!=(o.wkid&&u.Z[o.wkid])||o.wkt&&0===o.wkt.indexOf("PROJCS"))&&(s="projected"),this.geodesic){let o;switch(s){case"webMercator":o=(0,d.Sx)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":o=e}n=this._createGeodesicCircle(o,i,t),"webMercator"===s&&(n=(0,d.$)(n))}else{let o;"webMercator"===s||"projected"===s?o=i/this._convert2Meters(1,e.spatialReference):"geographic"===s&&(o=(0,r.ty)(i,"meters",(0,l.Iu)(e.spatialReference).radius)),n=this._createPlanarCircle(e,o,t)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:n,geodesic:r}=this;return new o({center:e?.clone(),numberOfPoints:t,radius:i,radiusUnit:n,geodesic:r})}_createGeodesicCircle(e,t,i){let o=0;const n=[];for(;o<360;){const r=[0,0],s=[e.x,e.y];(0,h.TB)(r,s,o,t),this.hasZ&&r.push(e.z),n.push(r),o+=360/i}return n.push(n[0]),new c.Z(n)}_createPlanarCircle(e,t,i){const o=[],n=2*Math.PI/i;for(let r=0;r<i;++r){const i=n*r,s=[e.x+Math.cos(-i)*t,e.y+Math.sin(-i)*t];this.hasZ&&s.push(e.z),o.push(s)}return o.push(o[0]),new c.Z({spatialReference:e.spatialReference,rings:[o]})}_convert2Meters(e,t){let i;if(t.wkid&&null!=u.Z[t.wkid])i=u.Z.values[u.Z[t.wkid]];else{const e=t.wkt,o=e.lastIndexOf(",")+1,n=e.lastIndexOf("]]");i=parseFloat(e.substring(o,n))}return e*i}};(0,n._)([(0,s.Cb)({type:p.Z})],g.prototype,"center",void 0),(0,n._)([(0,s.Cb)()],g.prototype,"geodesic",void 0),(0,n._)([(0,s.Cb)()],g.prototype,"numberOfPoints",void 0),(0,n._)([(0,s.Cb)()],g.prototype,"radius",void 0),(0,n._)([(0,s.Cb)()],g.prototype,"radiusUnit",void 0),g=o=(0,n._)([(0,a.j)("esri.geometry.Circle")],g);const y=g},40237:(e,t,i)=>{i.d(t,{N:()=>o});const o={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,i){const o=new n(e.getPointX(t),e.getPointY(t),i),r=e.hasZ(t),s=e.hasM(t);return r&&(o.z=e.getPointZ(t)),s&&(o.m=e.getPointM(t)),o},exportPolygon:function(e,t,i){return new r(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,i){return new s(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,i){return new a(e.exportPoints(t),i,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,i){const o=e.hasZ(t),n=e.hasM(t),r=new p(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),i);if(o){const i=e.getZExtent(t);r.zmin=i.vmin,r.zmax=i.vmax}if(n){const i=e.getMExtent(t);r.mmin=i.vmin,r.mmax=i.vmax}return r}};class n{constructor(e,t,i){this.x=e,this.y=t,this.spatialReference=i,this.z=void 0,this.m=void 0}}class r{constructor(e,t,i,o){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),o&&(this.hasM=o)}}class s{constructor(e,t,i,o){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),o&&(this.hasM=o)}}class a{constructor(e,t,i,o){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),o&&(this.hasM=o)}}class p{constructor(e,t,i,o,n){this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=o,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},19995:(e,t,i)=>{i.d(t,{_W:()=>d,iV:()=>y,oj:()=>m});var o=i(92026),n=i(79803),r=i(40237),s=i(92975),a=i(81753);const p=[0,0];function c(e,t){if(!t)return null;if("x"in t){const i={x:0,y:0};return[i.x,i.y]=e(t.x,t.y,p),null!=t.z&&(i.z=t.z),null!=t.m&&(i.m=t.m),i}if("xmin"in t){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,p),[i.xmax,i.ymax]=e(t.xmax,t.ymax,p),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:l(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:l(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:h(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function l(e,t){const i=[];for(const o of e)i.push(h(o,t));return i}function h(e,t){const i=[];for(const o of e){const e=t(o[0],o[1],[0,0]);i.push(e),o.length>2&&e.push(o[2]),o.length>3&&e.push(o[3])}return i}async function d(e,t){if(!e||!t)return;const i=Array.isArray(e)?e.map((e=>(0,o.pC)(e.geometry)?e.geometry.spatialReference:null)).filter(o.pC):[e];await(0,n.iQ)(i.map((e=>({source:e,dest:t}))))}const u=c.bind(null,a.hG),g=c.bind(null,a.R6);function y(e,t,i,o){if(!e)return e;if(i||(i=t,t=e.spatialReference),!(0,s.JY)(t)||!(0,s.JY)(i)||(0,s.fS)(t,i))return e;if((0,a.Q8)(t,i)){const t=(0,s.sS)(i)?u(e):g(e);return t.spatialReference=i,t}return(0,n.oj)(r.N,[e],t,i,null,o)[0]}const v=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,i){if(!e||!e.length||!t||!i||(0,s.fS)(t,i))return e;const o={geometries:e,inSpatialReference:t,outSpatialReference:i,resolve:null};return this._jobs.push(o),new Promise((e=>{o.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:i,outSpatialReference:o,resolve:p}=e;(0,a.Q8)(i,o)?(0,s.sS)(o)?p(t.map(u)):p(t.map(g)):p((0,n.oj)(r.N,t,i,o,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function m(e,t,i){return v.push(e,t,i)}},77498:(e,t,i)=>{i.d(t,{Z:()=>n,e:()=>o});var o;i(93169);function n(e){switch(e){case o.SUPPORTED:break;case o.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case o.GEOMETRY_MISSING:return"no geometry";case o.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case o.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case o.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}!function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(o||(o={}))},57889:(e,t,i)=>{i.d(t,{P:()=>s});i(93169);var o=i(92026),n=i(74509),r=i(77498);function s(e){if("graphics"!==e.layer?.type)return r.e.GRAPHICS_LAYER_MISSING;if((0,o.Wi)(e.geometry))return r.e.GEOMETRY_MISSING;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return r.e.GEOMETRY_TYPE_UNSUPPORTED}return"on-the-ground"!==(0,n.vu)(e)&&(0,n.Lt)(e)?r.e.ELEVATION_MODE_UNSUPPORTED:r.e.SUPPORTED}},46684:(e,t,i)=>{i.d(t,{P:()=>a,b:()=>p});var o=i(92026),n=i(42137),r=i(74509),s=i(77498);function a(e){return c(e).result}function p(e){return c(e).geometry}function c(e){return"graphics"!==e.layer?.type?{result:s.e.GRAPHICS_LAYER_MISSING,geometry:null}:(0,o.Wi)(e.geometry)?{result:s.e.GEOMETRY_MISSING,geometry:null}:"on-the-ground"!==(0,r.vu)(e)&&(0,r.Lt)(e)?{result:s.e.ELEVATION_MODE_UNSUPPORTED,geometry:null}:"point"!==e.geometry.type&&"polyline"!==e.geometry.type&&("polygon"!==e.geometry.type||e.geometry instanceof n.Z)?{result:s.e.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:s.e.SUPPORTED,geometry:e.geometry}}},83089:(e,t,i)=>{i.d(t,{j:()=>r,p:()=>n});var o=i(92026);function n(e,t,i){if(!t||!e||!e.map)return;const{map:o}=e,n=o.layers.find((e=>e===t));n||o.add(t,i),null!=i&&o.layers.reorder(n,i)}function r(e,t){return e.allLayerViews.find((e=>{const i=e.layer;return i===t||"sublayers"in i&&(0,o.pC)(i.sublayers)&&i.sublayers.includes(t)}))}},95122:(e,t,i)=>{i.d(t,{Bq:()=>v,Hk:()=>u,M8:()=>b,UL:()=>f,aU:()=>E,jg:()=>w,ku:()=>y});var o=i(92026),n=i(88396),r=i(6394),s=i(11186),a=i(71353),p=i(76014),c=i(64674),l=i(55793),h=i(94163);class d{constructor(e){this.coordinateHelper=e}intersect(e){return function(e,t){let i=[];if(C(e)){const{pointXYZ:o}=e;P(t)?i=(0,l.pk)(t.lineLike,o):G(t)?i=(0,l.l0)(t.centerXYZ,t.radius,o):O(t)?i=(0,l.hm)(t.planeLike,o):x(t)&&(i=T(t,e))}else if(P(e)){const{lineLike:o}=e;C(t)?i=(0,l.pk)(o,t.pointXYZ):P(t)?i=(0,l.Lh)(o,t.lineLike):G(t)?i=(0,l.UG)(o,t.centerXYZ,t.radius):O(t)?i=(0,l.fK)(t.planeLike,o):x(t)&&(i=T(t,e))}else if(G(e)){const{centerXYZ:o,radius:n}=e;P(t)?i=(0,l.UG)(t.lineLike,o,n):C(t)?i=(0,l.l0)(o,n,t.pointXYZ):O(t)?i=(0,l._w)(t.planeLike,o,n):x(t)&&(i=T(t,e))}else if(O(e)){const{planeLike:o,coordinateHelper:n}=e;if(O(t))return(0,l.qi)(o,t.planeLike).map((i=>new m(n,n.fromXYZ(i),e,t)));C(t)?i=(0,l.hm)(o,t.pointXYZ):P(t)?i=(0,l.fK)(o,t.lineLike):G(t)?i=(0,l._w)(o,t.centerXYZ,t.radius):x(t)&&(i=T(t,e))}else x(e)&&(i=T(e,t));return function(e,t,i){const o=t.coordinateHelper;return e.map((e=>new v(o,o.fromXYZ(e),t,i)))}(i,e,t)}(this,e)}}class u extends d{constructor(e,t){super(e),this.point=t,this.pointXYZ=e.toXYZ(t)}equals(e){return C(e)&&(0,c.Xv)(this.point,e.point)}check(e){const t=this.coordinateHelper.toXYZ(e,R);return(0,s.d)(t,this.pointXYZ)<p.c.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}}class g extends d{constructor(e,t,i,o){super(e),this.start=t,this.end=i,this.type=o,this.startXYZ=e.toXYZ(t),this.endXYZ=e.toXYZ(i),this.lineLike={start:this.startXYZ,end:this.endXYZ,type:this.type}}equals(e){return P(e)&&this.type===e.type&&(0,c.Xv)(this.start,e.start)&&(0,c.Xv)(this.end,e.end)}check(e){const t=this.coordinateHelper.toXYZ(e,R);return(0,l.Mm)(this.lineLike,t)<p.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper,i=t.toXYZ(e,R),o=(0,l.ZE)(i,this.lineLike);return t.fromXYZ(o)}}class y extends g{constructor(e,t,i){super(e,t,i,h.SP.LINE)}}class v extends d{constructor(e,t,i,o){super(e),this.intersection=t,this.first=i,this.second=o}equals(e){return e instanceof v&&this.first.equals(e.first)&&this.second.equals(e.second)}check(){return!1}closestTo(){return this.coordinateHelper.clone(this.intersection)}}class m extends d{constructor(e,t,i,o){super(e),this.basePoint=t,this.first=i,this.second=o}equals(e){return e instanceof m&&this.first.equals(e.first)&&this.second.equals(e.second)}check(){return!1}closestTo(e){const t=this.basePoint,i=this.coordinateHelper,o=i.toXYZ(e,R),n=(0,s.s)(A,t[0],t[1],o[2]);return i.fromXYZ(n)}}class f extends d{constructor(e,t,i){super(e),this.center=t,this.radius=i,this.centerXYZ=e.toXYZ(t)}equals(e){return G(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper,i=t.toXYZ(e,R),o=(0,l.xO)(i,this.centerXYZ,this.radius);return o[2]=t.getZ(e,this.centerXYZ[2]),t.fromXYZ(o)}}class _ extends d{constructor(e,t,i,o){super(e),this.start=t,this.end=i,this.type=o,this.planeLike={start:t,end:i,type:o}}equals(e){return O(e)&&this.type===e.type&&(0,c.Xv)(this.start,e.start)&&(0,c.Xv)(this.end,e.end)}check(e){const t=this.coordinateHelper.toXYZ(e,R);return(0,l.xb)(t,this.planeLike)<p.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper,i=t.toXYZ(e,R),o=(0,l.z9)(i,this.planeLike);return t.fromXYZ(o)}closestEndTo(e){const{start:t,end:i}=this;return Math.sign((0,n.h)((0,n.a)(M,i,t),(0,n.a)(I,e,t)))>0?i:t}}class E extends _{constructor(e,t,i){super(e,t,i,l.Jk.HALF_PLANE)}}class w extends _{constructor(e,t,i){super(e,t,i,l.Jk.PLANE)}}class b extends d{constructor(e,t,i,o){super(e),this.start=t,this.end=i,this.getZ=o,this.planeLike={start:t,end:i,type:l.Jk.HALF_PLANE}}equals(e){return x(e)&&(0,c.Xv)(this.start,e.start)&&(0,c.Xv)(this.end,e.end)&&this.getZ===e.getZ}check(e){const t=this.coordinateHelper.toXYZ(e,R),i=S(this,t);return(0,s.d)(t,i)<p.c.pointThreshold}closestTo(e){const t=this.coordinateHelper,i=S(this,t.toXYZ(e,R));return t.fromXYZ(i)}addIfOnTheGround(e,t){for(const i of t){const t=this.getZ(i[0],i[1],i[2]);(0,o.pC)(t)&&Math.abs(i[2]-t)<l.Ho&&(i[2]=t,e.push(i))}}}function S(e,t){const i=(0,l.z9)(t,e.planeLike),n=e.getZ(t[0],t[1],t[2]);return(0,o.pC)(n)&&(i[2]=n),i}function T(e,t){const{planeLike:i,getZ:n}=e,r=[];if(C(t))e.addIfOnTheGround(r,(0,l.hm)(i,t.pointXYZ));else if(P(t))e.addIfOnTheGround(r,(0,l.fK)(i,t.lineLike));else if(G(t))e.addIfOnTheGround(r,(0,l._w)(i,t.centerXYZ,t.radius));else if(O(t)||x(t))for(const[s,p]of(0,l.qi)(i,t.planeLike)){const e=n(s,p,0);(0,o.pC)(e)&&r.push((0,a.f)(s,p,e))}return r}function C(e){return e instanceof u}function P(e){return e instanceof g}function G(e){return e instanceof f}function O(e){return e instanceof _}function x(e){return e instanceof b}const R=(0,a.c)(),A=(0,a.c)(),M=(0,r.a)(),I=(0,r.a)()},95905:(e,t,i)=>{i.d(t,{L:()=>a});var o=i(95122),n=i(64674),r=i(75691),s=i(53397);class a extends r.a{constructor(e){super({...e,constraint:new o.ku(e.coordinateHelper,e.edgeStart,e.edgeEnd)})}get hints(){return[new s.w(n.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}}},75691:(e,t,i)=>{i.d(t,{a:()=>r});var o=i(80371),n=i(92605);class r extends n.j{constructor(e){let{coordinateHelper:t,targetPoint:i,objectId:n,constraint:r,elevationInfo:s}=e;super(t,i,r,s,o.B.FEATURE),this.objectId=n}}},92605:(e,t,i)=>{i.d(t,{j:()=>o});class o{constructor(e,t,i,o,n){this.coordinateHelper=e,this.targetPoint=t,this.constraint=i,this.elevationInfo=o,this.domain=n}}},11208:(e,t,i)=>{i.d(t,{$r:()=>p,By:()=>d,RS:()=>c,Rs:()=>h,a7:()=>l});var o=i(17842),n=(i(88396),i(11186)),r=i(71353),s=i(585),a=i(74509);function p(e,t,i,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,r.c)();const s=t.toXYZ(e);return s[2]=(0,a.zx)(o,s,t.spatialReference,i)||0,o.renderCoordsHelper.toRenderCoords(s,t.spatialReference,n),n}function c(e,t,i,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,r.c)();const p=(0,n.c)(g,e);return p[2]=(0,a.zx)(o,p,t,i)||0,o.renderCoordsHelper.toRenderCoords(p,t,s),s}function l(e,t,i,o){return h(t.toXYZ(e),t.spatialReference,i,o)}function h(e,t,i,n){return"2d"===n.type?(u.x=e[0],u.y=e[1],u.spatialReference=t,n.toScreen(u)):(c(e,t,i,n,g),n.state.camera.projectToScreen(g,y),(0,o.vW)(y[0],y[1]))}function d(e,t,i,o,n,r,s){if("absolute-height"===o.mode)return p(e,i,o,n,r),void p(t,i,o,n,s);const c=i.toXYZ(e),l=i.toXYZ(t),h=(0,a.zx)(n,c,i.spatialReference,o),d=(0,a.zx)(n,l,i.spatialReference,o),u=(null==h?d:null==d?h:Math.min(h,d))||0;c[2]=u,l[2]=u,n.renderCoordsHelper.toRenderCoords(c,i.spatialReference,r),n.renderCoordsHelper.toRenderCoords(l,i.spatialReference,s)}const u=new s.Z,g=(0,r.c)(),y=((0,o.J$)(),(0,o.J$)(),(0,o.s1)())},55793:(e,t,i)=>{i.d(t,{Ho:()=>C,Jk:()=>o,Lh:()=>E,Mm:()=>f,UG:()=>_,ZE:()=>m,_w:()=>l,fK:()=>h,hm:()=>d,l0:()=>b,pk:()=>w,qi:()=>u,xO:()=>v,xb:()=>y,z9:()=>g});var o,n=i(16889),r=i(88396),s=i(6394),a=i(11186),p=i(71353),c=i(94163);function l(e,t,i){let{start:n,end:s,type:a}=e;const c=[],l=t,h=(0,r.a)(P,s,n),d=(0,r.a)(G,n,l),u=(0,r.v)(h),g=2*(0,r.h)(h,d),y=g*g-4*u*((0,r.v)(d)-i*i);if(0===y){const e=-g/(2*u);(a===o.PLANE||e>=0)&&c.push((0,r.w)((0,p.f)(0,0,t[2]),n,h,e))}else if(y>0){const e=Math.sqrt(y),i=(-g+e)/(2*u);(a===o.PLANE||i>=0)&&c.push((0,r.w)((0,p.f)(0,0,t[2]),n,h,i));const s=(-g-e)/(2*u);(a===o.PLANE||s>=0)&&c.push((0,r.w)((0,p.f)(0,0,t[2]),n,h,s))}return c}function h(e,t){const i=e.start,n=e.end,s=(0,r.a)(P,n,i),l=(0,a.s)(G,-s[1],s[0],0),h=t.start,d=t.end,u=(0,a.y)(O,d,h),g=(0,a.e)(u,l),y=(0,a.s)(x,i[0],i[1],0),v=(0,a.y)(R,y,h),m=(0,a.e)(v,l);if(Math.abs(g)<C)return Math.abs(m),[];const f=(0,a.z)(A,h,u,m/g);if(t.type===c.SP.RAY){const e=(0,a.y)(M,f,h);if((0,a.e)(e,u)<-C)return[]}if(e.type===o.HALF_PLANE){const e=(0,r.e)(M,f,i);if((0,r.h)(e,s)<-C)return[]}return[(0,p.a)(f)]}function d(e,t){return w(S(I,t[2],e),t)}function u(e,t){const i=E(S(I,0,e),S(H,0,t)),o=[];for(const n of i)o.push((0,s.d)(n));return o}function g(e,t){return m(e,S(I,e[2],t))}function y(e,t){return f(S(I,e[2],t),e)}function v(e,t,i){const o=(0,a.s)(P,e[0],e[1],t[2]),n=(0,a.b)(G,o,t),r=i/(0,a.l)(n);return(0,a.z)((0,p.c)(),t,n,r)}function m(e,t){let{start:i,end:o,type:n}=t;const r=(0,a.y)(P,e,i),s=(0,a.y)(G,o,i),l=(0,a.e)(r,s)/(0,a.e)(s,s);return(0,a.z)((0,p.c)(),i,s,n===c.SP.RAY?Math.max(l,0):l)}function f(e,t){let{start:i,end:o,type:n}=e;const r=(0,a.y)(P,t,i),s=(0,a.y)(G,o,i);if(n===c.SP.RAY&&(0,a.e)(s,r)<-C)return(0,a.i)(i,t);const p=(0,a.f)(O,s,r);return(0,a.u)(p)/(0,a.u)(s)}function _(e,t,i){let{start:o,end:s,type:l}=e;const h=[];if((0,n.W8)(o[2],t[2],C)&&(0,n.W8)(s[2],t[2],C)){const e=o,n=t,a=(0,r.a)(P,s,e),d=(0,r.a)(G,e,n),u=(0,r.v)(a),g=2*(0,r.h)(a,d),y=g*g-4*u*((0,r.v)(d)-i*i);if(0===y){const i=-g/(2*u);(l===c.SP.LINE||i>=0)&&h.push((0,r.w)((0,p.f)(0,0,t[2]),e,a,i))}else if(y>0){const i=Math.sqrt(y),o=(-g+i)/(2*u);(l===c.SP.LINE||o>=0)&&h.push((0,r.w)((0,p.f)(0,0,t[2]),e,a,o));const n=(-g-i)/(2*u);(l===c.SP.LINE||n>=0)&&h.push((0,r.w)((0,p.f)(0,0,t[2]),e,a,n))}}else{const e=(0,a.y)(P,s,o);if((0,n.W8)(e[2],0,C))return h;const r=(t[2]-o[2])/e[2],p=(0,a.z)(G,o,e,r);if(l===c.SP.RAY){const t=(0,a.y)(O,p,o);if((0,a.e)(e,t)<-C)return h}for(const o of b(t,i,p))h.push(o)}return h}function E(e,t){const i=e.start,o=e.end,r=t.start,s=t.end,l=(0,a.y)(P,o,i),h=(0,a.y)(G,s,r),d=(0,a.y)(O,r,i),u=(0,a.f)(x,l,h),g=(0,a.e)(d,u);if(!(0,n.W8)(g,0,C))return[];const y=(0,a.D)(u);if((0,n.W8)(y,0,C))return[];const v=(0,a.f)(R,d,h),m=(0,a.e)(v,u)/y,f=(0,a.z)(A,i,l,m);if(e.type===c.SP.RAY){const e=(0,a.y)(M,f,i);if((0,a.e)(l,e)<-C)return[]}if(t.type===c.SP.RAY){const e=(0,a.y)(M,f,r);if((0,a.e)(h,e)<-C)return[]}return[(0,p.a)(f)]}function w(e,t){let{start:i,end:o,type:n}=e;const r=(0,a.y)(P,t,i),s=(0,a.y)(G,o,i),l=(0,a.f)(O,s,r);if((0,a.D)(l)/(0,a.D)(s)<C)switch(n){case c.SP.LINE:return[(0,p.a)(t)];case c.SP.RAY:return(0,a.e)(s,r)<-C?[]:[(0,p.a)(t)]}return[]}function b(e,t,i){return(0,n.W8)(e[2],i[2],C)&&(0,n.W8)((0,a.d)(i,e),t*t,C)?[(0,p.a)(i)]:[]}function S(e,t,i){let{start:o,end:n,type:r}=i;return(0,a.s)(e.start,o[0],o[1],t),(0,a.s)(e.end,n[0],n[1],t),e.type=T[r],e}!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(o||(o={}));const T={[o.PLANE]:c.SP.LINE,[o.HALF_PLANE]:c.SP.RAY},C=1e-6,P=(0,p.c)(),G=(0,p.c)(),O=(0,p.c)(),x=(0,p.c)(),R=(0,p.c)(),A=(0,p.c)(),M=(0,p.c)(),I={start:(0,p.c)(),end:(0,p.c)(),type:c.SP.LINE},H={start:(0,p.c)(),end:(0,p.c)(),type:c.SP.LINE}},97426:(e,t,i)=>{i.d(t,{Z:()=>nt});var o=i(27366),n=i(51508),r=i(40281),s=(i(93169),i(10064)),a=i(91505),p=i(100),c=i(32718),l=i(92026),h=i(66978),d=i(94172),u=i(49861),g=(i(63780),i(25243),i(69912)),y=i(79803),v=i(92183),m=i(69662),f=i(92975),_=i(93655),E=i(77498),w=i(57889),b=i(46684),S=i(74509);var T,C=i(83089),P=i(1614),G=i(87888),O=i(52349),x=i(77560),R=i(41691),A=i(84652),M=i(80371),I=i(77427),H=i(88396),L=i(11186),k=i(71353),Z=i(92536),U=i(95122),D=i(64674),Y=i(95905),j=i(75691),V=i(92605),N=i(53397),F=i(41216);class X extends V.j{constructor(e){let{coordinateHelper:t,targetPoint:i,constraint:o,previousVertex:n,otherVertex:r,otherVertexType:s,objectId:a,elevationInfo:p}=e;super(t,i,o,p,M.B.SELF),this.previousVertex=n,this.otherVertex=r,this.otherVertexType=s,this.objectId=a}get hints(){const e=this.previousVertex,t=this.otherVertexType===T.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===T.CENTER?this.targetPoint:this.otherVertex,o=this.elevationInfo;return[new N.w(D.ze.TARGET,t,i,o,this.domain),new N.w(D.ze.REFERENCE,e,t,o,this.domain),new F.y(this.previousVertex,t,i,o,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(T||(T={}));var W=i(11208);let z=class extends R.r{constructor(e){super(e),this.options=null,this._domain=M.B.FEATURE,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}get updating(){return(0,I.oE)(this.snappingSources,(e=>{let{snappingSource:t}=e;return t.updating}))||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,t=new Map;if((0,l.pC)(this.options)&&(0,l.pC)(this.options.featureSources))for(const i of this.options.featureSources.items){const o=i.layer.uid,n=e.get(o);if(n){e.delete(o),t.set(o,n);continue}if(!i.layer.loaded){this.updatingHandles.addPromise(i.layer.load());continue}const r=this._createSourceInfo(i);(0,l.pC)(r)&&t.set(o,r)}for(const[,i]of e)i.destroy();return t}initialize(){this.updatingHandles.add((()=>this.snappingSources),(()=>this.notifyChange("updating")),d.Z_),(0,l.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",(e=>this._updateLayerView(e.layer,e.layerView))),this.view.on("layerview-destroy",(e=>this._updateLayerView(e.layer,null)))])}_updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i,o){if(!(t&this._domain)||(0,l.Wi)(this.options)||!this.options.effectiveFeatureEnabled)return[];const n=[],r=this._computeScreeenSizeDistanceParameters(e,i),s={distance:r,point:e,coordinateHelper:i.coordinateHelper,types:this._types};for(const[,{snappingSource:p,layerView:c}]of this.snappingSources)!p.layerSource.enabled||(0,l.pC)(c)&&c.suspended||n.push(p.fetchCandidates(s,o).then((e=>e.filter((e=>!this._candidateIsExcluded(p,e,i.excludeFeature))))));const a=(await(0,h.WW)(n)).flat();return this._addRightAngleCandidates(a,e,r,i),(0,h.k_)(o),(0,D.lQ)(e,a,i.coordinateHelper),a}_addRightAngleCandidates(e,t,i,o){const n=(0,l.pC)(o.vertexHandle)?o.vertexHandle.rightEdge?.rightVertex?.pos:(0,l.pC)(o.editGeometryOperations)&&"polygon"===o.editGeometryOperations.data.type?(0,l.Wg)(o.editGeometryOperations.data.components[0]?.getFirstVertex())?.pos:null,r=(0,l.pC)(o.vertexHandle)?o.vertexHandle.leftEdge?.leftVertex?.pos:(0,l.pC)(o.editGeometryOperations)?(0,l.Wg)(o.editGeometryOperations.data.components[0]?.getLastVertex())?.pos:null,{view:s}=this,a=(0,D.Z_)(n,s,o),p=(0,D.Z_)(r,s,o),c=e.length;for(let l=0;l<c;l++)this._addRightAngleCandidate(e[l],p,t,i,o,e),this._addRightAngleCandidate(e[l],a,t,i,o,e)}_addRightAngleCandidate(e,t,i,o,n,r){const s=e instanceof Y.L,a=s&&(0,H.o)(e.constraint.start,e.constraint.end);if((0,l.Wi)(t)||!s||a)return;const p=e.constraint.closestTo(t),c=(p[0]-i[0])/o.x,h=(p[1]-i[1])/o.y;if(c*c+h*h<=1){const i=n.coordinateHelper,o=new X({coordinateHelper:i,targetPoint:p,otherVertex:t,otherVertexType:T.NEXT,previousVertex:e.constraint.start,constraint:new U.aU(i,t,p),objectId:e.objectId,elevationInfo:e.elevationInfo});r.push(o)}}_computeScreeenSizeDistanceParameters(e,t){let i=(0,l.pC)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return(0,l.Wi)(this.view)?{x:i,y:i,z:i,distance:i}:"2d"===this.view.type?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,o){const{coordinateHelper:n,elevationInfo:r}=o,{spatialReference:s}=n,a=n.hasZ()?S.jG:r,p=n.toXYZ(e,K);p[2]=(0,S.zx)(i,p,s,a,S.jG),i.renderCoordsHelper.toRenderCoords(p,s,J);const c=i.state.camera.computeScreenPixelSizeAt(J),l=c*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,h=t*l,d=(0,W.Rs)(p,s,S.jG,i),u=B(d,p,l,0,0,i,o),g=B(d,p,0,l,0,i,o),y=B(d,p,0,0,l,i,o);return{x:0===u?0:h/u,y:0===g?0:h/g,z:0===y?0:h/y,distance:c*t}}get _types(){return Z.r.EDGE|Z.r.VERTEX}_candidateIsExcluded(e,t,i){if((0,l.Wi)(i))return!1;const o=this._getCandidateObjectId(t);if((0,l.Wi)(o))return!1;const n=e.layerSource.layer;return"graphics"===n.type?i.uid===o:i.sourceLayer===n&&!(!i.attributes||!("objectIdField"in n))&&i.attributes[n.objectIdField]===o}_getCandidateObjectId(e){return e instanceof j.a?e.objectId:null}_createSourceInfo(e){const t=this._createFeatureSnappingSourceType(e);if((0,l.Wi)(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then((()=>{this.destroyed||this.notifyChange("snappingSources")}))),null;const i=(0,l.pC)(this.view)?this.view.allLayerViews.find((t=>t.layer===e.layer)):null;return new q(t.source,i)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}_createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;if((0,l.Wi)(t)||"3d"!==t.type)return null;const i=this._getSourceModule("scene");return(0,l.pC)(i.module)?{source:new i.module.SceneLayerSnappingSource({layerSource:e,view:t})}:{loading:i.loader}}_createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":case"oriented-imagery":{const t=this._getSourceModule("featureService");return(0,l.pC)(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===e.layer.geometryType)return null;const t=this._getSourceModule("featureCollection");return(0,l.pC)(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e,view:this.view})}:{loading:t.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const t=this._getSourceModule("graphics");return(0,l.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_createFeatureSnappingSourceMapNotesLayer(e){const t=this._getSourceModule("notes");return(0,l.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:()=>(0,l.pC)(e.layer.sublayers)?e.layer.sublayers.toArray():[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_getSourceModule(e){const t=this._sourceModules[e];if((0,l.Wi)(t.loader)){const i=this._loadSourceModule(e).then((e=>{t.module=e}));return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}_loadSourceModule(e){const t=this.updatingHandles;switch(e){case"featureService":return t.addPromise(Promise.all([i.e(5652),i.e(4134)]).then(i.bind(i,84134)));case"featureCollection":return t.addPromise(i.e(2137).then(i.bind(i,26823)));case"graphics":case"notes":return t.addPromise(Promise.all([i.e(4e3),i.e(8928),i.e(3518)]).then(i.bind(i,33518)));case"scene":return t.addPromise(Promise.all([i.e(5158),i.e(7814),i.e(9306)]).then(i.bind(i,34953)))}return null}};(0,o._)([(0,u.Cb)({constructOnly:!0})],z.prototype,"spatialReference",void 0),(0,o._)([(0,u.Cb)({constructOnly:!0})],z.prototype,"view",void 0),(0,o._)([(0,u.Cb)()],z.prototype,"options",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],z.prototype,"updating",null),(0,o._)([(0,u.Cb)({readOnly:!0})],z.prototype,"snappingSources",null),z=(0,o._)([(0,g.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],z);class q{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new p.Z;const i=this.snappingSource.layerSource.layer;if("refresh"in i){const t=i;this.handles.add(t.on("refresh",(()=>e.refresh())))}this.handles.add([(0,d.YP)((()=>e.updating),(t=>e.layerSource.updating=t),d.tX),(0,d.YP)((()=>e.availability),(t=>e.layerSource.availability=t),d.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}function B(e,t,i,o,n,r,s){let{coordinateHelper:a}=s;const p=(0,L.c)(Q,t);p[0]+=i,p[1]+=o,p[2]+=n;const c=(0,W.Rs)(p,a.spatialReference,S.jG,r);return(0,D.fG)(c,e)}const K=(0,k.c)(),J=(0,k.c)(),Q=(0,k.c)();var $=i(85015),ee=i(76014);class te{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=ee.c.shortLineThreshold*ee.c.shortLineThreshold}snap(e,t){return(0,l.pC)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}exceedsShortLineThreshold(e,t,i){let{elevationInfo:o,editGeometryOperations:n}=i;const r=n.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,D.Bb)((0,W.a7)(t,r,o,this.view),(0,W.a7)(e,r,o,this.view))>this.squaredShortLineThreshold}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class ie extends V.j{constructor(e){let{coordinateHelper:t,lineStart:i,lineEnd:o,targetPoint:n,elevationInfo:r}=e;super(t,n,new U.jg(t,i,o),r,M.B.SELF),this._referenceLineHint=new N.w(D.ze.REFERENCE_EXTENSION,i,o,r,this.domain)}get hints(){return[this._referenceLineHint,new N.w(D.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var oe=i(55793),ne=i(94163);class re extends te{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=i.edges.length,n=[];if(o<1)return n;const r=t.coordinateHelper,s=(0,W.a7)(e,r,S.jG,this.view),{view:a}=this,p=i.edges[o-1];let c=p;do{if(this.edgeExceedsShortLineThreshold(c,t)){const i=(0,D._j)(c,a,t);this._processCandidateProposal(i.left,i.right,e,s,t,n)}c=c.leftVertex.leftEdge}while(c&&c!==p);return n}snapExistingVertex(e,t){const i=[],o=(0,l.Wg)(t.vertexHandle),n=o.component;if(n.edges.length<2)return i;const{view:r}=this,{coordinateHelper:s}=t,a=(0,W.a7)(e,s,S.jG,r),p=o.leftEdge,c=o.rightEdge;p&&c&&this.edgeExceedsShortLineThreshold(p,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,D.Z_)(p.leftVertex.pos,r,t),(0,D.Z_)(c.rightVertex.pos,r,t),e,a,t,i);const h=n.edges[0];let d=h;do{if(d!==o.leftEdge&&d!==o.rightEdge&&this.edgeExceedsShortLineThreshold(d,t)){const o=(0,D._j)(d,r,t);this._processCandidateProposal(o.left,o.right,e,a,t,i)}d=d.rightVertex.rightEdge}while(d&&d!==h);return i}_processCandidateProposal(e,t,i,o,n,r){const{coordinateHelper:s,pointer:a}=n;s.toXYZ(e,se),s.toXYZ(t,ae);const p=s.toXYZ(i,ce),c=(0,oe.ZE)(p,pe),l=s.fromXYZ(c);(0,D.Bb)(o,(0,W.a7)(l,s,S.jG,this.view))<this.squaredProximityThreshold(a)&&r.push(new ie({coordinateHelper:s,lineStart:e,lineEnd:t,targetPoint:l,elevationInfo:s.hasZ()?S.jG:null}))}}const se=(0,k.c)(),ae=(0,k.c)(),pe={start:se,end:ae,type:ne.SP.LINE},ce=(0,k.c)();var le=i(6394),he=i(5916);class de extends V.j{constructor(e){let{coordinateHelper:t,referenceLine:i,lineStart:o,targetPoint:n,elevationInfo:r}=e;const s=t.toXYZ(o,ue),a=t.toXYZ(i.left,ge),p=t.toXYZ(i.right,ye);(0,L.b)(s,(0,L.a)(s,s,p),a),super(t,n,new U.jg(t,o,t.fromXYZ(s)),r,M.B.SELF),this._referenceLines=[{edge:i,fadeLeft:!0,fadeRight:!0}]}get hints(){const e=this.elevationInfo;return[new N.w(D.ze.TARGET,this.constraint.start,this.targetPoint,e,this.domain),new he.L(this.constraint.start,this.targetPoint,e,this.domain),...this._referenceLines.map((t=>new N.w(D.ze.REFERENCE,t.edge.left,t.edge.right,e,this.domain,t.fadeLeft,t.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0},{coordinateHelper:i}=this;this._referenceLines.forEach((o=>{i.equals(e.right,o.edge.left)&&(o.fadeLeft=!1,t.fadeRight=!1),i.equals(e.right,o.edge.right)&&(o.fadeRight=!1,t.fadeRight=!1),i.equals(e.left,o.edge.right)&&(o.fadeRight=!1,t.fadeLeft=!1),i.equals(e.left,o.edge.left)&&(o.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}const ue=(0,k.c)(),ge=(0,k.c)(),ye=(0,k.c)();class ve extends te{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=i.edges.length,n=i.vertices.length,r=[];if(o<2)return r;const{view:s}=this,a=(0,W.a7)(e,t.coordinateHelper,S.jG,s),p=(0,D.Z_)(i.vertices[n-1].pos,s,t),c=(0,D.Z_)(i.vertices[0].pos,s,t),l=i.edges[o-1];let h=l;do{if(this.edgeExceedsShortLineThreshold(h,t)){const i=(0,D._j)(h,s,t);this._checkEdgeForParalleLines(i,p,e,a,t,r),this._checkEdgeForParalleLines(i,c,e,a,t,r)}h=h.leftVertex.leftEdge}while(h&&h!==l);return r}snapExistingVertex(e,t){const i=[],o=(0,l.Wg)(t.vertexHandle),n=o.component;if(n.edges.length<3)return i;const{view:r}=this,s=(0,W.a7)(e,t.coordinateHelper,S.jG,r),a=o.leftEdge,p=o.rightEdge,c=n.vertices[0],h=(0,D.Z_)(c.pos,r,t),d=n.vertices.length,u=n.vertices[d-1],g=(0,D.Z_)(u.pos,r,t),y=n.edges[0];let v=y;do{if(v!==a&&v!==p&&this.edgeExceedsShortLineThreshold(v,t)){const n=(0,D._j)(v,r,t);a&&this._checkEdgeForParalleLines(n,(0,D.Z_)(a.leftVertex.pos,r,t),e,s,t,i),p&&this._checkEdgeForParalleLines(n,(0,D.Z_)(p.rightVertex.pos,r,t),e,s,t,i),o===c?this._checkEdgeForParalleLines(n,g,e,s,t,i):o===u&&this._checkEdgeForParalleLines(n,h,e,s,t,i)}v=v.rightVertex.rightEdge}while(v&&v!==y);return i}_checkEdgeForParalleLines(e,t,i,o,n,r){const s=e.left,a=e.right;if((0,ne.k0)(me,t,s,a),(0,H.k)(me,t)<ee.c.parallelLineThreshold)return;(0,ne.k0)(me,i,s,a,t);const{coordinateHelper:p,pointer:c}=n,l=p.fromXYZ(me,p.getZ(i,0));if((0,D.Bb)(o,(0,W.a7)(l,p,S.jG,this.view))<this.squaredProximityThreshold(c)){if(this._parallelToPreviousCandidate(e,r))return;r.push(new de({coordinateHelper:p,referenceLine:e,lineStart:t,targetPoint:l,elevationInfo:p.hasZ()?S.jG:null}))}}_parallelToPreviousCandidate(e,t){const i=e.left,o=e.right;for(const n of t)if((0,ne.k0)(me,o,n.constraint.start,n.constraint.end,i),(0,H.k)(me,o)<ee.c.parallelLineThreshold)return n.addReferenceLine(e),!0;return!1}}const me=(0,le.a)();class fe extends te{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=i.vertices.length,n=[];if(o<2)return n;const{view:r}=this,s=(0,W.a7)(e,t.coordinateHelper,S.jG,r),a=i.vertices[o-1];if(this.edgeExceedsShortLineThreshold(a.leftEdge,t)){const i=(0,D.Z_)(a.pos,r,t),o=(0,D._j)(a.leftEdge,r,t);this._checkForSnappingCandidate(n,o,i,e,o.left,i,t,e,s)}const p=i.vertices[0];if(this.edgeExceedsShortLineThreshold(p.rightEdge,t)){const i=(0,D.Z_)(p.pos,r,t),o=(0,D._j)(p.rightEdge,r,t);this._checkForSnappingCandidate(n,o,i,e,o.right,i,t,e,s)}return n}snapExistingVertex(e,t){const i=[],o=(0,l.Wg)(t.vertexHandle),n=o.component,r=n.vertices.length;if(r<3)return i;const{view:s}=this,a=(0,W.a7)(e,t.coordinateHelper,S.jG,s),p=o.leftEdge,c=o.rightEdge,h=n.vertices[0],d=n.vertices[r-1];if(!p){const o=h.rightEdge.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(o,t)){const n=(0,D._j)(o,s,t),r=(0,D.Z_)(h.rightEdge.rightVertex.pos,s,t);this._checkForSnappingCandidate(i,n,r,e,n.right,r,t,e,a)}return i}if(!c){const o=d.leftEdge.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(o,t)){const n=(0,D._j)(o,s,t),r=(0,D.Z_)(d.leftEdge.leftVertex.pos,s,t);this._checkForSnappingCandidate(i,n,r,e,n.left,r,t,e,a)}return i}if(p&&p.leftVertex.leftEdge){const o=p.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(o,t)){const n=(0,D._j)(o,s,t),r=(0,D.Z_)(p.leftVertex.pos,s,t);this._checkForSnappingCandidate(i,n,r,e,n.left,r,t,e,a)}}if(c&&c.rightVertex.rightEdge){const o=c.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(o,t)){const n=(0,D._j)(o,s,t),r=(0,D.Z_)(c.rightVertex.pos,s,t);this._checkForSnappingCandidate(i,n,r,e,n.right,r,t,e,a)}}return i}_checkForSnappingCandidate(e,t,i,o,n,r,s,a,p){const{coordinateHelper:c,pointer:l}=s;(0,H.a)(_e,t.right,t.left);const h=(0,L.s)(be,_e[1],-_e[0],0),d=(0,H.h)(h,(0,H.a)(_e,o,i))/(0,H.v)(h),u=c.fromXYZ((0,H.w)(_e,r,h,d),c.getZ(a,0));if((0,D.Bb)(p,(0,W.a7)(u,c,S.jG,this.view))<this.squaredProximityThreshold(l)){const t=c.toXYZ(r,Ee),i=(0,L.z)(we,t,h,Math.sign(d)),o=c.fromXYZ(i);e.push(new X({coordinateHelper:c,targetPoint:u,constraint:new U.aU(c,r,o),previousVertex:n,otherVertex:r,otherVertexType:T.CENTER,elevationInfo:c.hasZ()?S.jG:null}))}}}const _e=(0,le.a)(),Ee=(0,k.c)(),we=(0,k.c)(),be=(0,k.c)();class Se extends V.j{constructor(e){let{coordinateHelper:t,targetPoint:i,point1:o,point2:n,elevationInfo:r}=e;super(t,i,new U.UL(t,t.arrayToVector((0,H.l)(Te,o,n,.5)),.5*(0,H.d)(o,n)),r,M.B.SELF),this._p1=o,this._p2=n}get hints(){const e=this.elevationInfo;return[new N.w(D.ze.REFERENCE,this.targetPoint,this._p1,e,this.domain),new N.w(D.ze.REFERENCE,this.targetPoint,this._p2,e,this.domain),new F.y(this._p1,this.targetPoint,this._p2,e,this.domain)]}}const Te=(0,le.a)();class Ce extends te{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=[],n=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||n<2)return o;const{view:r}=this,s=i.vertices[0],a=i.vertices[n-1],p=(0,D.Z_)(s.pos,r,t),c=(0,D.Z_)(a.pos,r,t);return this._processCandidateProposal(p,c,e,t,o),o}snapExistingVertex(e,t){const i=[],o=(0,l.Wg)(t.vertexHandle),n=o.component;if(n.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===o.index||o.index===n.vertices.length-1))return i;const{view:r}=this,s=(0,D.Z_)(o.leftEdge.leftVertex.pos,r,t),a=(0,D.Z_)(o.rightEdge.rightVertex.pos,r,t);return this._processCandidateProposal(s,a,e,t,i),i}_processCandidateProposal(e,t,i,o,n){if(!this.exceedsShortLineThreshold(e,t,o))return;const r=(0,H.l)(Pe,e,t,.5),s=.5*(0,H.d)(e,t),a=(0,ne.xO)(Ge,i,r,s),{coordinateHelper:p,pointer:c}=o,l=p.fromXYZ(a,p.getZ(i,0)),h=(0,W.a7)(i,p,S.jG,this.view);(0,D.Bb)(h,(0,W.a7)(l,p,S.jG,this.view))<this.squaredProximityThreshold(c)&&n.push(new Se({coordinateHelper:p,targetPoint:l,point1:e,point2:t,elevationInfo:p.hasZ()?S.jG:null}))}}const Pe=(0,le.a)(),Ge=(0,le.a)();let Oe=class extends $.Z{constructor(e){super(e),this.updating=!1,this._snappers=new r.Z,this._domain=M.B.SELF}initialize(){this._snappers.push(new ve(this.view,this.options),new re(this.view,this.options),new fe(this.view,this.options),new Ce(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const o=[];for(const n of this._snappers.items)for(const t of n.snap(e,i))o.push(t);return(0,D.lQ)(e,o,i.coordinateHelper),o}};function xe(e,t){return[new Oe({view:e,options:t}),new z({view:e,options:t,spatialReference:e.spatialReference})]}(0,o._)([(0,u.Cb)({readOnly:!0})],Oe.prototype,"updating",void 0),(0,o._)([(0,u.Cb)({constructOnly:!0})],Oe.prototype,"view",void 0),(0,o._)([(0,u.Cb)()],Oe.prototype,"options",null),Oe=(0,o._)([(0,g.j)("esri.views.interactive.snapping.SelfSnappingEngine")],Oe);let Re=class extends $.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,o._)([(0,u.Cb)({constructOnly:!0})],Re.prototype,"layer",void 0),(0,o._)([(0,u.Cb)()],Re.prototype,"enabled",void 0),(0,o._)([(0,u.Cb)()],Re.prototype,"updating",void 0),(0,o._)([(0,u.Cb)()],Re.prototype,"availability",void 0),Re=(0,o._)([(0,g.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Re);const Ae=Re;let Me=class extends $.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new r.Z,this.distance=ee.c.distance,this.touchSensitivityMultiplier=ee.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,o._)([(0,u.Cb)()],Me.prototype,"enabled",void 0),(0,o._)([(0,u.Cb)()],Me.prototype,"enabledToggled",void 0),(0,o._)([(0,u.Cb)()],Me.prototype,"selfEnabled",void 0),(0,o._)([(0,u.Cb)()],Me.prototype,"featureEnabled",void 0),(0,o._)([(0,u.Cb)({type:r.Z.ofType(Ae)})],Me.prototype,"featureSources",void 0),(0,o._)([(0,u.Cb)()],Me.prototype,"distance",void 0),(0,o._)([(0,u.Cb)()],Me.prototype,"touchSensitivityMultiplier",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],Me.prototype,"effectiveEnabled",null),(0,o._)([(0,u.Cb)({readOnly:!0})],Me.prototype,"effectiveSelfEnabled",null),(0,o._)([(0,u.Cb)({readOnly:!0})],Me.prototype,"effectiveFeatureEnabled",null),Me=(0,o._)([(0,g.j)("esri.views.interactive.snapping.SnappingOptions")],Me);const Ie=Me;var He=i(90609);class Le extends V.j{constructor(e,t,i,o,n){super(e,t,new U.Bq(e,t,i.constraint,o.constraint),n,M.B.ALL),this.first=i,this.second=o}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new He.w(this.targetPoint,this.elevationInfo,this.domain)]}}let ke=class extends(a.Z.EventedMixin(R.r)){constructor(e){super(e),this.options=new Ie,this.snappingEnginesFactory=xe,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Ze.MAIN}initialize(){this.handles.add([(0,d.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:o}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:o}}),(()=>{this.doneSnapping(),this.emit("changed")}),d.Z_),(0,d.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),d.Z_),(0,d.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:i}=e;return this._recreateEngines(t,i)}),d.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:o}=this;this._engines=t(i,o)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e){return function(e){return(0,l.pC)(e.scenePoint)}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const o=this._currentMainCandidate;if((0,l.Wi)(o))return t;const n=this._selectUpdateInput(e);if((0,l.Wi)(n))return t;const{coordinateHelper:{spatialReference:r}}=i,s=(0,y.iV)(this._convertPointElevation(n,i),r);if((0,l.Wi)(s))return t;const{view:a}=this,{coordinateHelper:p,elevationInfo:c,visualizer:h}=i,d=[],u=p.pointToVector(s),g=o.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,g,i))return this._resetSnappingState(),t;o.targetPoint=g,d.push(...o.hints);for(const l of this._currentOtherActiveCandidates)l.targetPoint=g,d.push(...l.hints);(0,l.pC)(h)&&this.handles.add(h.draw(d,{coordinateHelper:p,elevationInfo:De(i),view:a,selfSnappingZ:i.selfSnappingZ}),Ue);const v=p.vectorToDehydratedPoint(g);return this._convertPointElevation(v,i,S.jG,c)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:i}=e;switch(this._currentSnappedType){case Ze.MAIN:return t;case Ze.SCENE:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Ze.MAIN}_removeVisualization(){this.handles.remove(Ue)}async _snapSinglePoint(e){let{point:t,context:i,signal:o}=e;const{coordinateHelper:n}=i,{view:r}=this,s=this._convertPointElevation(t,i),a=n.pointToVector(s),p=await this._fetchCandidates(a,M.B.ALL,i,o);return this._createSnapResult(a,Ze.MAIN,p,r,i,o)}async _snapMultiPoint(e){let{point:t,scenePoint:i,context:o,signal:n}=e;const{view:r}=this,{coordinateHelper:s}=o,{spatialReference:a}=s;await(0,y.iQ)(i.spatialReference,a);const p=(0,y.iV)(this._convertPointElevation(i,o),a),c=s.pointToVector(p),l=await this._fetchCandidates(c,M.B.FEATURE,o,n);if(l.length>0){const e=await this._fetchCandidates(c,M.B.SELF,o,n);return this._createSnapResult(c,Ze.SCENE,[...l,...e],r,o,n)}const h=this._convertPointElevation(t,o),d=s.pointToVector(h),u=await this._fetchCandidates(d,M.B.SELF,o,n);return this._createSnapResult(d,Ze.MAIN,u,r,o,n)}async _fetchCandidates(e,t,i,o){return(await Promise.all(this._engines.map((n=>n.fetchCandidates(e,t,i,o))))).flat()}_createSnapResult(e,t,i,o,n,r){return{get valid(){return!(0,h.Hc)(r)},apply:()=>{const{elevationInfo:r,coordinateHelper:s}=n,{snappedPoint:a,hints:p}=this._processCandidates(e,t,i,n);return this._removeVisualization(),(0,l.pC)(n.visualizer)&&this.handles.add(n.visualizer.draw(p,{coordinateHelper:s,elevationInfo:De(n),view:o,selfSnappingZ:n.selfSnappingZ}),Ue),this._convertPointElevation(a,n,S.jG,r)}}}_processCandidates(e,t,i,o){const{coordinateHelper:n}=o;if(i.length<1)return this.doneSnapping(),{snappedPoint:n.vectorToDehydratedPoint(e),hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,D.lQ)(e,i,n);const r=this._currentMainCandidate;if((0,l.pC)(r)){const n=this._findOldConstraintInNewCandidates(r,i);if(n>=0){if(!(i[n]instanceof Le))return this._intersectWithOtherCandidates(n,i,e,t,o);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,o))return this._updateSnappingCandidate(r,t,i,o)}}return this._intersectWithOtherCandidates(0,i,e,t,o)}_findOldConstraintInNewCandidates(e,t){return e instanceof Le?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,o,n){const{coordinateHelper:r}=n,s=t[e],a=[];for(let p=0;p<t.length;++p){if(p===e)continue;const o=t[p];for(const e of s.constraint.intersect(o.constraint)){const t=r.fromXYZ(e.closestTo(s.targetPoint),s.targetPoint[2]);a.push([new Le(r,t,s,o,o.elevationInfo),this._squaredScreenDistance(i,t,r)])}}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(n.pointer))?this._updateSnappingCandidate(a[0][0],o,t,n):this._updateSnappingCandidate(s,o,t,n)}_updateSnappingCandidate(e,t,i,o){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const n=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const s of i){if(e instanceof Le){if(s.constraint.equals(e.first.constraint)||s.constraint.equals(e.second.constraint))continue}else if(s.constraint.equals(e.constraint))continue;s.constraint.check(n)&&(s.targetPoint=n,this._currentOtherActiveCandidates.push(s),r.push(...s.hints))}return{snappedPoint:o.coordinateHelper.vectorToDehydratedPoint(n),hints:r}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,D.Bb)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,W.a7)(e,t,S.jG,this.view)}_findOldCandidateIndex(e,t){let i=-1;for(let o=0;o<e.length;++o)if(t.constraint.equals(e[o].constraint)){i=o;break}return i}_convertPointElevation(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.elevationInfo,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.jG;const{view:n}=this;if(!((0,l.pC)(e)&&t.coordinateHelper.hasZ()&&(0,l.pC)(n)&&"3d"===n.type))return e;const r=(0,A.d9)(e);return r.z=(0,S.vQ)(n,r,i,o),r}get test(){return{visualizationsActive:this.handles.has(Ue),engines:this._engines}}};var Ze;(0,o._)([(0,u.Cb)({constructOnly:!0})],ke.prototype,"view",void 0),(0,o._)([(0,u.Cb)()],ke.prototype,"options",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],ke.prototype,"updating",null),(0,o._)([(0,u.Cb)()],ke.prototype,"snappingEnginesFactory",void 0),(0,o._)([(0,u.Cb)()],ke.prototype,"_engines",void 0),(0,o._)([(0,u.Cb)()],ke.prototype,"_squaredMouseProximityTreshold",null),(0,o._)([(0,u.Cb)()],ke.prototype,"_squaredTouchProximityThreshold",null),ke=(0,o._)([(0,g.j)("esri.views.interactive.snapping.SnappingManager")],ke),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Ze||(Ze={}));const Ue="visualization-handle";function De(e){let{coordinateHelper:t,elevationInfo:i}=e;return t.hasZ()?S.jG:i}function Ye(e){return(0,l.pC)(e)&&"graphic"===e.type}var je=i(72612),Ve=i(41644);let Ne=class extends a.Z.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,Ve.Bg)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",(()=>{this.canUndo()&&e()}))}set redo(e){this._set("redo",(()=>{this.canRedo()&&e()}))}};(0,o._)([(0,u.Cb)()],Ne.prototype,"activeComponent",void 0),(0,o._)([(0,u.Cb)()],Ne.prototype,"cancelled",void 0),(0,o._)([(0,u.Cb)()],Ne.prototype,"history",void 0),(0,o._)([(0,u.Cb)()],Ne.prototype,"tool",null),(0,o._)([(0,u.Cb)()],Ne.prototype,"type",void 0),(0,o._)([(0,u.Cb)()],Ne.prototype,"canUndo",null),(0,o._)([(0,u.Cb)()],Ne.prototype,"canRedo",null),(0,o._)([(0,u.Cb)()],Ne.prototype,"onEnd",void 0),(0,o._)([(0,u.Cb)()],Ne.prototype,"undo",null),(0,o._)([(0,u.Cb)()],Ne.prototype,"redo",null),(0,o._)([(0,u.Cb)()],Ne.prototype,"toggleTool",void 0),(0,o._)([(0,u.Cb)()],Ne.prototype,"addToSelection",void 0),(0,o._)([(0,u.Cb)()],Ne.prototype,"removeFromSelection",void 0),Ne=(0,o._)([(0,g.j)("esri.widgets.Sketch.support.OperationHandle")],Ne);let Fe=class extends Ne{};(0,o._)([(0,u.Cb)()],Fe.prototype,"activeComponent",void 0),Fe=(0,o._)([(0,g.j)("esri.widgets.Sketch.support.CreateOperationHandle")],Fe);let Xe=class extends Ne{};(0,o._)([(0,u.Cb)()],Xe.prototype,"activeComponent",void 0),Xe=(0,o._)([(0,g.j)("esri.widgets.Sketch.support.UpdateOperationHandle")],Xe);var We=i(16072),ze=i(61459),qe=i(16851);const Be={defaultZ:0},Ke={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let Je=class extends a.Z.EventedAccessor{constructor(e){super(e),this._numUpdating=0,this._handles=new p.Z,this._internalGraphicsLayer=new _.Z({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new p.Z,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.labelOptions=new O.Z,this.layer=null,this.pointSymbol=new We.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new ze.Z({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new qe.Z({color:[130,130,130,1],width:2}),this._snappingManager=null,this.tooltipOptions=new x.Z,this.updateGraphics=new r.Z,this.updateOnGraphicClick=!0,this.updatePointSymbol=new We.Z({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new ze.Z({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new qe.Z({color:[12,207,255],width:2}),this.vertexSymbol=new We.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=Be,this.defaultUpdateOptions=Ke,this.snappingOptions=new Ie}initialize(){this._handles.add([(0,d.on)((()=>this.view?.map?.layers),"change",(e=>{e.removed.includes(this.layer)&&this.cancel()})),(0,d.on)((()=>this.layer?.graphics),"change",(e=>{if((0,l.pC)(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),(0,d.YP)((()=>this.layer?.elevationInfo??null),(e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)}),d.tX),(0,d.YP)((()=>this.view),(e=>{(0,l.SC)(this._snappingManager),e&&(this._snappingManager=new ke({view:e,options:this.snappingOptions}),"2d"===e.type?Promise.all([i.e(9058),i.e(5652),i.e(9096),i.e(7842),i.e(1129),i.e(7190),i.e(2113),i.e(799),i.e(5342)]).then(i.bind(i,51283)):"3d"===e.type&&(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(9096),i.e(7842),i.e(5063),i.e(1129),i.e(5269),i.e(5579),i.e(7190),i.e(2113),i.e(654),i.e(4753),i.e(8383),i.e(799),i.e(2232)]).then(i.bind(i,42232)),Promise.all([i.e(1378),i.e(2029),i.e(5652),i.e(5158),i.e(9096),i.e(5063),i.e(5269),i.e(5579),i.e(4753),i.e(7934),i.e(8383),i.e(1884),i.e(7702)]).then(i.bind(i,67702))))}),d.tX),(0,d.YP)((()=>this.view?.spatialReference),((e,t)=>{e&&t&&!e.equals(t)&&this.cancel()}))])}destroy(){this.cancel(),this._handles=(0,l.SC)(this._handles),this._viewHandles=(0,l.SC)(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=(0,l.SC)(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return"3d"===this.view.type?"move":"transform"}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return!(0,l.pC)(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):(0,l.Wg)(this.activeComponent.graphic)}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Be,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Ke,...e,reshapeOptions:{...Ke.reshapeOptions,...e?.reshapeOptions}})}set snappingOptions(e){(0,l.pC)(this._snappingManager)&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),i&&i.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const i="view-ready";this._handles.remove(i),e&&this._handles.add((0,d.gx)((()=>e.ready),(t=>{this._viewHandles.removeAll(),t&&this._viewHandles.add(this._generateViewHandles(e))}),d.tX),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,l.IM)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,l.IM)(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:e})}}async create(e,t){if(this.cancel(),await this._waitViewReady(),"disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),(0,h.zE)();if((0,l.pC)(this.view.activeTool)&&(this.view.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,C.p)(this.view,this._internalGraphicsLayer);const i=await this._setupCreateOperation(e,t);if((0,l.Wi)(i)||this.destroyed)return void this.view.map.remove(this._internalGraphicsLayer);i.on("complete",(()=>{if(i===this._operationHandle){const t=this.createGraphic,o=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||null==t||this.layer.add(t),this.emit("create",{graphic:t,state:o?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}})),this._operationHandle=i,this.view.ready&&this.view.focus()}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:o,state:n}=this;if("disabled"===n)throw o||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),i||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),(0,h.zE)();(0,l.pC)(this.view.activeTool)&&(this.view.activeTool=null);const r=Array.isArray(e)?e:[e];if(null==e||!r||!r.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some((e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):!!(0,l.Wi)(e.geometry)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0))))return;const s=await this._setupUpdateOperation(r,t);this.destroyed||(0,l.Wi)(s)||ot(s)||((0,C.p)(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(s,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:s.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){this._beginAsyncOperation(),e=Array.isArray(e)?e:[e];for(const t of e)(0,l.pC)(t.geometry)&&"mesh"!==t.geometry.type&&!(0,f.fS)(t.geometry.spatialReference,this.view.spatialReference)&&((0,y.Up)(t.geometry.spatialReference,this.view.spatialReference)||(0,y.kR)()||await(0,y.zD)(),t.geometry=(0,y.iV)(t.geometry,this.view.spatialReference));this._endAsyncOperation()}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=this.view;if("2d"===t.type){const t=[];this.view.map.allLayers.forEach((e=>{"vector-tile"!==e.type&&"imagery"!==e.type||t.push(e)}));return function(e){return e.find(Ye)??null}((await this.view.hitTest(e,{exclude:t})).results)}const i=[this.view.map.ground];t.map.allLayers.forEach((e=>{"integrated-mesh"===e.type&&i.push(e)}));const o=await t.hitTest(e,{exclude:i});if(o.results.length>0){const e=o.results[0];if((0,l.pC)(e)&&"graphic"===e.type&&e.graphic&&(!o.ground.mapPoint||t.map.ground.opacity<1||o.ground.distance-(0,l.Pt)(e.distance,0)>-Math.min(3*o.ground.distance,"global"===t.viewingMode?(0,v.Iu)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",(async t=>{const i="active"===this.state&&"create"===this._operationHandle.type;if("disabled"===this.state||i||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const o=await t.async((()=>this._getFirstHit((0,je.vT)(t))));let n=null;if((0,l.pC)(o)){const i=o.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(t.stopPropagation(),n=i):"2d"!==e.type||this._isComponentGraphic(i)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();(0,l.pC)(n)&&!this.updateGraphics.includes(n)&&await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()}),P.f.WIDGET)]}async _setupCreateOperation(e,t){const i={hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,this.view,i);return(0,l.Wi)(o)?null:(this.view.tools.add(o),this.view.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,i){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;const o="rectangle"!==e,n="rectangle"!==e;this.snappingOptions.enabledToggled=!1;const r={view:t,mode:"rectangle"===e||"circle"===e?"hybrid":"click",...i,snapToScene:!1,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),snappingManager:this._snappingManager,forceUniformSize:n,centered:o};return"2d"===this.view.type?this._makeDrawGraphicTool2D(r):this._makeDrawGraphicTool3D(r)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(Promise.all([i.e(9058),i.e(5652),i.e(9096),i.e(7842),i.e(1129),i.e(7190),i.e(2113),i.e(799),i.e(5342)]).then(i.bind(i,51283)));return ot(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Qe(e.geometryType)?this.activeFillSymbol:null,tooltipOptions:this.tooltipOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(9096),i.e(7842),i.e(5063),i.e(1129),i.e(5269),i.e(5579),i.e(7190),i.e(2113),i.e(654),i.e(4753),i.e(8383),i.e(799),i.e(2232)]).then(i.bind(i,42232)));if(ot(t)||this.destroyed)return null;const{elevationInfo:o}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:o,snapToScene:!(0,l.pC)(o)||"absolute-height"===o.mode,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions})}_setupCreateOperationHandle(e){let t=null;const i=e.forceUniformSize,o=e.centered,n=[this.view.on("key-down",(t=>{if(t.key===G.j.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===G.j.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==G.j.vertexAdd||t.repeat)t.key===G.j.undo?(t.stopPropagation(),r.undo()):t.key===G.j.redo?(t.stopPropagation(),r.redo()):t.key!==G.j.snappingToggle||"rectangle"===e.geometryType||"circle"===e.geometryType||t.repeat?t.key!==G.j.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===G.j.center&&(t.repeat||(e.centered=!o,t.stopPropagation())):(e.forceUniformSize=!i,t.stopPropagation()):(this.snappingOptions.enabledToggled=!0,t.stopPropagation());else{const i=e.drawOperation.geometryType;"polyline"!==i&&"polygon"!==i&&"multipoint"!==i||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}}),P.f.WIDGET),this.view.on("key-up",(t=>{t.key===G.j.pan?e.enabled=!0:t.key===G.j.snappingToggle&&"rectangle"!==e.geometryType&&"circle"!==e.geometryType?(this.snappingOptions.enabledToggled=!1,t.stopPropagation()):t.key!==G.j.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===G.j.center&&(e.centered=o,t.stopPropagation()):(e.forceUniformSize=i,t.stopPropagation())}),P.f.WIDGET),e.on("vertex-add",(i=>{switch(t=(0,l.Wi)(t)?"start":"active",i.operation){case"apply":this.emit("create",{graphic:(0,l.Wg)(e.graphic),state:t,tool:this.activeTool,toolEventInfo:i,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,l.Wg)(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[(0,l.Wg)(e.graphic)],tool:e.geometryType})}})),e.on("cursor-update",(t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:(0,l.Wg)(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),e.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:(0,l.Wg)(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,l.Wg)(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[(0,l.Wg)(e.graphic)],tool:e.geometryType})}})),e.on("complete",(e=>{this._set("createGraphic",(0,l.Wg)(e.graphic)),t="complete",e.aborted?r&&r.cancel():r&&r.complete()})),(0,d.YP)((()=>this._getGraphicSymbolFromTool(e.geometryType)),(t=>{e.graphicSymbol=t}))],r=new Fe({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{n.forEach((e=>e.remove())),n.length=0,this.view.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return r}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;default:return null}}async _setupUpdateOperation(e,t){const{layer:i,view:o}=this,n={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions}};let r=n.tool;for(const s of e)i.remove(s),i.add(s);if("3d"===o.type){if(0===e.length)return null;switch(r){case"move":return this._setupMove3DOperation(e,n,o,r);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,b.P)(e[0]);return t===E.e.SUPPORTED?this._setupReshape3DOperation(e[0],n,o):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,E.Z)(t)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,n,o)}}switch(r){case"move":return this._setupMove2DOperation(e,n,o);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,b.P)(e[0]);return t===E.e.SUPPORTED?this._setupTransformOrReshape2DOperation(e,r,n,o):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,E.Z)(t)}).`),null)}case"transform":if(1===e.length){const t=(0,l.U2)(e[0].geometry,"type");"point"!==t&&"multipoint"!==t||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,n,o)}}async _setupMove3DOperation(e,t,o,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];for(const i of e){const e=(0,w.P)(i);if(e!==E.e.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,E.Z)(e)}).`),null}const s=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(9096),i.e(7842),i.e(5063),i.e(1129),i.e(5269),i.e(5579),i.e(7190),i.e(2113),i.e(654),i.e(4753),i.e(8383),i.e(799),i.e(2232)]).then(i.bind(i,42232)));if(ot(s))return s;const a=new s.module.GraphicMoveTool({view:o,enableZ:t.enableZ,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(a),a.graphics.addMany(e),r||this.updateGraphics.addMany(e);const p=[],c=new Xe({activeComponent:a,tool:n,type:"update",onEnd:()=>{p.forEach((e=>e.remove())),p.length=0,this.view.tools?.remove(a),a.destroyed||a.destroy()},undo:()=>{$e(c,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{et(c,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:e=>{this.updateGraphics.push(e),a.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);c.history.undo.forEach((e=>e.updates.splice(t,1))),c.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics.remove(e):c.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==n)return;const e=this.updateGraphics.getItemAt(0);if((0,b.P)(e)!==E.e.SUPPORTED)return;const i=await this._setupReshape3DOperation(e,t,o,!0);ot(i)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(i,t))}});return p.push(...this._getHandlesForComponent(c,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(c,e,t)),P.f.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(c,e),e.key===G.j.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),P.f.WIDGET),o.on("key-up",(e=>{e.key===G.j.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),P.f.WIDGET)),c}_setupGraphicTransform3DOperation(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(1===e.length&&function(e){if("graphics"!==e.layer?.type)return E.e.GRAPHICS_LAYER_MISSING;if((0,l.Wi)(e.geometry))return E.e.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return E.e.SUPPORTED;default:return E.e.GEOMETRY_TYPE_UNSUPPORTED}const t=(0,l.pC)(e.symbol)&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.length>0&&t.some((e=>"object"===e.type))?"on-the-ground"!==(0,S.vu)(e)&&(0,S.Lt)(e)?E.e.ELEVATION_MODE_UNSUPPORTED:E.e.SUPPORTED:E.e.SYMBOL_TYPE_UNSUPPORTED}(e[0])===E.e.SUPPORTED){const n=e[0],r=n.geometry;if((0,l.pC)(r)&&("point"===r.type||"mesh"===r.type))return this._setupPointTransform3DOperation(n,t,i);if((0,l.pC)(r)&&("polygon"===r.type||"polyline"===r.type))return this._setupPolyTransform3DOperation(n,t,i,o)}return this._setupMove3DOperation(e,t,i,"transform",o)}async _setupPointTransform3DOperation(e,t,o){const n="transform",{enableRotation:r,enableScaling:s,enableZ:a}=t,p=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(9096),i.e(7842),i.e(5063),i.e(1129),i.e(5269),i.e(5579),i.e(7190),i.e(2113),i.e(654),i.e(4753),i.e(8383),i.e(799),i.e(2232)]).then(i.bind(i,42232)));if(ot(p))return p;const c=new p.module.GraphicTransformTool({graphic:e,view:o,enableRotation:r,enableScaling:s,enableZ:a,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(c),this.updateGraphics.add(e);const l=[],h=new Xe({activeComponent:c,tool:n,type:"update",onEnd:()=>{l.forEach((e=>e.remove())),l.length=0,this.view.tools?.remove(c),c.destroyed||c.destroy()},undo:()=>{$e(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{et(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);ot(i)||(h.onEnd(),h.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),h.complete()},toggleTool:()=>{}});return l.push(...this._getHandlesForComponent(h,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(h,e,t)),P.f.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(h,e),e.key===G.j.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),P.f.WIDGET),o.on("key-up",(e=>{e.key===G.j.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),P.f.WIDGET)),h}async _setupPolyTransform3DOperation(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r="transform",{enableRotation:s,enableScaling:a,enableZ:p,preserveAspectRatio:c}=t,l=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(9096),i.e(7842),i.e(5063),i.e(1129),i.e(5269),i.e(5579),i.e(7190),i.e(2113),i.e(654),i.e(4753),i.e(8383),i.e(799),i.e(2232)]).then(i.bind(i,42232)));if(ot(l))return l;const h=new l.module.ExtentTransformTool({graphic:e,view:o,enableRotation:s,enableScaling:a,enableZ:p,preserveAspectRatio:c,tooltipOptions:this.tooltipOptions});this.view.tools.add(h),n||this.updateGraphics.add(e);const d=[],u=new Xe({activeComponent:h,tool:r,type:"update",onEnd:()=>{d.forEach((e=>e.remove())),d.length=0,this.view.tools?.remove(h),h.destroyed||h.destroy()},canUndo:()=>h.canUndo,undo:()=>{h.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},canRedo:()=>h.canRedo,redo:()=>{h.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);ot(i)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),u.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.getItemAt(0);if((0,b.P)(e)!==E.e.SUPPORTED)return;const i=await this._setupReshape3DOperation(e,t,o,!0);ot(i)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(i,t))}});return d.push(...this._getHandlesForComponent(u,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(u,e,t)),P.f.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(u,e)),P.f.WIDGET),this.view.on("key-down",(e=>{e.key!==G.j.constraint||e.repeat||(h.preserveAspectRatio=!h.preserveAspectRatio,e.stopPropagation())}),P.f.WIDGET),this.view.on("key-up",(e=>{e.key===G.j.constraint&&(h.preserveAspectRatio=!h.preserveAspectRatio,e.stopPropagation())}),P.f.WIDGET)),u}async _setupMove2DOperation(e,t,i){const o="move";this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const n=await this._getGraphicMover(e,t,i);if(ot(n))return n;const r=new Xe({activeComponent:n,tool:o,type:"update",onEnd:()=>{this._displayDefaultCursor(),p.forEach((e=>e.remove())),a.forEach((e=>e.remove())),p=[],a=[],n.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();$e(r,e),r.refreshComponent(),this._emitUndoEvent({graphics:e,tool:o})},redo:()=>{const e=this.updateGraphics.toArray();et(r,e),r.refreshComponent(),this._emitRedoEvent({graphics:e,tool:o})},addToSelection:async e=>{await this._updateSpatialReference(e),this.updateGraphics.push(e),n.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach((e=>e.updates.splice(t,1))),r.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?n.graphics=i:r.complete()}});let s=!1,a=[i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(r,e,t)),P.f.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==G.j.constraint||e.repeat||(s=!0,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)}),P.f.WIDGET),i.on("key-up",(e=>{e.key===G.j.constraint&&s&&(s=!1,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)}),P.f.WIDGET)],p=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r="reshape",s=await this._requireModule(Promise.all([i.e(1378),i.e(2029),i.e(9058),i.e(5652),i.e(5158),i.e(9096),i.e(7842),i.e(5063),i.e(1129),i.e(5269),i.e(5579),i.e(7190),i.e(2113),i.e(654),i.e(4753),i.e(8383),i.e(799),i.e(2232)]).then(i.bind(i,42232)));if(ot(s))return s;this.snappingOptions.enabledToggled=!1;const a=new s.module.GraphicReshapeTool({view:o,graphic:e,enableZVertex:t.enableZ&&"move"===t.reshapeOptions.vertexOperation,enableZShape:t.enableZ&&"move"===t.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===t.reshapeOptions.shapeOperation||"move-xy"===t.reshapeOptions.shapeOperation,enableMidpoints:"split"===t.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===t.reshapeOptions.edgeOperation,snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});o.tools.add(a),n||this.updateGraphics.add(e);const p=[],c=new Xe({activeComponent:a,tool:r,type:"update",onEnd:()=>{p.forEach((e=>e.remove())),p.length=0,this.view.tools?.remove(a),a.destroyed||a.destroy()},canUndo:()=>a.canUndo,undo:()=>{a.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},canRedo:()=>a.canRedo,redo:()=>{a.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);ot(i)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),c.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,o,!0);ot(e)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(e,t))}});return p.push(...this._getHandlesForComponent(c,t),o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(c,e,t)),P.f.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(c,e),e.key===G.j.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),P.f.WIDGET),o.on("key-up",(e=>{e.key===G.j.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),P.f.WIDGET)),c}async _setupTransformOrReshape2DOperation(e,t,i,o){this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const n="transform"===t?await this._getBox(e,i,o):await this._getReshape(e,i,o);if(ot(n))return n;const r=new Xe({activeComponent:n,type:"update",onEnd:()=>{a.forEach((e=>e.remove())),s.forEach((e=>e.remove())),a=[],s=[],r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{$e(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{et(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async e=>{let t=r.activeComponent;if("reshape"===t.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll();const n=await this._setupMove2DOperation(t,i,o);if(ot(n))return;r.onEnd(),r.destroy(),this._setUpdateOperationHandle(n,i)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach((e=>e.updates.splice(t,1))),r.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();if(0===i.length)r.complete();else{const e=i[0].geometry;1!==i.length||!(0,l.pC)(e)||"point"!==e.type&&"multipoint"!==e.type?r.activeComponent.graphics=i:r.toggleTool()}this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.getItemAt(0),t=e.geometry;if((0,l.pC)(t)&&("reshape"===r.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===r.tool&&"extent"===t.type))return;let n=null;"transform"===r.tool?n=await this._getReshape([e],i,o):"reshape"===r.tool&&(n=await this._getBox([e],i,o)),ot(n)||(r.activeComponent.destroy(),r.activeComponent=n,r.activeComponent&&(a.forEach((e=>e.remove())),a=this._getHandlesForComponent(r,i)))}});let s=[o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(r,e,i)),P.f.WIDGET),o.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==G.j.snappingToggle||e.repeat||(this.snappingOptions.enabledToggled=!0,e.stopPropagation()),e.key===G.j.constraint&&!e.repeat&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),P.f.WIDGET),o.on("key-up",(e=>{if(e.key===G.j.snappingToggle&&"reshape"===r?.activeComponent?.type&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation()),e.key===G.j.constraint&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),P.f.WIDGET)],a=this._getHandlesForComponent(r,i);return r}async _getGraphicMover(e,t,o){const{enableMoveAllGraphics:n}=t,r=await this._requireModule(i.e(3503).then(i.bind(i,53503)));return ot(r)?r:new r.module.default({enableMoveAllGraphics:n,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:e,view:o,callbacks:{onGraphicMoveStart:e=>{let{dx:t,dy:i,graphic:o}=e;this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:"move-start"},type:"update"})},onGraphicMove:e=>{let{dx:t,dy:i,graphic:o}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:"move"},type:"update"})},onGraphicMoveStop:e=>{let{dx:t,dy:i,graphic:o}=e;this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,o){const{enableRotation:n,enableScaling:r,preserveAspectRatio:s}=t,a=await this._requireModule(Promise.all([i.e(9058),i.e(7190),i.e(3503),i.e(6387)]).then(i.bind(i,96306)));return ot(a)?a:new a.module.default({graphics:e,enableRotation:n,enableScaling:r,preserveAspectRatio:s,layer:this._internalGraphicsLayer,view:o,tooltipOptions:this.tooltipOptions,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,o){const n="split"===t.reshapeOptions?.edgeOperation,r="move"===t.reshapeOptions?.shapeOperation,s=await this._requireModule(Promise.all([i.e(9058),i.e(5652),i.e(1129),i.e(7190),i.e(3503),i.e(3362)]).then(i.bind(i,83362)));return ot(s)?s:new s.module.default({enableMidpoints:n,enableMovement:r,graphic:e[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions,view:o,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:e=>{let{mover:t,type:i}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t,type:i},type:"update"})},onMoveStart:e=>{let{dx:t,dy:i,mover:o,type:n}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:n},type:"update"})},onMove:e=>{let{dx:t,dy:i,mover:o,type:n}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:n},type:"update"})},onMoveStop:e=>{let{dx:t,dy:i,mover:o,type:n}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:i,mover:o,type:n},type:"update"})},onVertexAdd:e=>{let{added:t,type:i,vertices:o}=e;const n=t.map((e=>(0,m.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:n,vertices:o,type:i},type:"update"})},onVertexRemove:e=>{let{removed:t,type:i,vertices:o}=e;const n=t.map((e=>(0,m.nA)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:n,vertices:o,type:i},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;switch(i.type){case"graphic-mover":return[i.on("graphic-click",(t=>{let{graphic:i,viewEvent:o}=t;o.native?.shiftKey&&(o.stopPropagation(),e.removeFromSelection(i))})),i.on("graphic-move-start",(t=>e.addToHistory(it(t.allGraphics))))];case"box":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(it(t.graphics)))),i.on("rotate-start",(t=>e.addToHistory(it(t.graphics)))),i.on("scale-start",(t=>e.addToHistory(it(t.graphics))))];case"reshape":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(it([t.mover])))),i.on("reshape-start",(t=>e.addToHistory(it([t.graphic])))),i.on("vertex-add",(t=>e.addToHistory(it([t.oldGraphic])))),i.on("vertex-remove",(t=>e.addToHistory(it([t.oldGraphic]))))];case"move-3d":return[i.on("graphic-move-start",(t=>{e.addToHistory(it(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"})})),i.on("graphic-move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"})})),i.on("graphic-move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[i.on("record-undo",(t=>{let{record:i}=t;e.addToHistory({updates:[i]})})),i.on("graphic-translate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})})),i.on("graphic-translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})})),i.on("graphic-rotate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-start"},type:"update"})})),i.on("graphic-rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})})),i.on("graphic-scale-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})})),i.on("graphic-scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})})),i.on("graphic-translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})})),i.on("graphic-rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"})})),i.on("graphic-scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"reshape-3d":return[i.on("reshape",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];default:return}}_onTransformOrReshape2DGraphicClick(e,t,i){const{graphic:o,viewEvent:n}=i;return n.native?.shiftKey&&o.layer===this.layer?(n.stopPropagation(),e.removeFromSelection(o)):t.toggleToolOnClick?(n.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view.map;this._disablePopup(t);e.on("complete",(()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),n=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:n,toolEventInfo:null,type:"update"})}}))}async _getCommonUpdateOperationClickHandlers(e,t,i){const o=(0,je.vT)(t),n=await t.async((()=>this._getFirstHit(o)));(0,l.Wi)(n)?e.complete():t.native.shiftKey&&this._toggleSelection([n.graphic],e,i)||this.updateGraphics.includes(n.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const o=!!i.multipleSelectionEnabled;return e.some((e=>null!=e&&!(!o||e.layer!==this.layer)&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0)))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===G.j.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===G.j.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===G.j.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&G.j.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,i=this.updateGraphics.toArray();(0,l.Wi)(t)||"reshape-3d"===t.type||("reshape"!==t.type||1===i.length&&"point"===(0,l.U2)(i[0].geometry,"type"))&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,l.SC)(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||(0,l.Wi)(t))&&(e.attributes&&e.attributes.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){c.Z.getLogger(this.declaredClass).error(new s.Z(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:Ke}}wait(){return(0,d.N1)((()=>!this.updating))}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(0,l.pC)(e)&&e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&(0,l.Wi)(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1)}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&(0,l.pC)(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}async _waitViewReady(){const e=this.view;e&&((0,l.IM)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,h.Hl)((0,d.N1)((()=>e?.ready)),this._viewReadyAbortController.signal))}};function Qe(e){return"polygon"===e||"rectangle"===e||"circle"===e}function $e(e,t){tt("undo",e.history.undo,e.history.redo,t)}function et(e,t){tt("redo",e.history.redo,e.history.undo,t)}function tt(e,t,i,o){const n=t.pop().updates,r=[];o.forEach(((t,i)=>{const o=n[i];null!=o&&("geometry"in o&&(0,l.pC)(o.geometry)&&(r.push({geometry:t.geometry}),t.geometry=o.geometry),"symbol"in o&&(0,l.pC)(o.symbol)&&(r.push({symbol:t.symbol}),t.symbol=o.symbol),"undo"in o&&(r.push(o),o[e](t)))})),i.push({updates:r})}function it(e){return{updates:e.map((e=>({geometry:e.geometry})))}}function ot(e){return"requireError"in e&&"aborted"===e.requireError}(0,o._)([(0,u.Cb)()],Je.prototype,"updating",null),(0,o._)([(0,u.Cb)()],Je.prototype,"_operationHandle",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],Je.prototype,"activeTool",null),(0,o._)([(0,u.Cb)()],Je.prototype,"activeFillSymbol",void 0),(0,o._)([(0,u.Cb)()],Je.prototype,"activeLineSymbol",void 0),(0,o._)([(0,u.Cb)()],Je.prototype,"activeVertexSymbol",void 0),(0,o._)([(0,u.Cb)()],Je.prototype,"allowDeleteKey",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],Je.prototype,"createGraphic",null),(0,o._)([(0,u.Cb)()],Je.prototype,"defaultCreateOptions",null),(0,o._)([(0,u.Cb)()],Je.prototype,"defaultUpdateOptions",null),(0,o._)([(0,u.Cb)({type:O.Z,nonNullable:!0})],Je.prototype,"labelOptions",void 0),(0,o._)([(0,u.Cb)()],Je.prototype,"layer",void 0),(0,o._)([(0,u.Cb)({types:n.LB})],Je.prototype,"pointSymbol",void 0),(0,o._)([(0,u.Cb)({types:n.LB})],Je.prototype,"polygonSymbol",void 0),(0,o._)([(0,u.Cb)({types:n.LB})],Je.prototype,"polylineSymbol",void 0),(0,o._)([(0,u.Cb)({type:Ie,nonNullable:!0})],Je.prototype,"snappingOptions",null),(0,o._)([(0,u.Cb)()],Je.prototype,"_snappingManager",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],Je.prototype,"state",null),(0,o._)([(0,u.Cb)({type:x.Z,nonNullable:!0})],Je.prototype,"tooltipOptions",void 0),(0,o._)([(0,u.Cb)({readOnly:!0})],Je.prototype,"updateGraphics",void 0),(0,o._)([(0,u.Cb)()],Je.prototype,"updateOnGraphicClick",void 0),(0,o._)([(0,u.Cb)({types:n.LB})],Je.prototype,"updatePointSymbol",void 0),(0,o._)([(0,u.Cb)({types:n.LB})],Je.prototype,"updatePolygonSymbol",void 0),(0,o._)([(0,u.Cb)({types:n.LB})],Je.prototype,"updatePolylineSymbol",void 0),(0,o._)([(0,u.Cb)({types:n.LB})],Je.prototype,"vertexSymbol",void 0),(0,o._)([(0,u.Cb)({value:null})],Je.prototype,"view",null),Je=(0,o._)([(0,g.j)("esri.widgets.Sketch.SketchViewModel")],Je);const nt=Je}}]);
//# sourceMappingURL=5604.51e92e70.chunk.js.map