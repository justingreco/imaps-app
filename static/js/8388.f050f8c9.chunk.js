"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[8388],{18388:(e,a,s)=>{s.r(a),s.d(a,{default:()=>B});var t=s(85580),i=s(72791),l=s(70032),r=s(29479),n=s(36279);function o(e,a,s,t,i,l,r){var o,c;if(0===i&&r.map.basemap.baseLayers.removeAll(),1===i){const e=r.map.basemap.baseLayers.filter((e=>e.type.includes("image")));r.map.basemap.baseLayers.removeMany(e)}const u=null===a||void 0===a||null===(o=a.detail)||void 0===o||null===(c=o.selectedItems[0])||void 0===c?void 0:c.value;if(u){const a=s.find((e=>e.id===u));null===a||void 0===a||a.load().then((a=>{if("Web Map"===a.type){new n.Z({portalItem:{id:a.id}}).loadAll().then((a=>{setTimeout((()=>{null===a||void 0===a||a.basemap.baseLayers.forEach((e=>{console.log(e.type),e.type.includes("image")||(e.opacity=.5),t.baseLayers.add(e,0)})),t.baseLayers.addMany(t.baseLayers,0),l(e),"opacity"===e&&(r.map.basemap=t)}))}))}}))}}var c=s(80184);function u(e){var a,s,n;const u=(0,i.useRef)(!1),[d,m]=(0,i.useState)("basemap"),[p,v]=(0,i.useState)([]),[b,y]=(0,i.useState)([]),h=(0,i.useRef)(new r.default({baseLayers:[]}));return(0,i.useEffect)((()=>{if(!u.current){u.current=!0;(new l.Z).queryGroups({query:`id: ${e.mapGroup}`}).then((e=>{e.results[0].queryItems({query:"Web Map"}).then((e=>{v(e.results)}))}))}}),[e.mapGroup]),(0,i.useEffect)((()=>{(new l.Z).queryGroups({query:`id: ${e.imageGroup}`}).then((e=>{e.results[0].queryItems({query:"*"}).then((e=>{y(e.results)}))}))}),[e.imageGroup]),(0,c.jsx)("div",{className:"blend",children:(0,c.jsxs)(t.Gq,{layout:"vertical",children:[(0,c.jsx)(t.cl,{active:"basemap"===d||void 0,itemTitle:"Basemap",description:"Select basemap layer",onClick:()=>m("basemap"),children:(0,c.jsx)(t.Y,{label:"Basemaps",selectionMode:"single",scale:"l",onCalciteComboboxChange:a=>o("images",a,p,h.current,0,m,e.view),children:p.map((e=>(0,c.jsx)(t.tp,{title:e.title,textLabel:e.title,value:e.id},e.id)))})}),(0,c.jsx)(t.cl,{active:"images"===d||void 0,itemTitle:"Image",description:"Select imagery layer",onClick:()=>m("images"),children:(0,c.jsx)(t.Y,{label:"Images",selectionMode:"single",scale:"l",onCalciteComboboxChange:a=>o("opacity",a,b,h.current,1,m,e.view),children:b.sort(((e,a)=>e.title>a.title?-1:1)).map((e=>(0,c.jsx)(t.tp,{title:e.title,textLabel:e.title,value:e.id},e.id)))})}),(0,c.jsx)(t.cl,{active:"opacity"===d||void 0,itemTitle:"Opacity",description:"Set base map layer opacity",onClick:()=>m("opacity"),children:(0,c.jsx)(t.XQ,{max:1,min:0,step:.1,value:null===(a=h.current)||void 0===a||null===(s=a.baseLayers)||void 0===s||null===(n=s.getItemAt(h.current.baseLayers.length-1))||void 0===n?void 0:n.opacity,maxLabel:"Opaque",minLabel:"Transparent",onCalciteSliderInput:a=>{e.view&&(e.view.map.basemap.baseLayers.getItemAt(h.current.baseLayers.length-1).opacity=a.target.value)}})})]})})}const d=i.memo(u);var m=s(2170),p=s(6934),v=s(97862),b=s(76200),y=s(80885),h=s(51995),f=s(94172);let g,x,w,j;const L=e=>m.intersects(e,x),C=e=>!!w||e.portalItem.tags.includes("countywide"),I=e=>new Promise(((e,a)=>{(0,b.default)("https://maps.raleighnc.gov/images/rest/services/Orthos2020/ImageServer/queryBoundary?outSR=102100&f=json",{responseType:"json"}).then((a=>{x=y.Z.fromJSON(a.data.shape),e(x)}))})),S=(e,a,s)=>{x&&g.source.basemaps.find((e=>g.activeBasemap.title===e.title))&&(j=w,w=L(a.extent),j!==w&&(g.source.refresh(),setTimeout((()=>{const e=g.source.basemaps.find((e=>a.map.basemap.title===e.title));if(e)g.activeBasemap=e;else{const e=g.activeBasemap.title;g.activeBasemap=g.source.basemaps.at(0);const a=g.activeBasemap.title;s({show:!0,from:e,to:a})}}),1e3)))},q=(e,a)=>new Promise(((s,t)=>{if(e.baseLayers.length){const t=e.baseLayers.find((e=>"vector-tile"===e.type));"vector-tile"===(null===t||void 0===t?void 0:t.type)?f.N1((()=>t.loaded)).then((e=>{const i=t.getStyleLayer("background");if(i){const e=new h.Z(i.paint["background-color"]);a.background={color:e},s(e.isBright)}else s(!0)})):t||"imagery"!==e.baseLayers.getItemAt(0).type?s(!0):s(!1)}})),A=(e,a)=>{const s=e.map.allLayers.find((e=>e.title.includes("Property")&&"feature"===e.type));if(s){const e=(null===s||void 0===s?void 0:s.renderer).clone();a?(e.symbol.outline.color.r=0,e.symbol.outline.color.g=0,e.symbol.outline.color.b=0):(e.symbol.outline.color.r=255,e.symbol.outline.color.g=255,e.symbol.outline.color.b=255),s.renderer=e}};function k(e){const[a,s]=(0,i.useState)(),[l,r]=(0,i.useState)({show:!1,from:"",to:""}),[n,o]=(0,i.useState)(!1),u=(0,i.useRef)(!1),m=(0,i.useRef)(null),b=(0,i.useRef)(null),y=(0,i.useRef)(null),h="f6329364e80c438a958ce74aadc3a89f",f="492386759d264d49948bf7f83957ddb9";(0,i.useEffect)((()=>{s(e.view),u.current||(u.current=!0,function(e,a,s){new p.Z({container:a,view:e,source:{query:`id: ${s}`}})}(e.view,m.current,h),function(e,a,s,t){g=new p.Z({container:a,view:e,source:new v.Z({query:`id: ${s}`,filterFunction:C,updateBasemapsCallback:e=>e.reverse()})}),g.when((()=>{g.source.basemaps.reverse(),x||I(e).then((a=>{x=a,w=L(e.extent),g.source.refresh()})),e.watch("extent",(a=>S(a,e,t)))})),e.map.watch("basemap",(a=>{q(a,e).then((a=>{A(e,a)}))}))}(e.view,b.current,f,r),function(e,a){new p.Z({container:a,view:e})}(e.view,y.current))}),[e.view]),(0,i.useEffect)((()=>{o(e.isActive)}),[e.isActive]);const j=(0,i.useCallback)((a=>{e.panelDismissed()}),[]);return(0,c.jsx)(t.N$,{id:"basemaps-panel",heading:"Basemaps",hidden:!n,closed:!n||void 0,dismissed:!n||void 0,dismissible:!0,onCalcitePanelDismiss:j,children:(0,c.jsxs)("div",{className:"basemaps",children:[(0,c.jsxs)(t.A3,{position:"below",layout:"center",scale:"m",children:[(0,c.jsxs)(t.yj,{slot:"tab-nav",children:[(0,c.jsx)(t.A7,{children:"Maps"}),(0,c.jsx)(t.A7,{children:"Images"}),(0,c.jsx)(t.A7,{children:"Esri"}),(0,c.jsx)(t.A7,{children:"Blend"})]}),(0,c.jsx)(t.Qi,{children:(0,c.jsx)("div",{ref:m})}),(0,c.jsx)(t.Qi,{children:(0,c.jsx)("div",{ref:b})}),(0,c.jsx)(t.Qi,{children:(0,c.jsx)("div",{ref:y})}),(0,c.jsx)(t.Qi,{children:(0,c.jsx)(d,{view:a,mapGroup:h,imageGroup:f})})]}),(0,c.jsxs)(t.Uh,{active:!0===l.show||void 0,autoDismiss:!0,autoDismissDuration:"medium",color:"yellow",label:"Imagery Year Changed",children:[(0,c.jsx)("div",{slot:"title",children:"Imagery Not Available"}),(0,c.jsx)("div",{slot:"message",children:`Imagery for ${l.from} only available inside Raleigh, base map has changed to ${l.to}`})]})]})})}const B=i.memo(k)}}]);
//# sourceMappingURL=8388.f050f8c9.chunk.js.map