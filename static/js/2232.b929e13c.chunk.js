"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[2232],{11316:(e,t,i)=>{i.d(t,{S:()=>c,b:()=>h});var a=i(82552),s=i(95276),n=i(58406),r=i(98634),o=i(64201),l=i(4760);function h(e){const t=new o.kG;t.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:h,attributes:c,varyings:p}=t;return(0,a.Sv)(i,e),c.add(l.T.POSITION,"vec3"),c.add(l.T.UV0,"vec2"),p.add("vUV","vec2"),i.code.add(r.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),h.uniforms.add([new s.N("backgroundColor",(e=>e.backgroundColor)),new s.N("gridColor",(e=>e.gridColor)),new n.p("gridWidth",(e=>e.gridWidth))]),h.code.add(r.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const c=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},151:(e,t,i)=>{function a(){return new Float32Array(4)}function s(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function n(e,t,i,a){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=a,s}function r(){return a()}function o(){return n(1,1,1,1)}function l(){return n(1,0,0,0)}function h(){return n(0,1,0,0)}function c(){return n(0,0,1,0)}function p(){return n(0,0,0,1)}i.d(t,{a:()=>s,f:()=>n});const d=r(),u=o(),_=l(),g=h(),m=c(),y=p();Object.freeze(Object.defineProperty({__proto__:null,create:a,clone:s,fromValues:n,createView:function(e,t){return new Float32Array(e,t,4)},zeros:r,ones:o,unitX:l,unitY:h,unitZ:c,unitW:p,ZEROS:d,ONES:u,UNIT_X:_,UNIT_Y:g,UNIT_Z:m,UNIT_W:y},Symbol.toStringTag,{value:"Module"}))},66576:(e,t,i)=>{i.d(t,{B:()=>g});var a=i(80292),s=i(35995),n=i(71907),r=i(33397),o=i(25265),l=i(49861);function h(e){return c[function(e){return e instanceof Blob?e.type:function(e){const t=(0,s.Ml)(e);return u[t]||p}(e.url)}(e)]||d}const c={},p="text/plain",d=c[p],u={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const f in u)c[u[f]]=f;var _=i(53283);function g(e){const t=e?.origins??[void 0];return(i,n)=>{const c=function(e,t,i){if("resource"===e?.type)return function(e,t,i){const n=(0,r.VZ)(t,i);return{type:String,read:(e,t,i)=>{const a=(0,_.r)(e,t,i);return n.type===String?a:"function"==typeof n.type?new n.type({url:a}):void 0},write:{writer(t,r,l,c){if(!c||!c.resources)return"string"==typeof t?void(r[l]=(0,_.t)(t,c)):void(r[l]=t.write({},c));const p=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),d=(0,_.t)(p,{...c,verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},_.M.NO),u=n.type!==String&&(!(0,a.l)(this)||c&&c.origin&&this.originIdOf(i)>(0,o.M9)(c.origin)),g={object:this,propertyName:i,value:t,targetUrl:d,dest:r,targetPropertyName:l,context:c,params:e};c&&c.portalItem&&d&&!(0,s.YP)(d)?u?function(e){const{context:t,targetUrl:i,params:a,value:n,dest:r,targetPropertyName:o}=e;if(!t.portalItem)return;const l=t.portalItem.resourceFromPath(i),c=v(n,i,t),p=h(c),d=(0,s.Ml)(l.path),u=a?.compress??!1;p===d?(t.resources&&y({...e,resource:l,content:c,compress:u,updates:t.resources.toUpdate}),r[o]=i):m(e)}(g):function(e){let{context:t,targetUrl:i,dest:a,targetPropertyName:s}=e;t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i),compress:!1}),a[s]=i)}(g):c&&c.portalItem&&(null==d||null!=(0,_.i)(d)||(0,s.jc)(d)||u)?m(g):r[l]=d}}}}(e,t,i);switch(e?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=_.a;return{read:e,write:t}}}}(e,i,n);for(const e of t){const t=(0,l.CJ)(i,e,n);for(const e in c)t[e]=c[e]}}}function m(e){const{targetUrl:t,params:a,value:r,context:o,dest:l,targetPropertyName:c}=e;if(!o.portalItem)return;const p=(0,_.p)(t),d=p?.filename??(0,n.D)(),u=a?.prefix??p?.prefix,g=v(r,t,o),m=(0,s.v_)(u,d),f=`${m}.${h(g)}`,b=o.portalItem.resourceFromPath(f);(0,s.jc)(t)&&o.resources&&o.resources.pendingOperations.push(async function(e){const t=(await Promise.resolve().then(i.bind(i,76200))).default,{data:a}=await t(e,{responseType:"blob"});return a}(t).then((e=>{b.path=`${m}.${h(e)}`,l[c]=b.itemRelativeUrl})).catch((()=>{})));const M=a?.compress??!1;o.resources&&y({...e,resource:b,content:g,compress:M,updates:o.resources.toAdd}),l[c]=b.itemRelativeUrl}function y(e){let{object:t,propertyName:i,updates:a,resource:s,content:n,compress:r}=e;a.push({resource:s,content:n,compress:r,finish:e=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(t,i,e)}})}function v(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}},45238:(e,t,i)=>{i.d(t,{EU:()=>p,Ue:()=>o,WH:()=>d,ZZ:()=>c,qC:()=>h,uT:()=>l});var a=i(16889),s=i(48976),n=i(98131),r=i(11186);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;return[e[0],e[1],e[2],e[3]]}function l(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o();return(0,r.c)(i,e),i[3]=t,i}function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o();return(0,s.s)(g,e,d(e)),(0,s.s)(m,t,d(t)),(0,s.m)(g,m,g),u(i,(0,a.BV)((0,s.g)(i,g)))}function c(e){return e}function p(e){return e[3]}function d(e){return(0,a.Vl)(e[3])}function u(e,t){return e[3]=t,e}const _=[0,0,1,0],g=(0,n.a)(),m=(0,n.a)();o()},96669:(e,t,i)=>{function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function s(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let a=0;a<e.length;a++){const s=e[a].size;"number"==typeof s&&(t+=s,i++)}return t/i}(e.stops):t}function n(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:a}=t;return(s(i,e)+s(a,e))/2}));let a=0;const n=i.length;if(0===n)return e;for(let s=0;s<n;s++)a+=i[s];const r=Math.floor(a/n);return Math.max(r,e)}function r(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const s="visualVariables"in t?n(i,t.visualVariables):i;if("simple"===t.type)return a(s,t.symbol);if("unique-value"===t.type){let e=s;return t.uniqueValueInfos?.forEach((t=>{e=a(e,t.symbol)})),e}if("class-breaks"===t.type){let e=s;return t.classBreakInfos.forEach((t=>{e=a(e,t.symbol)})),e}return"dot-density"===t.type||t.type,s}i.d(t,{k:()=>r})},42232:(e,t,i)=>{i.r(t),i.d(t,{DrawGraphicTool3D:()=>Zt,ExtentTransformTool:()=>Us,GraphicMoveTool:()=>Bi,GraphicReshapeTool:()=>ya,GraphicTransformTool:()=>Va});var a=i(27366),s=i(42537),n=i(92026),r=i(94172),o=i(49861),l=i(63780),h=i(25243),c=i(69912),p=i(11186),d=i(71353),u=i(74509),_=i(64575),g=i(17842),m=(i(32718),i(10064),i(93169)),y=i(85015),v=i(14921),f=i(66978),b=i(58935),M=i(68860),S=i(88396),x=i(6394),w=i(69662),C=i(41201),O=i(51995);i(42877);let E=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),A=(e,t,i)=>{for(let a=0,s=t.length;a<s;a++){let s=t[a];Array.isArray(s)?A(e,s,i):null!=s&&!1!==s&&("string"==typeof s&&(s=E(s)),i.push(s))}};i(88367);const T={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let R=class extends y.Z{constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new O.Z([0,0,0,.6]),this.textColor=new O.Z([255,255,255]),this._textShadowSize=1}get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const e=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${e}`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}render(){return function(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let a,s;return i&&1===i.length&&"string"==typeof i[0]?a=i[0]:i&&(s=[],A(e,i,s),0===s.length&&(s=void 0)),{vnodeSelector:e,properties:t,children:s,text:""===a?void 0:a,domNode:null}}("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const i=this._padding,a=this._borderRadius,s=e.measureText(this.text).width,n=this.fontSize,r=G[this.anchor];e.textAlign="center",e.textBaseline="middle";const o=s+2*i,l=n+2*i,h=this.x+r.x*o,c=this.y+r.y*l;this._roundedRect(e,h,c,o,l,a),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const p=this.x+(r.x+.5)*o,d=this.y+(r.y+.5)*l;this._renderTextShadow(e,this.text,p,d),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,p,d)}_renderTextShadow(e,t,i,a){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/P.length})`;const s=this._textShadowSize;for(const[n,r]of P)e.fillText(t,i+s*n,a+s*r)}_roundedRect(e,t,i,a,s,n){e.beginPath(),e.moveTo(t,i+n),e.arcTo(t,i,t+n,i,n),e.lineTo(t+a-n,i),e.arcTo(t+a,i,t+a,i+n,n),e.lineTo(t+a,i+s-n),e.arcTo(t+a,i+s,t+a-n,i+s,n),e.lineTo(t+n,i+s),e.arcTo(t,i+s,t,i+s-n,n),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};for(const t in T)e[T[t]]=this.anchor===t;return e}};(0,a._)([(0,o.Cb)()],R.prototype,"x",void 0),(0,a._)([(0,o.Cb)()],R.prototype,"y",void 0),(0,a._)([(0,o.Cb)()],R.prototype,"position",null),(0,a._)([(0,o.Cb)()],R.prototype,"text",void 0),(0,a._)([(0,o.Cb)()],R.prototype,"fontSize",void 0),(0,a._)([(0,o.Cb)()],R.prototype,"anchor",void 0),(0,a._)([(0,o.Cb)()],R.prototype,"visible",void 0),(0,a._)([(0,o.Cb)()],R.prototype,"backgroundColor",void 0),(0,a._)([(0,o.Cb)()],R.prototype,"textColor",void 0),(0,a._)([(0,o.Cb)()],R.prototype,"_textShadowSize",void 0),(0,a._)([(0,o.Cb)()],R.prototype,"_textShadowColor",null),(0,a._)([(0,o.Cb)()],R.prototype,"_textShadow",null),(0,a._)([(0,o.Cb)()],R.prototype,"_padding",null),(0,a._)([(0,o.Cb)()],R.prototype,"_borderRadius",null),R=(0,a._)([(0,c.j)("esri.views.overlay.TextOverlayItem")],R);const G={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},P=[];{const e=16;for(let t=0;t<360;t+=360/e)P.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const D=R;var I=i(59418);const z={default:15,far:25};let L=class extends y.Z{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=(0,v.vr)((async e=>{const t=await(0,C.ME)("esri/core/t9n/Units");(0,f.k_)(e),this._messagesUnits=t})),t=()=>(0,n.yw)(this.context,(e=>e.editGeometryOperations));this.addHandles([(0,r.YP)((()=>[(0,n.pC)(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>(0,r.on)(t,e,(()=>this._update())))),(0,s.kB)((()=>e.abort()))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return(0,n.Wi)(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((e=>e.label.text))}}get _edgeDistancePixels(){return z[this.edgeDistance]}_update(){this._nextLabelIndex=0;const e=this.context;if((0,n.Wi)(e))return void this._destroyUnusedLabels();const{components:t,geometry:i,coordinateHelper:a}=e.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const s=t.length;for(let r=0;r<s;++r){const o=[];if(t[r].iterateVertices((e=>{o.push(a.toXYZ(e.pos))})),0===r&&(0,n.pC)(this.stagedVertex)&&o.push(a.toXYZ(this.stagedVertex)),o.length<2)continue;const l=o[0],h=o[o.length-1];"polygon"===i.type&&o.length>2&&!(0,p.F)(l,h)&&o.push(l);const c=1===s&&!(0,w.bu)(o,!1,!1);let d=N,u=Z;this.toScreenPointArray(e,l,d);for(let t=1;t<o.length;++t){const i=o[t-1],a=o[t];this.toScreenPointArray(e,a,u),this._addLabel(e,i,d,a,u,c),[d,u]=[u,d]}}this._destroyUnusedLabels()}_addLabel(e,t,i,a,s,r){const{label:o}=this._getOrCreateLabel(e);if(!this.visible||(0,S.k)(i,s)<3025)return void(o.visible=!1);const l=(0,n.pC)(e.graphicState)?e.graphicState.isDraped?"on-the-ground":"absolute-height":(0,u.VW)(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:h}=e.editGeometryOperations.data,c=(0,I.MU)(t,a,h,l),p=this._messagesUnits,d=(0,M.RG)(e.view);o.text=(0,n.pC)(p)&&(0,n.pC)(c)?(0,b.N9)(p,c,d):"",o.visible=!0;const _=s[0]-i[0],g=s[1]-i[1];r?(0,S.s)(W,-g,_):(0,S.s)(W,g,-_),(0,S.f)(W,W),(0,S.b)(W,W,this._edgeDistancePixels),(0,S.l)(V,i,s,.5),(0,S.j)(V,V,W),o.position=[V[0],V[1]],Math.abs(W[0])>Math.abs(W[1])?o.anchor=W[0]>0?"left":"right":o.anchor=-W[1]<0?"top":"bottom"}_getOrCreateLabel(e){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const t=new D({fontSize:10,anchor:"center"});e.view.overlay.items.add(t);const i={label:t};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel(e){let{label:t}=e;(0,n.yw)(this.context,(e=>e.view.overlay.items.remove(t))),t.destroy()}};(0,a._)([(0,o.Cb)()],L.prototype,"context",void 0),(0,a._)([(0,o.Cb)()],L.prototype,"stagedVertex",void 0),(0,a._)([(0,o.Cb)()],L.prototype,"visible",void 0),(0,a._)([(0,o.Cb)()],L.prototype,"edgeDistance",void 0),(0,a._)([(0,o.Cb)()],L.prototype,"updating",null),(0,a._)([(0,o.Cb)()],L.prototype,"_messagesUnits",void 0),(0,a._)([(0,o.Cb)()],L.prototype,"_edgeDistancePixels",null),L=(0,a._)([(0,c.j)("esri.views.interactive")],L);const W=(0,x.a)(),V=(0,x.a)(),N=(0,g.s1)(),Z=(0,g.s1)();var k=i(11208);let U=class extends L{getCameraOrExtent(e){let{view:t}=e;return t.state.camera}toScreenPointArray(e,t){let{view:i,elevationInfo:a,editGeometryOperations:s}=e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,g.s1)();const{spatialReference:r}=s.data.coordinateHelper;return(0,k.RS)(t,r,a,i,H),i.state.camera.projectToScreen(H,n),n}};U=(0,a._)([(0,c.j)("esri.views.3d.interactive.SegmentLabels3D")],U);const H=(0,d.c)();var Y=i(585),F=i(100),B=i(90045),X=i(151),j=i(70444),Q=i(95773),q=i(85981),J=i(40885),K=i(62389),$=i(14226),ee=i(81949),te=i(86244),ie=i(68401),ae=i(59887),se=i(97882);class ne extends te.l{constructor(e){super(e.view),this._resources=null,this._transform=(0,ee.c)()}get object(){return(0,n.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,$.c)(this._transform,e),(0,n.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,n.Wi)(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new se.F({isPickable:!1,updatePolicy:ie.jq.SYNC});e.add(t);const i=new ae.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!(0,n.Wi)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((t=>{e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){(0,n.Wi)(this._resources)||this._resources.object.setVisible(e)}}var re=i(70619),oe=i(56529),le=i(4760),he=i(58901);class ce extends ne{constructor(e){super(e),this._ray=(0,J.Ue)(),this._externalResources=null,this._handles=new F.Z,this._isWorldDown=!1,this._start=(0,d.c)(),this._end=(0,d.f)(1,0,0),this._width=1,this._color=(0,X.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,X.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=ge.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=oe.yD.OccludeAndTransparent,this._fadedExtensions=ye,this.applyProps(e)}createExternalResources(){const e=new he.U(this.materialParameters);this._handles.add((0,r.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()})));const t=new K.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){(0,n.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){(0,n.pC)(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[(0,d.c)(),(0,d.c)()],i=this.extensionType===ge.FADED;i&&t.push((0,d.c)(),(0,d.c)());const a=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,s=(0,re.rh)(t,null,a);e.addGeometry(s,(0,n.Wg)(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),(0,n.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,p.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,p.b)(this._end,e,this._end),(0,J.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,p.k)(this._start,e)||((0,p.c)(this._start,e),(0,J.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,p.k)(this._end,e)||((0,p.c)(this._end,e),(0,J.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,B.g)(e,this._color)||((0,B.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,B.g)(e,this._innerColor)||((0,B.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,n.pC)(e)!==(0,n.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,n.Wi)(e)||(0,n.Wi)(this._stippleOffColor)||!(0,B.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,n.pC)(e)?(0,X.a)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,n.pC)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,(0,n.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,n.pC)(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,n.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=(0,n.Pt)(e,ye),this.recreateGeometry()}_updateMaterial(){(0,n.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){(0,n.pC)(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===ge.FADED?this._updateLineSegmentFinite(_e):this._updateLineSegmentInfinite(this._extensionType,_e);this._updateVertexAttributes(e,t),(0,n.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return(0,q.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,j.iL)(this._ray,pe),e){case ge.LINE:pe.c0=-Number.MAX_VALUE;break;case ge.RAY:case ge.GROUND_RAY:{const e=this._ray.origin,t=(0,n.Pt)(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,p.o)(pe.ray.direction,pe.ray.direction),this._extensionType===ge.GROUND_RAY&&null!=t&&(pe.c1=Math.abs(i-t));break}}if(!(0,Q.zq)(i.frustum,pe))return(0,q.zk)(this._start,this._end,t);const a=(0,j.Ws)(pe,de),s=(0,j.S$)(pe,ue);return(0,q.zk)(a,s,t)}_updateVertexAttributes(e,t){const i=e.geometries[0].getMutableAttribute(le.T.POSITION).data;if(this.extensionType===ge.FADED){const e=(0,q.KU)(t,-this.fadedExtensions.start,de);i[0]=e[0],i[1]=e[1],i[2]=e[2];const a=(0,q.KU)(t,0,de);i[3]=a[0],i[4]=a[1],i[5]=a[2];const s=(0,q.KU)(t,1,de);i[6]=s[0],i[7]=s[1],i[8]=s[2];const n=(0,q.KU)(t,1+this.fadedExtensions.end,de);i[9]=n[0],i[10]=n[1],i[11]=n[2]}else{const e=(0,q.KU)(t,0,de);i[0]=e[0],i[1]=e[1],i[2]=e[2];const a=(0,q.KU)(t,1,de);i[3]=a[0],i[4]=a[1],i[5]=a[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const pe=(0,j.Ue)(),de=(0,d.c)(),ue=(0,d.c)(),_e=(0,q.Ue)();var ge;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(ge||(ge={}));const me=1/3,ye={start:me,end:me};class ve extends ne{constructor(e){super(e),this._handles=new F.Z,this._location=(0,d.c)(),this._direction=(0,d.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,X.f)(1,0,1,1),this._renderOccluded=oe.yD.OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){(0,p.k)(this._location,e)||((0,p.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,p.k)(this._direction,e)||((0,p.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,p.n)(this._direction,(0,p.b)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,B.g)(e,this._color)||((0,B.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new he.U(this.materialParameters);this._handles.add((0,r.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=(0,re.rh)([(0,d.c)(),(0,d.c)()]),i=(0,re.rh)([(0,d.c)(),(0,d.c)()]),a=(0,n.Wg)(this._externalResources).material;e.addGeometry(t,a),e.addGeometry(i,a),this._updateVertices(e)}forEachExternalMaterial(e){(0,n.pC)(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){(0,n.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;(0,n.Wi)(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,be),(0,p.a)(fe,this.location,this.direction),t.projectToScreen(fe,Me),(0,S.f)(Me,(0,S.a)(Me,Me,be)),this._updateVertexAttributes(t,e,0,be,Me,1),this._updateVertexAttributes(t,e,1,be,Me,-1)}_updateVertexAttributes(e,t,i,a,s,n){const r=t.geometryRecords[i],o=r.geometry.getMutableAttribute(le.T.POSITION).data,l=(0,S.b)(Se,(0,S.s)(Se,s[1]*n,s[0]*-n),this.offset+this.width/2),h=(0,S.j)(xe,(0,S.j)(xe,(0,S.j)(xe,a,(0,S.b)(xe,s,this.length/2)),l),l),c=(0,S.j)(we,h,(0,S.b)(we,s,-this.length));e.unprojectFromScreen(h,fe),o[0]=fe[0],o[1]=fe[1],o[2]=fe[2],e.unprojectFromScreen(c,fe),o[3]=fe[0],o[4]=fe[1],o[5]=fe[2],t.geometryVertexAttrsUpdated(r)}}const fe=(0,d.c)(),be=(0,g.s1)(),Me=(0,g.s1)(),Se=(0,g.s1)(),xe=(0,g.s1)(),we=(0,g.s1)();var Ce=i(16889),Oe=i(67077),Ee=i(79803),Ae=i(41414),Te=i(11185),Re=i(79100),Ge=i(76873);class Pe{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return(0,n.pC)(this._resources)?this._resources.object:null}get resources(){return(0,n.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if((0,n.Wi)(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type===Re.U.Geometry&&e.remove(t)})),t.removeAllGeometries();const i=this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const a=new se.F({isPickable:!1,updatePolicy:ie.jq.SYNC});i.add(a);const s=new ae.T({castShadow:!1}),n=e.createResources(s,a);n.forEach((e=>{i.add(e),e instanceof Ge.x&&i.loadImmediate(e)})),i.add(s),a.add(s);const o=e.cameraChanged?(0,r.YP)((()=>t.state.camera),(t=>e.cameraChanged(t)),r.nn):null;this._resources={layer:a,object:s,external:n,cameraHandle:o},this._syncVisible()}_destroyResources(){if((0,n.Wi)(this._resources))return;const e=this._resourceFactory.view._stage;e?.remove(this._resources.object),e?.remove(this._resources.layer),this._resources.external.forEach((t=>{e?.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){(0,n.Wi)(this._resources)||this._resources.object.setVisible(this._visible)}}var De=i(69691),Ie=i(78935),ze=i(67794),Le=i(21400);class We{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=(0,Oe.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,Oe.f)(1,1,1,1),this._elevationInfo=null,this._resources=new Pe({view:e.view,createResources:e=>this._createResources(e),recreateGeometry:(e,t)=>(e.geometry=this._recreateGeometry(t,e.material),(0,n.pC)(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this._resources.destroy()}get visible(){return this._resources.visible}set visible(e){this._resources.visible=e}get attached(){return this._resources.attached}set attached(e){this._resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?(0,n.pC)(this._resources)&&this._resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,B.g)(e,this._color)||((0,B.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,(0,n.pC)(this._resources)&&this._resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,B.g)(e,this._outlineColor)||((0,B.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._resources&&this._resources.recreateGeometry()}_updateMaterial(){const e=this._resources.resources;(0,n.Wi)(e)||e.material.setParameters(this._materialParameters(e.texture.id))}_updateSizeAttribute(){const e=this._resources.resources,t=this._resources.object;if((0,n.Wi)(e)||(0,n.Wi)(t))return;const i=e.geometry;if((0,n.Wi)(i))return;const a=i.getMutableAttribute(le.T.SIZE).data,s=this._geometrySize;a[0]=s,a[1]=s,t.geometryVertexAttrsUpdated(t.geometryRecords[0])}_materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:Ne,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get _geometrySize(){return this._size/Ve}_recreateGeometry(e,t){const i=this._createRenderGeometry();return(0,n.pC)(i)&&e.addGeometry(i,t),i}_createResources(e){const t=(0,ze.cU)(this._primitive,this._preferredTextureSize),i=new Le.A(this._materialParameters(t.id)),a=this._recreateGeometry(e,i);return{material:i,texture:t,geometry:a,forEach(e){e(t),e(i),(0,n.pC)(this.geometry)&&e(this.geometry)}}}get _preferredTextureSize(){return(0,Ce.uZ)((0,Ce.Sf)(2*this._geometrySize),16,128)}calculateMapBounds(e){if((0,n.Wi)(this._resources.resources)||(0,n.Wi)(this._resources.resources.geometry))return!1;const t=this._resources.resources.geometry.vertexAttributes.get(le.T.POSITION);return(0,Ee.SH)(t.data,this.view.renderCoordsHelper.spatialReference,Ze,this.view.spatialReference),(0,Ae.G1)(e,Ze),!0}_createRenderGeometry(){const e=this.geometry;if((0,n.Wi)(e))return null;const{renderCoordsHelper:t,elevationProvider:i}=this.view,a=(0,De.w7)(e,i,Ie.o.fromElevationInfo(this.elevationInfo),t),s=(0,p.s)(Te.WM.get(),e.x,e.y,a),r=Te.WM.get();(0,Ee.SH)(s,e.spatialReference,r,t.spatialReference);const o=this._geometrySize;return(0,re.dV)(null,r,null,[o,o],[0,0,0,1])}}const Ve=ze.Ns,Ne=[Ve/2,Ve/2,1-Ve/2,1-Ve/2],Ze=(0,d.c)();var ke=i(74894),Ue=i(66832);class He extends ne{constructor(e){super(e),this._handles=new F.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,d.c)(),this._up=(0,d.c)(),this._right=(0,d.c)(),this._renderOccluded=oe.yD.OccludeAndTransparent,this._color=(0,X.f)(1,0,0,1),this._outlineColor=(0,X.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=oe.yD.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,B.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,B.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:i,next:a}=e;this._maxSize=Math.min((0,p.i)(i,t),(0,p.i)(i,a))/3,(0,p.n)(this._up,(0,p.b)(this._up,t,i)),(0,p.n)(this._right,(0,p.b)(this._right,a,i)),(0,p.c)(this._position,i),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new Ue.E(this._quadMaterialParameters),this._outlineMaterial=new he.U(this._outlineMaterialParameters),this._handles.add((0,r.YP)((()=>this.view.state.camera),(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){(0,p.k)(this._up,d.Z)&&(0,p.k)(this._right,d.Z)||(this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e))}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,p.a)(Te.WM.get(),this._up,this._right),i=(0,re.rh)([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,i);(0,$.f)(Ye,this._position),(0,$.k)(Ye,Ye,[a,a,a]),(0,n.pC)(e)&&(e.transformation=Ye)}_quadGeometryData(e,t){const i=(0,p.a)(Te.WM.get(),e,t);return new ke.Z([[le.T.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[le.T.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this._outlineMaterialParameters)}}const Ye=(0,ee.c)();var Fe=i(76014),Be=i(80371),Xe=i(64674),je=i(38561);class Qe extends je.a{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,view:a}=t;return(0,s.ed)(new We({view:a,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:(0,n.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:O.Z.toUnitRGBA(Fe.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{view:i,coordinateHelper:a}=t,n=this._alignPoint(e.point,e.domain,t);return(0,s.ed)(new We({view:i,primitive:"circle",geometry:a.vectorToPoint(n),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:O.Z.toUnitRGBA(Fe.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{view:i,coordinateHelper:a}=t,n=this._alignPoint(e.lineStart,e.domain,t),r=this._alignPoint(e.lineEnd,e.domain,t);return(0,s.ed)(this._createLineSegmentHintFromMap(e.type,n,r,a,this._hintElevationInfo(e,t),i,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,coordinateHelper:a}=t,n=this._hintElevationInfo(e,t),r=this._alignPoint(e.lineStart,e.domain,t),o=this._alignPoint(e.lineEnd,e.domain,t),l=(0,k.$r)(r,a,n,i),h=(0,k.$r)(o,a,n,i),c=(0,p.h)(h,l,h,.5),d=new ve({view:i,attached:!1,offset:Fe.c.parallelLineHintOffset,length:Fe.c.parallelLineHintLength,width:Fe.c.parallelLineHintWidth,color:O.Z.toUnitRGBA(Fe.c.orange),location:c,renderOccluded:oe.yD.Opaque});return d.setDirectionFromPoints(l,c),d.attached=!0,(0,s.ed)(d)}visualizeRightAngleQuad(e,t){const{view:i,coordinateHelper:a}=t,n=this._hintElevationInfo(e,t),r=this._alignPoint(e.previousVertex,e.domain,t),o=this._alignPoint(e.centerVertex,e.domain,t),l=this._alignPoint(e.nextVertex,e.domain,t);return(0,s.ed)(new He({view:i,attached:!0,color:O.Z.toUnitRGBA(Fe.c.orange),renderOccluded:oe.yD.Transparent,outlineRenderOccluded:oe.yD.Opaque,outlineColor:O.Z.toUnitRGBA(Fe.c.orange),outlineSize:Fe.c.rightAngleHintOutlineSize,size:Fe.c.rightAngleHintSize,geometry:{previous:(0,k.$r)(r,a,n,i),center:(0,k.$r)(o,a,n,i),next:(0,k.$r)(l,a,n,i)}}))}_createLineSegmentHintFromMap(e,t,i,a,s,n){let r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=(0,d.c)(),h=(0,d.c)();return(0,k.By)(t,i,a,s,n,l,h),this._createLineSegmentHint(e,n,l,h,r,o)}_createLineSegmentHint(e,t,i,a){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const r=new ce({view:t,extensionType:ge.FADED,start:i,end:a,color:O.Z.toUnitRGBA(Fe.c.orange),renderOccluded:oe.yD.Opaque});switch(e){case Xe.ze.TARGET:r.width=Fe.c.lineHintWidthTarget,r.fadedExtensions={start:0,end:Fe.c.lineHintFadedExtensions};break;case Xe.ze.REFERENCE_EXTENSION:r.width=Fe.c.lineHintWidthReference,r.fadedExtensions={start:0,end:0};break;case Xe.ze.REFERENCE:r.width=Fe.c.lineHintWidthReference,r.fadedExtensions={start:s?Fe.c.lineHintFadedExtensions:0,end:n?Fe.c.lineHintFadedExtensions:0}}return r.attached=!0,r}_alignPoint(e,t,i){const a=this._getSelfSnappingZ(t,i);if((0,n.Wi)(a))return e;const s=i.coordinateHelper,r=s.vectorToPoint(e,qe);return r.z=a,s.pointToVector(r)}_hintElevationInfo(e,t){return(0,n.pC)(this._getSelfSnappingZ(e.domain,t))?(0,n.Wg)(t.selfSnappingZ).elevationInfo:(0,n.Pt)(e.elevationInfo,t.elevationInfo)}_getSelfSnappingZ(e,t){let{selfSnappingZ:i}=t;return e===Be.B.SELF&&(0,n.pC)(i)?i.value:null}}const qe=new Y.Z;var Je=i(86950),Ke=i(86700);const $e={main:new O.Z([255,127,0]),selected:new O.Z([255,255,255]),staged:new O.Z([12,207,255]),outline:new O.Z([0,0,0,.5]),selectedOutline:new O.Z([255,255,255])},et=.3;function tt(e,t){const i=e.clone();return i.a*=t,i}function it(e,t){const i=e.clone(),a=(0,Je._Y)(i);a.s*=t;const s=(0,Je.xr)(a);return i.r=s.r,i.g=s.g,i.b=s.b,i}function at(e,t){if(t)for(const i in t)e[i]=t[i]}class st{constructor(e){this.color=$e.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=oe.yD.Opaque,at(this,e)}}class nt{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=$e.main,this.outlineColor=$e.outline,this.renderOccluded=oe.yD.Opaque,this.hoverOutlineColor=$e.selectedOutline,at(this,e)}apply(e,t){const i=this[e];t.setParameters({color:gt(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class rt{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=tt($e.main,.5),this.hoverColor=$e.main,this.renderOccluded=oe.yD.Transparent,this.minSquaredEdgeLength=900,at(this,e)}apply(e,t){const i=this[e];t.setParameters({color:gt(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class ot{constructor(e){this.vertex=new nt({color:$e.main,outlineColor:$e.outline}),this.edge=new nt({color:it(tt($e.main,2/3),.5),outlineColor:tt($e.outline,.5),size:8,collisionPadding:8}),this.selected=new nt({color:$e.selected,outlineColor:$e.outline}),this.edgeOffset=new rt,at(this,e)}}class lt{constructor(e){this.color=$e.selected,this.width=1.5,this.stipplePattern=(0,Ke.z5)(5),this.stippleOffColor=$e.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=$e.selected,this.renderOccluded=oe.yD.OccludeAndTransparent,at(this,e)}apply(e){e.color=gt(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=gt(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=gt(this.innerColor),e.renderOccluded=this.renderOccluded}}class ht{constructor(e){this.color=$e.selected,this.size=4,this.outlineSize=1,this.outlineColor=$e.outline,this.shape="square",at(this,e)}apply(e){e.color=gt(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=gt(this.outlineColor),e.primitive=this.shape}}class ct{constructor(e){this.innerColor=$e.selected,this.innerWidth=1,this.glowColor=$e.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=et,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=$e.main,at(this,e)}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i={glowColor:O.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:O.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class pt{constructor(e){this.outline=new lt({color:$e.outline,renderOccluded:oe.yD.OccludeAndTransparentStencil,stippleOffColor:$e.selected,stipplePattern:(0,Ke.z5)(5),width:1.5,innerWidth:0}),this.staged=new lt({color:$e.selected,renderOccluded:oe.yD.OccludeAndTransparentStencil,innerColor:$e.staged,stippleOffColor:$e.outline,stipplePattern:(0,Ke.z5)(5),width:1.5}),this.shadowStyle=new ct({globalAlpha:et,glowColor:$e.main,glowFalloff:8,glowWidth:8,innerColor:$e.selected,innerWidth:1}),at(this,e)}}class dt{constructor(e){this.outline=new ht({color:$e.selected,outlineColor:$e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new ct({globalAlpha:et,glowColor:$e.main,glowFalloff:1.5,glowWidth:6,innerColor:$e.selected,innerWidth:1,radius:2}),at(this,e)}}class ut extends lt{constructor(e){super(),this.extensionType=ge.GROUND_RAY,at(this,e)}}class _t{constructor(e){this.lineGraphics=new pt,this.pointGraphics=new dt,this.heightPlane=new ct({globalAlpha:et,glowColor:$e.main,glowFalloff:8,glowWidth:8,innerColor:$e.selected,innerWidth:1}),this.heightBox=new ct({globalAlpha:et,glowColor:$e.main,glowFalloff:8,glowWidth:8,innerColor:$e.selected,innerWidth:0,heightFillColor:$e.main}),this.zVerticalLine=new ut({color:tt($e.main,.5),falloff:2,innerColor:tt($e.selected,0),renderOccluded:oe.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:ge.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,at(this,e)}}function gt(e){return(0,Oe.b)(O.Z.toUnitRGBA(e))}const mt=new class{constructor(e){this.visualElements=new _t,this.reshapeManipulators=new ot,this.zManipulator=new st,at(this,e)}colorToVec4(e){return gt(e)}};var yt=i(91505),vt=i(65618),ft=i(79056),bt=i(26279),Mt=i(78289);class St{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return(0,n.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?(0,n.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,n.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new xt({view:this._resourceFactory.view}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new xt({view:this._resourceFactory.view}),external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if((0,n.Wi)(this._resources))return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){(0,n.Wi)(this._resources)||(0,n.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,Mt.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){(0,n.Wi)(this._resources)||(0,n.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,Mt.T.UPDATE),this._resources.geometriesAdded=!0)}}let xt=class extends((0,ft.IG)(y.Z)){constructor(e){super(e),this.drapeSourceType=bt.L.Features,this.updatePolicy=ie.jq.SYNC}};(0,a._)([(0,o.Cb)({constructOnly:!0})],xt.prototype,"view",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],xt.prototype,"drapeSourceType",void 0),xt=(0,a._)([(0,c.j)("DrapedVisualElementLayerView")],xt);var wt=i(79685),Ct=i(78081),Ot=i(81955),Et=i(69831);class At{constructor(e){this.view=null,this._attachmentOrigin=(0,vt.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new yt.Z,this._isDraped=!1,this._geometry=null,this._width=1,this._color=(0,X.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,X.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=oe.yD.OccludeAndTransparentStencil,this._resources=new Pe({view:e.view,createResources:e=>this._createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this._drapedResources=new St({view:e.view,createResources:()=>this._createDrapedResources(),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}});let t=!0;this._laserline=new K.W({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this._resources.destroy(),this._drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this._updateAttached(this.attached),this._laserline.attached=this._laserlineAttached)}get _laserlineAttached(){return this.attached&&this.visible&&(0,n.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this._resources.visible}set visible(e){this._resources.visible=e,this._drapedResources.visible=e,this._laserline.attached=this._laserlineAttached}get attached(){return this._resources.attached||this._drapedResources.attached}set attached(e){this._updateAttached(e)}_updateAttached(e){this._resources.attached=!this.isDraped&&e,this._drapedResources.attached=this.isDraped&&e,this._laserline.attached=this._laserlineAttached,this.attached&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._resources.recreateGeometry(),this._drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,B.g)(e,this._color)||((0,B.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,B.g)(e,this._innerColor)||((0,B.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,n.pC)(e)!==(0,n.pC)(this._stipplePattern);this._stipplePattern=e,t?this._resources.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,B.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,X.a)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,(0,n.pC)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=(0,n.pC)(this._resources.resources)?this._resources.resources.geometries:null;if(!e||0===e.length)return null;(0,p.s)(Gt,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get(le.T.POSITION),a=i.indices.get(le.T.POSITION),s=(0,n.Wg)(this._resources.resources).material.isClosed(e.data,a);(0,Ot.qZ)(e,a,s,Rt)&&((0,p.a)(Gt,Gt,Rt),t++)}return 0===t?null:((0,p.g)(Gt,Gt,1/t),this.view.renderCoordsHelper.fromRenderCoords(Gt,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){(0,n.pC)(this._resources.resources)&&this._resources.resources.material.setParameters(this._materialParameters),(0,n.pC)(this._drapedResources.resources)&&this._drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return(0,n.pC)(this.geometry)&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===oe.yD.OccludeAndTransparentStencil?oe.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,i){const a=this._createRenderGeometries();for(const s of a)e.addGeometry(s,t),i.push(s);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createResources(e){const t=new he.U(this._materialParameters),i=[];return this._recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_createDrapedResources(){const e=new he.U(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const t=this.geometry;if((0,n.Wi)(t)||(0,n.Wi)(this.view.basemapTerrain.spatialReference))return[];const i=(0,Ct.r)(t,this.view.basemapTerrain.spatialReference),a=[];for(const{position:s}of i.lines){const t={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:s},removeDuplicateStartEnd:this._isClosed},i=new Et.z((0,wt.YU)(t),e),n=(0,Ae.cS)(Tt);(0,Ae.G1)(n,s),(0,B.s)(i.boundingSphere,.5*(n[0]+n[3]),.5*(n[1]+n[4]),0,.5*Math.sqrt((n[3]-n[0])*(n[3]-n[0])+(n[4]-n[1])*(n[4]-n[1]))),a.push(i)}return a}calculateMapBounds(e){if((0,n.Wi)(this._resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this._resources.resources.geometries){const a=i.vertexAttributes.get(le.T.POSITION),s=new Float64Array(a.data.length);(0,Ee.CM)(a.data,t.spatialReference,0,s,this.view.spatialReference,0,a.data.length/3),(0,Ae.G1)(e,s)}return!0}_createRenderGeometries(){const e=this.geometry;if((0,n.Wi)(e))return[];const t=(0,Ct.V)(e,this.view.elevationProvider,this.view.renderCoordsHelper,Ie.o.fromElevationInfo(this.elevationInfo??new _.Z({mode:(0,u.VW)(e,null)}))),i=[],a=[];for(const{position:s,mapPosition:n}of t.lines){const e={attributeData:{position:s,mapPosition:n},removeDuplicateStartEnd:this._isClosed};i.push((0,wt.YU)(e)),a.push(s)}return this._laserline.pathVerticalPlane=a,i}}const Tt=(0,Ae.Ue)(),Rt=(0,d.c)(),Gt=(0,d.c)();var Pt=i(11606);class Dt extends ne{constructor(e){super(e),this.view=null,this._renderOccluded=oe.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=mt.colorToVec4(mt.reshapeManipulators.vertex.color),this._size=mt.reshapeManipulators.vertex.size,this._outlineColor=mt.colorToVec4(mt.reshapeManipulators.vertex.outlineColor),this._outlineSize=mt.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,B.g)(e,this._color)||((0,B.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,B.g)(e,this._outlineColor)||((0,B.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if((0,n.Wi)(e)||0===e.length)return[];const t=function(e,t,i,a,s){const n=new Float64Array(3*e.length),r=new Float64Array(n.length);e.forEach(((e,t)=>{n[3*t+0]=e[0],n[3*t+1]=e[1],n[3*t+2]=e.length>2?e[2]:0}));const o=(0,De.rR)(n,t,0,r,0,n,0,n.length/3,i,a,s),l=null!=o;return{numVertices:e.length,position:n,mapPosition:r,projectionSuccess:l,sampledElevation:o}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Ie.o.fromElevationInfo(this.elevationInfo)),i=[],a=t.numVertices,s=t.position;for(let n=0;n<a;++n){const e=(0,p.s)(It,s[3*n+0],s[3*n+1],s[3*n+2]),t=zt(.5,e),a=zt(.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:a})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of t)e.addGeometry(i,this._vertexMaterial),e.addGeometry(a,this._vertexOutlineMaterial)}createExternalResources(){this._vertexMaterial=new Pt.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:ie.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Pt.Q({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:ie.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const It=(0,d.c)();function zt(e,t){return(0,re.PI)(e,16,16,{offset:t})}let Lt=class extends yt.Z.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,a._)([(0,o.Cb)({constructOnly:!0})],Lt.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)()],Lt.prototype,"tracking",void 0),(0,a._)([(0,o.Cb)()],Lt.prototype,"displaying",void 0),(0,a._)([(0,o.Cb)()],Lt.prototype,"isDraped",void 0),Lt=(0,a._)([(0,c.j)("esri.views.3d.layers.graphics.GraphicState")],Lt);var Wt=i(90799),Vt=i(66038),Nt=i(54016);let Zt=class extends Wt.T{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new _.Z({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:(0,u.mF)(t)}}return e}initializeGraphic(e){const t=this._createGraphicState=new Lt({graphic:e});return(0,s.AL)([this.view.maskOccludee(e),this.view.trackGraphicState(t),(0,r.YP)((()=>({element:this._outlineVisualElement,isDraped:t.isDraped})),(e=>{let{element:t,isDraped:i}=e;(0,n.yw)(t,(e=>e.isDraped=i))}),r.nn)])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new Vt.w({view:this.view,manipulators:this.manipulators,geometryType:(0,Wt.I)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Nt.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Nt.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Qe,segmentLabels:t?new U:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:(0,n.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,u.Zz)(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(e){const{view:t}=this;return(0,n.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],this._updateVerticalLineVisualElement(e),null):(this._activeVertexVisualElement=new Dt({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:mt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=mt.colorToVec4(mt.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new ce({view:t,extensionType:mt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:oe.yD.OccludeAndTransparent}),mt.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),(0,s.kB)((()=>{this._activeVertexVisualElement=(0,n.SC)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,n.SC)(this._verticalLineVisualElement)})))}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if((0,n.Wi)(t))return;const{renderCoordsHelper:i,spatialReference:a,elevationProvider:s}=this.view;(0,p.s)(Ut,e[0],e[1],e[2]),kt.setFromElevationInfo(this.elevationInfo),Ut[2]=(0,De.w7)(Ut,s,kt,i),i.toRenderCoords(Ut,a,Ut)?(t.setStartEndFromWorldDownAtLocation(Ut),t.attached=!0):t.attached=!1}onOutlineChanged(e){if((0,n.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new At({view:this.view,geometry:e,elevationInfo:t,isDraped:(0,n.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,u.Zz)(this.hasZ,t),attached:!1}),mt.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),mt.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,s.kB)((()=>{this._outlineVisualElement=(0,n.SC)(this._outlineVisualElement)}))}onRegularVerticesChanged(e){return(0,n.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new Dt({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:mt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,s.kB)((()=>{this._verticesVisualElement=(0,n.SC)(this._verticesVisualElement)})))}};(0,a._)([(0,o.Cb)({constructOnly:!0})],Zt.prototype,"elevationInfo",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Zt.prototype,"geometryType",void 0),(0,a._)([(0,o.Cb)()],Zt.prototype,"type",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Zt.prototype,"view",void 0),Zt=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Zt);const kt=new Ie.o,Ut=(0,d.c)();var Ht=i(40281),Yt=i(41691),Ft=i(47898),Bt=i(30036),Xt=i(77498);function jt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,u.RL)(e);return"on-the-ground"!==t.mode&&!((0,n.Wi)(e.geometry)||!e.geometry.hasZ)}var Qt,qt,Jt=i(35284);!function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"}(Qt||(Qt={})),function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"}(qt||(qt={}));class Kt{constructor(){this.grabbingState=Qt.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Qt.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(t===qt.TRANSLATE_Z&&(this.zManipulator=e),e instanceof Jt.Z&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),(0,n.Wi)(this.firstGrabbedXY)&&e.grabbing&&t===qt.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=Qt.ANY,t){case qt.TRANSLATE_Z:this.grabbingState|=Qt.Z;break;case qt.TRANSLATE_XY:this.grabbingState|=Qt.XY}}))}}function $t(e){const{view:t,graphic:i}=e,a=new Lt({graphic:i}),n=function(e,t){const{view:i,graphic:a}=e,n=new At({view:i,geometry:ti(a)?a.geometry:null,elevationInfo:(0,u.RL)(a),attached:!1});mt.visualElements.lineGraphics.shadowStyle.apply(n);const o=()=>{n.attached=t.displaying};mt.visualElements.lineGraphics.outline.apply(n);const l=[(0,r.YP)((()=>t.displaying),o),(0,r.YP)((()=>t.isDraped),(e=>{n.isDraped=e})),t.on("changed",(()=>n.geometry=ti(a)?a.geometry:null)),(0,s.ed)(n)];return o(),{visualElement:n,remove:()=>(0,s.AL)(l).remove()}}(e,a),o=[n,ei(e,n.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:n.visualElement,remove:()=>(0,s.AL)(o).remove()}}function ei(e,t,i){const{graphic:a,view:o}=e,l=[],h=(0,u.RL)(a),c="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,d=new Kt,_=new ce({view:o,extensionType:mt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:oe.yD.OccludeAndTransparent});mt.visualElements.pointGraphics.shadowStyle.apply(_);const g=(0,Ce.Vl)(mt.visualElements.heightPlaneAngleCutoff),m=new K.W({view:o,attached:!1,angleCutoff:g});mt.visualElements.heightPlane.apply(m);let y=1,v=1;const f=()=>{if(d.update(e),!i.displaying||c&&(i.isDraped||!ti(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,_.attached=!1,void(m.attached=!1);t.laserlineEnabled=!0;{const e=d.grabbingState&Qt.XY?mt.visualElements.laserlineAlphaMultiplier:1;e!==y&&(y=e,mt.visualElements.lineGraphics.shadowStyle.apply(t,e),mt.visualElements.pointGraphics.shadowStyle.apply(_,e))}{const e=d.grabbingState&Qt.Z?mt.visualElements.laserlineAlphaMultiplier:1;e!==v&&(v=e,mt.visualElements.heightPlane.apply(m,e))}(function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&(0,n.pC)(t.firstGrabbedXY)?t.firstGrabbedXY:null;(0,n.pC)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1})(_,d),function(e,t,i,a){if(a.numSelected>0){(0,p.s)(ii,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{i===qt.TRANSLATE_XY&&e.selected&&e instanceof Jt.Z&&((0,p.a)(ii,ii,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=(0,p.g)(ii,ii,1/t),i.attached=!0):i.attached=!1}else{const a=t.attachmentOrigin;(0,n.pC)(a)&&e.view.renderCoordsHelper.toRenderCoords(a,ii)?(i.heightManifoldTarget=ii,i.attached=!0):i.attached=!1}}(e,t,m,d)};mt.visualElements.zVerticalLine.apply(_),l.push(i.on("changed",f),(0,r.YP)((()=>i.displaying),f),t.events.on("attachment-origin-changed",f),(0,s.ed)(_),(0,s.ed)(m));const b=[],M=()=>{(0,s.AL)(b).remove(),b.length=0,e.forEachManipulator((e=>b.push(e.events.on("grab-changed",f)))),e.forEachManipulator((e=>b.push(e.events.on("select-changed",f)))),f()};return M(),l.push(e.onManipulatorsChanged(M),(0,s.iU)((()=>(0,s.AL)(b)))),(0,s.AL)(l)}function ti(e){return(0,n.pC)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const ii=(0,d.c)();var ai=i(65156);function si(e){const{view:t,graphic:i}=e,a=new Lt({graphic:i}),o=[],l=function(e,t,i){const{view:a,graphic:o}=e,l=new We({view:a,geometry:ni(o),elevationInfo:(0,u.RL)(o),attached:!1});return function(e,t,i,a){const o=()=>t.attached=i.displaying;(function(e,t,i,a){const{view:r,graphic:o}=e;let l=null;const h=e=>{(0,n.pC)(l)&&(l.remove(),l=null),i.isDraped&&(0,n.pC)(e)&&(l=function(e,t,i){const a=e.elevationProvider.spatialReference;(0,Ee.KC)(t,ri,a);const s=ri[0],n=ri[1];return e.elevationProvider.on("elevation-change",(e=>{(0,ai.jE)(e.extent,s,n)&&i()}))}(r,e,(()=>{t.geometry=e})))},c=()=>{const e=ni(o);h(e),t.geometry=e};a.push(i.on("changed",c),(0,s.iU)((()=>l))),c()})(e,t,i,a),mt.visualElements.pointGraphics.outline.apply(t),a.push((0,r.YP)((()=>i.displaying),o,r.nn))}(e,l,t,i),i.push((0,s.ed)(l)),l}(e,a,o);return function(e,t,i,a){const{view:o,graphic:l}=e,h=new ce({view:o,extensionType:mt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:oe.yD.OccludeAndTransparent});mt.visualElements.zVerticalLine.apply(h);const c=new K.W({view:o,intersectsLineInfinite:!0,attached:!1});mt.visualElements.pointGraphics.shadowStyle.apply(c);const d=(0,Ce.Vl)(mt.visualElements.heightPlaneAngleCutoff),_=new K.W({view:o,attached:!1,angleCutoff:d});mt.visualElements.heightPlane.apply(_);const g=(0,u.RL)(e.graphic),m=Ie.o.fromElevationInfo(g),y="on-the-ground"===g.mode||!g.offset&&"absolute-height"!==g.mode,v=new Kt;let f=1,b=1;const M=()=>{v.update(e);const i=ni(l),s=y&&(t.isDraped||(0,n.Wi)(i)||!i.hasZ);let r=!0;if(!s&&(0,n.pC)(i)){const e=(0,De.w7)(i,o.elevationProvider,m,o.renderCoordsHelper);(0,p.s)(ri,i.x,i.y,e),(0,Ee.SH)(ri,i.spatialReference,ri,o.renderCoordsHelper.spatialReference),h.setStartEndFromWorldDownAtLocation(ri),c.intersectsWorldUpAtLocation=ri}else r=!1;const d=v.grabbingState&Qt.Z?mt.visualElements.laserlineAlphaMultiplier:1;d!==f&&(f=d,mt.visualElements.heightPlane.apply(_,d));const u=(0,Ae.cS)(oi);!s&&t.displaying&&a.calculateMapBounds(u)&&(0,Ee.SH)((0,Ae.KE)(u,ri),o.spatialReference,ri,o.renderCoordsHelper.spatialReference)?(_.heightManifoldTarget=ri,_.attached=!0):_.attached=!1;const g=v.grabbingState&Qt.XY?mt.visualElements.laserlineAlphaMultiplier:1;g!==b&&(b=g,mt.visualElements.pointGraphics.shadowStyle.apply(c,g));const M=r&&t.displaying&&!s;c.attached=M,h.attached=M};i.push((0,r.YP)((()=>[t.displaying,t.isDraped]),M),t.on("changed",M)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",M))})),i.push((0,s.ed)(c)),i.push((0,s.ed)(h)),i.push((0,s.ed)(_)),M()}(e,a,o,l),o.push(t.trackGraphicState(a)),{visualElement:l,remove(){(0,s.AL)(o).remove()}}}function ni(e){const t=e.geometry;return(0,n.Wi)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const ri=(0,d.c)(),oi=(0,Ae.Ue)();function li(e){switch((0,n.Wg)(e.graphic.geometry).type){case"point":case"mesh":return si(e);case"polygon":case"polyline":return $t(e);default:return null}}const hi=[1,.5,0],ci=70,pi=Math.ceil(ci/3*2),di=160,ui=5*Math.PI/12,_i=1*Math.PI/3;class gi{constructor(){this._available=!0}set location(e){this._forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this._forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this._forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this._forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D((t=>t.available=e))}get hovering(){return this.someManipulator((e=>e.hovering))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}_forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof Jt.Z&&e(t,i)}))}}var mi=i(51328),yi=i(74229);function vi(e,t,i,a){const s=e.graphic,n=(e,i)=>t({action:e,graphic:s,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((e,t,i)=>{const r=t.next((e=>("start"===e.action&&n("start",e),e))).next((0,yi.a9)(s,a)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&n("update",e);break;case"end":n("end",e)}return e}));return i.next((0,yi.bD)(s)).next((()=>{n("end",{screenDeltaX:0,screenDeltaY:0})})),r}))}function fi(e){if((0,n.Wi)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],a=t[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}function bi(e){if((0,n.Wi)(e)||(0,n.Wi)(e.axis))return 1;const{mapStart:t,mapEnd:i,axis:a}=e,s=[i.x-t.x,i.y-t.y];return s[0]*a[0]+s[1]*a[1]>0?1:-1}var Mi=i(99034);class Si extends gi{constructor(e){super(),this._handles=new F.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=ci,this._updateAfterDrag=!1,this.events=new yt.Z,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._handles=(0,n.SC)(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,qt.TRANSLATE_XY)}createGraphicDragPipeline(e,t,i){const a=t.graphic,s=(0,u.RL)(a),r=(0,n.Wg)(a.geometry).spatialReference;return vi(t,i,(t=>this.createDragPipeline(((i,a,s,n,r)=>t(i,e(i,a,s,n,r),s)),s,r,a)),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){return(0,s.AL)(this._arrowManipulatorInfos.map(((s,n)=>{let{manipulator:r}=s;return(0,yi.Xd)(r,((s,r,o,l,h)=>{const c=r.next((e=>({...e,manipulatorType:qt.TRANSLATE_XY}))).next((0,yi.kY)(this._view,s.elevationAlignedLocation)).next((0,mi.G)(this._view,s.elevationAlignedLocation,t,i,a)).next((0,yi.M2)(s.location,this.angle+(n+1)*Math.PI*.5)).next((0,yi.zh)());e(s,c,o,l,h)}))})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator(e,t){let{manipulator:i,transform:a}=e;const s=this._radius/ci,n=54*s,r=n*Math.sqrt(3)/2,o=(0,re.DA)(r,n/2,n/2,.02);(0,re.mx)(o,(0,$.f)(Te.MP.get(),(0,p.s)(Te.WM.get(),0,-r/3,0))),i.renderObjects=[{geometry:o,material:this._opaqueMaterial,stateMask:Mi.Q9.Focused},{geometry:o,material:this._transparentMaterial,stateMask:Mi.Q9.Unfocused}],i.radius=r/3*2*1.2;const l=(0,$.b)(Te.MP.get(),t*Math.PI/2),h=(0,$.f)(Te.MP.get(),(0,p.s)(Te.WM.get(),0,100*s,0));(0,$.m)(a,l,h)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=(0,$.d)(Te.MP.get(),e,(0,d.f)(0,0,1));if((0,n.Wi)(t))return;const i=(0,$.C)(Te.MP.get(),(0,p.s)(Te.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,$.m)(Te.MP.get(),i,t);for(const s of this._arrowManipulatorInfos){const e=(0,$.m)(Te.MP.get(),a,s.transform);s.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new Jt.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,d.f)(0,0,1)}}),i={manipulator:t,transform:(0,ee.c)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=O.Z.toUnitRGBA($e.main);return t[3]*=e,new Ue.E({color:t,transparent:1!==e,cullFace:ie.Vr.Back,renderOccluded:oe.yD.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((e=>{let{manipulator:t}=e;return t}))}}}class xi{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this.next=new yi.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&(0,n.pC)(this._lastDragEvent)){const t=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if((0,n.pC)(i)){const a={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=e}_snap(e){const t=(0,n.pC)(this._view)?this._view.toMap(e,{exclude:[]}):null;return(0,n.pC)(t)&&(0,n.pC)(this._view)&&(t.z=(0,u.Ou)(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){return this._view=e,this._elevationInfo=t,this._lastDragEvent=null,e=>{if(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return(0,n.pC)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class wi extends gi{constructor(e){super(),this._snapToScene=new xi,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=ci,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,qt.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const a=t.graphic,s=(0,u.RL)(a),r=(0,n.Wg)(a.geometry).spatialReference;return vi(t,i,(t=>this.createDragPipeline(((i,a,s,n,r)=>t(i,e(i,a,s,n,r),s)),s,r,a)),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){const s=this._view;return(0,yi.Xd)(this._manipulator,((n,r,o,l,h)=>{const c=r.next((0,yi.kY)(s,n.elevationAlignedLocation)).next((0,mi.G)(s,n.elevationAlignedLocation,t,i,a)).next(this._snapToScene.createDragEventPipelineStep(s,t),this._snapToScene.next).next((e=>({...e,manipulatorType:qt.TRANSLATE_XY}))).next((0,yi.zh)());e(n,c,o,l,h)}))}_updateManipulatorTransform(){const e=(0,$.C)(Te.MP.get(),(0,p.s)(Te.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Jt.Z({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,d.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=(0,re.nb)(.02,1,128,(0,d.f)(0,0,1),(0,d.f)(0,0,0)),t=(0,$.C)((0,ee.c)(),(0,d.f)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:Mi.Q9.Focused},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:Mi.Q9.Unfocused}],this._manipulator.radius=this._radius/ci*80}_createMaterial(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=O.Z.toUnitRGBA($e.main);return t[3]*=e,new Ue.E({color:t,transparent:1!==e,cullFace:ie.Vr.Back,renderOccluded:oe.yD.Transparent})}get test(){return{discManipulator:this._manipulator}}}class Ci extends gi{constructor(e){super(),this._radius=ci,this.events=new yt.Z,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,qt.TRANSLATE_Z)}createGraphicDragPipeline(e,t,i){const a=(0,n.Wg)(t.graphic.geometry).spatialReference;return vi(t,i,(t=>this.createDragPipeline(((i,a,s,n,r)=>t(i,e(i,a,s,n,r),s)),a)),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return(0,yi.Xd)(this._manipulator,((a,s,n,r,o)=>{const l=s.next((e=>({...e,manipulatorType:qt.TRANSLATE_Z}))).next((0,mi.Sp)(i,a.renderLocation,t)).next((0,yi.zh)());e(a,l,n,r,o)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._radius/ci,t=mt.zManipulator.height*e,i=mt.zManipulator.coneHeight*e,a=mt.zManipulator.coneWidth*e,s=mt.zManipulator.width*e,n=[(0,d.f)(0,0,0),(0,d.f)(0,0,t)],r=(0,re.PD)(n,s/2,16,!1),o=(0,re.QL)(i,a/2,16,!1),l=[(0,d.f)(0,0,0),(0,d.f)(0,0,t+i)],h=(e=>{const i=(0,ee.c)();if((0,$.v)(i,i,[0,0,t]),(0,$.r)(i,i,Math.PI/2),e){const t=1+2*e/a;(0,$.k)(i,i,[t,t,t])}return i})(0),c=(e,t)=>{const i=(0,Je._j)(mt.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,mt.zManipulator.color.a*e]},p=(0,Bt.EA)(c(1,.25),oe.yD.Occlude),u=(0,Bt.EA)(c(1,0),oe.yD.Occlude),_=(0,Bt.EA)(c(.7,0),mt.zManipulator.renderOccluded),g=(0,Bt.EA)(c(.85,0),mt.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:h,material:p,stateMask:Mi.Q9.Unfocused},{geometry:r,material:p,stateMask:Mi.Q9.Unfocused},{geometry:o,transform:h,material:u,stateMask:Mi.Q9.Focused},{geometry:r,material:u,stateMask:Mi.Q9.Focused},{geometry:o,transform:h,material:_,stateMask:Mi.Q9.Unfocused},{geometry:r,material:_,stateMask:Mi.Q9.Unfocused},{geometry:o,transform:h,material:g,stateMask:Mi.Q9.Focused},{geometry:r,material:g,stateMask:Mi.Q9.Focused}],this._manipulator.radius=s/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}_createManipulator(){const e=new Jt.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=Oi;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=(0,p.j)(t.eye,i),s=t.computeRenderPixelSizeAtDist(a),n=(0,p.b)(Ei,i,t.eye);(0,p.n)(n,n);const r=Ai;this._view.renderCoordsHelper.worldUpAtPosition(Oi,r);const o=Math.abs((0,p.e)(n,r)),l=(0,p.f)(Ei,n,r),h=(0,p.f)(Ei,l,r),c=(0,Ce.uZ)(o,.01,1),d=1-Math.sqrt(1-c*c)/c/t.fullWidth,u=this._radius/ci,_=mt.zManipulator.width*u;(0,p.g)(h,(0,p.n)(h,h),(1/d-1)*a+s*_),e[12]-=Ei[0],e[13]-=Ei[1],e[14]-=Ei[2]},this._manipulator=e,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const Oi=(0,d.c)(),Ei=(0,d.c)(),Ai=(0,d.c)();class Ti extends gi{constructor(e){super(),this._handles=new F.Z,this._interactive=!0;const{tool:t,view:i,snapToScene:a,radius:s}=e;this._view=i,this.xyManipulation=new wi({tool:t,view:i,snapToScene:a,radius:s}),this.xyAxisManipulation=new Si({tool:t,view:i,radius:s}),this.zManipulation=new Ci({tool:t,view:i,radius:s}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((e=>{this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return(0,s.AL)([this.xyManipulation.createGraphicDragPipeline(((t,i,a,s,n)=>e(Gi.XY,t,i,a,s,n)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,a,s,n)=>e(Gi.XY_AXIS,t,i,a,s,n)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,a,s,n)=>e(Gi.Z,t,i,a,s,n)),t,i)])}createDragPipeline(e,t,i,a){return(0,s.AL)([this.xyManipulation.createDragPipeline(((t,i,a,s,n)=>e(Gi.XY,t,i,a,s,n)),t,i,a),this.xyAxisManipulation.createDragPipeline(((t,i,a,s,n)=>e(Gi.XY_AXIS,t,i,a,s,n)),t,i,a),this.zManipulation.createDragPipeline(((t,i,a,s,n)=>e(Gi.Z,t,i,a,s,n)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,qt.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((t=>e(t,qt.TRANSLATE_XY))),this.zManipulation.forEachManipulator((t=>e(t,qt.TRANSLATE_Z)))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if((0,m.Z)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const a=()=>{const t=[];this._xyAxisVisible||e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(Ri),this._handles.add(t,Ri)};for(const s of i)this._handles.add(s.events.on("focus-changed",a));this._view.inputManager&&this._handles.add((0,r.gx)((()=>this._view.inputManager?.latestPointerType),a)),a()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=(0,n.pC)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((e=>"icon"===e.type))?pi:ci}}const Ri="disable-xy-axis-display";var Gi;!function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"}(Gi||(Gi={}));var Pi=i(2346);class Di extends gi{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,qt.TRANSLATE_XY)}createGraphicDragPipeline(e){return vi(this._graphicState,e,(e=>this.createDragPipeline(e)),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,a=(0,n.pC)(i.geometry)?i.geometry.spatialReference:null;return(0,yi.Xd)(this._manipulator,((s,n,r,o,l)=>{const h=n.next((0,mi._y)(l,t,i,a)).next((0,yi.AN)()).next((0,yi.zh)());e(s,h,r,o,l)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new Pi.L({graphic:t,view:e,selectable:!0,cursor:"move"})}}var Ii=i(57889),zi=i(45900),Li=i(87268),Wi=i(77560),Vi=i(34019),Ni=i(80151),Zi=i(12586),ki=i(40524),Ui=i(4914);class Hi{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class Yi{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class Fi{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let Bi=class extends((0,Yt.p)(yt.Z.EventedMixin(zi.m))){constructor(e){super(e),this.graphics=new Ht.Z,this.enableZ=!0,this.tooltipOptions=new Wi.Z,this.type="move-3d",this._snappingPipeline=new Ni.n,this._tooltip=null}initialize(){const{graphics:e,view:t}=this;this.addHandles([e.on("change",(()=>this._refreshManipulators())),(0,r.YP)((()=>this.tooltipOptions.enabled),(e=>{this._tooltip=e?new Zi.u({view:t}):(0,n.SC)(this._tooltip)}),r.tX)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,n.SC)(this._tooltip),this._moveManipulation=(0,n.SC)(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter((e=>(0,Ii.P)(e)===Xt.e.SUPPORTED)).map((e=>new Xi(e)));e.length&&(this._createManipulators(e),this._createVisualElements(e),this.handles.add(e.map((e=>this.view.trackGraphicState(e.state)))),this._updateMoveManipulation(e))}_createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new Di({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this.handles.add([e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()})),e.events.on("grab-changed",(e=>{let{action:t}=e;const{tooltipOptions:i,_tooltip:a}=this;(0,n.Wi)(a)||("start"===t?a.info=new ki.$E({tooltipOptions:i}):a.clear())}))]))),this.handles.add(t.manipulationXY.createDragPipeline(((t,i,a,s)=>this._buildDragEventPipeline(e,Gi.XY,t,i,a,s))))}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new Ti({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Ti.radiusForSymbol(e[0].graphic.symbol):ci});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.handles.add(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=t=>i=>{this.handles.add(i.events.on("focus-changed",(i=>{let{action:a}=i;const s=this._tooltip;(0,n.Wi)(s)||("focus"===a?this._updateMoveTooltip(e,t):s.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(Gi.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(Gi.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(Gi.Z));const a=()=>this._updateMoveManipulation(e);for(const n of e)this.handles.add([n.state.on("changed",a),(0,r.YP)((()=>n.state.displaying),a)]);const s=e[e.length-1];this.handles.add(s.state.on("changed",(()=>this._updateMoveManipulationAngle(s)))),this.handles.add(t.createDragPipeline(((t,i,a,s,n)=>this._buildDragEventPipeline(e,t,i,a,s,n)),(0,u.RL)(s.graphic),(0,n.Wg)(s.graphic.geometry).spatialReference,s.graphic)),this._updateMoveManipulationAngle(s)}_createVisualElements(e){for(const t of e){const i=t.graphic,a=li({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>(0,s.kB)()});(0,n.Wi)(a)||(t.geometryRepresentation=a.visualElement,t.geometryRepresentation instanceof At&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this._updateMoveManipulation(e)})),(0,r.YP)((()=>t.state.isDraped),(()=>this._updateMoveManipulation(e)))]),this.handles.add(a))}}_updateMoveManipulationAngle(e){this._moveManipulation.angle=fi(e.graphic.geometry)}_updateMoveManipulation(e){const t=(0,vt.Tx)(0,0,0,this.view.spatialReference);let i=0,a=!1;const s=this._moveManipulation;for(const r of e){if(!r.state.displaying)continue;const e=r.state.graphic;this.enableZ&&jt(e)&&(a=!0);const s=r.geometryRepresentation instanceof At&&!r.state.isDraped?r.geometryRepresentation.attachmentOrigin:(0,Bt.du)(this.view,e);(0,n.pC)(s)&&(t.x+=s.x,t.y+=s.y,t.z+=s.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,s.location=t,s.xyManipulation.available=!0,s.xyAxisManipulation.available=!0,s.zManipulation.available=a):s.available=!1}_buildDragEventPipeline(e,t,i,a,s,n){const r=[],o=[];let l=null,h=null;const c=()=>{for(const e of r)e.dragging=!1;r.length=0,o.length=0,l=null,h=null,this._moveManipulation.interactive=!0};if(s=s.next((e=>h(e))).next((()=>{if(this.emit("graphic-move-stop",new Fi(o)),this.destroyed)return null;c()})),1===e.length&&t===Gi.XY){const t=e[0].graphic;a=this._buildSnappingPipelineSteps(t,(0,u.RL)(t),a,s,n)}return a.next((t=>{if("start"===t.action){r.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(r.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,l=(0,yi.oq)(o,this.view.state.viewingMode),h=(0,yi.QY)(o),this.emit("graphic-move-start",new Hi(o)),this.destroyed))return null}return 0!==o.length?t:null})).next((e=>l(e))).next((i=>(this._updateMoveTooltip(e,t,i),i))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),a=i.x-t.x,s=i.y-t.y;if(this.emit("graphic-move",new Yi(a,s,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Fi(o)),this.destroyed)return null;c()}}))}_updateMoveTooltip(e,t,i){const{tooltipOptions:a,_tooltip:s}=this;if((0,n.Wi)(s))return;s.clear();const r=0===e.length?"absolute-height":e[0].state.isDraped?"on-the-ground":"absolute-height";switch(t){case Gi.XY:s.info=new ki.$E({tooltipOptions:a}),this._updateMoveTooltipDistance(s.info,i,((e,t)=>(0,I.GQ)(e,t,r)));break;case Gi.XY_AXIS:s.info=new ki.in({tooltipOptions:a}),this._updateMoveTooltipDistance(s.info,i,((e,t)=>{const a=(0,I.GQ)(e,t,r);return(0,Ft.bA)(a,bi(i))}));break;case Gi.Z:s.info=new ki.QW({tooltipOptions:a}),this._updateMoveTooltipDistance(s.info,i,Ui._e)}}_updateMoveTooltipDistance(e,t,i){if((0,n.pC)(t)&&"end"!==t.action){const{mapStart:a,mapEnd:s}=t,r=i(a,s);e.distance=(0,n.pC)(r)?r:Ft.yP}}_buildSnappingPipelineSteps(e,t,i,a,s){const r=e.geometry;if((0,n.Wi)(r)||"point"!==r.type&&"mesh"!==r.type)return i;const o=("point"===r.type?r:r.anchor).clone(),l=new Vi.N({elevationInfo:t,pointer:s,editGeometryOperations:Li.c.fromGeometry(o,this.view.state.viewingMode),visualizer:new Qe,excludeFeature:e}),h=this.snappingManager;return i.next((t=>(o.z=(0,u.vQ)(this.view,o,(0,u.RL)(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:l.coordinateHelper.pointToVector(o)}))).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:h,cancel:a,updatingHandles:this.updatingHandles}),this._snappingPipeline.next)}get test(){return{tooltip:this._tooltip}}};(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Bi.prototype,"view",void 0),(0,a._)([(0,o.Cb)()],Bi.prototype,"graphics",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Bi.prototype,"enableZ",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Wi.Z})],Bi.prototype,"tooltipOptions",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Bi.prototype,"snappingManager",void 0),(0,a._)([(0,o.Cb)()],Bi.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],Bi.prototype,"updating",null),Bi=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Bi);class Xi{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Lt({graphic:e})}get graphic(){return this.state.graphic}}var ji=i(46684),Qi=i(29909),qi=i(55652),Ji=i(74579),Ki=i(3711);function $i(e,t,i){const a="on-the-ground"===i.mode?Ki.v.XY:Ki.v.XYZ;return new Ki.A(e,a,t,0)}function ea(e,t,i){const a=(0,d.c)();if(!e.renderCoordsHelper.toRenderCoords(t,a))return null;const s=ta(e,t,(0,qi.mJ)(i.plane)),r=ta(e,t,i.edgeDirection);if((0,n.Wi)(s)||(0,n.Wi)(r))return null;const o=(0,p.f)((0,d.c)(),s,r);return(0,qi.Yq)(a,o,(0,qi.Ue)())}function ta(e,t,i){const a=(0,vt.Tx)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),s=(0,d.c)(),n=(0,d.c)();return e.renderCoordsHelper.toRenderCoords(t,s)&&e.renderCoordsHelper.toRenderCoords(a,n)?(0,p.r)(n,s,n):null}var ia=i(63920),aa=i(153),sa=i(4943);let na=class extends sa.h{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=Ft.yP,this.area=null,this.totalLength=null}};(0,a._)([(0,o.Cb)()],na.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],na.prototype,"distance",void 0),(0,a._)([(0,o.Cb)()],na.prototype,"area",void 0),(0,a._)([(0,o.Cb)()],na.prototype,"totalLength",void 0),na=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],na);var ra=i(9856),oa=i(13615);let la=class extends(yt.Z.EventedMixin(Yt.r)){constructor(e){super(e),this._vertexManipulatorMaterial=(0,Bt.EA)(mt.colorToVec4(mt.reshapeManipulators.vertex.color),mt.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,Bt.qJ)(mt.colorToVec4(mt.reshapeManipulators.vertex.outlineColor),mt.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,Bt.qJ)(mt.colorToVec4(mt.reshapeManipulators.vertex.hoverOutlineColor),mt.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=(0,Bt.EA)(mt.colorToVec4(mt.reshapeManipulators.edge.color),mt.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,Bt.qJ)(mt.colorToVec4(mt.reshapeManipulators.edge.outlineColor),mt.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=(0,Bt.EA)(mt.colorToVec4(mt.reshapeManipulators.edgeOffset.color),mt.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=(0,Bt.EA)(mt.colorToVec4(mt.reshapeManipulators.edgeOffset.hoverColor),mt.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=(0,Bt.EA)(mt.colorToVec4(mt.reshapeManipulators.selected.color),mt.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,Bt.qJ)(mt.colorToVec4(mt.reshapeManipulators.selected.outlineColor),mt.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,Bt.qJ)(mt.colorToVec4(mt.reshapeManipulators.selected.hoverOutlineColor),mt.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new F.Z,this._manipulatorInfos=[],this._editGeometryOperations=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=_a.NONE,this._outlineVisualElement=null,this._segmentLabels=null,this.outputGeometry=null,this._snappingPipeline=new Ni.n,this._snappingPipelineHandle=new Ni.n,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:e,view:t}=this,i=this._graphicState=new Lt({graphic:e});this._tooltip=new Zi.u({view:t}),this.addHandles([(0,r.YP)((()=>i.displaying),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),(0,r.YP)((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(e=>{let{labels:t,enabled:i,edgeOffsetEnabled:a}=e;(0,n.pC)(t)&&(t.visible=i,t.edgeDistance=a?"far":"default")}),r.nn),(0,r.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),r.nn),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=(0,n.SC)(this._segmentLabels),this._tooltip=(0,n.SC)(this._tooltip),this._removeManipulators()}get inputGeometry(){return(0,n.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));this._removeVertices(e)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,n.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,n.SC)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(){if((0,n.Wi)(this._editGeometryOperations))return;const e=(0,u.RL)(this.graphic);for(const t of this._editGeometryOperations.data.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e)}this._createGraphicMoveManipulation(),this._createMoveManipulation(e),this._createVisualElements()}get canRedo(){return(0,n.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return(0,n.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if((0,n.Wi)(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return(0,n.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if((0,n.Wi)(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return(0,n.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._tooltip.clear(),this._createManipulators()}_recreateEditGeometryAndManipulators(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputGeometry;this._removeManipulators(),this._tooltip.clear(),(0,n.Wi)(e)||((0,n.SC)(this._editGeometryOperations),this._editGeometryOperations=Li.c.fromGeometry(e,this.view.state.viewingMode),this._createManipulators(),(0,n.SC)(this._segmentLabels),this._segmentLabels=new U({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,u.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}))}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const a=[],s=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),n=e===ga.SELECTED_OR_ALL&&s;for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.grabbing||n&&!r.manipulator.selected||a.push(r),i++);if(0===a.length)return t;if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(_a.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(_a.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)"vertex"===t.type&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(_a.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const s=[];for(const n of this._manipulatorInfos)"vertex"===n.type&&(n.manipulator.selected&&!n.manipulator.grabbing||n===e.info)&&s.push(n);this._moveVertices(s,e,aa.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case _a.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case _a.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case _a.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case _a.MOVING:switch(this._reshapeEventState){case _a.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case _a.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case _a.RESHAPING:switch(this._reshapeEventState){case _a.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case _a.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulation(){const{tool:e,view:t}=this,i=this._graphicState;if(this._graphicMoveManipulation=new Di({tool:e,view:t,graphicState:i}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,a)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=(0,n.Wg)(this._editGeometryOperations).createUndoGroup()),t))).next((e=>this._perGraphicManipulatorDragAction(ga.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(Gi.XY,e),e))).next((t=>{"end"===t.action&&(this._tooltip.clear(),e=(0,n.hw)(e))})),a.next((()=>this._onDragCancel(!0,(()=>e=(0,n.hw)(e)))))}))),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1))))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))))}_createMoveManipulation(e){const{graphic:t,handles:i,tool:a,view:s}=this,o=this._graphicState;this._moveManipulation=new Ti({tool:a,view:s,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&jt(t),snapToScene:!1,radius:Ti.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>i.add([e.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...i,graphic:t}),i.stopPropagation()})),this._watchAndUpdateGrabState(e,!1)])));const l=e=>t=>{i.add(t.events.on("focus-changed",(t=>{let{action:i}=t;"focus"===i&&this._tooltipOptions.enabled?this._updateTranslateTooltip(e):this._tooltip.clear()})))};this._moveManipulation.xyManipulation.forEachManipulator(l(Gi.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(l(Gi.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(l(Gi.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const h=(0,n.Wg)(t.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline(((i,s,r,o,l)=>(o=o.next((e=>(this._onDragCancel(),e))),r.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===qt.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e})).next((0,yi.BS)(this.view,e,t)).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:o,snappingManager:a.snappingManager,snappingContext:new Vi.N({editGeometryOperations:(0,n.Wg)(this._editGeometryOperations),elevationInfo:e,pointer:l,excludeFeature:t,visualizer:new Qe}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipelineHandle.next).next((0,yi.AN)()).next((e=>this._perGraphicManipulatorDragAction(ga.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(i,e),e))))),e,h,t),(0,r.YP)((()=>o.displaying),(()=>{this._updateMoveManipulationPosition()}),r.nn),o.on("changed",(()=>this._updateMoveManipulationPosition())),(0,r.YP)((()=>o.isDraped),(e=>{this._updateMoveManipulationPosition();const t="align-move-manipulation";e?i.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):i.remove(t)}),r.nn)])}_createVisualElements(){const{graphic:e,view:t}=this,i=li({view:t,graphic:e,forEachManipulator:e=>{if(!this.destroyed){this._graphicMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,qt.TRANSLATE_XY)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});(0,n.pC)(i)&&(this._outlineVisualElement=i.visualElement instanceof At?i.visualElement:null),(0,n.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,u.RL)(this.graphic);const i=mt.reshapeManipulators.edgeOffset,a=i.size/2,r=a+i.collisionPadding;if((0,n.Wi)(this._edgeOffsetManipulatorGeometryInside)||(0,n.Wi)(this._edgeOffsetManipulatorGeometryOutside)){const e=a/r,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=(0,re.DA)(t,e/2,e/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=(0,re.DA)(-t,e/2,e/2,i.height,-i.offset)}const o=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:Mi.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:Mi.Q9.Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:Mi.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:Mi.Q9.Focused}],l=new Jt.Z({view:this.view,renderObjects:o,elevationInfo:"on-the-ground"!==t.mode||(0,Ji.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:r,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:(0,d.f)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),h=new Jt.Z({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),c={manipulator:l,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(c,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(c);const p=[];for(const s of[c.handle.leftVertex,c.handle.rightVertex]){const e=this._getManipulatorInfoFromHandle(s);(0,n.pC)(e)&&p.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(c))))}c.locationUpdateHandle=(0,s.AL)(p),this._manipulatorHandles.add(c.locationUpdateHandle,l),this._manipulatorHandles.add([this._watchAndUpdateGrabState(l,!0),this._watchAndUpdateGrabState(h,!0)],l),this._manipulatorHandles.add((0,yi.Xd)(l,this._createEdgeOffsetPipeline(c,t)),l),this._manipulatorHandles.add((0,yi.Xd)(h,((e,i,a,s)=>{if("touch"===s)this._createEdgeOffsetPipeline(c,t)(e,i,a);else if(this.enableMoveGraphic){const s=this.graphic,r=(0,n.pC)(s.geometry)?s.geometry.spatialReference:null;i.next((e=>this._trackNumDragging(e))).next((0,yi.kY)(this.view,e.elevationAlignedLocation)).next((0,mi.G)(this.view,e.elevationAlignedLocation,t,r,s)).next((0,yi.zh)()).next((0,yi.AN)()).next((e=>this._perGraphicManipulatorDragAction(ga.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(Gi.XY,e),e))).next((e=>{"end"===e.action&&this._tooltip.clear()})),a.next((()=>this._onDragCancel(!e.metadata.deleting)))}})),l);const _=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([l.events.on("immediate-click",_),h.events.on("immediate-click",_),l.events.on("focus-changed",(e=>{let{action:t}=e;const i=this._tooltipOptions;if("focus"===t&&i.enabled){const e=this._tooltip.info=new na({tooltipOptions:i});this._updateTooltipAreaOrTotalLength(e)}else this._tooltip.clear()}))],l),this._manipulatorInfos.push(c),this.manipulators.add(l),this.manipulators.add(h),this.emit("manipulators-changed"),c}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,a=e.edgeManipulator,r=()=>{e.visibilityHandle=(0,n.hw)(e.visibilityHandle);const r=this._getManipulatorInfoFromHandle(e.handle.leftVertex),o=this._getManipulatorInfoFromHandle(e.handle.rightVertex),l=(0,n.pC)(r)&&(0,n.pC)(o)&&function(e,t,i){const a=i.projectToRenderScreen(e,(0,g.J$)()),s=i.projectToRenderScreen(t,(0,g.J$)());return(0,n.pC)(a)&&(0,n.pC)(s)?(0,p.p)((0,p.b)(a,a,s)):0}(r.manipulator.renderLocation,o.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!a.focused||l)&&(i.grabbable=!l,a.grabbable=!l,e.visibilityHandle=(0,s.AL)([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",r),a.events.on("focus-changed",r),{remove:()=>{(0,n.hw)(e.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)}}],i),r()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const{coordinateHelper:t}=(0,n.Wg)(this._editGeometryOperations).data,i=ea(this.view,e.manipulator.elevationAlignedLocation,$i(t,e.handle,(0,n.Wg)(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex),s=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if((0,n.Wi)(a)||(0,n.Wi)(s))return;const r=a.manipulator.renderLocation,o=s.manipulator.renderLocation,l=(0,n.pC)(i)?function(e,t,i){const a=(0,qi.mJ)(e),s=(0,p.r)((0,d.c)(),t,i),n=(0,p.f)((0,d.c)(),s,a),r=(0,p.f)((0,d.c)(),s,n);return(0,ee.f)(s[0],s[1],s[2],0,n[0],n[1],n[2],0,r[0],r[1],r[2],0,0,0,0,1)}(i,r,o):ee.I;e.manipulator.modelTransform=l,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=l;const h=(0,p.l)((0,p.b)(pa,r,o))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-h,0,0],[h,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,a,s)=>{this._clearSelection();const{step:r,cleanup:o}=this._initializeEdgeOffset(e,t);a.next((e=>this._trackNumDragging(e))).next((0,yi.kY)(this.view,i.elevationAlignedLocation)).next(r).next((0,mi.bB)(this.view)).next((0,mi.zP)(this.view,(0,n.Wg)(this._editGeometryOperations).data.spatialReference)).next((0,yi.AN)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next((e=>{"end"===e.action&&o()})),s.next((()=>{i.metadata.deleting||(o(),this._onDragCancel())}))}}_initializeEdgeOffset(e,t){const i=(0,n.Wg)(this._editGeometryOperations),a=$i(i.data.coordinateHelper,e.handle,t),o=i.createUndoGroup(),l=ea(this.view,e.manipulator.elevationAlignedLocation,a);if(a.requiresSplitEdgeLeft){const t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);(0,n.pC)(t)&&this._splitEdgeManipulator(t,1)}if(a.requiresSplitEdgeRight){const t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);(0,n.pC)(t)&&this._splitEdgeManipulator(t,0)}const h=()=>new Qi.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:i.data.spatialReference}),c=new At({view:this.view,isDraped:this._graphicState.isDraped,geometry:h(),elevationInfo:e.elevationInfo,width:mt.visualElements.lineGraphics.outline.width,color:mt.colorToVec4($e.main),attached:!0});let p;const d=()=>{this._cleanEdgeOffsetCollapsedEdges(e),p=(0,n.hw)(p)},u=this.on("undo",d);return p=(0,s.AL)([(0,s.ed)(c),(0,r.YP)((()=>this._graphicState.isDraped),(e=>c.isDraped=e)),this._graphicState.on("changed",(()=>c.geometry=h())),o,u]),{step:e=>(0,n.Wi)(a)||(0,n.Wi)(l)?(d(),null):{...e,operation:a,plane:l},cleanup:d}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||(0,n.Wi)(t.operation))return t;this._updateEventState(_a.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:s}=t;return(i||a||s)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;return(0,n.Wi)(t)||(0,n.Wi)(i)?e:("start"===e.action&&t.selectArrowFromStartPoint(i),{...e,signedDistance:t.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:a}=e,s=this._tooltip,r=this._tooltipOptions;if(!r.enabled||(0,n.Wi)(i))return s.clear(),e;let o=s.info;((0,n.Wi)(o)||"reshape-edge-offset"!==o.type)&&(o=s.info=new na({tooltipOptions:r}));const{coordinateHelper:l}=(0,n.Wg)(this._editGeometryOperations).data;return o.distance="end"===e.action?Ft.yP:function(e,t,i,a,s){if(e){const e=s.toXYZ(s.pointToVector(i)),r=(0,qi.nF)(a,e,Te.WM.get()),o=(0,oa.FB)(r,e,s.spatialReference);if((0,n.pC)(o))return(0,Ft.yG)(o.value*Math.sign(t),o.unit)}return(0,Ft.yG)(t*(0,M.c9)(i.spatialReference),"meters")}(this._graphicState.isDraped,i*a.selectedArrow,t,a.plane,l),this._updateTooltipAreaOrTotalLength(o),e}}_cleanEdgeOffsetCollapsedEdges(e){const t=e.handle.leftVertex.leftEdge?.leftVertex,i=e.handle.leftVertex,a=e.handle.rightVertex.rightEdge?.rightVertex,s=e.handle.rightVertex,r=(0,n.Wg)(this._editGeometryOperations).data.coordinateHelper,o=[];if(t&&r.distance(t.pos,i.pos)<da){const e=this._getManipulatorInfoFromHandle(i);(0,n.pC)(e)&&o.push(e)}if(r.distance(i.pos,s.pos)<da||a&&r.distance(a.pos,s.pos)<da){const e=this._getManipulatorInfoFromHandle(s);(0,n.pC)(e)&&o.push(e)}o.length&&this._removeVertices(o)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,u.RL)(this.graphic);if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if((0,n.Wi)(this._vertexManipulatorGeometry)||(0,n.Wi)(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(mt.reshapeManipulators.vertex);this._vertexManipulatorGeometry=(0,re.PI)(e,16,16),this._vertexManipulatorOutlineGeometry=(0,re.PI)(t,16,16)}if((0,n.Wi)(this._edgeManipulatorGeometry)||(0,n.Wi)(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(mt.reshapeManipulators.edge);this._edgeManipulatorGeometry=(0,re.PI)(e,16,16),this._edgeManipulatorOutlineGeometry=(0,re.PI)(t,16,16)}const i=(0,n.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:ua.Vertex|Mi.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:ua.Vertex|Mi.Q9.Unfocused|Mi.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:ua.Vertex|Mi.Q9.Focused|Mi.Q9.Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:Mi.Q9.Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:Mi.Q9.Selected|Mi.Q9.Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:Mi.Q9.Selected|Mi.Q9.Focused}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:ua.Edge|Mi.Q9.Focused|Mi.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:ua.Edge|Mi.Q9.Focused|Mi.Q9.Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:ua.Edge|Mi.Q9.Unfocused|Mi.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:ua.Edge|Mi.Q9.Unfocused|Mi.Q9.Unselected});const a=new Jt.Z({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible),metadata:{deleting:!1}});this._setTypeSpecificManipulatorSettings(a,e,t);const r="edge"===e.type?{manipulator:a,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(r),this.manipulators.add(a),this._updateManipulatorPosition(r),"edge"===r.type){const e=[];for(const t of[r.handle.leftVertex,r.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(t);(0,n.pC)(i)&&e.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(r))))}r.locationUpdateHandle=(0,s.AL)(e),this._manipulatorHandles.add(r.locationUpdateHandle,a)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const o=(0,yi.Xd)(a,((e,i,a,s)=>{let o=null;a=a.next((t=>(this._onDragCancel(!e.metadata.deleting,(()=>o=(0,n.hw)(o))),t))),i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(o=(0,n.Wg)(this._editGeometryOperations).createUndoGroup()),"edge"===r.type){const t=this._splitEdgeManipulator(r);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:r,snapOrigin:r.handle.pos}})).next((0,yi.kY)(this.view,e.elevationAlignedLocation)).next((0,mi.VG)(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next((0,yi.BS)(this.view,t,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new Vi.N({editGeometryOperations:(0,n.Wg)(this._editGeometryOperations),elevationInfo:t,pointer:s,excludeFeature:this.graphic,visualizer:new Qe}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipeline.next).next((0,yi.AN)()).next((t=>{this._perVertexManipulatorDragAction(t),"end"===t.action&&(o=(0,n.hw)(o)),this._updateTranslateVertexTooltip(e,Gi.XY,t)}))}));return this._manipulatorHandles.add([o,a.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,r))),a.events.on("select-changed",(()=>{r.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),a.events.on("focus-changed",(e=>{let{action:t}=e;"focus"===t&&"edge"!==r.type?this._updateTranslateVertexTooltip(a,Gi.XY):this._tooltip.clear()}))],a),this.emit("manipulators-changed"),r}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(this._numDragging--,e&&(this.undo(),this.outputGeometry=(0,n.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),(0,n.pC)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case _a.NONE:break;case _a.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case _a.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}t&&t(),this.destroyed||this._updateEventState(_a.NONE)}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=ua.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=mt.reshapeManipulators.vertex.size/2+mt.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=(0,n.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=ua.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=mt.reshapeManipulators.edge.size/2+mt.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||(0,Ji.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>this._onGrabStateChanged(e,t,i.action,i.pointerType)))}_onGrabStateChanged(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(_a.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{e.manipulator.interactive=e.manipulator.grabbing||!this._numGrabbing&&(0,n.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((e=>{e.interactive=e.grabbing||!this._numGrabbing})))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){(0,n.Wi)(e)||(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,l.e$)(this._manipulatorInfos,e),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if((0,n.Wi)(e))return;const t=(0,n.Wg)(this._editGeometryOperations);if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,ca),e.manipulator.grabbing&&(0,n.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if((0,n.Wi)(i)||(0,n.Wi)(a))return;const s=i.manipulator,r=a.manipulator;if((0,n.pC)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const i=s.location,a=r.location,n=.5,o=i.x+n*(a.x-i.x),l=i.y+n*(a.y-i.y),h=i.hasZ&&a.hasZ?0:void 0;e.manipulator.location=(0,vt.Tx)(o,l,h,t.data.spatialReference)}else(0,p.h)(pa,s.renderLocation,r.renderLocation,.5),e.manipulator.renderLocation=pa}}_splitEdgeManipulator(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const i=(0,n.Wg)(this._editGeometryOperations),a=(0,n.Wg)(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const s=(0,u.RL)(this.graphic);let r;this.enableEdgeOffset?(this._removeManipulator(e),r=this._createVertexOrEdgeManipulator(a)):(r=e,r.handle=a,r.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,s)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(r),this.enableEdgeOffset||this._updateTranslateVertexTooltip(r.manipulator,Gi.XY),this._updateSelection(e.manipulator);const o=this._updateEventState(_a.RESHAPING),l=i.data.coordinateHelper.vectorToArray(r.handle.pos),h=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:h,vertexIndex:(0,n.Wg)(a.index)}],added:l}),o&&this._updateEventState(_a.NONE),r}_updateMoveManipulationPosition(){const e=(0,p.s)(pa,0,0,0);let t=0,i=!1,a=null,s=null;for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.selected?(t++,(0,p.a)(e,e,r.manipulator.renderLocation),(0,n.Wi)(a)||r.selectedIndex>a.selectedIndex?(s=a,a=r):((0,n.Wi)(s)||r.selectedIndex>s.selectedIndex)&&(s=r)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&jt(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&jt(this.graphic)}if(0!==t){let e=0;if((0,n.pC)(a)){const t=a.handle.pos,i=(0,n.pC)(s)?s.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,r=(0,n.Wi)(s)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;i&&r?this._moveManipulation.xyAxisManipulation.available=!1:i?e=ha(i,t):r&&(e=ha(t,r))}this._moveManipulation.angle=e,this._moveManipulation.radius=pi}else this._moveManipulation.angle=fi((0,n.Wg)(this.graphic.geometry)),this._moveManipulation.radius=Ti.radiusForSymbol(this.graphic.symbol);0!==t&&i?((0,p.g)(e,e,1/t),ca.spatialReference=(0,n.Wg)(this._editGeometryOperations).data.spatialReference,ca.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,ca),this._moveManipulation.elevationAlignedLocation=ca):(0,n.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,n.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,Bt.u2)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=(0,n.Wg)(this._editGeometryOperations);for(const a of e)if("vertex"===a.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const e=(0,n.Wg)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:(0,n.Wg)(e.index)}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(_a.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(_a.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===t.action?aa.O.NEW_STEP:aa.O.ACCUMULATE_STEPS;const a=(0,n.Wg)(this._editGeometryOperations);a.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const s of e)this._updateManipulatorPosition(s)}_offsetEdge(e,t){if((0,n.Wi)(t.operation)||(0,n.Wi)(t.signedDistance))return;const i=(0,n.Wg)(this._editGeometryOperations),a=t.operation.clone();a.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===ia.t.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===ia.t.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){const i=this._tooltipOptions;if(!i.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case Gi.XY:this._tooltip.info=new ki.$E({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,((e,t)=>(0,I.GQ)(e,t,a)));break;case Gi.XY_AXIS:this._tooltip.info=new ki.in({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,((e,i)=>{const s=(0,I.GQ)(e,i,a);return(0,Ft.bA)(s,bi(t))}));break;case Gi.Z:this._tooltip.info=new ki.QW({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,Ui._e)}}_updateTranslateVertexTooltip(e,t,i){const a=this._tooltipOptions;if(!a.enabled)return;let s;const r=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case Gi.XY:s=new ki.nk({tooltipOptions:a}),this._updateTranslateTooltipDistance(s,i,((e,t)=>(0,I.GQ)(e,t,r))),this._updateTooltipAreaOrTotalLength(s);break;case Gi.XY_AXIS:s=new ki.c1({tooltipOptions:a}),this._updateTranslateTooltipDistance(s,i,((e,t)=>{const a=(0,I.GQ)(e,t,r);return(0,Ft.bA)(a,bi(i))})),this._updateTooltipAreaOrTotalLength(s);break;case Gi.Z:s=new ki.j({tooltipOptions:a}),this._updateTranslateTooltipDistance(s,i,Ui._e)}const o=(0,Ui.g1)(e.elevationAlignedLocation);(0,n.pC)(o)&&(s.elevation={mode:"absolute-height",...o}),this._tooltip.info=s}_updateTranslateTooltipDistance(e,t,i){if((0,n.pC)(t)&&"end"!==t.action){const{mapStart:a,mapEnd:s}=t,r=i(a,s);e.distance=(0,n.pC)(r)?r:Ft.yP}}_updateTooltipAreaOrTotalLength(e){const{geometry:t}=this.graphic;if((0,n.Wi)(t))return;const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";e.area="polygon"===t.type?(0,ra.k)(t,i):null,e.totalLength="polyline"===t.type?(0,I.Ul)(t,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function ha(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,a._)([(0,o.Cb)()],la.prototype,"_segmentLabels",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],la.prototype,"tool",void 0),(0,a._)([(0,o.Cb)()],la.prototype,"_tooltip",void 0),(0,a._)([(0,o.Cb)()],la.prototype,"inputGeometry",null),(0,a._)([(0,o.Cb)()],la.prototype,"outputGeometry",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],la.prototype,"updating",null),(0,a._)([(0,o.Cb)()],la.prototype,"manipulators",null),(0,a._)([(0,o.Cb)()],la.prototype,"view",null),(0,a._)([(0,o.Cb)()],la.prototype,"graphic",null),(0,a._)([(0,o.Cb)()],la.prototype,"enableZShape",null),(0,a._)([(0,o.Cb)()],la.prototype,"enableZVertex",null),(0,a._)([(0,o.Cb)()],la.prototype,"enableMoveGraphic",null),(0,a._)([(0,o.Cb)()],la.prototype,"enableMidpoints",null),(0,a._)([(0,o.Cb)()],la.prototype,"enableEdgeOffset",null),(0,a._)([(0,o.Cb)()],la.prototype,"_labelOptions",null),(0,a._)([(0,o.Cb)()],la.prototype,"_tooltipOptions",null),la=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],la);const ca=(0,vt.Tx)(0,0,null,null),pa=(0,d.c)(),da=1e-6;var ua,_a,ga;!function(e){e.Vertex=Mi.jg.Custom1,e.Edge=Mi.jg.Custom2}(ua||(ua={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(_a||(_a={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(ga||(ga={}));var ma=i(52349);let ya=class extends(yt.Z.EventedMixin(zi.m)){constructor(e){super(e),this._handles=new F.Z,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new ma.Z,this.tooltipOptions=new Wi.Z,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new la({tool:this});this.addHandles([e.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),e.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),e.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),e.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),e.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>{e.stopPropagation()})),(0,r.YP)((()=>this.graphic),(()=>this._updateGraphic()),r.tX)]),this.finishToolCreation()}destroy(){this._handles=(0,n.SC)(this._handles),this._reshapeOperation=(0,n.SC)(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const e=(0,ji.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,n.pC)(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,ji.P)(this.graphic)!==Xt.e.SUPPORTED)return;const e=(0,r.YP)((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),r.Z_);this._handles.add(e,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){(0,n.Wi)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){(0,n.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,n.pC)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){(0,n.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,n.pC)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,a._)([(0,o.Cb)()],ya.prototype,"_reshapeOperation",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ya.prototype,"view",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],ya.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ya.prototype,"enableZShape",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ya.prototype,"enableZVertex",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ya.prototype,"enableMoveGraphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ya.prototype,"enableMidpoints",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],ya.prototype,"enableEdgeOffset",void 0),(0,a._)([(0,o.Cb)()],ya.prototype,"type",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:ma.Z})],ya.prototype,"labelOptions",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Wi.Z})],ya.prototype,"tooltipOptions",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],ya.prototype,"snappingManager",void 0),(0,a._)([(0,o.Cb)()],ya.prototype,"updating",null),(0,a._)([(0,o.Cb)()],ya.prototype,"automaticManipulatorSelection",void 0),ya=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],ya);var va=i(50951),fa=i(17768),ba=i(99346);let Ma=class extends sa.h{constructor(e){super(e),this.type="transform-rotate",this.rotationType="geographic"}};(0,a._)([(0,o.Cb)()],Ma.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],Ma.prototype,"rotation",void 0),(0,a._)([(0,o.Cb)()],Ma.prototype,"rotationPrecision",void 0),(0,a._)([(0,o.Cb)()],Ma.prototype,"orientation",void 0),(0,a._)([(0,o.Cb)()],Ma.prototype,"orientationPrecision",void 0),(0,a._)([(0,o.Cb)()],Ma.prototype,"rotationType",void 0),Ma=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Ma);let Sa=class extends sa.h{constructor(e){super(e),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};(0,a._)([(0,o.Cb)()],Sa.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],Sa.prototype,"scale",void 0),(0,a._)([(0,o.Cb)()],Sa.prototype,"size",void 0),(0,a._)([(0,o.Cb)()],Sa.prototype,"sizeUnit",void 0),(0,a._)([(0,o.Cb)()],Sa.prototype,"sizePrecision",void 0),Sa=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Sa);let xa=class extends sa.h{constructor(e){super(e),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var wa,Ca;(0,a._)([(0,o.Cb)()],xa.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],xa.prototype,"orientation",void 0),(0,a._)([(0,o.Cb)()],xa.prototype,"orientationEnabled",void 0),(0,a._)([(0,o.Cb)()],xa.prototype,"orientationPrecision",void 0),(0,a._)([(0,o.Cb)()],xa.prototype,"rotationType",void 0),(0,a._)([(0,o.Cb)()],xa.prototype,"size",void 0),(0,a._)([(0,o.Cb)()],xa.prototype,"sizeUnit",void 0),(0,a._)([(0,o.Cb)()],xa.prototype,"sizeEnabled",void 0),(0,a._)([(0,o.Cb)()],xa.prototype,"sizePrecision",void 0),xa=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],xa),function(e){e.ScaleIn=Mi.jg.Custom2,e.ScaleOut=Mi.jg.Custom3,e.RotateLeft=Mi.jg.Custom4,e.RotateRight=Mi.jg.Custom5,e.Unlocked=Mi.jg.Custom7,e.DelayedFocused=Mi.jg.Custom8,e.TouchInput=Mi.jg.Custom12}(wa||(wa={}));class Oa{constructor(e){let{adapter:t,tooltipOptions:i,mode:a,tool:s}=e;this._mode=null,this._handles=new F.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new yt.Z,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>(0,n.pC)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._adapter.scale:1,this.tool=s,this._mode=a,this._adapter=t,this._tooltipOptions=i,this._tooltip=new Zi.u({view:s.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,r.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),r.nn))}get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}destroy(){(0,n.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,n.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,n.SC)(this._tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=(0,ba.A)({update:t=>{let{deltaTime:i}=t;e.update(i)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){(0,n.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,n.SC)(this._activeAnimation))}forEachManipulator(e){e(this._ringManipulator,qt.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.graphicState.graphic,i=(0,yi.Xd)(e,((e,i,a)=>{this._scaleRotateDragData=null;const s=this._adapter.startInteraction(),r={mode:"none",origin:(0,d.a)(e.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=r,this._updateDragState();const o=Te.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),i.next((0,mi._N)(this.tool.view,(0,qi.Yq)(e.renderLocation,o,(0,qi.Ue)()))).next((e=>{const i=(0,qi.mJ)(e.plane),a=(0,Bt.Gd)(e.renderStart,e.renderEnd,r.origin,i),o=fa.Q4.shortestSignedDiff(r.angle,a);r.angleDir=(0,Ce.uZ)(r.angleDir+o,-.3,.3),r.angle=a;const l=function(e,t){const i=(0,p.b)(Te.WM.get(),t.renderStart,e.origin),a=(0,p.b)(Te.WM.get(),t.renderEnd,e.origin),s=(0,p.l)(i),n=(0,p.l)(a);return 0===s?0:n/s}(r,e),h=l-this._adapter.scale;if(r.scaleDir=(0,Ce.uZ)(r.scaleDir+h,-.2,.2),this._onScaleChanged(),"none"===r.mode){const i=this._mode||function(e,t,i,a){const{renderStart:s,renderEnd:n}=e,r=Ea(s,a,Te.WM.get()),o=Ea(n,a,Te.WM.get());if((0,p.d)(r,o)<100)return null;const l=(0,p.b)(Te.WM.get(),s,i),h=(0,p.f)(Te.WM.get(),l,(0,qi.mJ)(t)),c=s,d=(0,p.a)(Te.WM.get(),c,h),u=Ea(i,a,Te.WM.get()),_=r,g=Ea(d,a,Te.WM.get()),m=(0,p.b)(Te.WM.get(),g,_),y=(0,p.b)(Te.WM.get(),r,u),v=(0,J.re)(_,m),f=(0,J.re)(u,y);return(0,J.Jk)(v,o)<(0,J.Jk)(f,o)?"rotate":"scale"}(e,e.plane,r.origin,this.tool.view.state.camera);if((0,n.pC)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}r.mode=i}}switch(r.mode){case"rotate":s.state.angle=r.initialAngle+a;break;case"scale":s.state.scale=l,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:(0,Ce.BV)(r.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:l,yScale:l})}break;case"end":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:(0,Ce.BV)(r.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:l,yScale:l})}}return"end"===e.action&&(this.startAnimation(Aa(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),s.done()),e})).next(this._updateTooltipPipelineStep(r)),a.next((()=>{if(s.cancel(),(0,n.pC)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(Aa(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this._handles.add([i,e.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t){let i=0,a=null;const s=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=s,i=0,t()},update:e=>(i+=e,!a()||i>200?Ca.STOP:Ca.CONTINUE),destroy:()=>{e.getFocused=a,t()}}}(this,(()=>this._updateDelayedFocusedState()))):this._updateDelayedFocusedState()})),e.events.on("immediate-click",(e=>{e.stopPropagation()})),(0,r.YP)((()=>this.tool.graphicState?.displaying),(e=>this._ringManipulator.available=e),r.nn)])}_updateTooltipPipelineStep(e){return t=>{const i=this._tooltipOptions;if(!i.enabled)return t;if("end"===t.action)return this._updateFocusTooltip(),t;const a=this._tooltip,s=this._tooltipOptions.visualVariables,r=(0,n.pC)(s)?s.size:null,o=(0,n.pC)(s)?s.rotation:null;switch(e.mode){case"scale":a.info=new Sa({tooltipOptions:i,scale:{value:this._adapter.scale},size:(0,Ft.yG)((0,n.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,n.pC)(r)?r.unit:null,sizePrecision:(0,n.pC)(r)?Ta(r.valueType):null});break;case"rotate":{const e=(0,n.pC)(o)?Ta(o.valueType):null,t=(0,n.pC)(o)?o.rotationType:"geographic";a.info=new Ma({tooltipOptions:i,rotation:(0,Ft.GJ)((0,n.Pt)(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:e,orientation:(0,Ft.GJ)(-this._adapter.angle,"radians","geographic"),orientationPrecision:e,rotationType:t})}}return t}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const e=this._tooltipOptions.visualVariables,t=(0,n.pC)(e)?e.rotation:null,i=(0,n.pC)(e)?e.size:null;this._tooltip.info=new xa({tooltipOptions:this._tooltipOptions,orientation:(0,Ft.GJ)(-this._adapter.angle,"radians","geographic"),orientationEnabled:null==this._mode||"rotate"===this._mode,orientationPrecision:(0,n.pC)(t)?Ta(t.valueType):null,rotationType:(0,n.pC)(t)?t.rotationType:"geographic",size:(0,Ft.yG)((0,n.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,n.pC)(i)?i.unit:null,sizeEnabled:null==this._mode||"scale"===this._mode,sizePrecision:(0,n.pC)(i)?Ta(i.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(wa.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(wa.Unlocked,!((0,n.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,n.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(wa.ScaleIn|wa.ScaleOut,!1),this._ringManipulator.updateStateEnabled(wa.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(wa.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(wa.RotateLeft|wa.RotateRight,!1),this._ringManipulator.updateStateEnabled(wa.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(wa.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(wa.ScaleIn|wa.ScaleOut|wa.RotateLeft|wa.RotateRight,!1)}_updateManipulatorTransform(){const e=(0,$.d)(Te.MP.get(),this._adapter.angle,(0,d.f)(0,0,1));if((0,n.Wi)(e))return;const t=this.getScale(),i=(0,$.C)(Te.MP.get(),(0,p.s)(Te.WM.get(),t,t,t));this._ringManipulator.modelTransform=(0,$.m)(Te.MP.get(),i,e)}_createRingManipulator(){const e=(e,t,i)=>{const a=[],s=Math.ceil(128*(t-e)/(2*Math.PI));for(let n=0;n<s+1;n++){const r=e+n*(t-e)/s;a.push((0,d.f)(i*Math.cos(r),i*Math.sin(r),0))}return a},t=t=>e(0,2*Math.PI,t),i=(e,t)=>(0,re.x2)((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),a=t(di),s=i(a,24),n={left:[],right:[]},r=[];for(let d=0;d<2;d++){const t=d*Math.PI-Math.PI/4,a=Math.PI/2-ui,s=t+a,o=t+Math.PI/2-a,l=e(s,o,190),h=i(l,9);r.push(l),r.push(e(s,o,201)),n.left.push(h),n.right.push(h);for(let e=0;e<2;e++){const t=0===e,i=(0,ee.c)();if(t){(0,$.k)(i,i,[1,-1,1]),(0,$.e)(i,i,-s,[0,0,1]);const e=Math.round(.2*(l.length-1));i[12]=l[e][0],i[13]=l[e][1],i[14]=l[e][2]}else{(0,$.e)(i,i,o,[0,0,1]);const e=Math.round(.8*(l.length-1));i[12]=l[e][0],i[13]=l[e][1],i[14]=l[e][2]}const a=(0,re.DA)(60,0,23,.5);(0,re.mx)(a,i),(t?n.left:n.right).push(a)}}const o=[];for(let d=0;d<2;d++){const t=d*Math.PI-Math.PI/4,a=Math.PI/2-_i,s=t+a,n=t+Math.PI/2-a,r=e(s,n,213);o.push(i(r,9))}const l=t(190),h=t(213),c=i(l,9),p=i(h,9),_=t(130),g=t(107),m=i(_,9),y=i(g,9),v=this._createMaterial(),f=this._createMaterial(.66),b=this._createMaterial(.5),M=this._createMaterial(.33);let S=[{geometry:s,material:v,stateMask:wa.DelayedFocused},{geometry:s,material:b,stateMask:Mi.Q9.None}];this._mode&&"scale"!==this._mode||(S=S.concat([{geometry:o,material:v,stateMask:wa.DelayedFocused|wa.Unlocked},{geometry:c,material:f,stateMask:wa.DelayedFocused|wa.ScaleIn},{geometry:p,material:M,stateMask:wa.DelayedFocused|wa.ScaleIn},{geometry:m,material:f,stateMask:wa.DelayedFocused|wa.ScaleOut},{geometry:y,material:M,stateMask:wa.DelayedFocused|wa.ScaleOut}])),this._mode&&"rotate"!==this._mode||(S=S.concat([{geometry:n.right,material:v,stateMask:wa.DelayedFocused|wa.Unlocked},{geometry:n.left,material:v,stateMask:wa.DelayedFocused|wa.RotateLeft},{geometry:n.right,material:v,stateMask:wa.DelayedFocused|wa.RotateRight}]));const x=[a,...r];return new Jt.Z({view:this.tool.view,renderObjects:S,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,u.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:x,direction:(0,d.f)(0,0,1)}})}_createMaterial(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=(0,Oe.b)([...hi,e]);return new Ue.E({color:t,transparent:1!==e,cullFace:ie.Vr.Back,renderOccluded:oe.yD.Transparent})}get test(){return{ringManipulator:this._ringManipulator,tooltip:this._tooltip}}}function Ea(e,t,i){return t.projectToScreen(e,Ra),(0,p.s)(i,Ra[0],Ra[1],0)}function Aa(e,t){let i=null,a=1;const s=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=s,t()},update:e=>(a+=((a+1)/2-a)*Math.min(3*e,1),t(),Math.abs(a-1)<.01?Ca.STOP:Ca.CONTINUE),destroy:()=>{e.getScale=i,t()}}}function Ta(e){switch(e){case"integer":case"long":return 0;default:return null}}!function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(Ca||(Ca={}));const Ra=(0,g.s1)();var Ga=i(45238);function Pa(e){return(0,n.pC)(e.geometry)&&"mesh"===e.geometry.type?function(e){return(0,n.pC)(e.transform)?function(e,t){let i=t.clone(),a=null;return{undo:t=>{a=(0,n.pC)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:t=>{i=(0,n.pC)(e.transform)?e.transform.clone():null,e.transform=a,t.notifyGeometryChanged()}}}(e,e.transform):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:a=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,a.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){let t=e.geometry,i=n.YP;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e)}let Da=class extends Yt.r{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([(0,r.gx)((()=>(0,n.pC)(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null),(e=>{let{interactionState:t}=e;this._updateMeshRotation(t)}),r.Z_),(0,r.gx)((()=>(0,n.pC)(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null),(e=>{let{interactionState:t}=e;this._updateMeshSize(t)}),r.Z_)])}get angle(){const e=this.geometry.transform;if((0,n.Wi)(e))return 0;const t=(0,Ga.ZZ)(e.rotation)[2];return Math.abs(t)>.999999?(0,Ce.Vl)((0,Ga.EU)(e.rotation))*Math.sign(t):0}get scale(){return(0,n.pC)(this._interactionState)?this._interactionState.scale:1}startInteraction(){const e=new Ia({angle:this.angle});this._interactionState=e;const t=()=>this._interactionState=null;return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return Pa(this.graphic)}_updateMeshRotation(e){const t=this.geometry.anchor,i=this.viewingMode===va.JY.Global,{angle:a,previousAngle:s}=e;this.geometry.rotate(0,0,(0,Ce.BV)(a-s),{origin:t,geographic:i}),e.previousAngle=a,(0,n.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(e){const t=this.geometry.anchor,i=this.viewingMode===va.JY.Global,{scale:a,previousScale:s}=e;this.geometry.scale(a/s,{origin:t,geographic:i}),e.previousScale=a,(0,n.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};(0,a._)([(0,o.Cb)({constructOnly:!0})],Da.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Da.prototype,"geometry",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Da.prototype,"viewingMode",void 0),(0,a._)([(0,o.Cb)()],Da.prototype,"angle",null),(0,a._)([(0,o.Cb)()],Da.prototype,"scale",null),(0,a._)([(0,o.Cb)()],Da.prototype,"_interactionState",void 0),Da=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Da);let Ia=class extends y.Z{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,a._)([(0,o.Cb)()],Ia.prototype,"angle",void 0),(0,a._)([(0,o.Cb)()],Ia.prototype,"initialAngle",void 0),(0,a._)([(0,o.Cb)()],Ia.prototype,"previousAngle",void 0),(0,a._)([(0,o.Cb)()],Ia.prototype,"previousScale",void 0),(0,a._)([(0,o.Cb)()],Ia.prototype,"scale",void 0),(0,a._)([(0,o.Cb)()],Ia.prototype,"state",null),Ia=(0,a._)([(0,c.j)("InteractionState")],Ia);let za=class extends Yt.r{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,r.gx)((()=>(0,n.pC)(this._interactionState)?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),r.Z_))}get angle(){return(0,n.pC)(this._interactionState)?this._interactionState.angle:(0,n.pC)(this._orientationReferenceSymbolLayer)?function(e){return-(0,Ce.Vl)(e)}(this._orientationReferenceSymbolLayer.heading):0}get scale(){return(0,n.pC)(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return(0,n.pC)(this._interactionState)?this._interactionState.initialAngle:0}get size(){const e=this._sizeReferenceSymbolLayer;if((0,n.Wi)(e))return null;const t=this.findLayerView(),i=this._graphicSymbol;if((0,n.Wi)(t)||(0,n.Wi)(i)||"point-3d"!==i.type)return null;const a=t.getSymbolLayerSize(i,e);if("size"in a&&(0,n.pC)(a.size))return a.size;const s=this.sizeAxis;return"width"in a&&(0,n.pC)(a.width)&&((0,n.Wi)(s)||"width"===s||"all"===s||"width-and-depth"===s)?a.width:"depth"in a&&(0,n.pC)(e.depth)&&((0,n.Wi)(s)||"depth"===s||"all"===s||"width-and-depth"===s)?a.depth:"height"in a&&(0,n.pC)(e.height)&&((0,n.Wi)(s)||"height"===s||"all"===s)?a.height:null}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return(0,n.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return(0,n.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&(0,n.pC)(e.heading)))}get _graphicSymbol(){return(0,n.pC)(this.graphic)&&(0,n.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if((0,n.pC)(this._interactionState)||(0,n.Wi)(e)||(0,n.Wi)(t))return La;const i=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray(),a=e.clone(),s=this.angle,r=new Wa({originalSymbol:a,angle:s,initialSizes:i});this._interactionState=r;const o=()=>this._interactionState=null;return{state:r,done:o,cancel:()=>{this._graphicSymbol=a,o()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol(e){let{scale:t,angle:i,originalSymbol:a,initialSizes:s}=e;const r=this._graphicSymbol;if((0,n.Wi)(r)||"point-3d"!==r.type)return;const o=r.clone(),l=-(0,Ce.BV)(i-this.initialAngle);let h=!1;this._forEachObjectSymbolLayerPair(a,o,((e,i,a)=>{const r=(0,n.Pt)(e.heading,0)+l;i.heading!==r&&(i.heading=r,h=!0);const o=s[a];if((0,n.pC)(o)&&"width"in o){o.width=this.sizeFilter(o.width),o.height=this.sizeFilter(o.height),o.depth=this.sizeFilter(o.depth);const e=o.width*t;i.width!==e&&(i.width=e,h=!0);const a=o.depth*t;i.depth!==a&&(i.depth=a,h=!0);const s=o.height*t;i.height!==s&&(i.height=s,h=!0)}})),h&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,a)=>{const s=t.symbolLayers.getItemAt(a);"object"===e.type&&"object"===s.type&&i(e,s,a)}))}};(0,a._)([(0,o.Cb)()],za.prototype,"angle",null),(0,a._)([(0,o.Cb)()],za.prototype,"scale",null),(0,a._)([(0,o.Cb)()],za.prototype,"relativeAngle",null),(0,a._)([(0,o.Cb)()],za.prototype,"initialAngle",null),(0,a._)([(0,o.Cb)()],za.prototype,"size",null),(0,a._)([(0,o.Cb)()],za.prototype,"sizeAxis",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],za.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)()],za.prototype,"_interactionState",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],za.prototype,"findLayerView",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],za.prototype,"sizeFilter",void 0),(0,a._)([(0,o.Cb)()],za.prototype,"_sizeReferenceSymbolLayer",null),(0,a._)([(0,o.Cb)()],za.prototype,"_orientationReferenceSymbolLayer",null),(0,a._)([(0,o.Cb)()],za.prototype,"_graphicSymbol",null),za=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],za);const La={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Wa=class extends y.Z{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}get state(){const{originalSymbol:e,angle:t,initialAngle:i,scale:a,initialSizes:s}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:a,initialSizes:s}}};(0,a._)([(0,o.Cb)()],Wa.prototype,"originalSymbol",void 0),(0,a._)([(0,o.Cb)()],Wa.prototype,"angle",void 0),(0,a._)([(0,o.Cb)()],Wa.prototype,"initialAngle",void 0),(0,a._)([(0,o.Cb)()],Wa.prototype,"initialSizes",void 0),(0,a._)([(0,o.Cb)()],Wa.prototype,"scale",void 0),(0,a._)([(0,o.Cb)()],Wa.prototype,"state",null),Wa=(0,a._)([(0,c.j)("InteractionState")],Wa);let Va=class extends((0,Yt.p)(yt.Z.EventedMixin(zi.m))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Wi.Z,this.type="transform-3d",this._scaleRotate=null,this._snappingPipeline=new Ni.n,this._tooltip=null}initialize(){const{graphic:e,view:t}=this;this.graphicState=new Lt({graphic:e}),this.addHandles((0,r.YP)((()=>this.tooltipOptions.enabled),(e=>{this._tooltip=e?new Zi.u({view:t}):(0,n.SC)(this._tooltip)}),r.tX)),this._moveManipulation=new Ti({tool:this,view:t,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&jt(e),radius:Ti.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t=>this.handles.add(t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})))));const i=e=>t=>{this.handles.add(t.events.on("focus-changed",(t=>{let{action:i}=t;const a=this._tooltip;(0,n.Wi)(a)||("focus"===i?this._updateMoveTooltip(e):a.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(Gi.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(Gi.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(Gi.Z)),this._moveManipulation.elevationInfo=(0,u.RL)(e);const a=e.geometry;if(this._moveManipulation.createGraphicDragPipeline(((i,s,r,o,l)=>((0,n.pC)(a)&&i===Gi.XY&&(r=r.next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Vi.N({elevationInfo:(0,u.RL)(e),pointer:l,editGeometryOperations:Li.c.fromGeometry(new Y.Z({spatialReference:a.spatialReference}),t.state.viewingMode),visualizer:new Qe,excludeFeature:e}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:o,useZ:!1}),this._snappingPipeline.next)),r.next((e=>(this._updateMoveTooltip(i,e),e))))),this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:a,dyScreen:s}=e,n={graphic:i,dxScreen:a,dyScreen:s};switch(t){case"start":this.emit("graphic-translate-start",n),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",n);break;case"end":this.emit("graphic-translate-stop",n)}})),this._moveManipulation.angle=(0,n.pC)(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,r.YP)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Oa({tool:this,mode:e,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.handles.add([li({view:this.view,graphic:this.graphic,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,s.kB)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),(0,r.YP)((()=>t.scale),(()=>this._updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((e=>{e instanceof Jt.Z&&this.handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this._tooltip=(0,n.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,n.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,n.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){(0,n.Wi)(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return(0,n.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Da({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new za({graphic:this.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.graphic.layer)),sizeAxis:(0,n.pC)(this.tooltipOptions.visualVariables)&&(0,n.pC)(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(e){this._moveManipulation.forEachManipulator(e),(0,n.pC)(this._scaleRotate)&&this._scaleRotate.forEachManipulator(e)}_hideManipulatorsForGraphicState(){return(0,r.YP)((()=>this.graphicState.displaying),(e=>{this._forEachManipulator((t=>t.available=e)),this._moveManipulation.zManipulation.available=e&&this.enableZ&&jt(this.graphic)}))}_createGeometryUndoRecord(){return Pa(this.graphic)}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this._moveManipulation.location=e,(0,n.pC)(this._scaleRotate)&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,(0,n.pC)(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){(0,n.pC)(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if((0,n.Wi)(this._scaleRotate))return;const e=this._scaleRotate.getScale();this._moveManipulation.displayScale=e}_updateMoveAngle(){this.view.state.viewingMode===va.JY.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){(0,Bt.u2)(this.view,this,this.graphic)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(e,t){const{tooltipOptions:i,_tooltip:a}=this;if((0,n.Wi)(a))return;a.clear();const s=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case Gi.XY:a.info=new ki.$E({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,t,((e,t)=>(0,I.GQ)(e,t,s)));break;case Gi.XY_AXIS:a.info=new ki.in({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,t,((e,i)=>{const a=(0,I.GQ)(e,i,s);return(0,Ft.bA)(a,bi(t))}));break;case Gi.Z:a.info=new ki.QW({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,t,Ui._e)}}_updateMoveTooltipDistance(e,t,i){if((0,n.pC)(t)&&"end"!==t.action){const{mapStart:a,mapEnd:s}=t,r=i(a,s);e.distance=(0,n.pC)(r)?r:Ft.yP}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,n.pC)(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Va.prototype,"view",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Va.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Va.prototype,"enableZ",void 0),(0,a._)([(0,o.Cb)()],Va.prototype,"enableRotation",void 0),(0,a._)([(0,o.Cb)()],Va.prototype,"enableScaling",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Wi.Z})],Va.prototype,"tooltipOptions",void 0),(0,a._)([(0,o.Cb)()],Va.prototype,"graphicState",void 0),(0,a._)([(0,o.Cb)({value:!1})],Va.prototype,"snapToScene",null),(0,a._)([(0,o.Cb)({constructOnly:!0})],Va.prototype,"snappingManager",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],Va.prototype,"type",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],Va.prototype,"updating",null),Va=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Va);var Na=i(82218),Za=(i(59486),i(11582)),ka=i(46784),Ua=i(89125),Ha=i(66576);let Ya=class extends((0,Za.J)(ka.wq)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,n._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,a._)([(0,o.Cb)({readOnly:!0,json:{read:!1,write:!0}})],Ya.prototype,"type",void 0),(0,a._)([(0,o.Cb)({type:Y.Z}),(0,Ha.B)()],Ya.prototype,"position",void 0),(0,a._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Ha.B)(),(0,Ua.p)((e=>fa.BV.normalize((0,h.q9)(e),0,!0)))],Ya.prototype,"heading",void 0),(0,a._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Ha.B)(),(0,Ua.p)((e=>fa.BV.normalize((0,h.q9)(e),0,!0)))],Ya.prototype,"tilt",void 0),(0,a._)([(0,o.Cb)({type:Number,nonNullable:!0}),(0,Ha.B)()],Ya.prototype,"width",void 0),(0,a._)([(0,o.Cb)({type:Number,nonNullable:!0}),(0,Ha.B)()],Ya.prototype,"height",void 0),Ya=(0,a._)([(0,c.j)("esri.analysis.SlicePlane")],Ya);var Fa=i(48976),Ba=(i(14320),i(40927));(0,m.Z)("mac"),Math.cos((0,Ce.Vl)(45)),Math.cos((0,Ce.Vl)(5));const Xa=(0,d.f)(1,.5,0),ja=((0,Oe.b)([...Xa,.7]),(0,Oe.b)([...Xa,.5]),(0,Oe.f)(1,1,1,1)),Qa=(0,Oe.f)(1,.8,.6,1),qa=(0,Oe.f)(1,.93,.86,1),Ja=(0,Oe.b)([...Xa,1]),Ka=(0,Oe.b)([...Xa,1]),$a=22.5,es=40,ts=(0,Oe.b)([...Xa,1]);(0,ee.c)();i(37081),i(23620),i(93822),i(64226),i(22909),i(98634);var is=i(82144),as=i(31132),ss=i(7566),ns=i(27627),rs=i(11316),os=i(8548),ls=i(36207);class hs extends as.A{initializeProgram(e){return new ns.$(e.rctx,hs.shader.get().build(this.configuration),ss.i)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.wK)(os.zi.ONE,os.zi.ONE,os.zi.ONE_MINUS_SRC_ALPHA,os.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:os.wb.LESS},colorWrite:ls.BK})}}hs.shader=new is.J(rs.S,(()=>i.e(8492).then(i.bind(i,18492))));i(92183),i(78952),i(23470);(0,d.c)();(0,d.c)();i(92028);var cs,ps=i(81703),ds=i(24231);i(53866);function us(e,t){switch(t){case cs.POSITIVE_X:return{basis:e.basis1,direction:1,position:(0,p.a)(Te.WM.get(),e.origin,e.basis1),edge:t};case cs.POSITIVE_Y:return{basis:e.basis2,direction:1,position:(0,p.a)(Te.WM.get(),e.origin,e.basis2),edge:t};case cs.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:(0,p.b)(Te.WM.get(),e.origin,e.basis1),edge:t};case cs.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:(0,p.b)(Te.WM.get(),e.origin,e.basis2),edge:t}}}function _s(e){const t=(0,p.l)(e.basis1),i=(0,p.l)(e.basis2);return.3*Math.min(t,i)}function gs(e){return _s(e)}function ms(e){return 0!==e.direction[0]&&0!==e.direction[1]}function ys(e,t){const i=ms(t),a=i?[(0,d.f)(1,0,0),(0,d.f)(0,0,0),(0,d.f)(0,1,0)]:[(0,d.f)(1,0,0),(0,d.f)(-1,0,0)],s=(0,re.rh)(a),n=ts,r=i?4:1,o=2*r,l=e=>e>1?(e=>new he.U({color:n,width:e,renderOccluded:oe.yD.OccludeAndTransparent}))(e):new ds.Y({color:n,renderOccluded:oe.yD.OccludeAndTransparent}),h=[{geometry:s,material:l(r),stateMask:Mi.Q9.Unfocused|Es},{geometry:s,material:l(o),stateMask:Mi.Q9.Focused|Es},{geometry:s,material:l(1),stateMask:As}],c=new Jt.Z({view:e,renderObjects:h,collisionType:{type:"line",paths:[a]},radius:i?6:4,...Bt.X9});return c.state=Es,c}function vs(e,t,i){const a=a=>{const s=(a?t:e).slice(0),r=(0,p.b)(Te.WM.get(),s[0],s[1]);(0,p.n)(r,r);const o=(0,p.b)(Te.WM.get(),s[s.length-1],s[s.length-2]);if((0,p.n)(o,o),i.padding>0){const e=(0,p.g)((0,d.c)(),o,-i.padding);if(s[s.length-1]=(0,p.a)(e,e,s[s.length-1]),i.bothEnds){const e=(0,p.g)((0,d.c)(),r,-i.padding);s[0]=(0,p.a)(e,e,s[0])}}const l=a?i.tipFocusMultiplier:1,h=i.tipLength*(i.focusTipLength?l:1),c=i.tipRadius*l,u=(0,$.i)(Te.MP.get());if(i.padding>0){const e=h/4,t=(0,p.s)(Te.WM.get(),0,e,0),a=1+i.padding/e;(0,$.v)(u,u,t),(0,$.k)(u,u,(0,p.s)(Te.WM.get(),a,a,a)),(0,$.v)(u,u,(0,p.g)(t,t,-1/a))}const _=(0,$.i)((0,ee.c)()),g=(0,d.f)(0,1,0),m=(0,$.D)((0,ee.c)(),(0,Fa.r)(Te.vD.get(),g,o));m[12]=s[s.length-1][0],m[13]=s[s.length-1][1],m[14]=s[s.length-1][2],(0,$.m)(m,m,u);const y=[{part:"tube",geometry:fs(i.tubeRadius*(a?i.tubeFocusMultiplier:1)+i.padding,i.flat,s),transform:_}];let v,f;if((0,n.pC)(i.flat)?v=(0,re.DA)(h,c,c,i.flat.thickness):(v=(0,re.QL)(h,c,24,!1,!1,!0),f=(0,re.QL)(h,c,24,!1,!0,!1)),y.push({part:"tip",geometry:v,transform:m}),f&&y.push({part:"cap",geometry:f,transform:m}),i.bothEnds){const e=(0,$.D)((0,ee.c)(),(0,Fa.r)(Te.vD.get(),g,r));e[12]=s[0][0],e[13]=s[0][1],e[14]=s[0][2],(0,$.m)(e,e,u),y.push({part:"tip",geometry:v,transform:e}),f&&y.push({part:"cap",geometry:f,transform:e})}return y};return{normal:a(!1),focused:a(!0)}}function fs(e,t,i){const a=[];if((0,n.pC)(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const s=i/t*2*Math.PI;a.push([Math.cos(s)*e,Math.sin(s)*e])}}return(0,re.x2)(a,i,[],[],!1)}function bs(e,t){const i=(0,p.b)((0,d.c)(),e[e.length-1],e[e.length-2]);if((0,p.n)(i,i),(0,p.g)(i,i,$a),(0,p.a)(i,i,e[e.length-1]),t){const t=(0,p.b)((0,d.c)(),e[0],e[1]);return(0,p.n)(t,t),(0,p.g)(t,t,$a),(0,p.a)(t,t,e[0]),[t,...e,i]}return[...e,i]}function Ms(e,t){return(0,Ba.cp)(t,e.basis2,e.basis1)+Os}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(cs||(cs={}));const Ss=Mi.jg.Custom1;var xs,ws;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(xs||(xs={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(ws||(ws={}));const Cs=Mi.jg.Custom2,Os=((0,J.Ue)(),Math.PI/2),Es=Mi.jg.Custom1,As=Mi.jg.Custom2;var Ts;!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Ts||(Ts={}));const Rs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",Gs={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};class Ps{constructor(){this._lastDragEvent=null,this.next=new yi.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&(0,n.pC)(this._lastDragEvent)){const t={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const t=ms(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}var Ds=i(34778),Is=i(254),zs=i(12225),Ls=i(29014);function Ws(e,t){return Ns(e,t,!1)}function Vs(e,t){return Ns(e,t,!0)}function Ns(e,t,i){if(e instanceof Ds.y){if(e.operation instanceof Is.z)return function(e,t){const i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-1:1,a=(0,d.f)(i*e.dx,i*e.dy,i*e.dz);(0,p.a)(t.origin,t.origin,a)}(e.operation,t,i),!0;if(e.operation instanceof zs.S)return function(e,t){const i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-e.angle:e.angle;(0,p.I)(t.basis1,t.basis1,d.Z,i),(0,p.I)(t.basis2,t.basis2,d.Z,i)}(e.operation,t,i),!0;if(e.operation instanceof Ls.q)return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=i?1/e.factor1:e.factor1,s=i?1/e.factor2:e.factor2;(0,p.g)(t.basis1,t.basis1,a),(0,p.g)(t.basis2,t.basis2,s),(0,S.u)(t.origin,t.origin,e.origin,e.axis1,a),(0,S.u)(t.origin,t.origin,e.origin,e.axis2,s)}(e.operation,t,i),!0}return!1}function Zs(e,t,i,a){const s=Te.WM.get();(0,p.b)(s,(0,p.b)(s,e.origin,e.basis1),e.basis2);const r=Te.WM.get();(0,p.z)(r,s,e.basis1,2);const o=Te.WM.get();(0,p.z)(o,r,e.basis2,2);const l=Te.WM.get();(0,p.z)(l,s,e.basis2,2),s[2]=r[2]=o[2]=l[2]=t;const h=a?"on-the-ground":"absolute-height",c=(0,Ft.Fp)((0,I.bZ)(s,r,i,h),(0,I.bZ)(l,o,i,h)),d=(0,Ft.Fp)((0,I.bZ)(r,o,i,h),(0,I.bZ)(s,l,i,h));return(0,n.Wi)(d)||(0,n.Wi)(c)?null:[c,d]}var ks=i(7068);let Us=class extends(yt.Z.EventedMixin(zi.m)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Wi.Z,this._preserveAspectRatio=new Ps,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new F.Z,this._moveZManipulator=null,this._resizeManipulators=null,this._rotateManipulator=null,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=(0,Na.a)(),this._mapBoundsStart=(0,Na.a)(),this._zmax=0,this._sizeStart=null,this._displayBounds=(0,Na.a)(),this._displayBoundsStart=(0,Na.a)(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=(0,x.a)(),this._endScale=(0,x.a)()}initialize(){const{view:e,graphic:t,manipulators:i,_handles:a}=this,o=this._graphicState=new Lt({graphic:t}),l=t.geometry;this._editGeometryOperations=Li.c.fromGeometry(l,e.state.viewingMode),this._graphicMoveManipulation=new Di({tool:this,view:e,graphicState:o}),this._moveZManipulator=function(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ts.CENTER_ON_ARROW)===Ts.CENTER_ON_CALLOUT?es:0,i=[(0,d.f)(t,0,-24),(0,d.f)(t,0,24)],a=bs(i,!0),s=(e,t)=>vs(i,i,{tubeRadius:3,tipRadius:11,tipLength:$a,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),n=s(0,!1),r=s(2.25,!0),o=new Ue.E({color:ja,cullFace:ie.Vr.Back,renderOccluded:oe.yD.Opaque}),l=new Ue.E({color:Qa,cullFace:ie.Vr.Back,renderOccluded:oe.yD.Opaque}),h=new Ue.E({color:qa,cullFace:ie.Vr.Back,renderOccluded:oe.yD.Opaque}),c=new Ue.E({color:Ka,transparent:!0,writeDepth:!1,cullFace:ie.Vr.Front,renderOccluded:oe.yD.Transparent}),p=(0,re.rh)([[t,0,0],[t-es,0,0]]),u=(0,re.rh)([[t,0,0],[t-es,0,0]]),_=new ds.Y({color:Ja,renderOccluded:oe.yD.OccludeAndTransparent});return new Jt.Z({view:e,renderObjects:[...n.normal.map((e=>{let{part:t,geometry:i,transform:a}=e;return{geometry:i,material:"tip"===t?o:"cap"===t?l:h,transform:a,stateMask:Mi.Q9.Unfocused|Ss}})),...r.normal.map((e=>{let{geometry:t,transform:i}=e;return{geometry:t,material:c,transform:i,stateMask:Mi.Q9.Unfocused|Ss}})),{geometry:p,material:_,stateMask:Mi.Q9.Unfocused|Ss|Cs},...n.focused.map((e=>{let{part:t,geometry:i,transform:a}=e;return{geometry:i,material:"tip"===t?o:"cap"===t?l:h,transform:a,stateMask:Mi.Q9.Focused|Ss}})),...r.focused.map((e=>{let{geometry:t,transform:i}=e;return{geometry:t,material:c,transform:i,stateMask:Mi.Q9.Focused|Ss}})),{geometry:u,material:_,stateMask:Mi.Q9.Focused|Ss|Cs}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[a]},collisionPriority:1,radius:11,state:Ss})}(e,Ts.CENTER_ON_CALLOUT),this._moveZManipulator.state|=Cs,a.add([this._createMoveXYGraphicDragPipeline(),(0,r.YP)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._moveZManipulator,qt.TRANSLATE_Z))),this._createMoveZDragPipeline()]),i.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map((t=>{const i=ys(e,t);return a.add([(0,r.YP)((()=>this.enableScaling),(()=>this._updateManipulatorAvailability(i,qt.SCALE))),i.events.on("grab-changed",(e=>this._onResizeGrab(e))),this._createResizeDragPipeline(i,t)]),i})),i.addMany(this._resizeManipulators),this._rotateManipulatorTexture=function(e){return e.fromData(Rs,(()=>new Ge.x(Rs,Gs)))}(e.toolViewManager.textures),this._rotateManipulator=(0,Bt.Ju)(e,{texture:this._rotateManipulatorTexture.texture}),a.add([(0,r.YP)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._rotateManipulator,qt.ROTATE))),this._rotateManipulator.events.on("grab-changed",(e=>{this._onRotateGrab(e)})),this._createRotateDragPipeline(this._rotateManipulator)]),i.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const h=li({view:e,graphic:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,s.kB)()});(0,n.pC)(h)&&(this._outlineVisualElement=h.visualElement instanceof At?h.visualElement:null),(0,n.pC)(this._outlineVisualElement)&&a.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),a.add(h),a.add([o.on("changed",(()=>this._onGeometryChanged())),(0,r.YP)((()=>o.displaying),(()=>this._updateAllManipulatorAvailability())),(0,r.YP)((()=>o.isDraped),(()=>this._graphicDrapedChanged()),r.nn),e.trackGraphicState(o)]);const c=e.pointsOfInterest;c&&a.add((0,r.YP)((()=>c.centerOnSurfaceFrequent.location),(()=>this._updateDisplayBounds())));this._forEachManipulator((e=>{a.add(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((e,i)=>{a.add(e.events.on("immediate-click",(e=>{i===qt.TRANSLATE_XY&&this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:e,view:t}=this,i=this._tooltip=new Zi.u({view:t}),a=()=>{i.info=this._getUpdatedTooltipInfo()};e.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()})),this.on("graphic-rotate-start",(e=>{this._startAngle=e.angle,a()})),this.on("graphic-rotate",(e=>{this._endAngle=e.angle,a()})),this.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0,a()})),this.on("graphic-scale-start",(e=>{(0,S.s)(this._startScale,e.xScale,e.yScale),(0,S.s)(this._endScale,e.xScale,e.yScale),a()})),this.on("graphic-scale",(e=>{(0,S.s)(this._endScale,e.xScale,e.yScale),a()})),this.on("graphic-scale-stop",(()=>{(0,S.s)(this._startScale,0,0),(0,S.s)(this._endScale,0,0),a()}))]),this._forEachManipulator((t=>{e.add([t.events.on("focus-changed",a),t.events.on("grab-changed",a),t.events.on("drag",(e=>{"cancel"===e.action?this._tooltip.clear():a()}))])}))}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some((e=>e.focused))?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=(0,n.Pt)(this._moveXYTooltipInfo,(()=>new ki.$E({tooltipOptions:this.tooltipOptions})))}_computeMoveZTooltipInfo(){const e=this._moveZTooltipInfo=(0,n.Pt)(this._moveZTooltipInfo,(()=>new ki.QW({tooltipOptions:this.tooltipOptions}))),t=this._moveUnit;if(this._moveZManipulator.dragging){const t=this._mapBoundsStart.origin,i=this._mapBounds.origin,a=(0,Ui.Cr)(t,i,this.view.spatialReference);if((0,n.Wi)(a))return null;e.distance=a}else e.distance=(0,Ft.yG)(0,t);return e}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo=(0,n.Pt)(this._rotateTooltipInfo,(()=>new ks.c({tooltipOptions:this.tooltipOptions})));return e.angle=this._startAngle-this._endAngle,e}_computeScaleTooltipInfo(){const e=this.graphic.geometry;if((0,n.Wi)(e))return null;const t=this._scaleTooltipInfo=(0,n.Pt)(this._scaleTooltipInfo,(()=>new ks.p({tooltipOptions:this.tooltipOptions}))),i=Zs(this._mapBounds,this._zmax,e.spatialReference,this._graphicState.isDraped);return(0,n.Wi)(i)?null:(t.xSize=i[0],t.ySize=i[1],(0,n.pC)(this._sizeStart)&&this._resizeManipulators.some((e=>e.dragging))?(t.xScale=i[0].value/this._sizeStart[0].value,t.yScale=i[1].value/this._sizeStart[1].value):(t.xScale=1,t.yScale=1),t)}_graphicDrapedChanged(){this._handles.remove(Hs),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",(e=>{(0,n.pC)(this._attachmentOrigin)&&(0,ai.jE)(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()})),Hs)}_updateAllManipulatorAvailability(){this._forEachManipulator(((e,t)=>this._updateManipulatorAvailability(e,t)))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof Jt.Z){const a=this._graphicState.displaying,s=this.enableZ&&jt(this.graphic);switch(t){case qt.ROTATE:e.available=a&&this.enableRotation;break;case qt.SCALE:e.available=a&&(this.enableScaling||this.enableRotation||s),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Es:As;break;case qt.TRANSLATE_Z:e.available=a&&s;break;default:e.available=a}}}_forEachManipulator(e){this._graphicMoveManipulation.forEachManipulator(e),this._resizeManipulators.forEach((t=>e(t,qt.SCALE))),e(this._rotateManipulator,qt.ROTATE),e(this._moveZManipulator,qt.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get _moveUnit(){return(0,n.Pt)((0,M.j5)(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const e=this.graphic.geometry,t=this._editGeometryOperations.data,i=t.components[0].edges[0],a=(0,S.a)(Te.qW.get(),i.leftVertex.pos,i.rightVertex.pos);(0,S.f)(a,a);const s=(0,n.Pt)((0,Bt.du)(this.view,this.graphic),(()=>e.extent.center));let r=Fs*this.view.pixelSizeAt(s);const o=this.view.spatialReference,l=e.spatialReference;o.equals(l)||(r*=(0,M.c9)(o)/(0,M.c9)(l)),function(e,t,i,a){a||(a=(0,Na.a)());const s=(0,S.s)(Te.qW.get(),e[1],-e[0]),n=(0,S.s)(Te.qW.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=(0,S.s)(Te.qW.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=Te.qW.get();t.components.forEach((t=>t.vertices.forEach((t=>{const i=t.pos;(0,S.s)(o,(0,S.h)(e,i),(0,S.h)(s,i)),(0,S.y)(n,n,o),(0,S.z)(r,r,o)}))));const l=1e-6,h=(0,S.s)(Te.qW.get(),r[0]-n[0]<l?i/2:0,r[1]-n[1]<l?i/2:0);(0,S.a)(n,n,h),(0,S.j)(r,r,h),(0,S.b)(a.basis1,e,(r[0]-n[0])/2),(0,S.b)(a.basis2,s,(r[1]-n[1])/2),(0,S.s)(a.origin,n[0]*e[0]+n[1]*s[0],n[0]*e[1]+n[1]*s[1]),(0,S.j)(a.origin,a.origin,a.basis1),(0,S.j)(a.origin,a.origin,a.basis2)}(a,t,r,this._mapBounds),this._updateZMax()}_updateZMax(){const e=this._editGeometryOperations.data;if(!e.geometry.hasZ)return void(this._zmax=0);const t=e.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of e.components)for(const e of a.vertices){const a=t.getZ(e.pos);i=Math.max(a,i)}this._zmax=i}_updateDisplayBounds(){const e=this.graphic.geometry;if((0,n.Wi)(e))return;const t=(0,n.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,n.pC)(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:(0,Bt.du)(this.view,this.graphic);this._attachmentOrigin=(0,n.Pt)(t,e.extent.center);const i=(0,n.pC)(t)?t.z:(0,De.w7)(this._mapBounds.origin,this.view.elevationProvider,Ie.o.fromElevationInfo((0,u.RL)(this.graphic)),this.view.renderCoordsHelper),a=(0,Na.c)(this._mapBounds);a.origin[2]=i,function(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;s||(s=(0,Na.a)()),t.toRenderCoords(e.origin,i,s.origin);const n=Te.WM.get();(0,p.a)(n,e.origin,e.basis1),(0,p.a)(n,n,e.basis2),t.toRenderCoords(n,i,n);const r=Te.WM.get();(0,p.a)(r,e.origin,e.basis1),(0,p.b)(r,r,e.basis2),t.toRenderCoords(r,i,r);const o=Te.WM.get();(0,p.b)(o,e.origin,e.basis1),(0,p.b)(o,o,e.basis2),t.toRenderCoords(o,i,o);const l=Te.WM.get();(0,p.b)(l,e.origin,e.basis1),(0,p.a)(l,l,e.basis2),t.toRenderCoords(l,i,l);const h=(0,p.h)(Te.WM.get(),n,r,.5);(0,p.b)(h,h,s.origin);const c=(0,p.h)(Te.WM.get(),o,l,.5);(0,p.b)(c,s.origin,c),(0,p.h)(s.basis1,h,c,.5);const d=(0,p.h)(Te.WM.get(),l,n,.5);(0,p.b)(d,d,s.origin);const u=(0,p.h)(Te.WM.get(),r,o,.5);(0,p.b)(u,s.origin,u),(0,p.h)(s.basis2,d,u,.5);const _=(0,p.f)(Te.WM.get(),s.basis1,s.basis2),g=(0,p.f)(_,_,s.basis1);(0,p.n)(g,g),(0,p.g)(s.basis2,g,(0,p.e)(s.basis2,g)),(0,p.g)(s.basis1,s.basis1,1+a/(0,p.l)(s.basis1)),(0,p.g)(s.basis2,s.basis2,1+a/(0,p.l)(s.basis2)),(0,Na.u)(s)}(a,this.view.renderCoordsHelper,e.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){const e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent.center;return Ys*this.view.pixelSizeAt(t)}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline(((e,t,i)=>this._applyGraphicMoveSteps(t,i,Gi.XY)))}_createMoveZDragPipeline(){const e=this.view,t=this._editGeometryOperations.data.spatialReference;return(0,yi.Xd)(this._moveZManipulator,((i,a,s)=>{const n=(0,d.a)(i.renderLocation),r=a.next((0,mi.Sp)(e,n,t)).next((0,yi.zh)());this._applyGraphicMoveSteps(r,s,Gi.Z)}))}_applyGraphicMoveSteps(e,t,i){const a=e.next((e=>("start"===e.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next((0,yi.AN)()).next(this._moveDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e})).next((e=>this._updateMoveTooltip(e,i)));return t.next((()=>{(0,n.pC)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()})),a}_updateOperationStartProperties(){(0,Na.c)(this._displayBounds,this._displayBoundsStart),(0,Na.c)(this._mapBounds,this._mapBoundsStart),(0,n.Wi)(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=Zs(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return e=>{if((0,n.Wi)(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const a of this._editGeometryOperations.data.components)t.push(...a.vertices);const i="start"===e.action?aa.O.NEW_STEP:aa.O.ACCUMULATE_STEPS;return Ws(this._editGeometryOperations.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,e}}_updateMoveTooltip(e,t){if(t===Gi.XY||t===Gi.XY_AXIS){const t=(0,I.GQ)(e.mapStart,e.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");(0,n.pC)(t)&&(0,n.pC)(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=t)}return e}_onResizeGrab(e){if("start"!==e.action)return;const t=this._calculatePickRay(e.screenPoint);(0,qi.BR)(this._displayBounds.plane,t,Te.WM.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return(0,yi.Xd)(e,((e,i,a)=>{(0,n.Wi)(this.inputState)||(i.next((e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e))).next((0,mi._N)(this.view,this._displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e})),a.next((()=>{(0,n.pC)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()})))}))}_resizeDragRenderPlaneToFactors(){return e=>{const t=this._displayBoundsStart,i=e.handle.direction,a=this._displayBoundsMargin,s=this._displayBoundsMarginStart,n=(0,p.c)(Te.WM.get(),t.origin);(0,p.z)(n,n,t.basis1,-i[0]),(0,p.z)(n,n,t.basis2,-i[1]);const r=(0,p.b)(Te.WM.get(),e.renderEnd,n),o=(0,p.b)(Te.WM.get(),e.renderStart,n),l=ms(e.handle),h=gs(t),c=gs(this._displayBounds)/h,d=(e,t)=>{if(0===e)return 1;let i=(0,p.l)(t),n=.5*e*(0,p.e)(t,r)/i;const h=n<0?-1:1;l&&(n+=(i-.5*e*(0,p.e)(t,o)/i)*h*c);const d=i<1.5*s?1:Bs;return i=Math.max(i-s,Bs),h>0&&(n-=a),h*Math.max(h*(n/i),d)};return{...e,factor1:d(i[0],t.basis1),factor2:d(i[1],t.basis2)}}}_resizeDragUpdateGeometry(){return e=>{const t=(0,p.c)((0,d.c)(),this._mapBoundsStart.origin);(0,p.z)(t,t,this._mapBoundsStart.basis1,-e.handle.direction[0]),(0,p.z)(t,t,this._mapBoundsStart.basis2,-e.handle.direction[1]);const i=(0,S.s)((0,x.a)(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);(0,S.f)(i,i);const a=[];for(const r of this._editGeometryOperations.data.components)a.push(...r.vertices);const s="start"===e.action?aa.O.NEW_STEP:aa.O.ACCUMULATE_STEPS,n=this._editGeometryOperations.scaleVertices(a,t,i,e.factor1,e.factor2,s,Ds.w.REPLACE);return(0,Na.c)(this._mapBoundsStart,this._mapBounds),Ws(n,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,e}}_onRotateGrab(e){if("start"!==e.action)return;const t=function(e,t,i,a){const s=t.worldUpAtPosition(e.origin,Te.WM.get()),n=Te.WM.get();switch(i){case xs.HEADING:(0,p.c)(n,s);break;case xs.TILT:(0,p.c)(n,e.basis1)}return(0,qi.Yq)(e.origin,n,a)}(this._displayBounds,this.view.renderCoordsHelper,xs.HEADING,(0,qi.Ue)()),i=this._calculatePickRay(e.screenPoint);(0,qi.BR)(t,i,Te.WM.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(e){return(0,yi.Xd)(e,((e,t,i)=>{const a=this.inputState;(0,n.Wi)(a)||(t.next((e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e))).next((0,mi._N)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,angle:(0,Ce.BV)(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e})),i.next((()=>{(0,n.pC)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const i=(0,qi.mJ)(e.rotatePlane),a=(0,Bt.Gd)(t.renderStart,t.renderEnd,this._displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return e=>{const t=(0,p.c)((0,d.c)(),this._mapBoundsStart.origin),i=[];for(const n of this._editGeometryOperations.data.components)i.push(...n.vertices);const a="start"===e.action?aa.O.NEW_STEP:aa.O.ACCUMULATE_STEPS,s=this._editGeometryOperations.rotateVertices(i,t,e.rotateAngle,a,Ds.w.REPLACE);return(0,Na.c)(this._mapBoundsStart,this._mapBounds),Ws(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,e}}_calculatePickRay(e){const t=(0,J.Ue)(),i=(0,g.md)(e);return(0,ps.u4)(this.view.state.camera,i,t),(0,p.n)(t.direction,t.direction),t}_updateManipulators(){if(!this.visible)return;const e=function(e,t){return(0,Bt.Aq)(e.basis1,e.basis2,e.origin,t)}(this._displayBounds,Te.MP.get());(function(e,t,i,a){const s=a.worldUpAtPosition(i.origin,Te.WM.get()),n=us(i,cs.POSITIVE_X),r=(0,$.b)(Te.MP.get(),n.edge*Math.PI/2);(0,$.r)(r,r,-Ms(i,s)),(0,$.m)(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=n.position})(this._rotateManipulator,e,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,e),this._resizeManipulators.forEach(((t,i)=>{!function(e,t,i,a){const s=(0,p.l)(a.basis1),n=(0,p.l)(a.basis2),r=_s(a),o=gs(a),l=(0,p.s)(Te.WM.get(),0,0,0);(0,p.a)(l,(0,p.g)(Te.WM.get(),a.basis1,t.direction[0]),(0,p.g)(Te.WM.get(),a.basis2,t.direction[1])),(0,p.a)(l,a.origin,l);let h=0,c=1;if(ms(t))1===t.direction[0]&&-1===t.direction[1]?h=Os:1===t.direction[0]&&1===t.direction[1]?h=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(h=3*Math.PI/2),c=o;else{const e=0!==t.direction[0]?1:2;h=1===e?Os:0,c=(1===e?n:s)-r}const d=(0,$.b)(Te.MP.get(),h);(0,$.k)(d,d,(0,p.s)(Te.WM.get(),c,c,c)),(0,$.m)(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=l}(t,this._resizeHandles[i],e,this._displayBounds)}))}_updateZMoveHandle(e,t){const i=this._displayBounds,a={basis:i.basis1,direction:-1,position:(0,p.b)(Te.WM.get(),i.origin,i.basis1),edge:2},s=Te.MP.get();(0,$.o)(s,t,a.edge*Math.PI/2),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position}_cancel(){const e=this._editGeometryOperations.lastOperation;(0,n.Wi)(e)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,Vs(e,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if((0,n.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Vs((0,n.Wg)(e),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Ws((0,n.Wg)(e),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Us.prototype,"view",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Us.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Us.prototype,"enableZ",void 0),(0,a._)([(0,o.Cb)()],Us.prototype,"enableRotation",void 0),(0,a._)([(0,o.Cb)()],Us.prototype,"enableScaling",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Wi.Z})],Us.prototype,"tooltipOptions",void 0),(0,a._)([(0,o.Cb)()],Us.prototype,"preserveAspectRatio",null),(0,a._)([(0,o.Cb)()],Us.prototype,"grabbing",void 0),(0,a._)([(0,o.Cb)()],Us.prototype,"inputState",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],Us.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],Us.prototype,"_moveUnit",null),Us=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Us);const Hs="draped-elevation-changes",Ys=10,Fs=80,Bs=1e-6},2346:(e,t,i)=>{i.d(t,{L:()=>f});var a=i(27366),s=i(85015),n=i(91505),r=i(92026),o=i(94172),l=i(17842),h=i(49861),c=(i(63780),i(25243),i(69912)),p=i(88396),d=i(11186),u=i(71353),_=i(79803),g=i(74509),m=i(61574),y=i(64575),v=i(45008);let f=class extends s.Z{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new n.Z.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=(0,g.vu)(this.graphic),i=e?e.offset:0;return new y.Z({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if((0,r.Wi)(i))return null;const a=this._get("focusedSymbol"),s=(0,r.pC)(a)?a:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,s):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),(0,r.pC)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,r.pC)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,o.YP)((()=>this.graphic?.symbol),(e=>{(0,r.pC)(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&(0,r.pC)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),o.Z_)}detachSymbolChanged(){(0,r.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&(0,r.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,a){if(a=a||(0,m.js)(i),(0,r.Wi)(a))return null;let s=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==a.type)return(0,v.D)(t,i,e)?1:null;if((0,r.Wi)(s)||!s.originalPoint.equals(i)){const t=i,n=e.spatialReference;if((0,_.Up)(t.spatialReference,n)){const e=(0,_.iV)(t,n);s={originalPoint:t.clone(),mapPoint:e,radiusPx:(0,l.F2)(a.size)},this._circleCollisionCache=s}}if((0,r.pC)(s)){const i=(0,l.md)(t,M),n=e.toScreen(s.mapPoint),r=s.radiusPx,o=n.x+(0,l.F2)(a.xoffset),h=n.y-(0,l.F2)(a.yoffset);return(0,p.k)(i,[o,h])<r*r?1:null}return null}_intersectDistance3D(e,t,i){const a=e.toMap(t,{include:[i]});return a&&(0,_.KC)(a,b,e.renderSpatialReference)?(0,d.i)(b,e.state.camera.eye):null}};(0,a._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],f.prototype,"graphic",null),(0,a._)([(0,h.Cb)()],f.prototype,"elevationInfo",null),(0,a._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],f.prototype,"view",void 0),(0,a._)([(0,h.Cb)({value:null})],f.prototype,"focusedSymbol",null),(0,a._)([(0,h.Cb)({constructOnly:!0})],f.prototype,"layer",void 0),(0,a._)([(0,h.Cb)()],f.prototype,"interactive",void 0),(0,a._)([(0,h.Cb)()],f.prototype,"selectable",void 0),(0,a._)([(0,h.Cb)()],f.prototype,"grabbable",void 0),(0,a._)([(0,h.Cb)({value:!1})],f.prototype,"grabbing",null),(0,a._)([(0,h.Cb)()],f.prototype,"dragging",void 0),(0,a._)([(0,h.Cb)()],f.prototype,"hovering",null),(0,a._)([(0,h.Cb)({value:!1})],f.prototype,"selected",null),(0,a._)([(0,h.Cb)()],f.prototype,"cursor",void 0),f=(0,a._)([(0,c.j)("esri.views.interactive.GraphicManipulator")],f);const b=(0,u.c)(),M=(0,l.s1)()},7068:(e,t,i)=>{i.d(t,{c:()=>l,p:()=>h});var a=i(27366),s=i(47898),n=i(49861),r=i(69912),o=i(4943);let l=class extends o.h{constructor(e){super(e),this.type="extent-rotate",this.angle=0}};(0,a._)([(0,n.Cb)()],l.prototype,"type",void 0),(0,a._)([(0,n.Cb)()],l.prototype,"angle",void 0),l=(0,a._)([(0,r.j)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],l);let h=class extends o.h{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=s.yP,this.ySize=s.yP}};(0,a._)([(0,n.Cb)()],h.prototype,"type",void 0),(0,a._)([(0,n.Cb)()],h.prototype,"xScale",void 0),(0,a._)([(0,n.Cb)()],h.prototype,"yScale",void 0),(0,a._)([(0,n.Cb)()],h.prototype,"xSize",void 0),(0,a._)([(0,n.Cb)()],h.prototype,"ySize",void 0),h=(0,a._)([(0,r.j)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],h)},40524:(e,t,i)=>{i.d(t,{$E:()=>l,QW:()=>h,c1:()=>u,in:()=>c,j:()=>d,nk:()=>p});var a=i(27366),s=i(47898),n=i(49861),r=i(69912),o=i(4943);let l=class extends o.h{constructor(e){super(e),this.type="translate-graphic",this.distance=s.yP}};(0,a._)([(0,n.Cb)()],l.prototype,"type",void 0),(0,a._)([(0,n.Cb)()],l.prototype,"distance",void 0),l=(0,a._)([(0,r.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],l);let h=class extends o.h{constructor(e){super(e),this.type="translate-graphic-z",this.distance=s.yP}};(0,a._)([(0,n.Cb)()],h.prototype,"type",void 0),(0,a._)([(0,n.Cb)()],h.prototype,"distance",void 0),h=(0,a._)([(0,r.j)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],h);let c=class extends o.h{constructor(e){super(e),this.type="translate-graphic-xy",this.distance=s.yP}};(0,a._)([(0,n.Cb)()],c.prototype,"type",void 0),(0,a._)([(0,n.Cb)()],c.prototype,"distance",void 0),c=(0,a._)([(0,r.j)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],c);let p=class extends o.h{constructor(e){super(e),this.type="translate-vertex",this.distance=s.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,a._)([(0,n.Cb)()],p.prototype,"type",void 0),(0,a._)([(0,n.Cb)()],p.prototype,"distance",void 0),(0,a._)([(0,n.Cb)()],p.prototype,"elevation",void 0),(0,a._)([(0,n.Cb)()],p.prototype,"area",void 0),(0,a._)([(0,n.Cb)()],p.prototype,"totalLength",void 0),p=(0,a._)([(0,r.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],p);let d=class extends o.h{constructor(e){super(e),this.type="translate-vertex-z",this.distance=s.yP,this.elevation=null}};(0,a._)([(0,n.Cb)()],d.prototype,"type",void 0),(0,a._)([(0,n.Cb)()],d.prototype,"distance",void 0),(0,a._)([(0,n.Cb)()],d.prototype,"elevation",void 0),d=(0,a._)([(0,r.j)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],d);let u=class extends o.h{constructor(e){super(e),this.type="translate-vertex-xy",this.distance=s.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,a._)([(0,n.Cb)()],u.prototype,"type",void 0),(0,a._)([(0,n.Cb)()],u.prototype,"distance",void 0),(0,a._)([(0,n.Cb)()],u.prototype,"elevation",void 0),(0,a._)([(0,n.Cb)()],u.prototype,"area",void 0),(0,a._)([(0,n.Cb)()],u.prototype,"totalLength",void 0),u=(0,a._)([(0,r.j)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],u)},45008:(e,t,i)=>{i.d(t,{D:()=>l,K:()=>o});i(59486);var a=i(92026),s=i(68860),n=i(96669),r=i(53866);function o(e,t,i){let n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.Z;if("2d"===i.type)n=t*i.resolution;else if("3d"===i.type){const r=i.overlayPixelSizeInMapUnits(e),o=i.basemapSpatialReference;n=(0,a.pC)(o)&&!o.equals(i.spatialReference)?(0,s.c9)(o)/(0,s.c9)(i.spatialReference):t*r}const l=e.x-n,h=e.y-n,c=e.x+n,p=e.y+n,{spatialReference:d}=i;return o.xmin=Math.min(l,c),o.ymin=Math.min(h,p),o.xmax=Math.max(l,c),o.ymax=Math.max(h,p),o.spatialReference=d,o}function l(e,t,i){const s=i.toMap(e);return!(0,a.Wi)(s)&&o(s,(0,n.k)(),i,h).intersects(t)}const h=new r.Z},92028:(e,t,i)=>{i.d(t,{D:()=>n});var a=i(72619),s=i(50951);function n(e,t){return null!=e&&(null==t||(t===s.JY.Local?!e.isGeographic||e.isWGS84||e.wkid===a.W.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===a.W.CGCS2000||e.wkid===a.W.GCSMARS2000||e.wkid===a.W.GCSMARS2000_SPHERE||e.wkid===a.W.GCSMOON2000))}}}]);
//# sourceMappingURL=2232.b929e13c.chunk.js.map