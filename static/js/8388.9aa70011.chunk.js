"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[8388],{18388:(e,t,a)=>{a.r(t),a.d(t,{default:()=>B});a(81325),a(47760),a(57766),a(86899),a(18936);var s=a(85580),i=a(72791),l=(a(74037),a(29134),a(78159),a(45946),a(21775),a(70032)),r=a(29479),o=a(26834);function n(e,t,a,s,i,l,r){var n,c;0===i&&r.map.basemap.baseLayers.removeAll();const u=null===t||void 0===t||null===(n=t.detail)||void 0===n||null===(c=n.selectedItems[0])||void 0===c?void 0:c.value;if(u){const t=a.find((e=>e.id===u));null===t||void 0===t||t.load().then((t=>{if("Web Map"===t.type){new o.Z({portalItem:{id:t.id}}).loadAll().then((t=>{setTimeout((()=>{null===t||void 0===t||t.basemap.baseLayers.forEach((e=>{0===i&&(e.blendMode="multiply"),s.baseLayers.add(e,0)})),s.baseLayers.addMany(s.baseLayers,0),l(e),"opacity"===e&&(r.map.basemap=s)}))}))}}))}}var c=a(80184);function u(e){var t,a,o;const[u,d]=(0,i.useState)(),m=(0,i.useRef)(!1),[p,v]=(0,i.useState)("basemap"),[b,y]=(0,i.useState)([]),[h,f]=(0,i.useState)([]),g=(0,i.useRef)(new r.default({baseLayers:[]}));return(0,i.useEffect)((()=>{if(d(e.view),!m.current){const t=new l.Z;t.queryGroups({query:`id: ${e.mapGroup}`}).then((e=>{e.results[0].queryItems({query:"*"}).then((e=>{y(e.results)}))})),t.queryGroups({query:`id: ${e.imageGroup}`}).then((e=>{e.results[0].queryItems({query:"*"}).then((e=>{f(e.results)}))}))}}),[e.view,e.mapGroup,e.imageGroup]),(0,c.jsx)("div",{className:"blend",children:(0,c.jsxs)(s.Gq,{layout:"vertical",children:[(0,c.jsx)(s.cl,{active:"basemap"===p||void 0,itemTitle:"Basemap",description:"Select basemap layer",onClick:()=>v("basemap"),children:(0,c.jsx)(s.Y,{label:"Basemaps",selectionMode:"single",scale:"l",onCalciteComboboxChange:e=>n("images",e,b,g.current,0,v,u),children:b.map((e=>(0,c.jsx)(s.tp,{title:e.title,textLabel:e.title,value:e.id},e.id)))})}),(0,c.jsx)(s.cl,{active:"images"===p||void 0,itemTitle:"Image",description:"Select imagery layer",onClick:()=>v("images"),children:(0,c.jsx)(s.Y,{label:"Images",selectionMode:"single",scale:"l",onCalciteComboboxChange:e=>n("opacity",e,h,g.current,1,v,u),children:h.sort(((e,t)=>e.title>t.title?-1:1)).map((e=>(0,c.jsx)(s.tp,{title:e.title,textLabel:e.title,value:e.id},e.id)))})}),(0,c.jsx)(s.cl,{active:"opacity"===p||void 0,itemTitle:"Opacity",description:"Set opacity",onClick:()=>v("opacity"),children:(0,c.jsx)(s.XQ,{max:1,min:0,step:.1,value:null===(t=g.current)||void 0===t||null===(a=t.baseLayers)||void 0===a||null===(o=a.getItemAt(g.current.baseLayers.length-1))||void 0===o?void 0:o.opacity,maxLabel:"Opaque",minLabel:"Transparent",onCalciteSliderInput:e=>{u&&(u.map.basemap.baseLayers.getItemAt(0).opacity=e.target.value)}})})]})})}const d=i.memo(u);var m=a(2170),p=a(6934),v=a(97862),b=a(76200),y=a(80885),h=a(51995),f=a(94172);let g,x,w,j;const L=e=>m.intersects(e,x),I=e=>!!w||e.portalItem.tags.includes("countywide"),C=e=>new Promise(((e,t)=>{(0,b.default)("https://maps.raleighnc.gov/images/rest/services/Orthos2020/ImageServer/queryBoundary?outSR=102100&f=json",{responseType:"json"}).then((t=>{x=y.Z.fromJSON(t.data.shape),e(x)}))})),S=(e,t,a)=>{x&&g.source.basemaps.find((e=>g.activeBasemap.title===e.title))&&(j=w,w=L(t.extent),j!==w&&(g.source.refresh(),setTimeout((()=>{const e=g.source.basemaps.find((e=>t.map.basemap.title===e.title));if(e)g.activeBasemap=e;else{const e=g.activeBasemap.title;g.activeBasemap=g.source.basemaps.at(0);const t=g.activeBasemap.title;a({show:!0,from:e,to:t})}}),1e3)))},q=(e,t)=>new Promise(((a,s)=>{if(e.baseLayers.length){const s=e.baseLayers.find((e=>"vector-tile"===e.type));"vector-tile"===(null===s||void 0===s?void 0:s.type)?f.N1((()=>s.loaded)).then((e=>{const i=s.getStyleLayer("background");if(i){const e=new h.Z(i.paint["background-color"]);t.background={color:e},a(e.isBright)}else a(!0)})):s||"imagery"!==e.baseLayers.getItemAt(0).type?a(!0):a(!1)}})),k=(e,t)=>{const a=e.map.allLayers.find((e=>e.title.includes("Property")&&"feature"===e.type));if(a){const e=(null===a||void 0===a?void 0:a.renderer).clone();t?(e.symbol.outline.color.r=0,e.symbol.outline.color.g=0,e.symbol.outline.color.b=0):(e.symbol.outline.color.r=255,e.symbol.outline.color.g=255,e.symbol.outline.color.b=255),a.renderer=e}};function A(e){const[t,a]=(0,i.useState)(),[l,r]=(0,i.useState)({show:!1,from:"",to:""}),o=(0,i.useRef)(!1),n=(0,i.useRef)(null),u=(0,i.useRef)(null),m=(0,i.useRef)(null),b="f6329364e80c438a958ce74aadc3a89f",y="492386759d264d49948bf7f83957ddb9";return(0,i.useEffect)((()=>{a(e.view),o.current||(o.current=!0,function(e,t,a){new p.Z({container:t,view:e,source:{query:`id: ${a}`}})}(e.view,n.current,b),function(e,t,a,s){g=new p.Z({container:t,view:e,source:new v.Z({query:`id: ${a}`,filterFunction:I,updateBasemapsCallback:e=>e.reverse()})}),g.when((()=>{g.source.basemaps.reverse(),x||C(e).then((t=>{x=t,w=L(e.extent),g.source.refresh()})),e.watch("extent",(t=>S(t,e,s)))})),e.map.watch("basemap",(t=>{q(t,e).then((t=>{k(e,t)}))}))}(e.view,u.current,y,r),function(e,t){new p.Z({container:t,view:e})}(e.view,m.current))}),[e.view]),(0,c.jsxs)("div",{className:"basemaps",children:[(0,c.jsxs)(s.A3,{position:"below",layout:"center",scale:"m",children:[(0,c.jsxs)(s.yj,{slot:"tab-nav",children:[(0,c.jsx)(s.A7,{children:"Maps"}),(0,c.jsx)(s.A7,{children:"Images"}),(0,c.jsx)(s.A7,{children:"Esri"}),(0,c.jsx)(s.A7,{children:"Blend"})]}),(0,c.jsx)(s.Qi,{children:(0,c.jsx)("div",{ref:n})}),(0,c.jsx)(s.Qi,{children:(0,c.jsx)("div",{ref:u})}),(0,c.jsx)(s.Qi,{children:(0,c.jsx)("div",{ref:m})}),(0,c.jsx)(s.Qi,{children:(0,c.jsx)(d,{view:t,mapGroup:b,imageGroup:y})})]}),(0,c.jsxs)(s.Uh,{active:!0===l.show||void 0,autoDismiss:!0,autoDismissDuration:"medium",color:"yellow",label:"Imagery Year Changed",children:[(0,c.jsx)("div",{slot:"title",children:"Imagery Not Available"}),(0,c.jsx)("div",{slot:"message",children:`Imagery for ${l.from} only available inside Raleigh, base map has changed to ${l.to}`})]})]})}const B=i.memo(A)}}]);
//# sourceMappingURL=8388.9aa70011.chunk.js.map