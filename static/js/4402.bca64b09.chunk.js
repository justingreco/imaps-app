"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[4402],{94402:(e,t,i)=>{i.r(t),i.d(t,{Layers:()=>E,default:()=>A});var l=i(85580),a=i(72791),r=i(36279),n=i(40281),s=i(9676),o=i(35387),d=i(1250),c=i(80184);const u=e=>{const t=(0,a.useRef)(!1),[i,r]=(0,a.useState)(0),[n,s]=(0,a.useState)(0);return(0,a.useEffect)((()=>{e.layer&&e.datefield&&!t.current&&(t.current=!0,(async(t,i)=>{e.layer.queryFeatures({where:`EXTRACT(YEAR,${i}) >= 2010`,returnGeometry:!1,outStatistics:[{statisticType:"max",onStatisticField:i,outStatisticFieldName:"MAX_DATE"},{statisticType:"min",onStatisticField:i,outStatisticFieldName:"MIN_DATE"}],outFields:["MAX_DATE","MIN_DATE"]}).then((i=>{if(null!==i&&void 0!==i&&i.features.length){const l=new Date(i.features[0].getAttribute("MAX_DATE")).getFullYear(),a=new Date(i.features[0].getAttribute("MIN_DATE")).getFullYear();t.definitionExpression=`EXTRACT(YEAR FROM ${e.datefield}) >= ${a}\n            AND EXTRACT(YEAR FROM ${e.datefield}) <= ${l}\n            `,t.refresh(),r(l),s(a)}})).catch((e=>{console.log(e)}))})(e.layer,e.datefield).then((()=>{})))}),[]),(0,c.jsx)("div",{children:(0,c.jsx)(l.XQ,{labelHandles:!0,labelTicks:!0,min:n,max:i,maxValue:i,minValue:i-1,minLabel:n.toString(),maxLabel:i.toString(),onCalciteSliderChange:t=>{e.layer.definitionExpression=`EXTRACT(YEAR FROM ${e.datefield}) >= ${t.target.minValue}\n            AND EXTRACT(YEAR FROM ${e.datefield}) <= ${t.target.maxValue}\n            `,e.layer.refresh()}})})},p=(0,a.lazy)((()=>i.e(516).then(i.bind(i,50516))));function y(e,t){return new Promise(((i,l)=>{(function(e){return new Promise(((t,i)=>{const l=new r.Z({portalItem:{id:"95092428774c4b1fb6a3b6f5fed9fbc4"}});l.load().then((()=>{e.map.allLayers.filter((e=>"group"===e.type)).toArray().forEach((e=>{const t=l.allLayers.find((t=>"group"===t.type&&t.title===e.title));e.addMany(t.layers.filter((t=>{const i=e.findLayerById(t.id);return void 0!==i&&"feature"===i.type&&(i.popupTemplate=t.popupTemplate,i.renderer=t.renderer),void 0===e.findLayerById(t.id)})).toArray())})),t(!0)}))}))})(t).then((()=>{const l=new o.Z({view:t,container:e,listItemCreatedFunction:b});l.on("trigger-action",(e=>{"Property"===e.item.layer.title&&m(e)})),i(l)}))}))}const m=e=>{if("Property"===e.item.layer.title){t=e.item.layer,(i=e.item.actionsSections).length>1&&((e,t)=>{const i=e.renderer.clone();t?(i.symbol.outline.color.r=0,i.symbol.outline.color.g=0,i.symbol.outline.color.b=0):(i.symbol.outline.color.r=255,i.symbol.outline.color.g=255,i.symbol.outline.color.b=255),e.renderer=i})(t,!i.getItemAt(1).getItemAt(0).value),e.item.layer.labelsVisible||(e.item.layer.labelsVisible=!0);const l=e.item.actionsSections.getItemAt(0).filter((e=>e.value)).map((e=>e.title)),a=f.filter((e=>l.includes(e.title))),r=a.map((e=>e.expression)),n=r.join("+ TextFormatting.NewLine+");e.item.layer.labelingInfo=[],e.item.layer.labelingInfo=[{symbol:{type:"text",color:"black",haloColor:"white",haloSize:1,font:{family:"AvenirNext LT Pro Regular",style:"normal",weight:"bold"}},labelExpressionInfo:{expression:n},maxScale:0,minScale:5e3}]}var t,i},f=[{expression:"First(Split($feature['SITE_ADDRESS'], ' '))",title:"Address"},{expression:"$feature['PIN_NUM']",title:"PIN"},{expression:"$feature['REID']",title:"REID"},{expression:'When(IsEmpty($feature["SALE_DATE"]),null, Concatenate(Month($feature["SALE_DATE"])+1, \'/\',Day($feature["SALE_DATE"]), \'/\',Year($feature["SALE_DATE"])))',title:"Sale Date"},{expression:"Text($feature.TOTSALPRICE,'$#,###')",title:"Sale Price"}],h=e=>{if(e.visible&&!e.panel&&"group"!==e.layer.type&&void 0!==e.layer.type){const t=document.createElement("slider-container");(0,d.createRoot)(t).render((0,c.jsx)(a.Suspense,{fallback:"",children:(0,c.jsx)(p,{value:e.layer.opacity,layer:e.layer})})),e.panel={content:[t,"legend"],open:!1},(e=>{if(e.layer.title.includes("Development Plans")&&"group"!==e.layer.type&&0===e.actionsSections.length){const t=document.createElement("filter-container");(0,d.createRoot)(t).render((0,c.jsx)(a.Suspense,{fallback:"",children:(0,c.jsx)(u,{datefield:"apply_date",layer:e.layer})})),e.panel.content.push(t)}})(e)}},b=e=>{const t=e.item;h(t),t.open=t.layer.visible,t.layer.watch("visible",(e=>{t.open=e,h(t),e&&(t.layer.parent&&"group"===t.layer.parent.type&&(t.layer.parent.visible=!0),t.layer.parent.parent&&"group"===t.layer.parent.parent.type&&(t.layer.parent.parent.visible=!0))})),(e=>{if("Property"===e.layer.title&&"group"!==e.layer.type&&0===e.actionsSections.length){let t=new n.Z;t.addMany(f.map((t=>{var i;return new s.Z({value:null===(i=e.layer.labelingInfo)||void 0===i?void 0:i.find((i=>{var l;return(null===(l=i.labelExpressionInfo)||void 0===l?void 0:l.expression.includes(t.expression))&&e.layer.labelsVisible})),title:t.title,visible:!0})}))),e.actionsSections.push(t),t=new n.Z,t.add(new s.Z({value:e.layer.renderer.symbol.outline.color.isBright,title:"Light Outline",visible:!0})),e.actionsSections.push(t),e.actionsOpen=!0,setTimeout((()=>{const e=document.createElement("h4");e.id="labels-actions-title",e.textContent="Labels",e.setAttribute("style","padding: 0.5em;margin: 0;");const t=document.querySelector(".esri-layer-list__item-actions");null!==t&&void 0!==t&&t.parentElement&&!document.getElementById("labels-actions-title")&&t.prepend(e)}),500)}})(t)},v={title:"Layer List Tips",tips:[{title:"Group Layers",text:"Layers in the layer list are now grouped based on category, making it easier to find layers."}]},g=e=>{const t=(0,a.useRef)(),i=(0,a.useRef)(!1),[l,r]=(0,a.useState)(),[n,s]=(0,a.useState)(!0),[o,d]=(0,a.useState)(!1);(0,a.useEffect)((()=>(i.current||(i.current=!0,y(t.current,e.view).then((e=>{r(e),e.when((()=>{s(!1)}))}))),()=>{l&&(null===l||void 0===l||l.destroy())})),[]),(0,a.useEffect)((()=>{d(e.isActive)}),[e.isActive]);const c=(0,a.useCallback)((t=>{e.panelDismissed()}),[]),u=(0,a.useCallback)((t=>{e.showTips(v)}),[]);return{ref:t,layerList:l,isLoading:n,isActive:o,panelDismissed:c,tipsClicked:u}},E=e=>{const{ref:t,layerList:i,isLoading:a,isActive:r,panelDismissed:n,tipsClicked:s}=g(e);return(0,c.jsxs)(l.N$,{id:"layers-panel",heading:"Layers",hidden:!r,closed:!r||void 0,dismissed:!r||void 0,dismissible:!0,onCalcitePanelDismiss:n,children:[(0,c.jsx)(l.G1,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:s}),(0,c.jsx)(l.$A,{label:"Show Tip",referenceElement:"tip",children:"Show Tip"}),(0,c.jsxs)("div",{className:"layers",children:[i&&(0,c.jsxs)("div",{className:"row sticky",children:[(0,c.jsx)(l.e,{clearable:!0,placeholder:"Filter by layer name",scale:"m",onCalciteInputInput:e=>{i&&((e,t)=>{e||(e=""),t.operationalItems.forEach((i=>{if("group"===i.layer.type){let u=!1;var l,a,r,n,s,o,d,c;i.layer.layers.forEach((t=>{t.title.toLowerCase().includes(e.toLowerCase())?(t.listMode="show",u=!0):t.listMode="hide","group"===t.type&&t.layers.forEach((i=>{i.title.toLowerCase().includes(e.toLowerCase())?(t.listMode="show",i.listMode="show",u=!0):i.listMode="hide"}))})),i.open=e.length>0&&u,(!e.length||u)&&(null===(l=document.getElementById(`${t.id}_${i.uid}__title`))||void 0===l||null===(a=l.parentElement)||void 0===a||null===(r=a.parentElement)||void 0===r||null===(n=r.parentElement)||void 0===n||n.removeAttribute("hidden")),u||null===(s=document.getElementById(`${t.id}_${i.uid}__title`))||void 0===s||null===(o=s.parentElement)||void 0===o||null===(d=o.parentElement)||void 0===d||null===(c=d.parentElement)||void 0===c||c.setAttribute("hidden","")}}))})(e.target.value,i)}}),(0,c.jsx)(l.G1,{text:"clear",icon:"viewHide",scale:"s",onClick:()=>{var e;(null===(e=i)||void 0===e?void 0:e.view.map.allLayers.filter((e=>"group"===e.type))).forEach((e=>{e.visible="Property"===e.title,e.layers.forEach((e=>{e.visible="Property"===e.title}))}))}})]}),(0,c.jsx)("div",{ref:t}),(0,c.jsx)(l.Ed,{loading:!0,hidden:!a||void 0})]})]})},A=E}}]);
//# sourceMappingURL=4402.bca64b09.chunk.js.map