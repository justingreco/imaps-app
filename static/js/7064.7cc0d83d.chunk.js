"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[7064],{99180:(e,t,i)=>{i.d(t,{Z:()=>u});var a=i(27366),s=i(46784),r=i(49861),n=(i(63780),i(25243),i(69912)),o=i(53866);let l=class extends s.wq{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};(0,a._)([(0,r.Cb)({type:o.Z})],l.prototype,"extent",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"height",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"href",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"opacity",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"rotation",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"scale",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"visible",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"width",void 0),l=(0,a._)([(0,n.j)("esri.layer.support.MapImage")],l);const u=l},87072:(e,t,i)=>{function a(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?r(e.view.floors,t.floorInfo.floorField):null}function s(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?r(e,t.floorInfo.floorField):null}function r(e,t){if(!e?.length)return null;const i=e.filter((e=>""!==e)).map((e=>`'${e}'`));return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}i.d(t,{c:()=>a,f:()=>s})},77262:(e,t,i)=>{i.d(t,{Z:()=>p});var a=i(27366),s=i(85015),r=i(49861),n=(i(63780),i(25243)),o=i(69912),l=i(53866),u=i(78952);let c=class extends s.Z{constructor(){super(...arguments),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}};(0,a._)([(0,r.Cb)({type:u.Z})],c.prototype,"outSpatialReference",void 0),(0,a._)([(0,r.Cb)({type:l.Z})],c.prototype,"processExtent",void 0),(0,a._)([(0,r.Cb)({type:u.Z})],c.prototype,"processSpatialReference",void 0),(0,a._)([(0,r.Cb)({nonNullable:!0})],c.prototype,"returnFeatureCollection",void 0),(0,a._)([(0,r.Cb)({nonNullable:!0})],c.prototype,"returnM",void 0),(0,a._)([(0,r.Cb)({nonNullable:!0})],c.prototype,"returnZ",void 0),c=(0,a._)([(0,o.j)("esri.rest.geoprocessor.GPOptions")],c),c.from=(0,n.se)(c);const p=c},85216:(e,t,i)=>{i.d(t,{h:()=>n});var a=i(77262),s=i(16012),r=i(2429);async function n(e,t,i,n){return i=a.Z.from(i||{}),(0,s.By)(e,"execute",i,t,n).then((e=>{const t=e.data.results||[],i=e.data.messages||[];return{results:t.map(s.Jx),messages:i.map((e=>r.Z.fromJSON(e)))}}))}},16012:(e,t,i)=>{i.d(t,{By:()=>h,Jx:()=>m,ms:()=>y});var a=i(76200),s=(i(93169),i(91340)),r=i(83040),n=i(99180),o=i(23084),l=i(75413),u=i(49818),c=i(77408),p=i(4192),d=i(49186);async function h(e,t,i,r,n){const l={},c={},p=[];return function(e,t,i){for(const a in e){const s=e[a];if(s&&"object"==typeof s&&s instanceof u.default){const{features:e}=s;i[a]=[t.length,t.length+e.length],e.forEach((e=>{t.push(e.geometry)}))}}}(r,p,l),(0,s.aX)(p).then((s=>{const{outSpatialReference:u,processExtent:p,processSpatialReference:d,returnFeatureCollection:h,returnM:m,returnZ:f}=i,{path:b}=(0,o.en)(e);for(const e in l){const t=l[e];c[e]=s.slice(t[0],t[1])}const g=u?u.wkid||u:null,v=d?d.wkid||d:null,_="execute"===t?{returnFeatureCollection:h||void 0,returnM:m||void 0,returnZ:f||void 0}:null,w=y({...p?{context:{extent:p,outSR:g,processSR:v}}:{"env:outSR":g,"env:processSR":v},...r,..._,f:"json"},null,c),S={...n,query:w};return(0,a.default)(`${b}/${t}`,S)}))}function m(e){const t=e.dataType,i=p.Z.fromJSON(e);switch(t){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return i;case"GPDate":i.value=new Date(i.value);break;case"GPDataFile":i.value=l.Z.fromJSON(i.value);break;case"GPLinearUnit":i.value=c.Z.fromJSON(i.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":{const t=e.value.url;i.value=t?l.Z.fromJSON(i.value):u.default.fromJSON(i.value);break}case"GPRasterData":case"GPRasterDataLayer":{const t=e.value.mapImage;i.value=t?n.Z.fromJSON(t):d.Z.fromJSON(i.value);break}case"GPField":i.value=r.Z.fromJSON(i.value);break;case"GPMultiValue:GPDate":{const e=i.value;i.value=e.map((e=>new Date(e)));break}case"GPMultiValue:GPDataFile":i.value=i.value.map((e=>l.Z.fromJSON(e)));break;case"GPMultiValue:GPLinearUnit":i.value=i.value.map((e=>c.Z.fromJSON(e)));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":i.value=i.value.map((e=>u.default.fromJSON(e)));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":i.value=i.value.map((e=>e?n.Z.fromJSON(e):d.Z.fromJSON(i.value)));break;case"GPMultiValue:GPField":i.value=i.value.map((e=>r.Z.fromJSON(e)))}return i}function y(e,t,i){for(const a in e){const t=e[a];Array.isArray(t)?e[a]=JSON.stringify(t.map((e=>y({item:e},!0).item))):t instanceof Date&&(e[a]=t.getTime())}return(0,o.cv)(e,t,i)}},97913:(e,t,i)=>{i.d(t,{ht:()=>k});var a=i(19545),s=i(76200),r=i(10064),n=i(43404),o=i(92026),l=i(17842),u=i(35995),c=i(80885),p=i(37270),d=i(87072),h=i(56011),m=i(23084),y=i(85216),f=i(77262),b=i(16012),g=i(52636);var v=i(96971),_=i(60849);const w="simple-marker",S="simple-line";function x(e,t){const{graphic:i,renderer:a,symbol:s}=t,r=s.type;if("text"===r||"shield-label-symbol"===r||!("visualVariables"in a)||!a.visualVariables)return;const n=a.getVisualVariablesForType("size"),o=a.getVisualVariablesForType("color"),u=a.getVisualVariablesForType("opacity"),c=a.getVisualVariablesForType("rotation"),p=n[0],d=o[0],m=u[0],y=c[0];if(p){const t=r===w?s.style:null,a=(0,h.getSize)(p,i,{shape:t});null!=a&&(r===w?e.size=(0,l.Wz)(a):"picture-marker"===r?(e.width=(0,l.Wz)(a),e.height=(0,l.Wz)(a)):r===S?e.width=(0,l.Wz)(a):e.outline&&(e.outline.width=(0,l.Wz)(a)))}if(d){const t=(0,h.getColor)(d,i);(t&&r===w||r===S||"simple-fill"===r)&&(e.color=t?t.toJSON():void 0)}if(m){const t=(0,h.getOpacity)(m,i);null!=t&&e.color&&(e.color[3]=Math.round(255*t))}y&&(e.angle=-(0,h.getRotationAngle)(a,i))}function T(e){return"bing-maps"===e?.type}function C(e){return e&&"blendMode"in e&&"effect"in e}function O(e){return"csv"===e?.type}function P(e){return"esri.views.2d.layers.GroupLayerView2D"===e?.declaredClass}function I(e){const t=e.layer;if(C(t)){const i=t.blendMode;if((!i||"normal"===i)&&(t.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}var L=i(79422);const M={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},D=new n.X({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),E=new n.X({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),V=new Map;async function k(e,t,i){const n=F(e);let l=V.get(n);return Promise.resolve().then((()=>l?{data:l.gpMetadata}:(l={gpServerUrl:n,is11xService:!1,legendLayerNameMap:{},legendLayers:[]},(0,s.default)(n,{query:{f:"json"}})))).then((e=>(l.gpMetadata=e.data,l.cimVersion=l.gpMetadata.cimVersion,l.is11xService=!!l.cimVersion,V.set(n,l),async function(e,t){t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const i=e.template||new L.Z;null==i.showLabels&&(i.showLabels=!0);const s=i.exportOptions;let n;const l=(0,_.a)(i.layout);if(s&&(n={dpi:s.dpi},"map_only"===l.toLowerCase()||""===l)){const e=s.width,t=s.height;n.outputSize=[e,t]}const u=i.layoutOptions;let c;if(u){let e,t;"Miles"===u.scalebarUnit||"Kilometers"===u.scalebarUnit?(e="Kilometers",t="Miles"):"Meters"!==u.scalebarUnit&&"Feet"!==u.scalebarUnit||(e="Meters",t="Feet"),c={titleText:u.titleText,authorText:u.authorText,copyrightText:u.copyrightText,customTextElements:u.customTextElements,elementOverrides:u.elementOverrides,scaleBarOptions:{metricUnit:D.toJSON(e),metricLabel:M[e],nonMetricUnit:D.toJSON(t),nonMetricLabel:M[t]}}}let p=null;u?.legendLayers&&(p=u.legendLayers.map((e=>{t.legendLayerNameMap[e.layerId]=e.title;const i={id:e.layerId};return e.subLayerIds&&(i.subLayerIds=e.subLayerIds),i})));const d=await async function(e,t,i){const a=e.view;let s=a.spatialReference;const r={operationalLayers:await N(a,t,i)};let n=i.ssExtent||e.extent||a.extent;if(s&&s.isWrappable&&(n=n.clone()._normalize(!0),s=n.spatialReference),r.mapOptions={extent:n&&n.toJSON(),spatialReference:s&&s.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,a.background&&(r.background=a.background.toJSON()),a.rotation&&(r.mapOptions.rotation=-a.rotation),t.scalePreserved&&(r.mapOptions.scale=t.outScale||a.scale),(0,o.pC)(a.timeExtent)){const e=(0,o.pC)(a.timeExtent.start)?a.timeExtent.start.getTime():null,t=(0,o.pC)(a.timeExtent.end)?a.timeExtent.end.getTime():null;r.mapOptions.time=[e,t]}return r}(e,i,t);if(d.operationalLayers){const e=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),i=/[\u0600-\u06FF]/,a=t=>{const a=t.text,s=t.font,r=s&&s.family&&s.family.toLowerCase();a&&s&&("arial"===r||"arial unicode ms"===r)&&(s.family=e.test(a)?"Arial Unicode MS":"Arial","normal"!==s.style&&i.test(a)&&(s.family="Arial Unicode MS"))},s=()=>{throw new r.Z("print:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")};d.operationalLayers.forEach((e=>{e.featureCollection?.layers?e.featureCollection.layers.forEach((e=>{if(e.layerDefinition?.drawingInfo?.renderer?.symbol){const i=e.layerDefinition.drawingInfo.renderer;"esriTS"===i.symbol.type?a(i.symbol):"CIMSymbolReference"!==i.symbol.type||t.is11xService||s()}e.featureSet?.features&&e.featureSet.features.forEach((e=>{e.symbol&&("esriTS"===e.symbol.type?a(e.symbol):"CIMSymbolReference"!==e.symbol.type||t.is11xService||s())}))})):!t.is11xService&&e.layerDefinition?.drawingInfo?.renderer&&JSON.stringify(e.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&s()}))}e.outSpatialReference&&(d.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(d,{exportOptions:n,layoutOptions:c||{}}),Object.assign(d.layoutOptions,{legendOptions:{operationalLayers:null!=p?p:t.legendLayers.slice()}}),t.legendLayers.length=0,V.set(t.gpServerUrl,t);const h={Web_Map_as_JSON:JSON.stringify(d),Format:(0,v.a)(i.format),Layout_Template:l,Layout_Item_ID:void 0};if(i.layoutItem){delete h.Layout_Template;const e=i.layoutItem;await e.load(),"public"!==e.access&&a.id&&await a.id.getCredential(t.gpServerUrl),h.Layout_Item_ID=JSON.stringify({id:e.id})}return e.extraParameters&&Object.assign(h,e.extraParameters),h}(t,l)))).then((a=>{const s=re(l);let r;const n=e=>"sync"===s?e.results&&e.results[0]&&e.results[0].value:r.fetchResultData("Output_File",null,i).then((e=>e.value));return"async"===s?async function(e,t,i,a){return i=f.Z.from(i||{}),(0,b.By)(e,"submitJob",i,t,a).then((t=>{const i=g.Z.fromJSON(t.data);return i.sourceUrl=e,i}))}(e,a,null,i).then((e=>(r=e,e.waitForJobCompletion({interval:t.updateDelay}).then(n)))):(0,y.h)(e,a,null,i).then(n)}))}function F(e){let t=e;const i=t.lastIndexOf("/GPServer/");return i>0&&(t=t.slice(0,i+9)),t}async function N(e,t,i){const a=[],s={layerView:null,printTemplate:t,view:e};let r=0;t.scalePreserved&&(r=t.outScale||e.scale);const n=function(e,t){const i=e.allLayerViews.items;if(t===e.scale)return i.filter((e=>!e.suspended));const a=new Array;for(const s of i)P(s.parent)&&!a.includes(s.parent)||!s.visible||t&&"isVisibleAtScale"in s&&!s.isVisibleAtScale(t)||a.push(s);return a}(e,r);for(const o of n){const e=o.layer;if(!e.loaded||"group"===e?.type)continue;let t;s.layerView=o,t=I(o)?await B(e,s,i):T(e)?G(e):O(e)?await j(e,s,i):"feature"===e?.type?await A(e,s,i):"geojson"===e?.type?await J(e,s,i):"graphics"===e?.type?await U(e,s,i):"imagery"===e?.type?Z(e,i):"imagery-tile"===e?.type?await $(e,s,i):"kml"===e?.type?await q(e,s,i):"map-image"===e?.type?z(e,s,i):"map-notes"===e?.type?await W(s,i):"open-street-map"===e?.type?{type:"OpenStreetMap"}:"stream"===e?.type?await K(e,s,i):"tile"===e?.type?X(e,i):"vector-tile"===e?.type?await H(e,s,i):"web-tile"===e?.type?Y(e):"wms"===e?.type?Q(e):"wmts"===e?.type?ee(e):await B(e,s,i),t&&(Array.isArray(t)?a.push(...t):(t.id=e.id,t.title=i.legendLayerNameMap[e.id]||e.title,t.opacity=e.opacity,t.minScale=e.minScale||0,t.maxScale=e.maxScale||0,C(e)&&e.blendMode&&"normal"!==e.blendMode&&(t.blendMode=e.blendMode),a.push(t)))}if(r&&a.forEach((e=>{e.minScale=0,e.maxScale=0})),e.graphics&&e.graphics.length){const s=await R(null,e.graphics,t,i);s&&a.push(s)}return a}function G(e){return{culture:e.culture,key:e.key,type:"BingMaps"+("aerial"===e.style?"Aerial":"hybrid"===e.style?"Hybrid":"Road")}}async function j(e,t,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const a=t.layerView,s=t.printTemplate;let r;return!i.is11xService||a.filter?R(e,await se(a),s,i):(r={type:"CSV"},e.write(r,{origin:"web-map"}),delete r.popupInfo,delete r.layerType,r.showLabels=s.showLabels&&e.labelsVisible,r)}async function R(e,t,i,a){let s;const r={layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}},n={layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}},o={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}},l={layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}},u={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}};if(u.layerDefinition.name="textLayer",delete u.layerDefinition.drawingInfo,e){if("esri.layers.FeatureLayer"===e.declaredClass||"esri.layers.StreamLayer"===e.declaredClass?r.layerDefinition.name=n.layerDefinition.name=o.layerDefinition.name=l.layerDefinition.name=a.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:"esri.layers.GraphicsLayer"===e.declaredClass&&(t=e.graphics.items),e.renderer){const t=e.renderer.toJSON();r.layerDefinition.drawingInfo.renderer=t,n.layerDefinition.drawingInfo.renderer=t,o.layerDefinition.drawingInfo.renderer=t,l.layerDefinition.drawingInfo.renderer=t}if(i.showLabels&&e.labelsVisible&&"function"==typeof e.write){const t=e.write({},{origin:"web-map"}).layerDefinition?.drawingInfo?.labelingInfo;t&&(s=!0,r.layerDefinition.drawingInfo.labelingInfo=t,n.layerDefinition.drawingInfo.labelingInfo=t,o.layerDefinition.drawingInfo.labelingInfo=t,l.layerDefinition.drawingInfo.labelingInfo=t)}}let d;e?.renderer||s||(delete r.layerDefinition.drawingInfo,delete n.layerDefinition.drawingInfo,delete o.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo);const h=e?.fieldsIndex,m=e?.renderer;if(h){const t=new Set;s&&await(0,p.Mu)(t,e),m&&"function"==typeof m.collectRequiredFields&&await m.collectRequiredFields(t,h),d=Array.from(t);const i=h.fields.map((e=>e.toJSON()));r.layerDefinition.fields=i,n.layerDefinition.fields=i,o.layerDefinition.fields=i,l.layerDefinition.fields=i}const y=t&&t.length;let f;for(let p=0;p<y;p++){const s=t[p]||t.getItemAt(p);if(!1===s.visible||!s.geometry)continue;if(f=s.toJSON(),f.hasOwnProperty("popupTemplate")&&delete f.popupTemplate,f.geometry&&f.geometry.z&&delete f.geometry.z,f.symbol&&f.symbol.outline&&"esriCLS"===f.symbol.outline.type&&!a.is11xService)continue;!a.is11xService&&f.symbol&&f.symbol.outline&&f.symbol.outline.color&&f.symbol.outline.color[3]&&(f.symbol.outline.color[3]=255);const h=e&&e.renderer&&("valueExpression"in e.renderer&&e.renderer.valueExpression||"hasVisualVariables"in e.renderer&&e.renderer.hasVisualVariables());if(!f.symbol&&e&&e.renderer&&h&&!a.is11xService){const t=e.renderer,i=await t.getSymbolAsync(s);if(!i)continue;f.symbol=i.toJSON(),"hasVisualVariables"in t&&t.hasVisualVariables()&&x(f.symbol,{renderer:t,graphic:s,symbol:i})}if(f.symbol&&(f.symbol.angle||delete f.symbol.angle,ne(f.symbol)?f.symbol=await ie(f.symbol,a):f.symbol.text&&delete f.attributes),(!i||!i.forceFeatureAttributes)&&d?.length){const e={};d.forEach((t=>{f.attributes&&f.attributes.hasOwnProperty(t)&&(e[t]=f.attributes[t])})),f.attributes=e}"polygon"===s.geometry.type?r.featureSet.features.push(f):"polyline"===s.geometry.type?n.featureSet.features.push(f):"point"===s.geometry.type?f.symbol&&f.symbol.text?u.featureSet.features.push(f):o.featureSet.features.push(f):"multipoint"===s.geometry.type?l.featureSet.features.push(f):"extent"===s.geometry.type&&(f.geometry=c.Z.fromExtent(s.geometry).toJSON(),r.featureSet.features.push(f))}const b=[r,n,l,o,u].filter((e=>e.featureSet.features.length>0));for(const c of b){const e=c.featureSet.features.every((e=>e.symbol));!e||i&&i.forceFeatureAttributes||c.featureSet.features.forEach((e=>{delete e.attributes})),e&&delete c.layerDefinition.drawingInfo,c.layerDefinition.drawingInfo&&c.layerDefinition.drawingInfo.renderer&&await ae(c.layerDefinition.drawingInfo.renderer,a)}return b.length?{featureCollection:{layers:b},showLabels:s}:null}async function A(e,t,i){let a;const s=e.renderer,r=parseFloat(i.cimVersion);if("binning"===e.featureReduction?.type||"cluster"===e.featureReduction?.type&&(!i.is11xService||r<2.9)||"pie-chart"===s?.type||"dot-density"===s?.type&&(!i.is11xService||r<2.6))return B(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const n=t.layerView,{printTemplate:o,view:l}=t,u=s&&("valueExpression"in s&&s.valueExpression||"hasVisualVariables"in s&&s.hasVisualVariables()),c="feature-layer"!==e.source?.type&&"ogc-feature"!==e.source?.type;if(!i.is11xService&&u||n.filter||c||!s||"field"in s&&null!=s.field&&("string"!=typeof s.field||!e.getField(s.field))){const t=await se(n);a=await R(e,t,o,i)}else{if(a={id:(p=e.write()).id,title:p.title,opacity:p.opacity,minScale:p.minScale,maxScale:p.maxScale,url:p.url,layerType:p.layerType,customParameters:p.customParameters,layerDefinition:p.layerDefinition},a.showLabels=o.showLabels&&e.labelsVisible,te(a,e),a.layerDefinition?.drawingInfo?.renderer&&(delete a.layerDefinition.minScale,delete a.layerDefinition.maxScale,await ae(a.layerDefinition.drawingInfo.renderer,i),"visualVariables"in s&&s.visualVariables&&s.visualVariables[0])){const e=s.visualVariables[0];if("size"===e.type&&e.maxSize&&"number"!=typeof e.maxSize&&e.minSize&&"number"!=typeof e.minSize){const t=(0,h.getSizeRangeAtScale)(e,l.scale);a.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=t.minSize,a.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=t.maxSize}}const t=(0,d.c)(n);t&&(a.layerDefinition||(a.layerDefinition={}),a.layerDefinition.definitionExpression=a.layerDefinition.definitionExpression?`(${a.layerDefinition.definitionExpression}) AND (${t})`:t)}var p;return a}async function J(e,t,i){return"binning"===e.featureReduction?.type||"cluster"===e.featureReduction?.type?B(e,t,i):(e.legendEnabled&&i.legendLayers.push({id:e.id}),R(e,await se(t.layerView),t.printTemplate,i))}async function U(e,t,i){let{printTemplate:a}=t;return R(e,null,a,i)}function Z(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=e.write()).layerType,customParameters:a.customParameters};var a;if(i.bandIds=e.bandIds,i.compressionQuality=e.compressionQuality,i.format=e.format,i.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(t.is11xService)e.renderingRule&&(i.renderingRule=e.renderingRule.toJSON()),e.renderer&&(i.layerDefinition=i.layerDefinition||{},i.layerDefinition.drawingInfo=i.layerDefinition.drawingInfo||{},i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const t=e.exportImageServiceParameters.combineRendererWithRenderingRule();t&&(i.renderingRule=t.toJSON())}return te(i,e),i}async function $(e,t,i){if("flow"===e.renderer?.type)return B(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const a={bandIds:(s=e.write()||{}).bandIds,customParameters:s.customParameters,interpolation:s.interpolation,layerDefinition:s.layerDefinition};var s;return a.layerType="ArcGISImageServiceLayer",te(a,e),a}async function q(e,t,i){const a=t.printTemplate;if(i.is11xService){const t={type:"kml"};return e.write(t,{origin:"web-map"}),delete t.layerType,t.url=(0,u.Fv)(e.url),t}{const s=[],r=t.layerView;r.allVisibleMapImages.forEach(((t,i)=>{const a={id:`${e.id}_image${i}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity,extent:t.extent};"data:image/png;base64,"===t.href.substr(0,22)?a.imageData=t.href.substr(22):a.url=t.href,s.push(a)}));const n=[...r.allVisiblePoints.items,...r.allVisiblePolylines.items,...r.allVisiblePolygons.items],o={id:e.id,...await R(null,n,a,i)};return s.push(o),s}}function z(e,t,i){let a,{view:s}=t;const r={id:e.id,subLayerIds:[]};let n=[];const o=s.scale,l=e=>{const t=0===o,i=0===e.minScale||o<=e.minScale,a=0===e.maxScale||o>=e.maxScale;if(e.visible&&(t||i&&a))if(e.sublayers)e.sublayers.forEach(l);else{const t=e.toExportImageJSON(),i={id:e.id,name:e.title,layerDefinition:{drawingInfo:t.drawingInfo,definitionExpression:t.definitionExpression,source:t.source}};n.unshift(i),r.subLayerIds.push(e.id)}};var u;return e.sublayers&&e.sublayers.forEach(l),n.length&&(n=n.map((e=>{let{id:t,name:i,layerDefinition:a}=e;return{id:t,name:i,layerDefinition:a}})),a={layerType:(u=e.write()).layerType,customParameters:u.customParameters},a.layers=n,a.visibleLayers=e.capabilities.exportMap.supportsDynamicLayers?void 0:r.subLayerIds,te(a,e),e.legendEnabled&&i.legendLayers.push(r)),a}async function W(e,t){let{layerView:i,printTemplate:a}=e;const s=[],r=i.layer;if((0,o.pC)(r.featureCollections))for(const n of r.featureCollections){const e=await R(n,n.source,a,t);e&&s.push(...e.featureCollection.layers)}else if((0,o.pC)(r.sublayers))for(const n of r.sublayers){const e=await R(null,n.graphics,a,t);e&&s.push(...e.featureCollection.layers)}return{featureCollection:{layers:s}}}async function B(e,t,i){let{printTemplate:a,view:s}=t;const r={type:"image"},n={format:"png",ignoreBackground:!0,layers:[e],rotation:0},o=i.ssExtent||s.extent.clone();let c=96,p=!0,d=!0;if(a.exportOptions){const e=a.exportOptions;e.dpi>0&&(c=e.dpi),e.width>0&&(p=e.width%2==s.width%2),e.height>0&&(d=e.height%2==s.height%2)}if("map-only"===a.layout&&a.scalePreserved&&(!a.outScale||a.outScale===s.scale)&&96===c&&(!p||!d)&&(n.area={x:0,y:0,width:s.width,height:s.height},p||(n.area.width-=1),d||(n.area.height-=1),!i.ssExtent)){const e=s.toMap((0,l.vW)(n.area.width,n.area.height));o.ymin=e.y,o.xmax=e.x,i.ssExtent=o}r.extent=o.clone()._normalize(!0).toJSON();const h=await s.takeScreenshot(n),{data:m}=(0,u.sJ)(h.dataUrl);return r.imageData=m,r}async function K(e,t,i){let{layerView:a,printTemplate:s}=t;return e.legendEnabled&&i.legendLayers.push({id:e.id}),R(e,await se(a),s,i)}function X(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=e.write()).layerType,customParameters:a.customParameters};var a;return te(i,e),i}async function H(e,t,i){if(i.is11xService&&e.serviceUrl&&e.styleUrl){const t=(0,m.LP)(e.styleUrl,e.apiKey),a=(0,m.LP)(e.serviceUrl,e.apiKey);if(!t&&!a||"2.1.0"!==i.cimVersion){const i={type:"VectorTileLayer"};return i.styleUrl=(0,u.Fv)(e.styleUrl),i.token=t,a!==t&&(i.additionalTokens=[{url:e.serviceUrl,token:a}]),i}}return B(e,t,i)}function Y(e){const t={type:"WebTiledLayer",urlTemplate:e.urlTemplate.replace(/\${/g,"{"),credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}function Q(e){let t;const i=[],a=e=>{e.visible&&(e.sublayers?e.sublayers.forEach(a):e.name&&i.unshift(e.name))};return e.sublayers&&e.sublayers.forEach(a),i.length&&(t={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:i,url:(0,u.Fv)(e.url),version:e.version}),t}function ee(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:(0,u.Fv)(e.url)}}function te(e,t){t.url&&(e.url=(0,u.Fv)(e.url||t.url),e.token=(0,m.LP)(e.url,t.apiKey))}async function ie(e,t){t.canvas||(t.canvas=document.createElement("canvas"));const i=1024;t.canvas.width=i,t.canvas.height=i;const a=t.canvas.getContext("2d");let r,n;if(e.path){const t=new Path2D(e.path);t.closePath(),a.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",a.fill(t);const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;const i=e.canvas.width,a=e.canvas.height,s=e.getImageData(0,0,i,a).data;let r,n,o,l,u,c;e:for(n=a;n--;)for(r=i;r--;)if(s[4*(i*n+r)+3]>t){c=n;break e}if(!c)return null;e:for(r=i;r--;)for(n=c+1;n--;)if(s[4*(i*n+r)+3]>t){u=r;break e}e:for(r=0;r<=u;++r)for(n=c+1;n--;)if(s[4*(i*n+r)+3]>t){o=r;break e}e:for(n=0;n<=c;++n)for(r=o;r<=u;++r)if(s[4*(i*n+r)+3]>t){l=n;break e}return{x:o,y:l,width:u-o,height:c-l}}(a);if(!s)return null;a.clearRect(0,0,i,i);const o=(0,l.F2)(e.size)/Math.max(s.width,s.height);a.scale(o,o);const u=i/o,c=u/2-s.width/2-s.x,p=u/2-s.height/2-s.y;if(a.translate(c,p),Array.isArray(e.color)&&a.fill(t),e.outline?.width&&Array.isArray(e.outline.color)){const i=e.outline;a.lineWidth=(0,l.F2)(i.width)/o,a.lineJoin="round",a.strokeStyle=`rgba(${i.color[0]},${i.color[1]},${i.color[2]},${i.color[3]/255})`,a.stroke(t),s.width+=a.lineWidth,s.height+=a.lineWidth}s.width*=o,s.height*=o;const d=a.getImageData(512-s.width/2,512-s.height/2,Math.ceil(s.width),Math.ceil(s.height));r=d.width,n=d.height,a.canvas.width=r,a.canvas.height=n,a.putImageData(d,0,0)}else{const t="image/svg+xml"===e.contentType?"data:image/svg+xml;base64,"+e.imageData:e.url,i=(await(0,s.default)(t,{responseType:"image"})).data;r=(0,l.F2)(e.width),n=(0,l.F2)(e.height),a.canvas.width=r,a.canvas.height=n,a.drawImage(i,0,0,a.canvas.width,a.canvas.height)}return{type:"esriPMS",imageData:a.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:(0,l.Wz)(n),width:(0,l.Wz)(r),xoffset:e.xoffset,yoffset:e.yoffset}}async function ae(e,t){const i=e.type;if("simple"===i&&ne(e.symbol))e.symbol=await ie(e.symbol,t);else if("uniqueValue"===i||"classBreaks"===i){ne(e.defaultSymbol)&&(e.defaultSymbol=await ie(e.defaultSymbol,t));const a=e["uniqueValue"===i?"uniqueValueInfos":"classBreakInfos"];if(a)for(const e of a)ne(e.symbol)&&(e.symbol=await ie(e.symbol,t))}}async function se(e){return e.queryFeatures(e.createQuery()).then((e=>e.features))}function re(e){return e.gpMetadata&&e.gpMetadata.executionType?E.fromJSON(e.gpMetadata.executionType):"sync"}function ne(e){return e&&(e.path||"image/svg+xml"===e.contentType||e.url&&e.url.endsWith(".svg"))}},75413:(e,t,i)=>{i.d(t,{Z:()=>l});var a=i(27366),s=i(46784),r=i(49861),n=(i(63780),i(25243),i(69912));let o=class extends s.wq{constructor(e){super(e),this.itemId=null,this.url=null}};(0,a._)([(0,r.Cb)({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],o.prototype,"itemId",void 0),(0,a._)([(0,r.Cb)({type:String,json:{write:!0}})],o.prototype,"url",void 0),o=(0,a._)([(0,n.j)("esri.rest.support.DataFile")],o);const l=o},2429:(e,t,i)=>{i.d(t,{Z:()=>c});var a=i(27366),s=i(43404),r=i(46784),n=i(49861),o=(i(63780),i(25243),i(69912));const l=new s.X({esriJobMessageTypeInformative:"informative",esriJobMessageTypeProcessDefinition:"process-definition",esriJobMessageTypeProcessStart:"process-start",esriJobMessageTypeProcessStop:"process-stop",esriJobMessageTypeWarning:"warning",esriJobMessageTypeError:"error",esriJobMessageTypeEmpty:"empty",esriJobMessageTypeAbort:"abort"});let u=class extends r.wq{constructor(e){super(e),this.description=null,this.type=null}};(0,a._)([(0,n.Cb)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,a._)([(0,n.Cb)({type:String,json:{read:l.read,write:l.write}})],u.prototype,"type",void 0),u=(0,a._)([(0,o.j)("esri.rest.support.GPMessage")],u);const c=u},52636:(e,t,i)=>{i.d(t,{Z:()=>b});var a,s=i(27366),r=i(76200),n=(i(93169),i(43404)),o=i(46784),l=i(66978),u=i(49861),c=(i(63780),i(25243),i(69912)),p=i(23084),d=i(77262),h=i(16012),m=i(2429);const y=new n.X({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"});let f=a=class extends o.wq{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.requestOptions=null,this.sourceUrl=null,this._timer=null}cancelJob(e){const{jobId:t,sourceUrl:i}=this,{path:s}=(0,p.en)(i),n={...this.requestOptions,...e,query:{f:"json"}};return this._clearTimer(),(0,r.default)(`${s}/jobs/${t}/cancel`,n).then((e=>{const t=a.fromJSON(e.data);return this.messages=t.messages,this.jobStatus=t.jobStatus,this}))}destroy(){clearInterval(this._timer)}checkJobStatus(e){const{path:t}=(0,p.en)(this.sourceUrl),i={...this.requestOptions,...e,query:{f:"json"}},s=`${t}/jobs/${this.jobId}`;return(0,r.default)(s,i).then((e=>{let{data:t}=e;const i=a.fromJSON(t);return this.messages=i.messages,this.jobStatus=i.jobStatus,this}))}fetchResultData(e,t,i){t=d.Z.from(t||{});const{returnFeatureCollection:a,returnM:s,returnZ:n,outSpatialReference:o}=t,{path:l}=(0,p.en)(this.sourceUrl),u=(0,h.ms)({returnFeatureCollection:a,returnM:s,returnZ:n,outSR:o,returnType:"data",f:"json"},null),c={...this.requestOptions,...i,query:u},m=`${l}/jobs/${this.jobId}/results/${e}`;return(0,r.default)(m,c).then((e=>(0,h.Jx)(e.data)))}fetchResultImage(e,t,i){const{path:a}=(0,p.en)(this.sourceUrl),s={...t.toJSON(),f:"json"},n=(0,h.ms)(s),o={...this.requestOptions,...i,query:n},l=`${a}/jobs/${this.jobId}/results/${e}`;return(0,r.default)(l,o).then((e=>(0,h.Jx)(e.data)))}async fetchResultMapImageLayer(){const{path:e}=(0,p.en)(this.sourceUrl),t=e.indexOf("/GPServer/"),a=`${e.substring(0,t)}/MapServer/jobs/${this.jobId}`;return new(0,(await Promise.all([i.e(9668),i.e(9583)]).then(i.bind(i,19583))).default)({url:a})}async waitForJobCompletion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{interval:t=1e3,signal:i,statusCallback:a}=e;return new Promise(((e,s)=>{(0,l.fu)(i,(()=>{this._clearTimer(),s((0,l.zE)())})),this._clearTimer();const r=setInterval((()=>{this._timer||s((0,l.zE)()),this.checkJobStatus(this.requestOptions).then((t=>{const{jobStatus:i}=t;switch(this.jobStatus=i,i){case"job-succeeded":this._clearTimer(),e(this);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":a&&a(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(),s(this)}}))}),t);this._timer=r}))}_clearTimer(){this._timer&&(clearInterval(this._timer),this._timer=null)}};(0,s._)([(0,u.Cb)()],f.prototype,"jobId",void 0),(0,s._)([(0,u.Cb)({json:{read:y.read}})],f.prototype,"jobStatus",void 0),(0,s._)([(0,u.Cb)({type:[m.Z]})],f.prototype,"messages",void 0),(0,s._)([(0,u.Cb)()],f.prototype,"requestOptions",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],f.prototype,"sourceUrl",void 0),f=a=(0,s._)([(0,c.j)("esri.rest.support.JobInfo")],f);const b=f},77408:(e,t,i)=>{i.d(t,{Z:()=>c});var a=i(27366),s=i(43404),r=i(46784),n=i(49861),o=(i(63780),i(25243),i(69912));const l=new s.X({esriMeters:"meters",esriFeet:"feet",esriKilometers:"kilometers",esriMiles:"miles",esriNauticalMiles:"nautical-miles",esriYards:"yards"},{ignoreUnknown:!1});let u=class extends r.wq{constructor(e){super(e),this.distance=0,this.units=null}};(0,a._)([(0,n.Cb)({json:{write:!0}})],u.prototype,"distance",void 0),(0,a._)([(0,n.Cb)({json:{read:l.read,write:l.write}})],u.prototype,"units",void 0),u=(0,a._)([(0,o.j)("esri.rest.support.LinearUnit")],u);const c=u},4192:(e,t,i)=>{i.d(t,{Z:()=>c});var a=i(27366),s=i(43404),r=i(46784),n=i(49861),o=(i(63780),i(25243),i(69912));const l=new s.X({GPBoolean:"boolean",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",GPField:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string","GPMultiValue:GPBoolean":"multi-value","GPMultiValue:GPDataFile":"multi-value","GPMultiValue:GPDate":"multi-value","GPMultiValue:GPDouble":"multi-value","GPMultiValue:GPFeatureRecordSetLayer":"multi-value","GPMultiValue:GPField":"multi-value","GPMultiValue:GPLinearUnit":"multi-value","GPMultiValue:GPLong":"multi-value","GPMultiValue:GPRasterData":"multi-value","GPMultiValue:GPRasterDataLayer":"multi-value","GPMultiValue:GPRecordSet":"multi-value","GPMultiValue:GPString":"multi-value"});let u=class extends r.wq{constructor(e){super(e),this.dataType=null,this.value=null}};(0,a._)([(0,n.Cb)({json:{read:l.read,write:l.write}})],u.prototype,"dataType",void 0),(0,a._)([(0,n.Cb)()],u.prototype,"value",void 0),u=(0,a._)([(0,o.j)("esri.rest.support.ParameterValue")],u);const c=u},6764:(e,t,i)=>{i.d(t,{Z:()=>l});var a=i(27366),s=i(85015),r=i(49861),n=(i(63780),i(25243),i(69912));let o=class extends s.Z{constructor(e){super(e),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};(0,a._)([(0,r.Cb)()],o.prototype,"extent",void 0),(0,a._)([(0,r.Cb)()],o.prototype,"extraParameters",void 0),(0,a._)([(0,r.Cb)()],o.prototype,"outSpatialReference",void 0),(0,a._)([(0,r.Cb)()],o.prototype,"template",void 0),(0,a._)([(0,r.Cb)()],o.prototype,"updateDelay",void 0),(0,a._)([(0,r.Cb)()],o.prototype,"view",void 0),o=(0,a._)([(0,n.j)("esri.rest.support.PrintParameters")],o);const l=o},79422:(e,t,i)=>{i.d(t,{Z:()=>u});var a=i(27366),s=i(85015),r=i(49861),n=(i(63780),i(25243),i(69912)),o=i(98995);let l=class extends s.Z{constructor(e){super(e),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.scalePreserved=!0,this.showLabels=!0}};(0,a._)([(0,r.Cb)()],l.prototype,"attributionVisible",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"exportOptions",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"forceFeatureAttributes",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"format",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"label",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"layout",void 0),(0,a._)([(0,r.Cb)({type:o.default})],l.prototype,"layoutItem",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"layoutOptions",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"outScale",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"scalePreserved",void 0),(0,a._)([(0,r.Cb)()],l.prototype,"showLabels",void 0),l=(0,a._)([(0,n.j)("esri.rest.support.PrintTemplate")],l);const u=l},49186:(e,t,i)=>{i.d(t,{Z:()=>l});var a=i(27366),s=i(46784),r=i(49861),n=(i(63780),i(25243),i(69912));let o=class extends s.wq{constructor(e){super(e),this.format=null,this.itemId=null,this.url=null}};(0,a._)([(0,r.Cb)()],o.prototype,"format",void 0),(0,a._)([(0,r.Cb)({json:{read:{source:"itemID"},write:{target:"itemID"}}})],o.prototype,"itemId",void 0),(0,a._)([(0,r.Cb)()],o.prototype,"url",void 0),o=(0,a._)([(0,n.j)("esri.rest.support.RasterData")],o);const l=o},96971:(e,t,i)=>{i.d(t,{a:()=>r,i:()=>s});const a=new(i(43404).X)({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"}),s=a.fromJSON.bind(a),r=a.toJSON.bind(a)},60849:(e,t,i)=>{i.d(t,{a:()=>r,i:()=>s});const a=new(i(43404).X)({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),s=a.fromJSON.bind(a),r=a.toJSON.bind(a)},97064:(e,t,i)=>{i.d(t,{Z:()=>pt});var a=i(27366),s=i(40281),r=i(98928),n=i(84652),o=i(32718),l=i(94172),u=i(35995),c=i(49861),p=(i(25243),i(69912)),d=i(23084),h=i(69407),m=i(85015),y=i(100);i(63780);let f=class extends m.Z{constructor(e){super(e),this._handles=new y.Z,this.state="pending",this.url=""}initialize(){this._handles.add([(0,l.YP)((()=>[this.extension,this.name]),(()=>this._setFormattedFileName()),l.nn)])}destroy(){this._handles.destroy()}_setFormattedFileName(){if(!this.name||!this.extension)return;let e=this.name+"."+this.extension;this.count&&(e=this.name+"("+this.count+")."+this.extension),this.formattedName=e}};(0,a._)([(0,c.Cb)()],f.prototype,"count",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"error",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"extension",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"formattedName",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"name",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"state",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"url",void 0),f=(0,a._)([(0,p.j)("esri.widgets.print.FileLink")],f);const b=f;var g=i(76200),v=i(10064),_=i(54472),w=i(92026),S=i(76969),x=i(36257),T=i(70032),C=i(85216),O=(i(77262),i(93169),i(91340),i(83040),i(99180),i(42265),i(19545),i(75413),i(49818),i(77408),i(4192),i(49186),i(52636),i(97913)),P=i(96971),I=i(60849),L=i(6764),M=i(79422),D=i(46784);let E=class extends D.wq{constructor(e){super(e),this.description=null,this.format=null,this.label=null,this.layout=null,this.layoutOptions=null}};(0,a._)([(0,c.Cb)()],E.prototype,"description",void 0),(0,a._)([(0,c.Cb)({json:{read:P.i}})],E.prototype,"format",void 0),(0,a._)([(0,c.Cb)()],E.prototype,"label",void 0),(0,a._)([(0,c.Cb)({json:{read:I.i}})],E.prototype,"layout",void 0),(0,a._)([(0,c.Cb)()],E.prototype,"layoutOptions",void 0),E=(0,a._)([(0,p.j)("esri.widgets.Print.CustomTemplate")],E);const V=E,k=s.Z.ofType(V);let F=class extends _.Z{constructor(e){super(e),this.allowedFormats="all",this.allowedLayouts="all",this.defaultTemplates=new k,this.extraParameters=null,this.includeDefaultTemplates=!0,this.error=null,this.portal=T.Z.getDefault(),this.printServiceUrl=null,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null,this.print=this.print.bind(this)}destroy(){this.view=null}get effectivePrintServiceUrl(){return this.printServiceUrl??null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const e=(0,n.d9)(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach((t=>{const i=e[t];if(i){const e=this.templateCustomTextElements[t];i.forEach((t=>{const[i]=Object.entries(t)[0];e.find((e=>{const[a,s]=Object.entries(e)[0];i===a&&(t[i]=s)}))}))}})),Object.freeze(e)}get state(){return"loading"===this.loadStatus?"initializing":this.error||"failed"===this.loadStatus?"error":this.get("view.ready")&&"loaded"===this.loadStatus?"ready":"disabled"}async load(e){return this.addResolvingPromise(this._loadResources(e).catch((e=>this.error=e))),this}async print(e){const{view:t,extraParameters:i,updateDelay:a}=this;if(!t)throw new v.Z("print:view-required","view is not set");!function(e){if(e.layoutOptions||(e.layoutOptions={}),e.layoutOptions.customTextElements||(e.layoutOptions.customTextElements=[]),!e.layoutOptions.customTextElements.find((e=>"date"in e))){const{customTextElements:t}=e.layoutOptions;let i=(0,S.p6)(Date.now(),(0,S.Ze)("short-date"));"ar"===(0,x.G3)()&&(i="\u200f"+i),t.push({date:i})}}(e);const s=new L.Z({view:t,template:e,extraParameters:i,updateDelay:a});try{return await(0,O.ht)(this.effectivePrintServiceUrl,s)}catch(f){throw new v.Z("print:export-error","An error occurred while exporting the web map.",{error:f})}}toPrintTemplate(e){let{attributionEnabled:t,author:i,copyright:a,customTextElements:s,dpi:r,forceFeatureAttributes:n,format:o,height:l,layout:u,legendEnabled:c,northArrowEnabled:p,scale:d,scaleEnabled:h,title:m,width:y}=e;const f=new M.Z({attributionVisible:t,forceFeatureAttributes:n,format:o,layout:u,layoutOptions:{authorText:i||"",copyrightText:a||"",customTextElements:s,titleText:m||""},outScale:d,scalePreserved:h});y&&(f.exportOptions.width=y),l&&(f.exportOptions.height=l),r&&(f.exportOptions.dpi=r),c||(f.layoutOptions.legendLayers=[]);const b=this.templateToNorthArrowInfo[u];return b&&(b.visible===p||(f.layoutOptions.elementOverrides={[b.name]:{visible:p}})),f}async _loadResources(e){let t=[];const{printServiceUrl:i}=this;if(!i){if(this.destroyed)return;const{portal:i}=this;try{await i.load(e)}catch(j){throw new v.Z("print:could-not-load-portal","Cannot load print resource information from portal",{url:this.effectivePrintServiceUrl})}const a=i.helperServices?.printTask;a&&(this._set("effectivePrintServiceUrl",a.url),t=(a?.templates??[]).map((e=>V.fromJSON(e))))}if(t.length>0&&this.defaultTemplates.addMany(t),-1===this.effectivePrintServiceUrl.toLowerCase().split("/").indexOf("gpserver"))throw new v.Z("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl});this._processLayoutTemplateInfos(await this._getLayoutTemplatesInfo(e)),await this._loadServiceDescription(e)}async _loadServiceDescription(e){const t=await this._getPrintTemplatesFromService(e);this._set("templatesInfo",t)}async _getLayoutTemplatesInfo(e){let t=[];const i=async t=>{const i=this.effectivePrintServiceUrl.replace(/(\/GPServer\/).+/i,`$1${encodeURI(t)}`);return(await(0,C.h)(i,null,null,(0,w.Wg)(e))).results[0].value};try{t=await i("Get Layout Templates Info Task")}catch(a){}if(!t||t.length<1)try{t=await i("Get Layout Templates Info")}catch(a){}return t}_processLayoutTemplateInfos(e){const t={},i={};e.forEach((e=>{let{layoutTemplate:a,layoutOptions:{customTextElements:s,mapSurroundInfos:r}}=e;const n=(0,I.i)(a);t[n]=s,r&&(i[n]=r.find((e=>"CIMMarkerNorthArrow"===e.type)))})),this.templateCustomTextElements=Object.freeze(t),this.templateToNorthArrowInfo=i}async _getPrintTemplatesFromService(e){return(0,g.default)(this.effectivePrintServiceUrl,{...e,query:{f:"json"},timeout:6e4}).then((e=>{const t=e&&e.data,i=t&&t.parameters;let a=null,s=null;return i.forEach((e=>{let t,i=e.choiceList&&e.choiceList.slice();i&&i.length&&e.defaultValue&&(t=i.indexOf(e.defaultValue)),t>-1&&(i.splice(t,1),i.unshift(e.defaultValue));const r=(e,t)=>{const i="all"===t?e:e.filter((e=>t.includes(e)));return 0===i.length?e:i};if("Format"===e.name){const t=r(i.map(P.i),this.allowedFormats),s=(0,P.i)(e.defaultValue);a={defaultValue:t.includes(s)?s:t[0],choiceList:t}}else if("Layout_Template"===e.name){let t,a;i=i.filter((e=>"map_only"!==e.toLowerCase())),i.some(((e,i)=>{const a=e.toLowerCase();return a.includes("letter")&&a.includes("landscape")?(t=i,!0):!(!a.includes("a4")||!a.includes("landscape"))&&(t=i,!1)})),t&&(a=i[t],i.splice(t,1),i.unshift(a));const n=r(i.map(I.i),this.allowedLayouts),o=(0,I.i)(e.defaultValue);s={defaultValue:n.includes(o)?o:n[0],choiceList:n}}})),this.error=null,{format:a,layout:s}})).catch((e=>{throw new v.Z("print:unavailable-service-info","Can't fetch templates info from service",{error:e})}))}};(0,a._)([(0,c.Cb)()],F.prototype,"_serviceTemplateCustomTextElements",void 0),(0,a._)([(0,c.Cb)()],F.prototype,"allowedFormats",void 0),(0,a._)([(0,c.Cb)()],F.prototype,"allowedLayouts",void 0),(0,a._)([(0,c.Cb)({type:k})],F.prototype,"defaultTemplates",void 0),(0,a._)([(0,c.Cb)()],F.prototype,"extraParameters",void 0),(0,a._)([(0,c.Cb)()],F.prototype,"includeDefaultTemplates",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],F.prototype,"effectivePrintServiceUrl",null),(0,a._)([(0,c.Cb)()],F.prototype,"effectiveTemplateCustomTextElements",null),(0,a._)([(0,c.Cb)()],F.prototype,"error",void 0),(0,a._)([(0,c.Cb)({type:T.Z})],F.prototype,"portal",void 0),(0,a._)([(0,c.Cb)()],F.prototype,"printServiceUrl",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],F.prototype,"state",null),(0,a._)([(0,c.Cb)({readOnly:!0})],F.prototype,"templatesInfo",void 0),(0,a._)([(0,c.Cb)()],F.prototype,"updateDelay",void 0),(0,a._)([(0,c.Cb)()],F.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],F.prototype,"templateCustomTextElements",void 0),(0,a._)([(0,c.Cb)()],F.prototype,"templateToNorthArrowInfo",void 0),F=(0,a._)([(0,p.j)("esri.widgets.Print.PrintViewModel")],F);const N=F;let G=class extends m.Z{constructor(e){super(e),this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format=null,this.height=null,this.layout=null,this.legendEnabled=!0,this.northArrowEnabled=!1,this.scale=null,this.scaleEnabled=!1,this.title=null,this.width=null}};(0,a._)([(0,c.Cb)()],G.prototype,"attributionEnabled",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"author",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"copyright",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"customTextElements",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"dpi",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"fileName",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"forceFeatureAttributes",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"format",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"height",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"layout",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"legendEnabled",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"northArrowEnabled",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"scale",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"scaleEnabled",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"title",void 0),(0,a._)([(0,c.Cb)()],G.prototype,"width",void 0),G=(0,a._)([(0,p.j)("esri.widgets.Print.TemplateOptions")],G);const j=G;var R=i(96919),A=i(65701),J=i(80975),U=i(80532),Z=i(67005);const $=s.Z.ofType(b),q="MAP_ONLY";var z,W;(W=z||(z={})).layout="layoutTab",W.mapOnly="mapOnlyTab";const B="esri-print",K="esri-print__header-title",X="esri-print__input-text",H="esri-print__layout-tab-list",Y="esri-print__layout-tab",Q="esri-print__layout-section",ee="esri-print__map-only-section",te="esri-print__scale-input",ie="esri-print__template-list",ae="esri-print__template-list-scroller",se="esri-print__template-list-footer",re="esri-print__loader",ne="esri-print__advanced-options-button",oe="esri-print__advanced-options-button-container",le="esri-print__advanced-options-button-title",ue="esri-print__advanced-options-button-icon--opened",ce="esri-print__advanced-options-button-icon--closed",pe="esri-print__advanced-options-button-icon--closed-rtl",de="esri-print__refresh-button",he="esri-print__swap-button",me="esri-print__export-button",ye="esri-print__template-button",fe="esri-print__form-section-container",be="esri-print__advanced-options-section",ge="esri-print__advanced-options-container",ve="esri-print__author-info-container",_e="esri-print__copyright-info-container",we="esri-print__export-panel-container",Se="esri-print__export-title",xe="esri-print__exported-file",Te="esri-widget__anchor esri-print__exported-file-link",Ce="esri-print__exported-file-link-title",Oe="esri-print__height-container",Pe="esri-print__legend-info-container",Ie="esri-print__container",Le="esri-print__panel-container",Me="esri-print__scale-info-container",De="esri-print__scale-input-container",Ee="esri-print__size-container",Ve="esri-print__width-container",ke="esri-widget",Fe="esri-widget--panel",Ne="esri-widget--button",Ge="esri-button",je="esri-button--secondary",Re="esri-button--tertiary",Ae="esri-select",Je="esri-input",Ue="esri-widget__anchor--disabled",Ze="esri-button--disabled",$e="esri-print__panel--error",qe="esri-print__exported-file--error",ze="esri-rotating",We="esri-menu__list",Be="esri-menu__list-item",Ke="esri-menu__list-item--focus",Xe="esri-menu__header",He="esri-icon-download",Ye="esri-icon-launch-link-external",Qe="esri-icon-error",et="esri-icon-right-triangle-arrow",tt="esri-icon-left-triangle-arrow",it="esri-icon-down-arrow",at="esri-icon-refresh",st="esri-icon-loading-indicator",rt="esri-icon-swap",nt="esri-icon-printer",ot="User sets an invalid layout, resetting it to the default valid one...",lt="User sets an invalid format, resetting it to the default valid one...";function ut(e){return e?.toUpperCase()===q}let ct=class extends h.Z{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._focusedTemplateIndex=0,this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this._selectTemplateNode=null,this._templateListPopover=new A.Z({owner:this,placement:"top",offset:[0,-100],anchorElement:()=>this._selectTemplateNode,renderContentFunction:this.renderTemplateList}),this.exportedLinks=new $,this.headingLevel=3,this.iconClass=nt,this.templateOptions=new j,this.viewModel=new N,this.handleTemplateListCreation=e=>e.focus(),this.handleTemplateChildBlur=e=>{const t=e.relatedTarget?.closest(`.${ie}`);t||this.handleCloseTemplateSelection()},this.handleCloseTemplateSelection=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!1,this._selectTemplateNode.focus()},this.handleSelectTemplateClick=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!0},this.handleTemplateListClick=e=>{const t=e.target;this.applyTemplate(t["data-template"])},this.handleTemplateListKeyDown=e=>{if((0,J.pf)(e.key))return this.applyTemplate(this.viewModel.defaultTemplates.getItemAt(this._focusedTemplateIndex)),void e.preventDefault();if("ArrowDown"===e.key||"ArrowUp"===e.key){const{defaultTemplates:t}=this.viewModel,i="ArrowDown"===e.key?1:-1,a=(this._focusedTemplateIndex+i)%t.length;this._focusedTemplateIndex=a<0?t.length-1:a;const s=e.currentTarget;(0,J._q)(s.querySelectorAll(`.${Be}`)[this._focusedTemplateIndex],s.parentElement),e.preventDefault()}"Escape"===e.key&&this.handleCloseTemplateSelection()},this._removeLink=e=>{const t=e.currentTarget["data-item"];t&&"error"===t.state&&this.exportedLinks.remove(t)},this._handleLinkClick=e=>{const t=e.currentTarget,{href:i}=t,a=(0,d.LP)(this.viewModel.effectivePrintServiceUrl);if(!a)return;if(!e.isTrusted)return void e.stopPropagation();e.preventDefault();const s=new URL(i);s.searchParams.set("token",a),t.href=s.href,t.click(),t.href=i},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([(0,l.YP)((()=>this.viewModel?.templatesInfo),(e=>{const{format:t,layout:i}=this.templateOptions;if(e){const a=i===e.layout.defaultValue||ut(i)||e.layout.choiceList&&e.layout.choiceList.includes(i),s=t===e.format.defaultValue||e.format.choiceList&&e.format.choiceList.includes(t);a||(i&&o.Z.getLogger(this.declaredClass).warn(ot),this.templateOptions.layout=e.layout.defaultValue),s||(t&&o.Z.getLogger(this.declaredClass).warn(lt),this.templateOptions.format=e.format.defaultValue),ut(i)&&(this._layoutTabSelected=!1)}}),l.nn),(0,l.YP)((()=>this.templateOptions?.format),(e=>{const{viewModel:{templatesInfo:t}}=this;if(t&&e){let i=!1;t.format.choiceList&&t.format.choiceList.forEach((t=>{t.toUpperCase()===e.toUpperCase()&&(this.templateOptions.format=t,i=!0)})),i||(this.templateOptions.format=t.format.defaultValue,o.Z.getLogger(this.declaredClass).warn(lt)),this.scheduleRender()}}),l.nn),(0,l.YP)((()=>this.templateOptions?.layout),(e=>{const{viewModel:{templatesInfo:t}}=this;if(t&&e){this._layoutTabSelected=!ut(e);let i=!this._layoutTabSelected;i||t.layout.choiceList&&t.layout.choiceList.forEach((t=>{t.toUpperCase()===e.toUpperCase()&&(this.templateOptions.layout=t,i=!0)})),i||(this.templateOptions.layout=t.layout.defaultValue,o.Z.getLogger(this.declaredClass).warn(ot));const a=this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=a?(0,n.d9)(a):null,this.scheduleRender()}}),l.nn),(0,l.YP)((()=>this.templateOptions?.dpi),(e=>{e<=0?this.templateOptions.dpi=1:this.scheduleRender()}),l.nn),(0,l.YP)((()=>this.viewModel?.view?.scale),(e=>{const{scale:t,scaleEnabled:i}=this.templateOptions;i&&t||(this.templateOptions.scale=e)}),l.nn)]);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const i=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender()}),500);this.viewModel.load().then((()=>clearTimeout(i)))}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{attributionEnabled:e,author:t,copyright:i,dpi:a,format:s,height:r,layout:n,legendEnabled:o,northArrowEnabled:l,scaleEnabled:u,scale:c,width:p}=this.templateOptions,d="ready"!==this.get("viewModel.state"),h=this.renderTitleOrFileNameSection(),{includeDefaultTemplates:m,messages:y,viewModel:f}=this,b=this.get("viewModel.templatesInfo.format.choiceList")||[],g=b.length>0?b.map((e=>(0,Z.u)("option",{key:e,selected:e===s,value:e},e.toUpperCase()))):(0,Z.u)("option",{key:"format-default-option"},y.formatDefaultOption),v=(0,Z.u)("div",{class:fe},(0,Z.u)("label",null,y.fileFormatTitle,(0,Z.u)("select",{class:Ae,onchange:this._updateFromOption,"data-target-property":"format",bind:this},g))),_=this.get("viewModel.templatesInfo.layout.choiceList")||[],w=_.length>0?_.map((e=>{const t=e===n,i=y[e]||e;return(0,Z.u)("option",{key:e,selected:t,value:e},i)})):(0,Z.u)("option",{key:"layout-default-option"},y.layoutDefaultOption),S=(0,Z.u)("div",{class:fe},(0,Z.u)("label",null,y.layoutTitle,(0,Z.u)("select",{class:Ae,onchange:this._updateFromOption,"data-target-property":"layout",bind:this},w))),x=(0,Z.u)("div",{class:fe},(0,Z.u)("label",null,y.dpi,(0,Z.u)("input",{type:"number",class:this.classes(X,Je),"data-input-name":"dpi",onchange:this._handleDPIChange,value:`${a}`,min:"1",tabIndex:0,bind:this}))),T=(0,Z.u)("div",{class:this.classes(Me,fe)},(0,Z.u)("label",null,(0,Z.u)("input",{"data-option-name":"scaleEnabled",checked:u,type:"checkbox",tabIndex:0,onchange:this._toggleInputValue,bind:this}),y.scale),(0,Z.u)("div",{class:De},(0,Z.u)("input",{"aria-label":y.scaleLabel,"aria-valuenow":`${c}`,role:"spinbutton",type:"number",class:this.classes(X,Je,te),tabIndex:0,"data-input-name":"scale",onchange:this._updateInputValue,disabled:!u,value:`${c}`,bind:this}),(0,Z.u)("button",{type:"button","aria-label":y.reset,class:this.classes(Ne,de,at),tabIndex:0,onclick:this._resetToCurrentScale,bind:this}))),C=this._advancedOptionsVisibleForLayout?(0,Z.u)("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:ge},T,(0,Z.u)("div",{class:this.classes(ve,fe)},(0,Z.u)("label",null,y.author,(0,Z.u)("input",{type:"text",value:t,class:this.classes(X,Je),tabIndex:0,"data-input-name":"author",onchange:this._updateInputValue,bind:this}))),(0,Z.u)("div",{class:this.classes(_e,fe)},(0,Z.u)("label",null,y.copyright,(0,Z.u)("input",{type:"text",class:this.classes(X,Je),tabIndex:0,value:i,"data-input-name":"copyright",onchange:this._updateInputValue,bind:this}))),x,(0,Z.u)("div",{class:this.classes(Pe,fe)},(0,Z.u)("label",null,(0,Z.u)("input",{type:"checkbox","data-option-name":"legendEnabled",tabIndex:0,checked:o,onchange:this._toggleInputValue,bind:this}),y.legend)),this.viewModel.templateToNorthArrowInfo[n]?(0,Z.u)("div",{class:this.classes(Pe,fe),key:"north-arrow"},(0,Z.u)("label",null,(0,Z.u)("input",{type:"checkbox","data-option-name":"northArrowEnabled",tabIndex:0,checked:l,onchange:this._toggleInputValue,bind:this}),y.northArrow)):null,this.renderCustomTextElementSection()):null,O=this._advancedOptionsVisibleForMapOnly?(0,Z.u)("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:ge},T,x,(0,Z.u)("div",{class:fe},(0,Z.u)("label",null,(0,Z.u)("input",{"data-option-name":"attributionEnabled",type:"checkbox",onchange:this._toggleInputValue,tabIndex:0,checked:e,bind:this}),y.attribution)),this.renderCustomTextElementSection()):null,P=this._layoutTabSelected?(0,Z.u)("section",{key:"esri-print__layoutContent",id:`${this.id}__layoutContent`,"aria-labelledby":`${this.id}__layoutTab`,class:Q,role:"tabpanel","aria-selected":this._layoutTabSelected.toString()},(0,Z.u)("div",{class:Le},h,S,this._layoutTabSelected?v:null),(0,Z.u)("div",{class:this.classes(Le,be)},(0,Z.u)("button",{"aria-label":y.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false",class:ne,onclick:this._showAdvancedOptions,bind:this,type:"button"},(0,Z.u)("div",{class:oe},(0,Z.u)("span",{"aria-hidden":"true",class:this.classes(et,ce)}),(0,Z.u)("span",{"aria-hidden":"true",class:this.classes(tt,pe)}),(0,Z.u)("span",{"aria-hidden":"true",class:this.classes(it,ue)}),(0,Z.u)("span",{class:le},y.advancedOptions))),C)):(0,Z.u)("section",{key:"esri-print__mapOnlyContent",id:`${this.id}__mapOnlyContent`,"aria-selected":(!this._layoutTabSelected).toString(),"aria-labelledby":`${this.id}__mapOnlyTab`,class:ee,role:"tabpanel"},(0,Z.u)("div",{class:Le},h,this._layoutTabSelected?null:v,(0,Z.u)("div",{class:this.classes(Ee,fe)},(0,Z.u)("div",{class:Ve},(0,Z.u)("label",null,y.width,(0,Z.u)("input",{type:"number",class:this.classes(X,Je),"data-input-name":"width",onchange:this._updateInputValue,value:`${p}`,tabIndex:0,bind:this}))),(0,Z.u)("div",{class:Oe},(0,Z.u)("label",null,y.height,(0,Z.u)("input",{type:"number",class:this.classes(X,Je),"data-input-name":"height",onchange:this._updateInputValue,value:`${r}`,tabIndex:0,bind:this}))),(0,Z.u)("button",{type:"button","aria-label":y.swap,class:this.classes(Ne,he,rt),onclick:this._switchInput,tabIndex:0,bind:this})),(0,Z.u)("div",{class:this.classes(Le,be)},(0,Z.u)("button",{"aria-label":y.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false",type:"button",class:ne,onclick:this._showAdvancedOptions,bind:this},(0,Z.u)("div",{class:oe},(0,Z.u)("span",{"aria-hidden":"true",class:this.classes(et,ce)}),(0,Z.u)("span",{"aria-hidden":"true",class:this.classes(tt,pe)}),(0,Z.u)("span",{"aria-hidden":"true",class:this.classes(it,ue)}),(0,Z.u)("span",{class:le},y.advancedOptions))),O))),I=this.exportedLinks.toArray(),L=this._renderExportedLink(I),M={[Ze]:d||!n&&!s},D=null!=this.get("view")&&"2d"!==this.get("view.type"),E=(0,Z.u)("div",{class:$e},D?y.sceneViewError:y.serviceError),V=(0,Z.u)("div",null,(0,Z.u)("ul",{class:H,role:"tablist",onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,bind:this},(0,Z.u)("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__layoutTab`,"data-tab-id":z.layout,class:Y,role:"tab",tabIndex:0,"aria-selected":`${this._layoutTabSelected}`},y.layoutTab),(0,Z.u)("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__mapOnlyTab`,"data-tab-id":z.mapOnly,class:Y,role:"tab",tabIndex:0,"aria-selected":`${!this._layoutTabSelected}`},y.mapOnlyTab)),P,(0,Z.u)("button",{"aria-label":y.exportDescription,type:"button",class:this.classes(me,Ge,M),disabled:d,tabIndex:0,onclick:this._handlePrintMap,bind:this},y.export),m&&f.defaultTemplates.length>0?this.renderTemplateSectionTrigger():null,(0,Z.u)("div",{class:we,afterUpdate:this._scrollExportIntoView,bind:this},(0,Z.u)(R.X6,{class:Se,level:this.headingLevel},y.exportText),I.length>0?null:(0,Z.u)("div",null,(0,Z.u)("div",null,y.exportHint)),L)),k=(0,Z.u)("div",{class:Ie},(0,Z.u)("header",{class:K},y.export),this.error||D||!this.view?E:V),F="initializing"===this.get("viewModel.state")?this._renderLoader():k;return(0,Z.u)("div",{afterCreate:this._handleRootAfterCreate,bind:this,class:this.classes(B,ke,Fe)},F)}renderTemplateSectionTrigger(){const{messages:e,_templateListPopover:t}=this,i=t.open;return(0,Z.u)("button",{afterCreate:e=>this._selectTemplateNode=e,"aria-controls":i?`${this.id}__template-selection`:"","aria-label":e.selectTemplateDescription,"aria-pressed":i.toString(),class:this.classes(Ge,Re,ye),onclick:this.handleSelectTemplateClick,title:e.selectTemplateDescription,type:"button"},e.selectTemplate)}renderCustomTextElementSection(){const{templateOptions:{customTextElements:e}}=this;return e?(0,Z.u)("div",{class:fe,key:"custom-text-elements"},e.map((e=>{const[t,i]=Object.entries(e)[0];return"date"===t?null:(0,Z.u)("label",{key:t},t,(0,Z.u)("input",{bind:this,class:this.classes(X,Je),"data-input-custom":!0,"data-input-name":t,onchange:this._updateInputValue,type:"text",value:i}))}))):null}renderTemplateList(){const{messages:e,messagesCommon:t,viewModel:i}=this,{defaultTemplates:a}=i,s=e.selectTemplateDescription,r=`${this.id}__template-selection`;return(0,Z.u)("div",{class:this.classes(ie,ke,Fe),id:r},(0,Z.u)(R.X6,{class:Xe,level:this.headingLevel},e.selectTemplate),(0,Z.u)("div",{class:ae},(0,Z.u)("ul",{afterCreate:this.handleTemplateListCreation,"aria-activedescendant":`${this.id}__template-item--${this._focusedTemplateIndex}`,"aria-label":s,class:We,key:"templates",onblur:this.handleTemplateChildBlur,onclick:this.handleTemplateListClick,onkeydown:this.handleTemplateListKeyDown,role:"listbox",tabIndex:0,title:s},a.toArray().map(((t,i)=>{const{description:a}=t,s=i===this._focusedTemplateIndex,r=t.label;return(0,Z.u)("li",{"aria-label":a,class:this.classes(Be,{[Ke]:s}),"data-template":t,id:`${this.id}__template-item--${i}`,key:r,title:a},ut(r)?e.mapOnlyTab:r)})))),(0,Z.u)("div",{class:se},(0,Z.u)("button",{type:"button",class:this.classes(Ge,je),onblur:this.handleTemplateChildBlur,onclick:this.handleCloseTemplateSelection},t.done)))}applyTemplate(e){const{format:t,layout:i,layoutOptions:a}=e,{templateOptions:s}=this;this._templateListPopover.open=!1,this._toggleTab("map-only"===i?z.mapOnly:z.layout,!1),t&&(s.format=t),i&&(s.layout=i),this._focusedTemplateIndex=null,s.legendEnabled=a?.legend??s.legendEnabled,this.handleCloseTemplateSelection()}renderTitleOrFileNameSection(){const{templateOptions:e,messages:t}=this;let i,a,s,r;return this._layoutTabSelected?(i=t.title,a=t.titlePlaceHolder,s=e.title,r="title"):(i=t.fileName,a=t.fileNamePlaceHolder,s=e.fileName,r="fileName"),(0,Z.u)("div",{class:fe,key:r},(0,Z.u)("label",null,i,(0,Z.u)("input",{type:"text",tabIndex:0,placeholder:a,class:this.classes(X,Je),value:s,"data-input-name":r,onchange:this._updateInputValue,bind:this})))}_handleRootAfterCreate(e){this._rootNode=e,this.addHandles((0,r.on)(e,"scroll",(()=>{this._templateListPopover.open&&this.handleCloseTemplateSelection()})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");("layoutTab"===t&&this._layoutTabSelected||"mapOnlyTab"===t&&!this._layoutTabSelected)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[re]:this._awaitingServerResponse};return(0,Z.u)("div",{class:this.classes(e),key:"loader"})}_createFileLink(e,t){const i=t||this.messages.untitled,a=e.format.toLowerCase(),s=a.includes("png")?"png":a,r=i+s;return void 0!==this._exportedFileNameMap[r]?this._exportedFileNameMap[r]++:this._exportedFileNameMap[r]=0,new b({name:i,extension:s,count:this._exportedFileNameMap[r]})}_resetToCurrentScale(){this.templateOptions.scale=this.viewModel.view.scale}_updateCustomTextElementValue(e,t,i){e.find((e=>{const[i]=Object.entries(e)[0];return i===t}))[t]=i}_updateInputValue(e){const t=e.target,i=t.getAttribute("data-input-name"),a=!!t["data-input-custom"],{templateOptions:s}=this;if(a)return void this._updateCustomTextElementValue(s.customTextElements,i,t.value);let r;if("number"===t.type){if(!function(e){return!isNaN(e)&&e>0}(t.valueAsNumber)){const e=s[i];return void(t.value=`${e}`)}r=t.valueAsNumber}else r=t.value;s[i]=r}_handleDPIChange(e){this._updateInputValue(e);const t=e.currentTarget.valueAsNumber,{height:i,width:a}=function(e){return{width:Math.round(8.3333*e),height:Math.round(11.4583*e)}}(t),{templateOptions:s}=this;s.height=i,s.width=a}_handlePrintMap(){this._pendingExportScroll=!0;const{templateOptions:e}=this,t=this.viewModel.toPrintTemplate(e),i=this._layoutTabSelected?t.layoutOptions.titleText:e.fileName,a=this._createFileLink(t,i);this.exportedLinks.add(a),this.emit("submit",{link:a}),this.viewModel.print(t).then((e=>{a.set({url:e&&e.url,state:"ready"})})).catch((e=>{a.set({error:e,state:"error"})})).then((()=>{this.emit("complete",{link:a}),this.scheduleRender()}))}_updateFromOption(e){const t=e.target,i=t.selectedOptions?t.selectedOptions.item(0).value:t.options[t.selectedIndex].value,a=t.getAttribute("data-target-property");this.templateOptions[a]=i}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly}_scrollExportIntoView(){if(this._pendingExportScroll){this._pendingExportScroll=!1;const{_rootNode:e,_rootNode:{clientHeight:t,scrollHeight:i}}=this,a=i-t;a>0&&(e.scrollTop=a)}}_toggleInputValue(e){const t=e.target,i=t.getAttribute("data-option-name");this.templateOptions[i]=t.checked,"scaleEnabled"===i&&(this.templateOptions[i]||this._resetToCurrentScale())}_renderExportedLink(e){const t=this.messages;return e.map((e=>{const{error:i,url:a,formattedName:s,state:r}=e,n="error"===r,o="pending"===r,l="ready"===r,c={[Ue]:o||n};let p=a||null;p&&(p=(0,u.qg)(p));const d=(0,u.D6)(a,location.href),h={[st]:o,[ze]:o,[He]:d&&l,[Ye]:!d&&l,[Qe]:n,[qe]:n},m={[qe]:n};let y;y=o?t.pending:l?t.ready:t.errorMessage;const f=n?"print-task:cim-symbol-unsupported"===i.name?t.exportWebMapCIMError:t.exportWebMapError:"";return(0,Z.u)("div",{"aria-label":y,class:xe,"data-item":e,key:s,onclick:this._removeLink,title:f},(0,Z.u)("a",{"aria-label":`${s}. ${t.linkReady}`,download:s,href:p,rel:"noreferrer",tabIndex:0,target:"_blank",class:this.classes(Te,c),onclick:this._handleLinkClick},(0,Z.u)("span",{class:this.classes(h)}),(0,Z.u)("span",{class:this.classes(Ce,m)},s)))}))}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._layoutTabSelected=e===z.layout,this._layoutTabSelected){const e=this.get("viewModel.templatesInfo.layout.choiceList");this.templateOptions.layout=e&&e[0]}else this.templateOptions.layout=q;t&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const t=(0,r.kK)(e),i=e.target.getAttribute("data-tab-id");if((0,J.pf)(t))return this._toggleTab(i),e.preventDefault(),void e.stopPropagation();"ArrowLeft"!==t&&"ArrowRight"!==t||(this._toggleTab(i===z.layout?z.mapOnly:z.layout),e.preventDefault(),e.stopPropagation())}};(0,a._)([(0,c.Cb)()],ct.prototype,"allowedFormats",null),(0,a._)([(0,c.Cb)()],ct.prototype,"allowedLayouts",null),(0,a._)([(0,c.Cb)()],ct.prototype,"error",null),(0,a._)([(0,c.Cb)({type:$})],ct.prototype,"exportedLinks",void 0),(0,a._)([(0,c.Cb)()],ct.prototype,"extraParameters",null),(0,a._)([(0,c.Cb)()],ct.prototype,"headingLevel",void 0),(0,a._)([(0,c.Cb)()],ct.prototype,"iconClass",void 0),(0,a._)([(0,c.Cb)()],ct.prototype,"includeDefaultTemplates",null),(0,a._)([(0,c.Cb)()],ct.prototype,"label",null),(0,a._)([(0,c.Cb)(),(0,U.H)("esri/widgets/Print/t9n/Print")],ct.prototype,"messages",void 0),(0,a._)([(0,c.Cb)(),(0,U.H)("esri/t9n/common")],ct.prototype,"messagesCommon",void 0),(0,a._)([(0,c.Cb)()],ct.prototype,"portal",null),(0,a._)([(0,c.Cb)()],ct.prototype,"printServiceUrl",null),(0,a._)([(0,c.Cb)()],ct.prototype,"templateCustomTextElements",null),(0,a._)([(0,c.Cb)({type:j})],ct.prototype,"templateOptions",void 0),(0,a._)([(0,c.Cb)()],ct.prototype,"view",null),(0,a._)([(0,c.Cb)({type:N})],ct.prototype,"viewModel",void 0),ct=(0,a._)([(0,p.j)("esri.widgets.Print")],ct);const pt=ct}}]);
//# sourceMappingURL=7064.7cc0d83d.chunk.js.map