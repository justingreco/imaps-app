"use strict";(globalThis.webpackChunkimaps_app=globalThis.webpackChunkimaps_app||[]).push([[6934],{54134:(e,t,s)=>{var i,a,r,n,l,o;s.d(t,{NH:()=>l,Xo:()=>r,fu:()=>i}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(a||(a={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(r||(r={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(n||(n={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(l||(l={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}))},97731:(e,t,s)=>{s.d(t,{E6:()=>c,Kj:()=>p,RQ:()=>g,T:()=>n,ep:()=>o,hu:()=>r,kG:()=>u,tM:()=>m,u_:()=>h,yK:()=>l,zF:()=>d});var i=s(6394);s(90045);(0,s(67077).c)();class a{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function r(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new a(t)}function n(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function l(e,t,s,i){let a,r=(s[0]-e[0])/t[0],n=(i[0]-e[0])/t[0];r>n&&(a=r,r=n,n=a);let l=(s[1]-e[1])/t[1],o=(i[1]-e[1])/t[1];if(l>o&&(a=l,l=o,o=a),r>o||l>n)return!1;l>r&&(r=l),o<n&&(n=o);let c=(s[2]-e[2])/t[2],h=(i[2]-e[2])/t[2];return c>h&&(a=c,c=h,h=a),!(r>h||c>n)&&(h<n&&(n=h),!(n<0))}function o(e,t,s,a,r){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,i.a)();const l=(a[r]-s[r])*(t[0]-e[0])-(a[0]-s[0])*(t[r]-e[r]),o=(a[0]-s[0])*(e[r]-s[r])-(a[r]-s[r])*(e[0]-s[0]);if(0===l)return!1;const c=o/l;return n[0]=e[0]+c*(t[0]-e[0]),n[1]=e[r]+c*(t[r]-e[r]),!0}function c(e,t){return Math.log(e)/Math.log(t)}function h(e,t,s,i){e[12]=t,e[13]=s,e[14]=i}function u(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}function p(e,t,s){return 2*Math.atan(Math.sqrt(t*t+s*s)*Math.tan(.5*e)/t)}function d(e,t,s){return 2*Math.atan(Math.sqrt(t*t+s*s)*Math.tan(.5*e)/s)}function m(e,t,s){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+s*s))}function g(e,t,s){return 2*Math.atan(s*Math.tan(.5*e)/Math.sqrt(t*t+s*s))}},92028:(e,t,s)=>{s.d(t,{D:()=>r});var i=s(72619),a=s(50951);function r(e,t){return null!=e&&(null==t||(t===a.JY.Local?!e.isGeographic||e.isWGS84||e.wkid===i.W.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===i.W.CGCS2000||e.wkid===i.W.GCSMARS2000||e.wkid===i.W.GCSMARS2000_SPHERE||e.wkid===i.W.GCSMOON2000))}},6934:(e,t,s)=>{s.d(t,{Z:()=>ze});var i=s(27366),a=s(65905),r=s(100),n=s(94172),l=s(8025),o=s(63780),c=(s(93169),s(25243),s(49861)),h=s(69912),u=s(69407),p=s(29479),d=s(40281),m=s(41691),g=s(54472),f=s(92026),_=s(89125),b=s(79803),y=s(92975),v=s(23037),w=s(10064),k=s(66978),T=s(37933),S=s(50951),C=(s(41644),s(76200)),R=s(85015),E=s(84652),M=s(97731);class O{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new L}}class L{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class x{constructor(e,t,s,i){this._workerFunc=e,this._callbackFunc=t,this._maxTotalNumWorkers=s,this._totalNumWorkers=0,this._clients=i.map((e=>new O(e)))}hasQuota(e){const t=this._clients[e];return!!t&&(this._totalNumWorkers<this._maxTotalNumWorkers||t.numWorkers+t.tasks.length<t.typeWorkerQuota)}push(e){const t=this._clients[e.client];t&&(this._totalNumWorkers<this._maxTotalNumWorkers?(t.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,((e,t)=>this._taskCallback(e,t)))):t.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(e){const t=this._clients[e.client];this._totalNumWorkers--,t.numWorkers--,t.statistics.requests++,t.statistics.size+=e.size||0,t.statistics.duration+=e.duration||0,t.statistics.speed=t.statistics.duration>0?t.statistics.size/t.statistics.duration:0,(0,M.hu)(t.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),((e,t)=>this._taskCallback(e,t))))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,t){e._cancelled||(this._callbackFunc(e,t),this._taskFinished(e))}getStatsForType(e){const t=this._clients[e];return t?{quota:t.typeWorkerQuota,workers:t.numWorkers,queueSize:t.tasks.length,requestStats:t.statistics}:null}get test(){const e=this;return{set workerFunc(t){e._workerFunc=t}}}}var W=s(99912);let A=class extends R.Z{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,s){this._loadQueue=new x(((e,t)=>this._startLoading(e,t)),((e,t)=>this._doneLoadingCB(e,t)),e,t),s&&(this._frameTask=s.registerTask(W.T8.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=(0,f.hw)(this._frameTask),this._tasks.forEach((e=>(0,f.IM)(e.abortController))),this._loadQueue=(0,f.SC)(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=(0,k.hh)();a.__signal=(0,f.pC)(i)?i.signal:null;const r=this._createOrUpdateTask(e,t,s,i,a);return(0,k.fu)(i,(()=>this._cancelRequest(r,a))),a.promise}_createTask(e,t,s,i,a,r){const n=new B(e,t,s,i,a);return this._updateTask(n,r),this._tasks.set(a,n),1===this._tasks.size&&this._set("updating",!0),this._loadQueue.push(n),n}_cancelRequest(e,t){(0,o.e$)(e.resolvers,t),t.reject((0,k.zE)()),0===e.resolvers.length&&(e.status===N.DOWNLOADING&&(e.status=N.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=N.CANCELLED,this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,s,i,a){const r=function(e,t,s){return`${e}:${t}:${s}`}((0,f.pC)(i)&&i.uid||e,t,s),n=this._tasks.get(r);return n?(this._updateTask(n,a),n):this._createTask(e,i,t,s,r,a)}_doneLoadingCB(e,t){this._loadQueue&&((0,M.hu)(e.status===N.DOWNLOADING),e.status=N.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();(0,k.k_)(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==N.DOWNLOADED&&(t.err=t.err||(0,k.zE)()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!(0,k.D_)(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let s=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const i of e.resolvers)if(t)(0,k.D_)(t)?i.reject(t):i.reject(new w.Z("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--s;const t=s<=0?e.result:(0,E.d9)(e.result);i.resolve(t)}this._tasks.delete(e.key),0===this._tasks.size&&this._set("updating",!1)}_startLoading(e,t){if(e.status===N.CANCELLED)return!1;let s,i;switch(e.startTime=performance.now(),e.status=N.DOWNLOADING,e.docType){case"binary":i="array-buffer",s=0;break;case"image":i="image";break;case"image+type":i="array-buffer";break;default:i="json"}e.abortController=new AbortController;const a=e.abortController.signal;e.request=(0,C.default)(e.url,{...e.options,responseType:i,timeout:s,signal:a});let r=()=>{};const n=s=>{e.duration=performance.now()-e.startTime,e.size=s instanceof ArrayBuffer?s.byteLength:e.size||0,e.result=s,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},l=s=>{e.status===N.DOWNLOADING&&t(e,s),r()};return"image+type"!==e.docType?(e.request.then((e=>n(e.data)),l),!0):(e.request.then((t=>{const o=t.data,c=function(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return 137===t[0]&&80===t[1]?"image/png":71===t[0]&&73===t[1]?"image/gif":66===t[0]&&77===t[1]?"image/bmp":255===t[0]&&216===t[1]?"image/jpeg":"unknown"}(o);if(i="image",e.size=o.byteLength,"unknown"===c)return e.request=(0,C.default)(e.url,{responseType:i,timeout:s,signal:a}),void e.request.then((e=>n(e.data)),l);const h=new Blob([o],{type:c}),u=window.URL.createObjectURL(h);r=()=>window.URL.revokeObjectURL(u),e.request=(0,C.default)(u,{responseType:i,timeout:s,signal:a}),e.request.then((e=>n(new Z(e.data,c,r))),l)}),l),!0)}get test(){return{loadQueue:this._loadQueue}}};(0,i._)([(0,c.Cb)({readOnly:!0})],A.prototype,"updating",void 0),A=(0,i._)([(0,h.j)("esri.views.3d.support.StreamDataLoader")],A);const I=0;class Z{constructor(e,t,s){this.image=e,this.type=t,this.release=s}get isOpaque(){return"image/jpeg"===this.type}}class B extends class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}}{constructor(e,t,s,i,a){super(i),this.url=e,this.options=t,this.docType=s,this.key=a,this.result=null,this.status=N.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=I}}var N;!function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"}(N||(N={}));var z=s(54134),D=s(11186),F=s(71353),G=s(65156),q=s(16889),U=s(68860),P=s(53866),Q=s(78952),H=s(81753),j=s(22824);class Y{constructor(e){const t=Y.checkUnsupported(e);if((0,f.pC)(t))throw t;const s=(0,f.Wg)(e);this.spatialReference=s.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=(0,b.jF)(this.spatialReference)||(0,y.BZ)(this.spatialReference)||(0,y.V2)(this.spatialReference),this.origin=[s.origin.x,s.origin.y],this.pixelSize=s.size[0],this.dpi=s.dpi;const i=s.lods.reduce(((e,t,s)=>(t.level<e.min&&(e.min=t.level,e.minIndex=s),e.max=Math.max(e.max,t.level),e)),{min:1/0,minIndex:0,max:-1/0}),a=s.lods[i.minIndex],r=2**a.level;let n=a.resolution*r,l=a.scale*r;this.levels=new Array(i.max+1);for(let o=0;o<this.levels.length;o++)this.levels[o]={resolution:n,scale:l,tileSize:[n*s.size[0],n*s.size[1]]},n/=2,l/=2}clone(){return new Y(this.toTileInfo())}toTileInfo(){return new j.Z({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,t)=>({level:t,scale:e.scale,resolution:e.resolution})))})}getExtent(e,t,s,i){const a=this.levels[e],r=a.tileSize[0],n=a.tileSize[1];i[0]=this.origin[0]+s*r,i[2]=this.origin[0]+(s+1)*r,i[3]=this.origin[1]-t*n,i[1]=this.origin[1]-(t+1)*n}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=(0,H.tp)(e[0]),t[1]=(0,H.mZ)(e[1]),t[2]=(0,H.tp)(e[2]),t[3]=(0,H.mZ)(e[3])):this._isGCS&&(t[0]=(0,q.Vl)(e[0]),t[1]=(0,q.Vl)(e[1]),t[2]=(0,q.Vl)(e[2]),t[3]=(0,q.Vl)(e[3]))}getExtentGeometry(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new P.Z;return this.getExtent(e,t,s,V),i.spatialReference=this.spatialReference,i.xmin=V[0],i.ymin=V[1],i.xmax=V[2],i.ymax=V[3],i.zmin=void 0,i.zmax=void 0,i}ensureMaxLod(e){if(null==e)return!1;let t=!1;for(;this.levels.length<=e;){const e=this.levels[this.levels.length-1],s=e.resolution/2;this.levels.push({resolution:s,scale:e.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),t=!0}return t}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof Y)){if(Y.checkUnsupported(e))return!1;e=new Y(e)}if(!e.spatialReference.equals(this.spatialReference))return!1;if(e.pixelSize!==this.pixelSize)return!1;const t=Math.min(this.levels.length,e.levels.length)-1,s=this.levels[t].resolution;let i=.5*s;return!(!(0,q.W8)(e.origin[0],this.origin[0],i)||!(0,q.W8)(e.origin[1],this.origin[1],i))&&(i=.5*s/2**t/this.pixelSize*12,(0,q.W8)(s,e.levels[t].resolution,i))}rootTilesInExtent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;const i=new Array,a=this.levels[0].tileSize;if((0,f.Wi)(e)||0===a[0]||0===a[1])return i;Y.computeRowColExtent(e,a,this.origin,V);let r=V[1],n=V[3],l=V[0],o=V[2];const c=o-l,h=n-r;if(c*h>s){const e=Math.floor(Math.sqrt(s));h>e&&(r=r+Math.floor(.5*h)-Math.floor(.5*e),n=r+e),c>e&&(l=l+Math.floor(.5*c)-Math.floor(.5*e),o=l+e)}for(let u=r;u<n;u++)for(let e=l;e<o;e++)i.push([0,u,e]);return(0,f.pC)(t)&&(t[0]=this.origin[0]+l*a[0],t[1]=this.origin[1]-n*a[1],t[2]=this.origin[0]+o*a[0],t[3]=this.origin[1]-r*a[1]),i}static computeRowColExtent(e,t,s,i){const a=.001*(e[2]-e[0]+(e[3]-e[1]));i[0]=Math.max(0,Math.floor((e[0]+a-s[0])/t[0])),i[2]=Math.max(0,Math.ceil((e[2]-a-s[0])/t[0])),i[1]=Math.max(0,Math.floor((s[1]-e[3]+a)/t[1])),i[3]=Math.max(0,Math.ceil((s[1]-e[1]-a)/t[1]))}static isPowerOfTwo(e){const t=e.lods,s=t[0].resolution*2**t[0].level;return!t.some((e=>!(0,q.Y8)(e.resolution,s/2**e.level)))}static hasGapInLevels(e){const t=e.lods.map((e=>e.level));t.sort(((e,t)=>e-t));for(let s=1;s<t.length;s++)if(t[s]!==t[0]+s)return!0;return!1}static tileSizeSupported(e){const t=e.size[1];return t===e.size[0]&&0==(t&t-1)&&t>=128&&t<=512}static hasOriginPerLODs(e){const t=e.origin;return e.lods.some((e=>null!=e.origin&&(e.origin[0]!==t.x||e.origin[1]!==t.y)))}static getMissingTileInfoError(){return new w.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return(0,f.Wi)(e)?$():e.lods.length<1?new w.Z("tilingscheme:generic","Tiling scheme must have at least one level"):Y.isPowerOfTwo(e)?Y.hasGapInLevels(e)?new w.Z("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Y.tileSizeSupported(e)?Y.hasOriginPerLODs(e)?new w.Z("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new w.Z("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new w.Z("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,t){const s=e[2]-e[0],i=e[3]-e[1],a=(0,U.c9)(t),r=1.2*Math.max(s,i),n=256,l=new Y(new j.Z({size:[n,n],origin:{x:e[0]-.5*(r-s),y:e[3]+.5*(r-i)},lods:[{level:0,resolution:r/n,scale:1/(n/96*.0254/(r*a))}],spatialReference:t}));return l.ensureMaxLod(20),l}static makeWebMercatorAuxiliarySphere(e){const t=new Y(Y.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(e),t}static makeGCSWithTileSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16;const i=256/t,a=new Y(new j.Z({size:[t,t],origin:{x:-180,y:90,spatialReference:e},spatialReference:e,lods:[{level:0,resolution:.703125*i,scale:295497598.570834*i}]}));return a.ensureMaxLod(s),a}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function $(){return new w.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Y.WebMercatorAuxiliarySphereTileInfo=new j.Z({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:Q.Z.WebMercator},spatialReference:Q.Z.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),Y.WebMercatorAuxiliarySphere=Y.makeWebMercatorAuxiliarySphere(19);const V=(0,G.Ue)(),X=((0,q.oK)(q._3/10),(0,G.Ue)());Y.WebMercatorAuxiliarySphere.getExtent(0,0,0,X);(0,G.Ue)([-180,-90,180,90]);const J=(0,F.c)(),K=(0,F.c)(),ee=(0,F.c)(),te=(0,F.c)();function se(e,t,s,i){(0,D.c)(J,s),J[i]=t[i];const a=(0,D.b)(J,J,t),r=(0,D.b)(K,e,t),n=(0,D.e)(r,a),l=(0,D.e)(a,a);let o;o=n<=0?t:l<=n?s:(0,D.a)(J,t,(0,D.g)(a,a,n/l));const c=(0,D.b)(J,e,o);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}const ie=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=e.extent;if((0,f.Wi)(i))return!1;if(0===s)return(0,G.BD)(i,t);const a=Math.min(i[2]-i[0],i[3]-i[1]);return(0,G.Zm)(i,t,s*a)},tiltToExtentEdge:function(e,t,s){const i=e.extent;if((0,f.Wi)(i))return 0;ee[0]=i[0],ee[1]=i[1],ee[2]=s,te[0]=i[2],te[1]=i[3],te[2]=s;let a=1/0,r=1/0;return t[0]<ee[0]?a=se(t,ee,te,0):t[0]>te[0]&&(a=se(t,te,ee,0)),t[1]<ee[1]?r=se(t,ee,te,1):t[1]>te[1]&&(r=se(t,te,ee,1)),Math.min(a,r)},checkIfTileInfoSupportedForViewSR:function(e,t,s){if((0,f.Wi)(e))return $();if(e.spatialReference.isGeographic&&!(0,b.jF)(e.spatialReference))return new w.Z("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Y.checkUnsupported(e);if((0,f.pC)(i))return i;if((0,f.Wi)(s))return new w.Z("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const a=function(e,t){const s=e.lods,i=s[0].resolution*2**s[0].level,a=[i*e.size[0],i*e.size[1]],r=[e.origin.x,e.origin.y],n=(0,G.oJ)(t),l=(0,G.Ue)();Y.computeRowColExtent(n,a,r,l);const o=(l[2]-l[0])*(l[3]-l[1]);if(o>64){const t=s[0].scale*2**s[0].level;let a=Math.max((n[3]-n[1])/e.size[1],(n[2]-n[0])/e.size[0])*t/i;const r=Math.floor(Math.log(a)/Math.log(10));return a=Math.ceil(a/10**r)*10**r,new w.Z("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(t).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+a.toLocaleString()+".",{level0Scale:t,suggestedLevel0Scale:a,requiredNumRootTiles:o,allowedNumRootTiles:64})}return null}(e,s);if(a)return a;const r=e.spatialReference;return(0,f.pC)(t)&&!(r.equals(t)||t.isWGS84&&r.isWebMercator)?new w.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}},Symbol.toStringTag,{value:"Module"}));const ae=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:function(){return!0},tiltToExtentEdge:function(){return 0},checkIfTileInfoSupportedForViewSR:function(e,t){if((0,f.Wi)(e))return $();const s=e.lods.length-1,i=e.spatialReference,a=(0,b.jF)(i)||(0,y.BZ)(i)||(0,y.V2)(i);if(i.isWebMercator){if(!Y.makeWebMercatorAuxiliarySphere(s).compatibleWith(e))return new w.Z("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!a)return new w.Z("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Y.makeGCSWithTileSize(e.spatialReference,e.size[0],s).compatibleWith(e))return e.spatialReference.isWGS84?new w.Z("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new w.Z("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return(0,f.pC)(t)&&!e.spatialReference.equals(t)?new w.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}},Symbol.toStringTag,{value:"Module"})),re={[S.JY.Global]:ae,[S.JY.Local]:ie};function ne(e,t,s,i){return re[i].checkIfTileInfoSupportedForViewSR(e,s,t)}function le(e,t,s){const i=(0,T.mt)(e);if((0,f.pC)(i)){if(!d.Z.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const e=i.find((e=>null==ne(e.tileInfo,e.fullExtent,t,s)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}z.Xo.NORTH,z.Xo.EAST,z.Xo.SOUTH,z.Xo.WEST,z.Xo.NORTH_EAST,z.Xo.SOUTH_EAST,z.Xo.SOUTH_WEST,z.Xo.NORTH_WEST;var oe=s(92028);async function ce(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await pe(e,t),(0,k.k_)(t)}async function he(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{basemap:s,view:i}=e;if((0,k.k_)(t),"spatialReferenceLocked"in i&&!i.spatialReferenceLocked)return;if(await s.load(t),(0,k.k_)(t),0===s.baseLayers.length)return;const a=s.baseLayers.getItemAt(0);if(!(0,T.iC)(a))return;if(s.spatialReference){if(i.spatialReference.equals(s.spatialReference))return;ue()}await a.load(t),(0,k.k_)(t);const r=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?a.tileInfo.spatialReference:null]).filter(Boolean);0!==r.length&&r.every((e=>!i.spatialReference.equals(e)))&&ue()}function ue(){throw new w.Z("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}async function pe(e,t){const{basemap:s,view:i}=e;if(await s.load(t),0===s.baseLayers.length)return;const a=s.baseLayers.concat(s.referenceLayers).toArray().filter((e=>!(0,T.qq)(e))).map((e=>new w.Z("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})));if(a.length)throw a[0];const r=s.baseLayers.getItemAt(0);if((0,T.qq)(r)){try{await r.load(t)}catch(n){const e="basemap-compatibility:unknown-error",t="Unknown basemap compatibility error",{name:s=e,message:i=t,details:a}=n;throw new w.Z(s,i,a)}!function(e,t){const s=t.state.viewingMode;if(!s)return;let i,a;if("wmts"===e?.type){const r=le(e,t.spatialReference,s);if((0,f.Wi)(r.tileInfo))throw new w.Z("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");i=r.tileInfo,a=r.fullExtent}else i=e.tileInfo,a=e.fullExtent;if((0,f.Wi)(i))return;if(!(0,oe.D)(i.spatialReference,s))throw new w.Z(`basemapgalleryitem:spatial-reference-unsupported-${(0,S.M7)(s)}`,`Basemap spatial reference is unsupported in ${(0,S.M7)(s)} mode`);const r=i.spatialReference.isGeographic,n="vector-tile"===e?.type?i.getOrCreateCompatible(256,r?1:2):null;if(s===S.JY.Global){let t=ne(i,a,null,s);if(t&&"vector-tile"===e?.type&&(0,f.pC)(a)&&n&&!ne(n,a,null,s)&&(t=null),t){const e=i.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new w.Z(`basemapgalleryitem:tiling-scheme-unsupported-${e}-global`,"Basemap tiling scheme is unsupported in global mode",{error:t})}}else if(Y.checkUnsupported(i))throw new w.Z("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const l=t.get("basemapTerrain.tilingScheme");if(l&&!l.compatibleWith(i)&&("vector-tile"!==e?.type||!n||!l.compatibleWith(n)))throw new w.Z("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}(r,i)}}let de=class extends((0,m.p)(R.Z)){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.handles.add([(0,n.YP)((()=>this.basemap?.loadStatus),e),(0,n.YP)((()=>this.compatibilityFunction),e),(0,n.YP)((()=>this.view&&"basemapTerrain"in this.view&&this.view.basemapTerrain?.tilingScheme),e),(0,n.YP)((()=>this.view?.ready),e),(0,n.YP)((()=>this.view?.spatialReference),e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return(0,v.Us)(this.view,this.basemap)}set basemap(e){const t=this._get("basemap");t&&t.cancelLoad(),e&&e.load().catch((()=>{})),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){this._cancelRefresh(),this._set("state","loading");const e=this.basemap?.loadStatus;if("loaded"!==e&&"failed"!==e)return;if(!this.compatibilityFunction)return void("loaded"===e?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:s}=t;this.compatibilityFunction(this,{signal:s}).then((()=>(0,n.N1)((()=>!this._spatialReferenceTask.updating),s))).then((()=>{this._set("state","ready"),this._set("error",null)})).catch((e=>{(0,k.D_)(e)||(this._set("state","error"),this._set("error",e))})),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};(0,i._)([(0,c.Cb)({readOnly:!0})],de.prototype,"_spatialReferenceTask",null),(0,i._)([(0,c.Cb)()],de.prototype,"basemap",null),(0,i._)([(0,c.Cb)()],de.prototype,"compatibilityFunction",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],de.prototype,"error",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],de.prototype,"spatialReference",null),(0,i._)([(0,c.Cb)({readOnly:!0})],de.prototype,"state",void 0),(0,i._)([(0,c.Cb)()],de.prototype,"view",void 0),de=(0,i._)([(0,h.j)("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],de);const me=de;var ge=s(76243),fe=s(97862);const _e=d.Z.ofType(me);let be=class extends((0,m.p)(g.Z)){constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new _e,this.source=new fe.Z,this.view=null}initialize(){const e=()=>this._recreateItems();this.handles.add([(0,n.YP)((()=>"ready"===this.state?this.compatibilityFunction:null),(()=>this._updateItems())),(0,n.on)((()=>this.source?.basemaps),"change",e,{onListenerAdd:e})])}get activeBasemap(){return this.view?.map?.basemap??null}set activeBasemap(e){if(!this.view.map)return;const t="string"==typeof e?p.default.fromId(e):e;if(!t||!this.view.ready)return this.view.map.basemap=t,void this._clearOverride("activeBasemap");const s=t.spatialReference||this.items?.find((e=>this.basemapEquals(t,e.basemap)))?.spatialReference;if(s&&"spatialReferenceLocked"in this.view&&!this.view.spatialReferenceLocked){const i=this.view.spatialReference;if((0,f.pC)(s)&&!(0,y.fS)(i,s)&&!(0,b.Up)(this.view.spatialReference,s)&&!(0,b.kR)())return this._override("activeBasemap",t),this._loadingProjectionEngine=!0,void(0,b.zD)().then((()=>{this._get("activeBasemap")===e&&(this.view.map.basemap=e,this.view.spatialReference=s,this._clearOverride("activeBasemap"))}),(()=>{})).then((()=>{this._loadingProjectionEngine=!1}));this.view.map.basemap=t,this._clearOverride("activeBasemap"),(0,f.pC)(s)&&!(0,y.fS)(this.view.spatialReference,s)&&(this.view.spatialReference=s)}else this.view.map.basemap=t,this._clearOverride("activeBasemap")}get compatibilityFunction(){return"3d"===this.view?.type?ce:he}set compatibilityFunction(e){(0,f.pC)(e)?this._override("compatibilityFunction",e):this._clearOverride("compatibilityFunction")}castSource(e){return Array.isArray(e)||d.Z.isCollection(e)?new ge.Z({basemaps:e}):function(e){return e&&"esri.portal.Portal"===e.declaredClass}(e)?new fe.Z({portal:e}):function(e){return e&&!(e instanceof fe.Z)&&(!!e.portal||!!e.query)}(e)?new fe.Z(e):function(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}(e)?e:null}get state(){return this.view?.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return(0,v.Bj)(e,t)}refresh(){this._recreateItems()}load(e){return this.addResolvingPromise(g.Z.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_recreateItems(){const e=this.source?.basemaps,{view:t,compatibilityFunction:s}=this;this.items.removeAll().forEach((e=>e.destroy())),e&&this.items.addMany(e.map((e=>new me({basemap:e,compatibilityFunction:s,view:t}))))}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};(0,i._)([(0,c.Cb)()],be.prototype,"_loadingProjectionEngine",void 0),(0,i._)([(0,c.Cb)()],be.prototype,"activeBasemap",null),(0,i._)([(0,c.Cb)()],be.prototype,"compatibilityFunction",null),(0,i._)([(0,c.Cb)({readOnly:!0,type:_e})],be.prototype,"items",void 0),(0,i._)([(0,c.Cb)()],be.prototype,"source",void 0),(0,i._)([(0,_.p)("source")],be.prototype,"castSource",null),(0,i._)([(0,c.Cb)({readOnly:!0})],be.prototype,"state",null),(0,i._)([(0,c.Cb)()],be.prototype,"view",void 0),be=(0,i._)([(0,h.j)("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],be);const ye=be;var ve=s(96919),we=s(78088),ke=s(80532),Te=s(67005);s(80975);const Se="esri-basemap-gallery esri-widget esri-widget--panel-height-only",Ce="esri-basemap-gallery--source-loading",Re="esri-basemap-gallery__loader",Ee="esri-basemap-gallery__item",Me="esri-basemap-gallery__item-container",Oe="esri-basemap-gallery__item-title",Le="esri-basemap-gallery__item-thumbnail",xe="esri-basemap-gallery__item--selected",We="esri-basemap-gallery__item--error",Ae="esri-widget__content--empty",Ie="esri-icon-basemap",Ze="esri-disabled",Be="esri-widget__loader-animation";let Ne=class extends u.Z{constructor(e,t){super(e,t),this._handles=new r.Z,this.activeBasemap=null,this.disabled=!1,this.headingLevel=2,this.iconClass=Ie,this.label=void 0,this.messages=null,this.source=null,this.view=null,this.viewModel=new ye}initialize(){const e=this._handles;this.own([(0,n.on)((()=>this.viewModel.items),"change",(t=>{const s="basemap-gallery-item-changes",{added:i,moved:a}=t;e.remove(s),e.add([...i,...a].map((e=>(0,n.YP)((()=>e.state),(()=>this.scheduleRender())))),s),this.scheduleRender()})),e,(0,n.gx)((()=>this.source),(()=>this.viewModel.load()),{initial:!0,once:!0})])}destroy(){this._handles.destroy()}loadDependencies(){return s.e(6542).then(s.bind(s,86542))}render(){const e="loading"===this.get("source.state"),t=this.disabled||"disabled"===this.get("viewModel.state"),s=this.get("viewModel.items").toArray().map(this._renderBasemapGalleryItem,this),i={[Ce]:e,[Ze]:t},a=e?(0,Te.u)("div",{class:Re,key:"esri-basemap-gallery__loader"}):null,r=e?null:s.length>0?(0,Te.u)("ul",{class:Me,key:"esri-basemap-gallery__item-container",role:"menu"},s):(0,Te.u)("div",{class:Ae,key:"esri-basemap-gallery__empty-message"},(0,Te.u)(ve.X6,{level:this.headingLevel},this.messages.noBasemaps));return(0,Te.u)("div",{class:this.classes(Se,i)},a,r)}_handleClick(e){const t=e.currentTarget["data-item"];"ready"===t.state&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e){const t=e.get("basemap.thumbnailUrl")||(0,a.V)("esri/themes/base/images/basemap-toggle-64.svg"),s=e.get("basemap.title"),i=e.get("basemap.portalItem.snippet"),r=e.get("error.message")||i||s,{viewModel:n}=this,l=this.disabled||"disabled"===n.state||"ready"!==e.state?-1:0,o=n.basemapEquals(e.basemap,this.activeBasemap),c="loading"===n.state,h={[xe]:o,[We]:"error"===e.state};return(0,Te.u)("li",{"aria-selected":o.toString(),bind:this,class:this.classes(Ee,h),"data-item":e,onkeydown:this._handleClick,onclick:this._handleClick,role:"menuitem",tabIndex:l,title:r},(0,Te.u)("img",{alt:"",class:Le,src:t}),(0,Te.u)("div",{class:Oe},s),"loading"===e.state||o&&c?(0,Te.u)("calcite-scrim",null,(0,Te.u)("span",{"aria-hidden":"true",role:"presentation",class:Be})):null)}};(0,i._)([(0,l.B)("viewModel.activeBasemap")],Ne.prototype,"activeBasemap",void 0),(0,i._)([(0,c.Cb)()],Ne.prototype,"disabled",void 0),(0,i._)([(0,c.Cb)()],Ne.prototype,"headingLevel",void 0),(0,i._)([(0,c.Cb)()],Ne.prototype,"iconClass",void 0),(0,i._)([(0,c.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ne.prototype,"label",void 0),(0,i._)([(0,c.Cb)(),(0,ke.H)("esri/widgets/BasemapGallery/t9n/BasemapGallery")],Ne.prototype,"messages",void 0),(0,i._)([(0,l.B)("viewModel.source")],Ne.prototype,"source",void 0),(0,i._)([(0,l.B)("viewModel.view")],Ne.prototype,"view",void 0),(0,i._)([(0,c.Cb)()],Ne.prototype,"viewModel",void 0),(0,i._)([(0,we.h)()],Ne.prototype,"_handleClick",null),Ne=(0,i._)([(0,h.j)("esri.widgets.BasemapGallery")],Ne);const ze=Ne},76243:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(27366),a=s(29479),r=s(85015),n=s(40281),l=s(49861),o=(s(63780),s(93169),s(25243),s(69912));const c=n.Z.ofType(a.default);let h=class extends r.Z{constructor(e){super(e),this.basemaps=new c}get state(){return"ready"}refresh(){}};(0,i._)([(0,l.Cb)({type:c})],h.prototype,"basemaps",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],h.prototype,"state",null),h=(0,i._)([(0,o.j)("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],h);const u=h},97862:(e,t,s)=>{s.d(t,{Z:()=>w});var i=s(27366),a=s(29479),r=s(40281),n=s(10064),l=s(100),o=s(54472),c=s(32718),h=s(67426),u=s(66978),p=s(94172),d=s(49861),m=(s(63780),s(93169),s(25243),s(69912)),g=s(70032),f=s(76243);const _=r.Z.ofType(a.default),b="esri.widgets.BasemapGallery.support.PortalBasemapsSource",y=c.Z.getLogger(b);let v=class extends(o.Z.LoadableMixin((0,h.v)(f.Z))){constructor(e){super(e),this._handles=new l.Z,this.basemaps=new _,this.filterFunction=null,this.portal=g.Z.getDefault(),this.query=null,this.updateBasemapsCallback=null}initialize(){this._handles.add([(0,p.YP)((()=>[this.filterFunction,this.loadStatus,this.portal?.basemapGalleryGroupQuery,this.portal?.user,this.query,this.updateBasemapsCallback]),(()=>this.refresh()),p.nn)])}destroy(){this._handles.destroy(),this._handles=null,this.filterFunction=null,this.portal=null}get state(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),this.notifyChange("state"),Promise.resolve(this)}async refresh(){if("ready"!==this.state)return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{const s=await e.fetchBasemaps(this._toQueryString(this.query),t);this._updateBasemaps(s)}catch(s){if((0,u.D_)(s))throw s;y.warn(new n.Z("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:s})),this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(e){return e&&"string"!=typeof e?Object.keys(e).map((t=>`${t}:${e[t]}`)).join(" AND "):e}_updateBasemaps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.filterFunction?e.filter(this.filterFunction):e;t=this.updateBasemapsCallback?this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)}};(0,i._)([(0,d.Cb)({readOnly:!0,type:_})],v.prototype,"basemaps",void 0),(0,i._)([(0,d.Cb)()],v.prototype,"filterFunction",void 0),(0,i._)([(0,d.Cb)({type:g.Z})],v.prototype,"portal",void 0),(0,i._)([(0,d.Cb)()],v.prototype,"query",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],v.prototype,"state",null),(0,i._)([(0,d.Cb)()],v.prototype,"updateBasemapsCallback",void 0),v=(0,i._)([(0,m.j)(b)],v);const w=v}}]);
//# sourceMappingURL=6934.4ab48d84.chunk.js.map